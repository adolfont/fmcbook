%{{{ [vim] 
% vim:foldmarker=%{{{,%}}}
% vim:foldmethod=marker
% vim:foldcolumn=7
%}}}
%% fmcmain.tex
%% author: Thanos Tsouanas <thanos@tsouanas.org>
%% Copyright (c) 2016, 2017, 2018 Thanos Tsouanas
%% All rights reserved.

%%{{{ chapter: Introduction 
\chapter Introdução.

%%{{{ Afirmações vs.~objetos 
\section Afirmações vs.~objetos.

\endsection
%%}}}

%%{{{ Axioms, definitions, theorems, proofs 
\section Axiomas, definições, teoremas, provas.

\endsection
%%}}}

%%{{{ Bound and free variables 
\section Variáveis ligades e livres.
\label{Bound_and_free_variables}%

\endsection
%%}}}

%%{{{ Notation 
\section Notação.

\note.
\label{eqiff_decorators}%
$=$ vs $\defeq$ vs $\asseq$ vs $\eqass$.
$\iff$ vs $\defiff$ vs $\assiff$.

\endsection
%%}}}

%%{{{ Sorts of numbers 
\section Tipos de números.
% cyclic definitions
% from reals to nats
% from nats to reals
\endsection
%%}}}

%%{{{ Sets, functions, relations 
\section Conjuntos, funções, relações.

\TODO Aridade.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

Matemática elementar:
\cite{simmonsprecalculus} (para uma revisão rápida);
\cite{langbasicmath} (para um estudo mais profundo).

Sobre geometria euclideana:
\cite{elements},
\cite{coxeterrevisited};
\cite{hartshorneeuclidbeyond}.

Sobre calculus:
\cite{spivakcalculus},
\cite{hardypuremath};
\cite{apostol1}~\&~\cite{apostol2},
\cite{loomissternberg}.

Sobre álgebra linear:
\cite{janichlinalg},
\cite{halmoslapb},
\cite{halmosfdvs}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Rational and irrational numbers 
\chapter Números racionais e irracionais.

%%{{{ Rationals and the pythagoreans 
\section Os racionais e os pitagoreanos.

\endsection
%%}}}

%%{{{ sqrt(2) is not rational 
\section O $\sqrt 2$ não é racional.

\endsection
%%}}}

%%{{{ But sqrt(2) surely is a number 
\section Mas o $\sqrt 2$ com certeza é um número.

\endsection
%%}}}

%%{{{ Irrational numbers 
\section Números irracionais.

\endsection
%%}}}

%%{{{ sqrt(3) is irrational 
\section O $\sqrt 3$ é irracional.

\endsection
%%}}}

%%{{{ A lemma 
\section Um lemma.

\endsection
%%}}}

%%{{{ What happens with sqrt(4) and sqrt(5) 
\section O que acontece com $\sqrt 4$ e $\sqrt 5$.

\endsection
%%}}}

%%{{{ A generalization theorem 
\section Um teorema de generalização.

\endsection
%%}}}

%%{{{ More irrational numbers 
\section Mais números irracionais.

\endsection
%%}}}

%%{{{ Algebraic and transcendental numbers 
\section Números algébricos e transcendentais.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{nivenirrational}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Languages 
\chapter Linguagens.

%%{{{ Numbers, numerals, digits 
\section Números, numerais, dígitos.
% dígito aka "algarismo"

\note.
\tdefined{número}%
\tdefined{numeral}%
\tdefined{dígito}%
\iisee{algarismo}{dígito}%
Aceitamos por enquanto como dado o conceito dos números que usamos
para contar:
$$
0, 1, 2, 3, \dots, 247, 248, 249, \dots
$$
Usando então apenas um \emph{alfabeto} composto de 10 símbolos
$$
\digit 0\ 
\digit 1\ 
\digit 2\ 
\digit 3\ 
\digit 4\ 
\digit 5\ 
\digit 6\ 
\digit 7\ 
\digit 8\ 
\digit 9
$$
e seguindo as regras bem-conhecidas do sistema decimal conseguimos
denotar qualquer um dos números, mesmo que tem uma infinidade deles!

Chamamos esses símbolos \dterm{dígitos} (ou \dterm{algarismos}),
e as palavras (ou ``strings'') que formamos justapondo esses dígitos que
representam os números, \dterm{numerais}.
Sem contexto, lendo o ``10'' existe já uma ambigüidade:
é o numeral $\numeral {10}$ ou o número dez?
Para apreciar essa diferença ainda mais, note que o numeral $\numeral {10}$,
pode representar outro número em outro contexto.
Por exemplo, no sistema binário, o numeral $\numeral {10}$
representa o número dois.
E a ambigüidade pode ser ainda maior lendo ``1'':
é o numeral $\numeral {1}$; o número um; ou o dígito~$\digit 1$?
Quando o contexto é suficiente para entender, não precisamos mudar a fonte
como acabei de fazer aqui, nem escrever explicitamente o que é.
Note que existem numerais bem diferentes para denotar esses números:
o numeral (romano) {XII}
e o numeral (grego) {ιβ} denotam o mesmo número: doze.

\blah.
Temos então umas pequenas linguágens que nos permitem descrever \emph{números}.
Não fatos sobre números.
Não operações que involvem números.
Números.
Quais números?
Todos os números \emph{naturais}, cuja totalidade simbolizamos com $\nats$.

\endsection
%%}}}

%%{{{ Arithmetic expressions: syntax vs.~semantics 
\section Expressões aritméticas: sintaxe vs.~semântica.

%%{{{ A first example expression 
\note.
\tdefined{precedência}%
Considere agora a expressão
$$
1 + 5 \ntimes 2
$$
que involve os numerais $1$, $5$, e $2$,
e os símbolos de funções $+$ (adição) e $\ntimes$ (multiplicação).
O que ela representa?
A multiplicação de $1+5$ com $2$, ou a adição de $1$ com $5\ntimes 2$?
A segunda opção, graças a uma convenção que temos%
---e que você provavelmente já encontrou na vida.
Digamos que a $\ntimes$ ``pega mais forte'' do que a $+$,
então precisamos ``a~aplicar'' primeiro.
Mais formalmente, a $\ntimes$ tem uma \dterm{precedência} mais alta que a da $+$.
Quando não temos convenções como essa, usamos parenteses para tirar a ambigüidade
e deixar claro como parsear uma expressão.
Então temos
$$
(1 + 5) \ntimes 2 \neq 1 + 5 \ntimes 2 = 1 + (5 \ntimes 2).
$$
%%}}}

%%{{{ One more example; syntax-vs-semantics 
\note.
\tdefined{associatividade}[esquerda e direita]%
\tdefined{igualdade}[sintáctica]%
\tdefined{igualdade}[semântica]%
\sdefined {\holed A = \holed B}      {igualdade semântica}%
\sdefined {\holed A \syneq \holed B} {igualdade sintáctica}%
E a expressão
$$
1+5+2
$$
representa o quê?
Não seja tentado dizer ``tanto faz'', pois mesmo que as duas
possíveis interpretações
$$
(1+5) + 2
\qqqqtext{e}
1 + (5+2)
$$
\emph{denotam valores} iguais,
elas expressam algo diferente:
$$
\align
(1 + 5) + 2&: \quad\text{adicione o $1+5$ com o $2$};\\
1 + (5 + 2)&: \quad\text{adicione o $1$ com o $5+2$}.
\endalign
$$
Então\dots
$$
(1 + 5) + 2 \askeq 1 + (5 + 2)
$$
Como \emph{expressões} (a \emph{sintaxe}) são diferentes;
como \emph{valores} (a \emph{semântica}) são iguais,
pois denotam o mesmo objeto: o número oito.
Normalmente em matemática ligamos sobre as denotações das expressões,
e logo escrevemos igualdades como
$$
(1 + 5) + 2 = 6 + 2 = 8 = 1 + 7 = 1 + (5 + 2).
$$
Ou seja, o símbolo `$=$' em geral denota \dterm{igualdade semântica}:
$A=B$ significa que os dois lados, $A$ e $B$, denotam o mesmo objeto.
Querendo representar \dterm{igualdade sintáctica}, as vezes usamos
outros símbolos.  Vamos usar o `$\syneq$' agora, de modo que:
$$
\align
1 + 2 = 3
&\qqqtext{mas}
1 + 2 \synneq 3;\\
(1 + 5) + 2 = 1 + (5 + 2)
&\qqqtext{mas}
(1 + 5) + 2 \synneq 1 + (5 + 2);
\quad\text{etc.}
\endalign
$$

Voltando à expressão $1 + 5 + 2$, precisamos mais uma convenção
para atribuir uma associatividade esquerda ou direita.
Vamos concordar que $a + b + c$ representa a expressão
$((a + b) + c)$, ou seja, atribuimos em $+$ uma
\emph{associatividade esquerda}.

Mas $+$ não é uma operação associativa?
Sim, e isso quis dizer que como valores,
$$
((a + b) + c) = (a + (b + c)).
$$
Mas como expressões, são diferentes, e logo sem essa convenção,
$a + b + c$ não representaria nenhuma expressão de aritmética!

\exercise.
Sejam $a,b,c$ números naturais.
Usando $=$ para igualdade semântica e $\syneq$ para igualdade
sintáctica, decida para cada uma das afirmações seguintes
se é verdadeira ou falsa:
\doublecolumns
\beginol
\li $a + b + c                \syneq  a + (b + c)$
\li $a + b + c                \syneq  (a + b) + c$
\li $a + b + c                =       a + (b + c)$
\li $a + b + c                =       (a + b) + c$
\li $2 \ntimes 0 + 3          =       0 + 3$
\li $2 \ntimes 0 + 3          \syneq  0 + 3$
\li $(2 \ntimes 0) + 3 + 0    =       1 + 1 + 1$
\li $2 \ntimes 0 + 3          \syneq  1 + 1 + 1$
\li $2 \ntimes 0 + 3          \syneq  2 \ntimes (0 + 3)$
\li $2 \ntimes 0 + 3          =       2 \ntimes (0 + 3)$
\li $2 \ntimes 0 + 3          \syneq  (2 \ntimes 0) + 3$
\li $1 + 2                    \syneq  2 + 1$
\endol
\singlecolumn

\solution
Temos:
\doublecolumns
\beginol
\li $a + b + c                \synneq a + (b + c)$
\li $a + b + c                \syneq  (a + b) + c$
\li $a + b + c                =       a + (b + c)$
\li $a + b + c                =       (a + b) + c$
\li $2 \ntimes 0 + 3          =       0 + 3$
\li $2 \ntimes 0 + 3          \synneq 0 + 3$
\li $(2 \ntimes 0) + 3 + 0    =       1 + 1 + 1$
\li $2 \ntimes 0 + 3          \synneq 1 + 1 + 1$
\li $2 \ntimes 0 + 3          \synneq 2 \ntimes (0 + 3)$
\li $2 \ntimes 0 + 3          \neq    2 \ntimes (0 + 3)$
\li $2 \ntimes 0 + 3          \syneq  (2 \ntimes 0) + 3$
\li $1 + 2                    \synneq 2 + 1$
\endol
\singlecolumn

\endexercise

\exercise.
Verdade ou falso?:
$$
A \syneq B \implies A = B
$$

\endexercise

%%}}}

\endsection
%%}}}

%%{{{ Derivation trees 
\section Arvores de derivação.

\note Parsing.
\tdefined{parsing}%
\tdefined{árvore}[sintáctica]%
\tdefined{árvore}[de derivação]%
Lendo uma expressão ``linear'' como a
``$1 + 5 \ntimes 2$''
nos a \dterm{parseamos} para revelar sua estrutura,
freqüentemente representada numa forma bidimensional, como uma
\dterm{árvore sintáctica}.
Temos então as árvores:
$$
1 + (5 \ntimes 2)
\quad\leadsto\quad
\gathered
\tikzpicture[scale=0.8]
\node [circle,draw] (z) {$+$}
  child {node [circle,draw] (a) {$1$}}
  child {node [circle,draw] (b) {$\vphantom+\ntimes$}
    child {node [circle,draw] (b1) {$5$}}
    child {node [circle,draw] (b2) {$2$}}
  };
\endtikzpicture
\endgathered
\qqqquad
(1 + 5) \ntimes 2
\quad\leadsto\quad
\gathered
\tikzpicture[scale=0.8]
\node [circle,draw] (z) {$\vphantom+\ntimes$}
  child {node [circle,draw] (a) {$+$}
    child {node [circle,draw] (a1) {$1$}}
    child {node [circle,draw] (a2) {$5$}}
  }
  child {node [circle,draw] (b) {$2$}};
\endtikzpicture
\endgathered
$$
Não vamos usar mais esse tipo de árvore sintáctica nessas notas.

\note Arvores de derivação.
\tdefined{árvore de derivação}%
Em vez, vamos ficar usando \dterm{árvores de derivação} como essas:
$$
\def\fCenter{}
\xalignat2
&\centerAlignProof
\AxiomC{1}
\AxiomC{5}
\AxiomC{2}
\RightLabel{$\ntimes$}
\BinaryInf$\fCenter (5 \ntimes 2)$
\RightLabel{$+$}
\BinaryInf$\fCenter 1 + (5 \ntimes 2)$
\DisplayProof{}
&
&\centerAlignProof
\AxiomC{1}
\AxiomC{5}
\RightLabel{$+$}
\BinaryInf$\fCenter (1 + 5)$
\AxiomC{2}
\RightLabel{$\ntimes$}
\BinaryInf$\fCenter (1 + 5) \ntimes 2$
\DisplayProof{}
\endxalignat
$$

Sendo esse nosso primeiro contato com árvores sintácticas, vamos explicar
em detalhe como as escrevemos.  Começamos então com a expressão (linear)
que queremos parsear:
$$
(1 + 5) \ntimes 2.
$$
Graças à sua parêntese, o ``operador principal'' (o mais ``externo'')
é o $\ntimes$.  Isso quis dizer que, no final das contas, essa expressão
representa uma multiplicação de duas coisas.
Exatamente por isso, reduzimos essa expressão em duas novas, escrevendo
uma linha em cima dela, onde temos agora dois lugares para botar essas
duas coisas.  No lado da linha, escrevemos sua ``justificativa''
$$
\def\fCenter{}
\centerAlignProof
\AxiomC{$\hole$}
\AxiomC{$\hole$}
\RightLabel{$\holed \ntimes$}
\BinaryInf$\fCenter (1 + 5) \ntimes 2$
\DisplayProof{}
$$
e nos dois buracos que aparecem botamos as expressões que estão
nos lados desse $\ntimes$:
$$
\def\fCenter{}
\centerAlignProof
\AxiomC{$\holed {(1 + 5)}$}
\AxiomC{$\holed {\vphantom(2}$}
\RightLabel{$\ntimes$}
\BinaryInf$\fCenter (1 + 5) \ntimes 2$
\DisplayProof{}
$$
Agora $2$ já é uma expressão \dterm{atómica} (ou seja, inquebrável),
mas a $(1 + 5)$ não é então repetimos o mesmo processo nela:
$$
\def\fCenter{}
\centerAlignProof
\AxiomC{$\holed 1$}
\AxiomC{$\holed 5$}
\RightLabel{$\holed +$}
\BinaryInf$\fCenter (1 + 5)$
\AxiomC{${\vphantom(2}$}
\RightLabel{$\ntimes$}
\BinaryInf$\fCenter (1 + 5) \ntimes 2$
\DisplayProof{}
$$
Chegamos finalmente na árvore
$$
\def\fCenter{}
\centerAlignProof
\AxiomC{$1$}
\AxiomC{$5$}
\RightLabel{$+$}
\BinaryInf$\fCenter (1 + 5)$
\AxiomC{${\vphantom(2}$}
\RightLabel{$\ntimes$}
\BinaryInf$\fCenter (1 + 5) \ntimes 2$
\DisplayProof{}
$$
que mostra como a expressão aritmética $(1 + 5) \ntimes 2$ na sua \dterm{raiz}
(ou \dterm{root}) é composta por os numeráis $1$, $5$, e $2$
(que são as \dterm{folhas} (ou \dterm{leaves}) dessa árvore.

\endsection
%%}}}

%%{{{ Grammars and BNF notation 
\section Gramáticas e a notação BNF.
\label{BNF_notation}%
\tdefined{BNF}%
\tdefined{gramática}%
\iisee{Backus--Naur form}{BNF}%

%%{{{ A first try 
\note Uma primeira tentativa.
\label{BNF_a_first_try}%
Vamos começar diretamente com um exemplo de uso da
notação~\dterm{BNF}
(Backus\Backus{}--Naur\Naur{} form),
para descrever uma linguagem de expressões aritméticas, usando
a \dterm{gramática} seguinte:
%%}}}

%%{{{ g: ArExp_grammar_1 
\grammar ArExp (1).
\label{ArExp_grammar_1}%
$$
\align
\bnf{ArExp} &\bnfeq 0 \bnfor 1 \bnfor 2 \bnfor 3 \bnfor \dotsb \tag{1}\\
\bnf{ArExp} &\bnfeq (\bnf{ArExp} + \bnf{ArExp})                \tag{2}
\endalign
$$
%%}}}

%%{{{ Explanation 
\blah.
O que tudo isso significa?
A primeira linha, é uma regra dizendo:
uma expressão aritmética pode ser um dos
$0$, $1$, $2$, $3$, \dots.
A segunda linha é mais interessante: uma expressão aritmética pode começar
com o símbolo `(',
depois ter uma expressão aritmética,
depois o símbolo `+',
depois mais uma expressão aritmética,
e finalmente o símbolo `)'.
A idéia é que o que aparece com ângulos é algo que precisa ser substituido,
com uma das opções que aparecem no lado direito de alguma regra que começa com ele.

Começando com o $\bnf{ArExp}$ ficamos substituindo até não aparece mais nada em ângulos.
Et voilà: neste momento temos criado uma expressão aritmética.
%%}}}

%%{{{ eg: BNF_first_example 
\example.
Use as regras (1)--(2) da~\ref{ArExp_grammar_1} acima para criar uma expressão
aritmética.
Comece usando a regra (2).
$$
\align
\bnf{ArExp}
&\leadstoby {(2)} (\bnf{ArExp} + \bnf{ArExp})\\
&\leadstoby {(1)} (\bnf{ArExp} + 3)\\
&\leadstoby {(2)} ((\bnf{ArExp} + \bnf{ArExp}) + 3)\\
&\leadstoby {(1)} ((128 + \bnf{ArExp}) + 3)\\
&\leadstoby {(1)} ((128 + 0) + 3)
\endalign
$$
\endexample
%%}}}

%%{{{ eg: BNF_direct_example 
\example.
Use a mesma gramática (agora sem restrição) para criar uma expressão aritmética.
$$
\align
\bnf{ArExp}
&\leadstoby {(1)} 17
\endalign
$$
\endexample
%%}}}

%%{{{ x: BNF_with_goal 
\exercise.
Mostre como usar a~\ref{ArExp_grammar_1} para gerar a expressão aritmética
$((1 + (2 + 2)) + 3)$.

\solution
Uma solução é a seguinte:
$$
\align
\bnf{ArExp}
&\leadstoby {(2)} (\bnf{ArExp} + \bnf{ArExp})\\
&\leadstoby {(1)} (\bnf{ArExp} + 3)\\
&\leadstoby {(2)} ((\bnf{ArExp} + \bnf{ArExp}) + 3)\\
&\leadstoby {(2)} ((\bnf{ArExp} + (\bnf{ArExp} + \bnf{ArExp})) + 3)\\
&\leadstoby {(1)} ((1 + (\bnf{ArExp} + \bnf{ArExp})) + 3)\\
&\leadstoby {(1)} ((1 + (2 + \bnf{ArExp})) + 3)\\
&\leadstoby {(1)} ((1 + (2 + 2)) + 3)
\endalign
$$

\endexercise
%%}}}

% doesn't have to be the same expression for the same <name> 

%%{{{ Q: problems_of_first_BNF
\question.
Quais são uns defeitos dessa primeira tentativa?
O que podemos fazer para a melhorar?
\spoiler.
%%}}}

%%{{{ A: problems_of_first_BNF_answer 
\blah Resposta.
Umas deficiências são:

\beginol
\li A linguagem gerada por essa gramática não é suficiente para representar expressões que involvem outras operações, como $-$, $\ntimes$, $\div$, etc.
\li A regra (1) tem uma infinitade de casos (graças aos `$\dotsb$').
\li As regras e os nomes escolhidos não refletam bem nossa idéia.
\endol
%%}}}

%%{{{ x: solve_first_problem_of_ArExp 
\exercise.
\label{solve_first_problem_of_ArExp}%
Apenas alterando a segunda regra da~\ref{ArExp_grammar_1}, resolva a primeira deficiência.

\hint
Falta só adicionar 3 mais casos na segunda regra, imitando para os outros operadores o caso do $+$.

\solution
Temos:
$$
\align
\bnf{ArExp} &\bnfeq 0 \bnfor 1 \bnfor 2 \bnfor 3 \bnfor \dotsb \tag{1}\\
\bnf{ArExp}
&\bnfeq (\bnf{ArExp} + \bnf{ArExp})\tag{2}\\
&\bnfOR (\bnf{ArExp} - \bnf{ArExp})\\
&\bnfOR (\bnf{ArExp} \ntimes \bnf{ArExp})\\
&\bnfOR (\bnf{ArExp} \div \bnf{ArExp})
\endalign
$$

\endexercise
%%}}}

%%{{{ A second try 
\note Uma segunda tentativa.
A solução que encontramos no~\ref{solve_first_problem_of_ArExp}
não é a coisa mais elegante do mundo.
Tem muita repetição que podemos evitar, definindo uma nova regra em nossa gramática:
%%}}}

%%{{{ g: ArExp_grammar_2 
\grammar ArExp (2).
\label{ArExp_grammar_2}%
$$
\align
\bnf{ArExp} &\bnfeq 0 \bnfor 1 \bnfor 2 \bnfor 3 \bnfor \dotsb \tag{1}\\
\bnf{ArExp} &\bnfeq (\bnf{ArExp} \bnf{BinOp} \bnf{ArExp})\tag{2}\\
\bnf{BinOp} &\bnfeq + \bnfor - \bnfor \ntimes \bnfor \div\tag{3}
\endalign
$$
%%}}}

\blah.
Ainda a gramática não refleta bem nossa idéia.
Podemos a melhorar, com mais regras e com nomes melhores
que deixam mais claras nossas intenções:

%%{{{ g: ArExp_grammar_3 
\grammar ArExp (3).
\label{ArExp_grammar_3}%
$$
\align
\bnf{ArExp} &\bnfeq \bnf{Num} \bnfor \bnf{OpExp} \tag{0}\\
\bnf{Num}   &\bnfeq 0 \bnfor 1 \bnfor 2 \bnfor 3 \bnfor \dotsb \tag{1}\\
\bnf{OpExp} &\bnfeq (\bnf{ArExp} \bnf{BinOp} \bnf{ArExp})\tag{2}\\
\bnf{BinOp} &\bnfeq + \bnfor - \bnfor \ntimes \bnfor \div\tag{3}
\endalign
$$
%%}}}

\blah.
Falta achar um jeito para remover esses ``$\dotsb$'' ainda,
mas vamos deixar isso para depois (\ref{remove_dots_from_ArExp_grammar}).

%%{{{ Nat_grammar 
\grammar Nat.
\label{Nat_grammar}%
$$
\align
\bnf{Nat} &\bnfeq 0 \bnfor S \bnf{Nat}
\endalign
$$
%%}}}

%%{{{ x: generate_some_nats_from_grammar 
\exercise.
\label{generate_some_nats_from_grammar}%
Quais são umas das palavras que podes gerar com a~\ref{Nat_grammar}?
Pode usar sua linguagem como numerais para os naturais?

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Metalanguages 
\section Metalinguagens.

\note.
\tdefined{metalinguagem}%
\tdefined{linguagem-objeto}%
Já encontramos o conceito de linguagem como um objeto de estudo.
Logo vamos estudar bem mais linguagens, de lógica matemática,
estudar linguágens de programação, etc.
É preciso entender que enquanto estudando uma linguagem,
esse próprio estudo acontece também usando uma (outra) linguagem.
Aqui usamos por exemplo português, provando propriedades, dando definições,
afirmando relações, etc., de outras linguagens que estudamos,
como da aritmética, de lógica matemática, de linguagens de programação, etc.
Para enfatisar essa diferença e para tirar certas ambigüidades,
chamamos \dterm{linguagem-objeto} a linguagem que estudamos,
e \dterm{metalinguagem} a linguagem que usamos para falar
sobre a linguagem-objeto.

\note.
\tdefined{metavariável}%
Imagine que você trabalha como programador e teu chefe lhe pediu
fazer uma mudança no código de um programa escrito na linguagem de
programação C.
Ele disse:
<<Cada variável $\alpha$ de tipo $\tau$ que aparece no código fonte tem que ser renomeada
para $\alpha\code{\_of\_}\tau$.>>
<<Por exemplo,>> ele continuou abrindo o programa no seu editor,
<<essa variável aqui $\code{i}$ que é de tipo $\code{int}$,
precisa ser renomeada para $\code{i\_of\_int}$;
e essa $\code{count}$ também para $\code{count\_of\_int}$;
e essa $\code{mean}$ de $\code{float}$, para $\code{mean\_of\_float}$,
etc.>>
\endgraf
Nesse pedido---obviamente sem noção, algo muito comum em pedidos de chefes
de programadores---aparecem duas ``espécies'' de variáveis diferentes:
as $\alpha$ e $\tau$ são variáveis de uma espécie;
as $\code{i}$, $\code{i\_of\_int}$,
$\code{count}$, $\code{count\_of\_int}$,
$\code{mean}$, e $\code{mean\_of\_float}$
de outra.
Chamamos a $\alpha$ e $\tau$ \dterm{metavariável},
pois elas pertencem na metalinguagem,
e não na linguagem-objeto,
que nesse exemplo é a linguagem de programação C.

\endsection
%%}}}

%%{{{ Abbreviations and syntactic sugar 
\section Abreviações e açúcar sintáctico.

%%{{{ x: ArExp_outer_parentheses_missing 
\exercise.
\label{ArExp_outer_parentheses_missing}%
Tente gerar a expressão
$$
(1 + 5) \ntimes 2
$$
usando a~\ref{ArExp_grammar_2}.

\solution
Não tem como!

\endexercise
%%}}}

%%{{{ Abbreviations 
\note Abreviações.
\tdefined{abreviação}%
Seguindo nossa~\ref{ArExp_grammar_2}, cada vez que escrevemos um operador binário
começamos e terminamos com `$($' e `$)$' respectivamente.
Logo, ``$1 + 2$'' nem é uma expressão gerada por essa gramática!
Mas como é tedioso botar as parenteses mais externas, temos a convenção
de as omitir.
Logo, consideramos a ``$1 + 2$'' como uma \dterm{abreviação} da expressão aritmética ``$(1 + 2)$''.
Então qual é o primeiro caráter da $1 + 2$?  É sim o `$($',
pois consideramos o $1+2$ apenas como um nome que usamos na
metalinguagem para denotar a expressão aritmética $(1+2)$,
que pertence na linguagem-objeto.
%%}}}

%%{{{ beware: abbr_not_always_shorter 
\beware.
\label{abbr_not_always_shorter}%
Não se iluda com a palavra ``abreviação'' que usamos aqui:
uma expressão pode ser mais curta do que uma das suas abreviações!
Nosso motivo não é preguiça de escrever expressões mais longas,
mas sim ajudar nossos olhos humanos a parsear.
%%}}}

%%{{{ Syntactic sugar 
\note Açúcar sintáctico.
\tdefined{açúcar sintáctico}%
Querendo enriquecer uma linguagem com um novo conceito, uma nova operação,
etc., parece que precisamos aumentar sua sintaxe para adicionar certos
símbolos e formas para corresponder nessas novas idéias.
Mas isso não é sempre necessário.
Por exemplo, suponha que trabalhamos com a linguagem da~\ref{ArExp_grammar_3},
e queremos a usar com sua interpretação canônica, onde suas expressões aritméticas
geradas denotam realmente as operações que conhecemos desde pequenos.
Agora, queremos adicionar uma operação unária $S$, escrita na forma prefixa,
onde a idéia é que $Sn$ denota o sucessor de $n$ (o próximo inteiro).
Nesse caso, em vez de realmente alterar a sintaxe da nossa linguagem,
definimos como \dterm{açúcar sintáctico} o uso de $S$ tal que, para qualquer
expressão aritmética $\alpha$, o $S\alpha$ denota a expressão $(\alpha + 1)$.
Por exemplo, $S4$ é apenas uma abreviação para o $(4 + 1)$,
e $SS4$ só pode denotar o $((4 + 1) + 1)$.%
\footnote{Percebeu que esse $\alpha$ aqui é uma metavariável?}
Açúcar sintáctico é muito usado em linguagens de programação,
para adular os programadores (que ganham assim um mecanismo
``doce'' para usar nos seus programas) sem mexer e complicar
a linguagem de verdade.
%%}}}

%%{{{ x: for_while_sugar 
\exercise.
\label{for_while_sugar}%
Mostre como um $\code{while}$ loop pode ser implementado como
açúcar sintáctico numa linguagem que tem $\code{for}$ loops,
e vice versa.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ decimal_numerals_BNF_problem
\problem.
\label{decimal_numerals_BNF_problem}%
Usando BNF, defina uma gramática para a linguagem de todos os
numerais que representam os naturais no sistema decimal.
Embuta-la na gramática das expressões aritméticas
para eliminar os ``$\dotsb$''.

\endproblem
%%}}}

%%{{{ remove_dots_from_ArExp_grammar 
\problem.
\label{remove_dots_from_ArExp_grammar}%
Com base a~\ref{ArExp_grammar_3} defina uma gramática que gera a mesma linguagem,
sem usar ``$\dotsb$''.

\hint
Já resolveu o~\ref{decimal_numerals_BNF_problem}?

\endproblem
%%}}}

%%{{{ ArExp_fact_grammar 
\problem.
\label{ArExp_with_factorial}%
Aumenta tua gramática do~\ref{remove_dots_from_ArExp_grammar} para
gerar expressões aritméticas que usam o operador unitário (e postfixo)
do factorial, que denotamos com $!$, escrevendo por exemplo
$8!$ para o factorial de $8$.
Note que não usamos parenteses para aplicar o factorial:
$$
((2 + 3!)! \ntimes 0!!)
$$

\endproblem
%%}}}

%%{{{ ArExp_fact_vars_grammar 
\problem.
\label{ArExp_fact_vars_grammar}%
Aumenta tua gramática do~\ref{ArExp_with_factorial} para
gerar expressões aritméticas que usam as variáveis
$$
x,y,z,
x',y',z',
x'',y'',z'',
x''',y''',z''',
\dotsc
$$

\endproblem
%%}}}

%%{{{ g: NatList_grammar 
\grammar.
\label{NatList_grammar}%
$$
\align
\bnf{L} &\bnfeq [\,] \bnfor (\bnf{Nat} :: \bnf{L})\\
\intertext{onde $\bnf{Nat}$ é o}
\bnf{Nat} &\bnfeq 0 \bnfor S\bnf{Nat}
\endalign
$$
da~\ref{Nat_grammar}.
%%}}}

%%{{{ NatList_grammar_problem 
\problem.
\label{NatList_grammar_problem}%
Escreva umas expressões geradas por a~\ref{NatList_grammar} e ache um possível
uso dessa gramática: o que podemos representar com essa linguagem?

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite[Cap.~4]{alicebook}.
\cite[Cap.~2]{curryfoundations}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: The language of propositional logic 
\chapter A linguagem de lógica proposicional.

%%{{{ Propositions 
\section Proposições.

\note.
Considere as seguinte proposições:
\beginol
\li Se $x < y$ e $y < z$ então $z < x$.
\li O $\sqrt 2$ é irracional.
\li O $3$ é um múltiplo de $10$.
\li O $5$ é um divisor dos $25$ e $26$.
\li O $n$ é menor de $8$ ou maior de $4$.
\endol

\endsection
%%}}}

%%{{{ Its syntax 
\section Sua sintaxe.

\note Dados.
Um conjunto de símbolos
$$
\zolvars = \set{ P_0, P_1, P_2, \dotsc }
$$
chamados \dterm{variáveis proposicionais}.

%%{{{ df: propositional_formula 
\definition Fórmula.
\label{propositional_formula}%
\tdefined{fórmula}[proposicional]
\beginul
\li Se $P$ é uma variável proposicional, então $P$ é uma fórmula.
\li Se $A$ é uma fórmula, então $\lnot A$ é uma fórmula.
\li Se $A,B$ são fórmulas, então:
\item{-} $(A \limplies B)$ é uma fórmula;
\item{-} $(A \lor B)$ é uma fórmula;
\item{-} $(A \land B)$ é uma fórmula.
\endul
Nada mais é uma fórmula.
Uma fórmula que consiste em apenas uma variável proposicional é chamada
\dterm{fórmula atómica}.
%%}}}

%%{{{ g: zolang_grammar 
\grammar.
\label{zolang_grammar}%
Escrevemos
$$
\align
F &\bnfeq A \bnfor \lnot F \bnfor (F \limplies F) \bnfor (F \land F) \bnfor (F \lor F)\\
\intertext{onde $A$ denota as fórmulas atómicas da $\zolang$, ou seja as variáveis proposicionais:}
A &\bnfeq P_0 \bnfor P_1 \bnfor P_2 \bnfor \dotsb
\endalign
$$
%%}}}

\endsection
%%}}}

%%{{{ Its semantics 
\section Sua semântica.

\endsection
%%}}}

%%{{{ Syntactic sugar 
\section Açúcar sintáctico.

%%{{{ Notation: limplied_liff_abbr 
\note Notação.
\label{limplied_liff_abbr}%
Se $A,B$ são fórmulas, usamos as seguintes abreviações:
$$
\align
(A \liff B)     &\abbreq ((A \limplies B) \land (B \limplies A))\\
(A \limplied B) &\abbreq (B \limplies A)
\endalign
$$
%%}}}

%%{{{ x: second_character_of_limplied_abbr 
\exercise.
\label{second_character_of_limplied_abbr}%
Qual é o segundo caráter da fórmula $(A \limplied B)$?

\hint
Lembre-se que aqui $A,B$ são apenas \emph{metavariáveis}
que denotam algumas fórmulas, sobre quais não sabemos nada mais
fora do fato que são fórmulas (bem formadas).

\solution
O primeiro caráter da fórmula $B$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Its limitations 
\section Suas limitações.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite[Cap.~1]{velleman}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: The language of predicate logic 
\chapter A linguagem de lógica de predicados.

%%{{{ Its syntax 
\section Sua sintaxe.

%%{{{ givens_for_a_FOL 
\note Dados.
Um conjunto infinito de símbolos de variáveis
$$
\folvars  = \set{x_0, x_1, x_2, x_3, \dotsc}.
$$
Conjuntos de símbolos de constantes, de funções, e de predicados:
$$
\folcons, \folfuns, \folpreds.
$$
Uma função $\folarity : \folfuns \union \folpreds \to \nats$ de aridade,
que atribua para cada símbolo nesses conjuntos sua aridade.
\endgraf
Alternativamente, podemos grupear os símbolos de funções por aridade, e similarmente o símbolos de predicados, escrevendo assim
$\folfuns_n$, para o conjunto de símbolos de funções de aridade $n$, e similarmente $\folpreds_n$ para os símbolos de predicados.
Assim as duas afirmações são equivalentes:
$$
f \in \folfuns \mland \folarity(f) = n
\iff
f \in \folfuns_n.
$$
Note também que podemos considerar funções de aridade $0$ como constantes,
e assim nem precisamos um conjunto especial para esses símbolos.
%%}}}

%%{{{ eg: full_FOL_example 
\example.
Tomando
$$
\align
\folcons  &= \set{c_0, c_1, c_2, c_3, \dotsc}\\
\folfuns  &= \set{f_0, f_1, f_2, f_3, \dotsc}\\
\folpreds &= \set{P_0, P_1, P_2, P_3, \dotsc}
\endalign
$$
e especificando uma função de aridade $\folarity$ criamos uma FOL.
Alternativamente tomamos
$$
\xalignat2
\folcons =
\folfuns_0   &= \set{f^0_0, f^0_1, f^0_2, f^0_3, \dotsc} & \folpreds_0  &= \set{P^0_0, P^0_1, P^0_2, P^0_3, \dotsc}\\
\folfuns_1   &= \set{f^1_0, f^1_1, f^1_2, f^1_3, \dotsc} & \folpreds_1  &= \set{P^1_0, P^1_1, P^1_2, P^1_3, \dotsc}\\
\folfuns_2   &= \set{f^2_0, f^2_1, f^2_2, f^2_3, \dotsc} & \folpreds_2  &= \set{P^2_0, P^2_1, P^2_2, P^2_3, \dotsc}\\
             &\eqvdots                                   &              &\eqvdots                                    
\endxalignat
$$
onde temos denotado a aridade de cada símbolo como um ``exponente''.
\endexample
%%}}}

%%{{{ df: FOL_term 
\definition Termo.
\label{FOL_term}%
\tdefined{FOL}[termo]%
\beginul
\li Se $x \in \folvars$ então $x$ é um termo.
\li Se $c \in \folcons$ então $c$ é um termo.
\li Se $f \in \folfuns_n$ e $t_1,\dotsc,t_n$ são termos, então $f(t_1,\dotsc,t_n)$ é um termo.
\endul
\noindent Nada mais é um termo.
Denotamos o conjunto de termos com $\folterms$.
Resumindo esquematicamente a definição, temos:
$$
\align
x \in \folvars &\implies x \in \folterms\\
c \in \folcons &\implies c \in \folterms\\
\left.
\aligned
f &\in \folfuns_n\\
t_1,\dotsc,t_n &\in \folterms
\endaligned
\right\}
&\implies f(t_1,\dotsc,t_n) \in \folterms\\
\endalign
$$
%%}}}

%%{{{ df: FOL_atomic_formula 
\definition Fórmula atômica.
\label{FOL_atomic_formula}%
\tdefined{FOL}[fórmula atômica]%
\beginul
\li Se $P \in \folpreds_n$ e $t_1,\dotsc,t_n$ são termos, então $P(t_1,\dotsc,t_n)$ é uma \dterm{fórmula atómica}.
\endul
%%}}}

%%{{{ df: FOL_formula 
\definition Fórmula.
\label{FOL_formula}%
\tdefined{FOL}[fôrmula]%
\beginul
\li Se $A$ é uma fórmula atómica, então $A$ é uma fórmula.
\li Se $A$ é uma fórmula, então $\lnot A$ é uma fórmula.
\li Se $A,B$ são fórmulas, então:
\item{-} $(A \limplies B)$ é uma fórmula;
\item{-} $(A \lor B)$ é uma fórmula;
\item{-} $(A \land B)$ é uma fórmula.
\li Se $A$ é uma fórmula e $x$ é uma variável, então:
\item{-} $\forall x A$ é uma fórmula;
\item{-} $\exists x A$ é uma fórmula.
\endul
%%}}}

%%{{{ Practical abuse of BNF for FOL 
\grammar FOL.
\label{FOL_grammar}%
Seguindo uma práctica comum, escrevemos apenas
$$
\align
F &\bnfeq
\mathit{A}
\bnfor (\lnot F)
\bnfor (F \limplies F)
\bnfor (F \land F)
\bnfor (F \lor F)
\bnfor \forall v F
\bnfor \exists v F
\endalign
$$
onde $A$ denota fórmulas atômicas e $v$ denota qualquer variável da nossa FOL.
%%}}}

%%{{{ x: BNF_for_FOL 
\exercise.
\label{BNF_for_FOL}%
Supondo que $\bnf{At}$ pode ser substituito por qualquer fórmula atômica duma FOL (e por nada mais),
defina umas gramáticas em BNF para gerar a linguagem das suas fórmulas bem formadas.

\solution
Aqui uma solução:
$$
\align
\bnf{F}     &\bnfeq \bnf{At} \bnfor (\lnot \bnf{F}) \bnfor (\bnf{F} \bnf{Bin} \bnf{F}) \bnfor \bnf{Q}\bnf{Var}\bnf{F}\\
\bnf{Bin}   &\bnfeq \lor \bnfor \land \bnfor \limplies\\
\bnf{Q}     &\bnfeq \forall \bnfor \exists\\
\bnf{Var}   &\bnfeq x_0 \bnfor x_1 \bnfor x_2 \bnfor \dotsb\\
\intertext{Como já encontramos, um fácil jeito para evitar os ``$\dotsb$'' seria usar:}
\bnf{Var}   &\bnfeq x \bnfor \bnf{Var}'
\endalign
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Its semantics 
\section Sua semântica.

\endsection
%%}}}

%%{{{ Universes and structures 
\section Universos e mundos.

\endsection
%%}}}

%%{{{ Translations to and from FOL 
\section Traduzindo de e para FOL.
\label{FOL_translations}%

\endsection
%%}}}

%%{{{ Syntactic sugar 
\section Açúcar sintáctico.

%%{{{ x: exists_x_in_A_Px_sugar 
\exercise.
Ache uma fórmula de FOL equivalente da $\lexists {x \in A} {P(x)}$.

\solution
$$
\lexists {x \in A} {P(x)}
\iff
\lexists x \paren{ x\in A \land P(x) }
$$

\endexercise
%%}}}

%%{{{ x: forall_x_in_A_Px_sugar 
\exercise.
Ache uma fórmula de FOL equivalente da $\lforall {x \in A} {P(x)}$.

\solution
$$
\lforall {x \in A} {P(x)}
\iff
\forall x \paren{ x\in A \limplies P(x) }
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Its limitations 
\section Suas limitações.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite[Cap.~2]{velleman}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Proof strategies 
\chapter Estratégias de provas.

%%{{{ Proofs as games 
\section Provas como jogos.

\endsection
%%}}}

%%{{{ Attacking the logical structure of a proposition 
\section Atacando a estrutura logical duma proposição.

\endsection
%%}}}

%%{{{ Reductio ad absurdum 
\section Reductio ad absurdum.

\endsection
%%}}}

%%{{{ Proofs by cases 
\section Provas por casos.

\endsection
%%}}}

%%{{{ Existence and uniqueness proofs 
\section Provas de existência e unicidade.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite[Cap.~3]{velleman}

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Recursion 
\chapter Recursão.

%%{{{ First examples 
\section Primeiros exemplos.

\TODO Fibonacci e Lucas.

%%{{{ df: fibonacci 
\definition Os números Fibonacci.
\label{fibonacci}
\tdefined{Fibonacci}[seqüência]
Definimos os \emph{números Fibonacci}\Fibonacci[seqüência]\tdefined{Fibonacci}[números]{}
recursivamente assim:
$$
\align
    F_0     &= 0 \\
    F_1     &= 1 \\
    F_{n+2} &= F_{n+1} + F_n.
\endalign
$$
%%}}}

\TODO Computando seus valores.

%%{{{ x: lucas 
\exercise Os números Lucas.
\label{lucas}%
\tdefined{Lucas}[números]%
Os números Lucas\Lucas[números]\tdefined{Lucas}[números]{} são definidos similarmente:
$$
\align
L_0     &= 2\\
L_1     &= 1\\
L_{n+2} &= L_{n+1} + L_n.
\endalign
$$
Calcule o valor $L_{12}$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ The natural numbers formally 
\section Os números naturais formalmente.
\label{Nats_formally}%

%%{{{ df: nats_plus_recursive_def 
\definition Adição.
Definimos a operação $+$ no $\nats$ pelas:
$$
\align
n + 0   &= n      \tag{a1}\\
n + S m &= S(n+m) \tag{a2}
\endalign
$$
%%}}}

%%{{{ eg: three_plus_two_formally 
\example.
\label{three_plus_two_formally}%
Calcule a soma $SSS0 + SS0$.

\solution
Temos a expressão
$$
SSS0 + SS0.
$$
Qual equação aplica?
Com certeza não podemos aplicar a primeira (na direção ``$\Rightarrow$''),
pois nossa expressão não tem a forma $n + 0$.
Por quê não?  O primeiro termo na nossa expressão, o $SSS0$, não é um problema
pois ele pode ``casar'' com o $n$ do lado esquerdo da (a1).
Mas nosso segundo termo, o $SS0$,
não pode casar com o $0$, então a (a1) não é aplicável.
A segunda equação é sim, pois nossos termos podem casar assim
com as variáveis da (a2):
$$
\alignat2
{\munderbrace{SSS0}n} + {S\munderbrace{S0}m}\\
\intertext{Tomando $n\asseq SSS0$ e $m\asseq S0$ substituimos nossa expressão por seu
igual seguindo a (a2):}
{\munderbrace{SSS0}n} + {S\munderbrace{S0}m}
&= S\bigparen{ {\munderbrace{SSS0}n} + {\munderbrace{S0}m} }  \qqby{por (a2)}\\
\intertext{Depois um passo de cálculo então chegamos na expressão
$S(SSS0 + S0)$.
Como nenhuma equação tem a forma $S(\text{\thole}) = \text{\lthole}$,
olhamos ``dentro'' da nossa expressão para achar nas suas subexpressões
possíveis ``casamentos'' com nossas equações.
Focamos então na subexpressão sublinhada
$S(\underline{SSS0 + S0})$:
vamos tentar substituí-la por algo igual.
Novamente a primeira equação não é aplicavel
por causa do novo segundo termo ($S0$), mas a (a2) é:}
S\bigparen{{\munderbrace{SSS0}n} + {S\munderbrace{0}m}}\\
\intertext{Tomando agora $n\asseq SSS0$ e $m\asseq 0$ substituimos de novo
seguindo a (a2):}
S\toverbrace{\bigparen{{\munderbrace{SSS0}n} + {S\munderbrace{0}m}}}{isso}
&= S\toverbrace{S\bigparen{ {\munderbrace{SSS0}n} + {\munderbrace{0}m} }}{por isso}  \qqby{por (a2)}\\
\intertext{Agora focamos na subexpressão $SS(\underline{SSS0 + 0})$ e podemos finalmente
aplicar a primeira equação:}
SS\bigparen{{\munderbrace{SSS0}n} + 0}\\
\intertext{então tomando $n\asseq SSS0$ substituimos}
SS\toverbrace{\bigparen{{\munderbrace{SSS0}n} + 0}}{isso}
&= SS\toverbrace{ {\munderbrace{SSS0}n} }{por isso}  \qqby{por (a1)}
\endalignat
$$
Finalmente chegamos no resultado: no termo $SSSSS0$.
Nunca mais vamos escrever tudo isso com tanto detalhe!
Esse cálculo que acabamos de fazer, escrevemos curtamente nessa forma:
$$
\alignat2
SSS0 + SS0
&= S(SSS0 + S0) \qqby {por (a2)}\\
&= SS(SSS0 + 0) \qqby {por (a2)}\\
&= SSSSS0       \qqby {por (a1)}
\endalignat
$$
escrevendo apenas em cada linha o que foi usado.

\endexample
%%}}}

%%{{{ x: zero_plus_four_formally 
\exercise.
\label{zero_plus_four_formally}%
Calcule a soma dos $0 + SSSS0$.

\endexercise
%%}}}

%%{{{ Evaluation strategy 
\note Estratégias de evaluação.
\tdefined{estratégia}[de evaluação]%
Vamos dizer que queremos calcular começando com uma expressão mais complexa,
como por exemplo a
$$
0 + \bigparen{0 + S\bigparen{(SS0 + 0) + 0}}.
$$
Como procedimos?
A expressão enteira não pode ser substituida pois nenhuma das (a1)--(a2) tem
essa forma, mas aparecem várias subexpressões em quais podemos \emph{focar}
para nosso próximo passo de cálculo:
$$
\align
0 + \underline{\bigparen{0 + S\bigparen{(SS0 + 0) + 0}}},&\quad\text{casando com (a2)}\\
0 + \bigparen{0 + S\underline{\bigparen{(SS0 + 0) + 0}}},&\quad\text{casando com (a1)}\\
0 + \bigparen{0 + S\bigparen{\underline{(SS0 + 0)} + 0}},&\quad\text{casando com (a1)}.
\endalign
$$
Podemos seguir uma \dterm{estratégia de evaluação} específica, por exemplo,
focando sempre na expressão que aparece primeira à esquerda; ou podemos
escolher cada vez onde focar aleatoriamente; etc.
No~\ref{three_plus_two_plus_one} tu vai ter que escolher onde focar
várias vezes.
%%}}}

%%{{{ x: three_plus_two_plus_one 
\exercise.
\label{three_plus_two_plus_one}%
Calcule os valor das expressões $SSS0 + (SS0 + S0)$ e $(SSS0 + SS0) + S0$.

\solution
Um caminho para calcular a primeira é o seguinte:
$$
\alignat2
SSS0 + \underline{(SS0 + S0)}
&= SSS0 + S\underline{(SS0 + 0)} \qqby{por (a2)}\\
&= \underline{SSS0 + SSS0}       \qqby{por (a1)}\\
&= S\underline{(SSS0 + SS0)}     \qqby{por (a2)}\\
&= SS\underline{(SSS0 + S0)}     \qqby{por (a2)}\\
&= SSS\underline{(SSS0 + 0)}     \qqby{por (a2)}\\
&= SSSSSS0                       \qqby{por (a1)}\\
\intertext{e um caminho para calcular a segunda é o:}
\underline{(SSS0 + SS0) + S0}
&= S(\underline{(SSS0 + SS0)} + 0)  \qqby{por (a2)}\\
&= S(S\underline{(SSS0 + S0)} + 0)  \qqby{por (a2)}\\
&= S\underline{(SS(SSS0 + 0) + 0)}  \qqby{por (a2)}\\
&= SSS\underline{(SSS0 + 0)}        \qqby{por (a1)}\\
&= SSSSSS0                          \qqby{por (a1)}
\endalignat
$$

\endexercise
%%}}}

%%{{{ x: nats_double_def 
\exercise.
\label{nats_double_def}%
Define (recursivamente) a função $d : \Nat \to \Nat$ que dobra sua entrada.
Verifique que o dobro de $3$ é $6$.

\hint
Pensando fora do $\Nat$:
como podemos calcular o valor de $2(n+1)$, se sabemos como dobrar
qualquer número menor de $n+1$?

\hint
$2(n+1) = 2n + 2$.

\solution
Definimos:
$$
\align
d( 0 )  &= 0        \tag{D1}\\
d( Sn ) &= SSd(n).  \tag{D2}
\endalign
$$
Calculamos:
$$
\alignat2
d( SSS0 )
&= SSd(SS0)    \qqby{por (D2)}\\
&= SSSSd(S0)   \qqby{por (D2)}\\
&= SSSSSSd(0)  \qqby{por (D2)}\\
&= SSSSSS0.    \qqby{por (D1)}
\endalignat
$$

\endexercise
%%}}}

%%{{{ x: nats_ntimes_recursive_def 
\exercise.
\label{nats_ntimes_recursive_def}%
Define a multiplicação no $\nats$.

\hint
Precisa de novo duas equações.

\hint
$$
\align
n \ntimes 0  &= \text{\lthole}\\
n \ntimes Sm &= \text{\lthole}
\endalign
$$

\hint
Na segunda equação, no seu lado direito, tu tem acesso no valor
$n \ntimes m$, pois é ``mais simples'' do que o $n \ntimes Sm$.
Isso é o poder da recursão: podes considerar o problema que tu
tá tentando resolver (definir a multplicação), como resolvido
para as ``entradas mais simples''.

\endexercise
%%}}}

%%{{{ x: nats_exp_recursive_def 
\exercise.
\label{nats_exp_recursive_def}%
Define a exponencação no $\nats$.

\endexercise
%%}}}

%%{{{ nats_leq_recursive_def 
\definition Ordem.
Com que temos definido podemos já definir recursivamente
uma \emph{relação} no $\nats$.  A relação de ordem $\leq$:
$$
\align
0  \leq m  &\iff \True      \tag{LE1}\\
Sn \leq 0  &\iff \False     \tag{LE2}\\
Sn \leq Sm &\iff n \leq m   \tag{LE3}
\endalign
$$
%%}}}

%%{{{ eg: two_leq_four_but_four_notleq_two 
\example.
\label{two_leq_four_but_four_notleq_two}%
Ache se $SS0 \leq SSSS0$ e se $SSSS0 \leq SS0$.

\solution
Calculamos:
$$
\alignat2
SS0 \leq SSSS0
&\iff S0 \leq SSS0  \qqby{por (LE3)}\\
&\iff 0  \leq SS0   \qqby{por (LE3)}\\
&\iff \True         \qqby{por (LE1)}
\endalignat
$$
ou seja, realmente $SS0 \leq SSSS0$.
No outro lado, calculamos
$$
\alignat2
SSSS0 \leq SS0
&\iff SSS0 \leq S0  \qqby{por (LE3)}\\
&\iff SS0  \leq 0   \qqby{por (LE3)}\\
&\iff \False        \qqby{por (LE2)}
\endalignat
$$
ou seja, $SSSS0 \not\leq SS0$.

\endexample
%%}}}

\endsection
%%}}}

%%{{{ Sums and products, formally 
\section Somatórios e produtórios formalmente.

\TODO Definições recursivas de somatórios e produtórios.

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ prob: quot_rem_eq_prob 
\problem.
\label{quot_rem_eq_prob}
Considere as funções $q$, $r$, e $t$ definidas recursivamente:
$$
\xalignat3
q       &\eqtype \nats \to \nats   & r      &\eqtype \nats \to \nats   &  t          &\eqtype \nats^2 \to \bools     \\
q(0)    &=       0\phantom{666}    & r(0)   &=       0\phantom{666}    &  t(0,   0)  &=       \True          \\
q(1)    &=       0\phantom{666}    & r(1)   &=       1\phantom{666}    &  t(0,  Sn)  &=       \False         \\
q(2)    &=       0\phantom{666}    & r(2)   &=       2\phantom{666}    &  t(Sm,  0)  &=       \False         \\
q(n+3)  &=       q(n) + 1          & r(n+3) &=       r(n)              &  t(Sm, Sn)  &=       t(m,n)             
\endxalignat
$$
O que cada função calcula?

\hint
Calcule os valores $q(11)$, $q(12)$, $r(11)$, e $r(12)$.

\solution
\item{($q$:)}
    $q(n) = \bigg\lfloor{\dfrac n 3}\bigg\rfloor$.
\item{($r$:)}
    O $r(n)$ é o resto da divisão do $n$ por $3$.
\item{($t$:)}
    A $t$ decida se suas entradas são iguais ou não.

\endproblem
%%}}}

%%{{{ prob: products_in_disguise 
\problem.
\label{products_in_disguise}
Seja $h : \nats\to\nats$.
Defina recursivamente as funções $t : \nats \to \nats$ e $T : \nats^2 \to \nats$ que satisfazem:
$$
\align
t(n)   &= h(0)h(1)\dotsb h(n-1)     = \prod\limits_{i=0}^{n-1} h(i);\\
T(m,n) &= h(m)h(m+1)\dotsb h(m+n-1) = \prod\limits_{i=m}^{m+n-1} h(i).
\endalign
$$

\hint
Depois de definir confira tuas definições seguindo elas para calcular uns valores.
Por exemplo, $t(2)$ e $T(5,2)$ devem dar os resultados
$$
\xalignat2
t(2) &= h(0)h(1)
&
T(5,2) &= h(5)h(6).
\endxalignat
$$

\hint
Mesmo que a função $T$ tem aridade 2, escolhendo bem,
tu não precisarás escrever 4 equações, mas apenas 2.

\solution
Definimos
$$
\xalignat2
t      &\eqtype \nats\to\nats   &  T        &\eqtype \nats^2\to\reals\\
t(0)   &= 1                     &  T(m,0)   &= 1                     \\
t(n+1) &= h(n) \ntimes t(n)     &  T(m,k+1) &= h(m+k) \ntimes T(m,k).  
\endxalignat
$$
Tendo definido primeiro a $T$, podemos definir a $t$ assim:
$$
t(n) = T(0,n).
$$

\endproblem
%%}}}

%%{{{ prob: victors_mistake 
\problem.
\label{victors_mistake}%
Tentando resolver o~\ref{products_in_disguise},
% STUDENT: Victor
um aluno definiu corretamente a $t$ e depois a usou
na sua definição de $T$, assim:
$$
T(m,n) = {t(m+n)}/{t(m)}.
$$
Qual o problema com essa definição?
(Assuma como conhecida uma definição recursiva da
operação $/$ de divisão inteira.)

\hint
Qual é o contradomínio da $h$?

\hint
$0\in\nats$.

\hint
O que acontece se $h(i) = 0$ para algum $i \in \nats$?

\solution
Se $h(i) = 0$ para algum $i \in \nats$,
o $t(j)=0$ para todo $j>i$.
Assim, a expressão
${t(m+n)}/{t(m)}$ não é definida para qualquer $m>i$.
Observe que a solução seria certa se
o contradomínio da $h$ fosse o $\nats\setminus\set0$.

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Induction 
\chapter Indução.

%%{{{ The principle of finite induction 
\section O princípio da indução finita (PIF).

%%{{{ ax: FIP 
\axiom Princípio da indução finita (PIF).
\label{FIP}%
\tdefined{PIF}%
\iiseealso{PIF}{indução}%
\iisee{princípio}[da indução finita]{indução}%
\tdefined{indução}%
Seja $P(n)$ uma propriedade de naturais.
Se $P(0)$ e, para todo $k\in\nats$,
$P(k)$ implica $P(k+1)$,
então $P(n)$ é verdade para todo $n\in\nats$.
%%}}}

%%{{{ FIP schematically 
\note.
Esquematicamente o PIF:
$$
\left.
\aligned
\text{\proofpartstyle{Base:}}\quad            & P(0)\\
\text{\proofpartstyle{Passo Indutivo:}}\quad  & \lforall {k\in\nats} {P(k)\limplies P(k+1)}\quad
\endaligned
\right\}
\implies
\lforall {n\in\nats} {P(n)}.
$$
%%}}}

%%{{{ eg: gauss_child 
\example.
\label{gauss_child}
Prove que
$$
    1 + 2 + \cdots + n = \frac { n (n+1) } 2
$$
para todo $n\in\nats$.

\solution
Por indução, verificamos que a propriedade
$$
P(n)
\defiff
1 + 2 + \cdots + n = \frac { n (n+1) } 2
$$
é válida para todo $n$.
Primeiramente provamos a base
$$
P(0)
\iff
\underbrace{1 + 2 + \cdots + 0}_{\text{somatório vazio}}
= \frac { 0 (0+1) } { 2 }.
$$
Realmente, o lado esquerdo é um somatório vazio,
logo $0$, e o lado direito é o número $0(0+1)/2 = 0$ também.
Concluimos que $P(0)$.
\endgraf
Seja $k\in\nats$ tal que $P(k)$, ou seja,
$$
1 + 2 + \cdots + k = \frac { k (k+1) } 2.\tag{H.I.}
$$
Calculamos:
$$
\alignat 3
P(k+1)
&\iff& 1 + 2 + \cdots + (k+1)        &= \frac { (k+1) (k+2) } 2 \\
&\iff& 1 + 2 + \cdots + k + (k+1)    &= \frac { (k+1) (k+2) } 2 \\
&\iff& \frac { k (k+1) } 2  + (k+1)  &= \frac { (k+1) (k+2) } 2 \qqby{pela H.I.} \\
&\iff& k \cancel{(k+1)} + 2 \cancel{(k+1)} &= \cancel{(k+1)} (k+2) \\
&\iff& k + 2                         &= k + 2.
\endalignat
$$
\endexample
%%}}}

%%{{{ x: sum_of_cubes_formula 
\exercise.
\label{sum_of_cubes_formula}%
Prove que
$$
    1 + 8 + 27 + \cdots + n^3 = \paren{\frac { n (n+1) } { 2 } }^2
$$
para todo $n\in\nats$.

\hint
Lembre que o somatório vazio é $0$.

\endexercise
%%}}}

%%{{{ x: sum_of_negative_powers_of_two_formula 
\exercise.
\label{sum_of_negative_powers_of_two_formula}%
Observando os valores de:
$$
\align
    1
    +
    \frac 1 2
    &= 2 - \frac 1 2\\
    1
    +
    \frac 1 2
    +
    \frac 1 4
    &= 2 - \frac 1 4\\
    1
    +
    \frac 1 2
    +
    \frac 1 4
    +
    \frac 1 8
    &= 2 - \frac 1 8,
\intertext{adivinhe uma fórmula geral para o somatório}
    1 + \frac 1 2 + \frac 1 4 + \cdots + \frac 1 {2^n} &= \text{?}
\endalign
$$
e prove que ela é válida para todo $n\in\nats$.

\endexercise
%%}}}

%%{{{ x: one_minus_sum_of_1_over_n_formula 
\exercise.
\label{one_minus_sum_of_1_over_n_formula}%
Calculando os valores de:
$$
    \paren{1 - \frac 1 2},
   \qquad 
    \paren{1 - \frac 1 2}
    \paren{1 - \frac 1 3},
   \qquad
    \paren{1 - \frac 1 2}
    \paren{1 - \frac 1 3}
    \paren{1 - \frac 1 4},
$$
adivinhe uma fórmula geral para o produtório
$$
\prod_{i=2}^n\paren{ 1 - \frac 1 i}
=
    \paren{1 - \frac 1 2}
    \paren{1 - \frac 1 3}
    \paren{1 - \frac 1 4}
\dotsb
    \paren{1 - \frac 1 n}
$$
e prove que ela é válida para todo inteiro $n \geq 2$.

\endexercise
%%}}}

%%{{{ x: sum_of_squares_formula 
\exercise.
\label{sum_of_squares_formula}%
Prove que para todo $n \in\nats$,
$$
\sum_{i=1}^n i^2
= \frac {n^3} 3 + \frac {n^2} 2 + \frac n 6.
$$

\endexercise
%%}}}

%%{{{ x: sum_of_cubes_and_gauss_formula 
\exercise.
\label{sum_of_cubes_and_gauss_formula}%
Prove que para todo $n \in\nats$,
$$
\align
\sum_{i=1}^n i^3 &= \paren{\sum_{i=1}^n i}^2\\
\text{ou seja,}\qquad
1^3 + 2^3 + \dotsb + n^3 &= \paren{ 1 + 2 + 3 + \dotsb + n }^2.
\endalign
$$

\endexercise
%%}}}

%%{{{ x: sum_of_threes_and_fives 
\exercise.
\label{sum_of_threes_and_fives}%
Qualquer número inteiro positivo $n \geq 8$ pode ser escrito
como somatório de $3$'s e $5$'s.

\endexercise
%%}}}

%%{{{ x 
\exercise.
Seja
$$
P(n) \defiff 1 + 2 + \dotsb + n = \frac 1 8 \paren{2n + 1}^2.
$$
\item{(1)} Prove que para todo $k\in\nats$, se $P(k)$ então $P(k+1)$.
\item{(2)} Critique a sentença: ``\emph{Logo, por indução temos que $P(n)$ é válido para todo $n\in\nats$.}''
\item{(3)} Mudando o ``$=$'' para ``$>$'' ou ``$<$'', defina um novo predicado $P'(n)$, válido para todo $n\in\nats$, e prove a validade dele por indução.

\endexercise
%%}}}

%%{{{ x fibonacci 
\exercise.
Prove que para todo $n\in\nats$,
$$
\sum_{i=0}^n F_i = F_{n+2} - 1,
$$
onde $F_n$ o $n$-ésimo número Fibonacci.

\endexercise
%%}}}

%%{{{ x fibonacci 2 
\exercise.
Prove que para todo $n\in\nats$,
$$
\sum_{i=1}^n F_i^2 = F_n F_{n+1},
$$
onde $F_n$ o $n$-ésimo número Fibonacci.

\endexercise
%%}}}

%%{{{ x: n_over_succ_n_formula 
\exercise.
\label{n_over_succ_n_formula}%
Prove que para todo inteiro $n \geq 1$.
$$
    \frac 1 {1 \cdot 2} +
    \frac 1 {2 \cdot 3} +
    \frac 1 {3 \cdot 4} + \cdots + 
    \frac 1 {n (n+1)}
    =
    \frac n {n+1}
$$

\endexercise
%%}}}

%%{{{ x: squares_smaller_than_powers_of_two_induction 
\exercise.
\label{squares_smaller_than_powers_of_two_induction}%
Prove que para todo inteiro $n \geq 5$,
$$
    n^2 < 2^n.
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Proving properties of operations and relations of naturals 
\section Provando propriedades de operações e relações nos naturais.

%%{{{ convention: quantifiers 
\note Convenção.
Nessa secção todos os quantificadores que aparecem ``nus'' em fórmulas
\emph{quantificam sobre os naturais}.  Por exemplo
$$
\forall x
\forall y
\exists z
\forall w
P(x,y,z,w)
$$
significa
$$
\pforall {x \in \nats}
\pforall {y \in \nats}
\pexists {z \in \nats}
\lforall {w \in \nats}
{P(x,y,z,w)}.
$$
%%}}}

\blah.
Vamos primeiramente \emph{definir} recursivamente as tres operações de adição,
multiplicação, e exponenciação:

%%{{{ df: natops_rec_defs 
\definition.
\label{natops_rec_defs}%
Temos:
$$
\xxalignat3
&
\alignedat2
\text{(a1)}&\quad&   n + 0  &= n     \\
\text{(a2)}&&        n + Sm &= S(n+m)
\endalignedat
&&
\alignedat2
\text{(m1)}&\quad&   n \ntimes 0  &= 0   \\
\text{(m2)}&&        n \ntimes Sm &= (n \ntimes m) + n
\endalignedat
&&
\alignedat2
\text{(e1)}&\quad&   n \expop 0  &= S0   \\
\text{(e2)}&&        n \expop Sm &= (n \expop m) \ntimes n
\endalignedat
\endxxalignat
$$
%%}}}

%%{{{ prop: natadd_is_associative 
\proposition Associatividade da adição.
\label{natadd_is_associative}%
A operação $+$ da~\ref{natops_rec_defs}~é associativa:
$$
\forall n
\forall m
\forall k
\bigparen{n + (m + k) = (n + m) + k}.
$$
%%}}}

%%{{{ prop: natadd_is_commutative 
\proposition Comutatividade da adição.
\label{natadd_is_commutative}%
A operação $+$ da~\ref{natops_rec_defs}~é comutativa:
$$
\forall n
\forall m
\bigparen{n + m = m + n}.
$$
%%}}}

%%{{{ x: natmult_is_associative 
\exercise Associatividade da multiplicação.
\label{natadd_is_commutative}%
$
\forall n
\forall m
\forall k
\bigparen{(n \ntimes m) \ntimes k = n \ntimes (m \ntimes k)}.
$

\endexercise
%%}}}

%%{{{ x: natmult_is_commutative 
\exercise Comutatividade da multiplicação.
\label{natadd_is_commutative}%
$
\forall n
\forall m
\bigparen{n \ntimes m = m \ntimes n}.
$

\endexercise
%%}}}

%%{{{ x: natadd_distributive_over_natmult 
\exercise Distributividade.
\label{natmult_distributes_over_natadd}%
$
\forall x
\forall y
\forall z
\bigparen{x \ntimes (y + z) = (x \ntimes y) + (x \ntimes z)}.
$

\endexercise
%%}}}

%%{{{ x: law_of_natexp_1 
\exercise Lei de exponenciação 1.
\label{law_of_natexp_1}%
$
\forall x
\forall a
\forall b
\bigparen{x \expop (a + b) = (x \expop a) \ntimes (x \expop b)}.
$

\endexercise
%%}}}

%%{{{ x: law_of_natexp_2 
\exercise Lei de exponenciação 2.
\label{law_of_natexp_2}%
$
\forall a
\forall b
\forall c
\bigparen{a \expop (b \expop c) = a \expop (b \ntimes c)}.
$

\endexercise
%%}}}

%%{{{ df: natops_leq_def 
\definition.
\label{natops_leq_def}%
Definimos a relação $\leq$ assim:
$$
n \leq m \defiff \lexists {k\in\nats} {n + k = m}.
$$
%%}}}

%%{{{ x: natleq_lemma 
\exercise.
\label{natleq_lemma}%
Prove que
$$
\forall n \forall m \bigparen{ n \leq S m  \iff  n \leq m  \mlor  n = S m}
$$

\endexercise
%%}}}

%%{{{ x: natleq_loset 
\exercise.
\label{natleq_loset}%
Prove que $\leq$ é uma ordem linear, i.e.:
$$
\gather
\forall n \bigparen{ n \leq n } \\
\forall n \forall m \bigparen{n \leq m  \mland  m \leq n  \implies  m = n} \\
\forall x \forall y \forall z \bigparen{x \leq y  \mland  y \leq z  \implies  x \leq y} \\
\forall x \forall y \bigparen{n \leq m  \mlor  m \leq n}
\endgather
$$

\endexercise
%%}}}

%%{{{ x: natleq_woset 
\exercise.
\label{natleq_woset}%
Prove que $\leq$ é uma bem-ordem, i.e.,
$$
\text{para todo $A \subseteq \nats$,}\quad
A \neq \emptyset \implies \text{$A$ tem elemento mínimo}.
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ When one base is not enough 
\section Quando uma base não é suficiente.

%%{{{ prop: lucas_altdef_first_attempt 
\proposition.
\label{lucas_altdef_first_attempt}
Para todo inteiro $n \geq 1$,
seja $\ell : \nats\setminus\set0\to\nats$ a função definida pela equação
$$
    \ell(n) = F_{n-1} + F_{n+1},
$$
onde $F_n$ é o $n$-ésimo número \Fibonacci{}Fibonacci (veja~\ref{fibonacci}).
Queremos mostrar que para todo $n \geq 1$, $L_n = \ell(n)$,
onde $L_n$ é o $n$-ésimo número \Lucas{}Lucas (veja~\ref{lucas}).
\wrongproof.
Nos vamos provar por indução que \emph{para todo $n \geq 1$, $L_n = \ell(n)$}.
Vamos primeiramente verificar que para $n=1$, realmente temos $L_n = \ell(n)$:
$$
\alignat 2
\ell(1) &= F_0 + F_2      \qqby{def.~de $\ell(n)$} \\
        &= 0 + F_1 + F_0  \qqby{def.~de $F_n$}     \\
        &= 0 + 1 + 0      \qqby{def.~de $F_n$}     \\
        &= 1              \\
        &= L_1.           \qqby{def.~de $L_n$}
\intertext{Seja $k\in\nats$ com $k\geq 2$, tal que $L_{k-1} = \ell(k-1)$.
Realmente temos}
L_k
&= L_{k-1} + L_{k-2}                        \qqby{def.~de $L_n$}\\
&= \ell(k-1) + \ell(k-2)                    \qqby{H.I.}\\
&= (F_{k-2} + F_k) + (F_{k-3} + F_{k-1})    \qqby{def.~de $\ell(n)$}\\
&= (F_{k-2} + F_{k-3}) + (F_k + F_{k-1})    \qqby{ass.~e com.~de $+$}\\
&= F_{k-1} + F_{k+1}                        \qqby{def.~de $F_n$}\\
&= \ell(k)                                  \qqby{def.~de $\ell(n)$}.
\endalignat
$$
que termina nossa prova.
\mistaqed
%%}}}

%%{{{ x: lucas_altdef_find_error 
\exercise.
\label{lucas_altdef_find_error}
Na prova acima roubamos.
Ache onde e explique como, e pense numa solução.

\endexercise
%%}}}

%%{{{ lucas_altdef_final 
\proposition.
\label{lucas_altdef_final}
Com a notação da~\ref{lucas_altdef_first_attempt},
para todo $n\geq 1$, $\ell(n) = L_n$.
\proof.
Nos vamos provar por indução que \emph{para todo $n \geq 1$, $L_n = \ell(n)$}.
Vamos primeiramente verificar que para $n=1$ e $n=2$, realmente temos $L_n = \ell(n)$.
Para $n=1$:
$$
\alignat 2
\ell(1) &= F_0 + F_2      \qqby{def.~de $\ell(n)$} \\
        &= 0 + F_1 + F_0  \qqby{def.~de $F_n$}     \\
        &= 0 + 1 + 0      \qqby{def.~de $F_n$}     \\
        &= 1              \\
        &= L_1.           \qqby{def.~de $L_n$}
\endalignat
$$
E para $n=2$:
$$
\xalignat2
\alignedat 2
      L_2 &= L_1 + L_0  \qqby{def.~de $L_n$} \\
          &= 1 + 2      \qqby{def.~de $L_n$} \\
          &= 3          
\endalignedat
&&
\alignedat 2
\ell(2) &= F_1 + F_3          \qqby{def.~de $\ell(n)$}  \\
        &= 1 + F_2 + F_1      \qqby{def.~de $F_n$}      \\
        &= 1 + 1 + 1          \\
        &= 3.
\endalignedat
&
\endxalignat
$$
Seja $k\in\nats$ com $k\geq 3$ tal que
$$
L_{k-1} = \ell(k-1)
\qquad
\text{e}
\qquad
L_{k-2} = \ell(k-2)
$$
(nossas \emph{duas} hipoteses indutivas).
Vamos provar que $L_k = \ell(k)$.
Realmente temos
$$
\alignat 2
L_k
&= L_{k-1} + L_{k-2}                        \qqby{def.~de $L_n$}\\
&= \ell(k-1) + \ell(k-2)                    \qqby{H.I.}\\
&= (F_{k-2} + F_k) + (F_{k-3} + F_{k-1})    \qqby{def.~de $\ell(n)$, $k\geq3$}\\
&= (F_{k-2} + F_{k-3}) + (F_k + F_{k-1})    \qqby{ass.~e com.~de $+$}\\
&= F_{k-1} + F_{k+1}                        \qqby{def.~de $F_n$, $k\geq3$}\\
&= \ell(k)                                  \qqby{def.~de $\ell(n)$},
\endalignat
$$
que termina nossa prova.
\qed
%%}}}

%%{{{ x: new_proof_of_sum_of_threes_and_fives_with_three_bases 
\exercise.
\label{new_proof_of_sum_of_threes_and_fives_with_three_bases}%
Ache uma nova prova do~\ref{sum_of_threes_and_fives} por indução
com três bases.

\hint
$k = (k-3) + 3$.

\solution
Seja $k\geq 8 + 3 = 11$ tal que $k-1$, $k-2$, e $k-3$
podem ser escritos como somatórios de $3$'s e $5$'s (H.I.).
Temos
$$
\alignat 2
k &= (k-3) + 3      \\
  &= (3x + 5y) + 3  \quad\text{para alguns $x,y\in\nats$} \qqby{pela H.I.} \\
  &= 3(x+1) + 5y.
\endalignat
$$
Como precisamos a vericidade da proposição para o valor $k-3$,
devemos mostrar as $3$ bases, para os inteiros $8$, $9$, e $10$:
$$
\alignat 2
8  &= 3 + 5     &&= 3\ntimes 1 + 5\ntimes 1\\
9  &= 3 + 3 + 3 &&= 3\ntimes 3 + 5\ntimes 0\\
10 &= 5 + 5     &&= 3\ntimes 0 + 5\ntimes 2.
\endalignat
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Many variables 
\section Muitas variáveis.

%TODO explain that it's just one more tool to attack theorems
%TODO XXX Maybe refer to a weaker result from "irrationality"?
\lemma.
\label{odd_to_any_power_is_odd}
Para todo $n\in\nats$, e todo impar $k\in\ints$, $k^n$ é impar.
\proof.
Seja $k\in\ints$ impar, então $k=2a+1$ para um $a\in\ints$.%
\footnote{%
Aqui consideramos a seguinte definição de ``impar'':
\emph{um inteiro $n$ é \dterm{impar} sse existe inteiro $k$ tal que $n = 2k+1$.}
}
Vamos provar por indução que para todo $n\in\nats$, $k^n$ é impar.
Se $n=0$, imediatamente $k^0 = 1$ e é impar ($1 = 2\ntimes 0 + 1$).
Suponha que para algum $t\in\nats$, $k^t$ é impar, ou seja $k^t = 2b+1$ para um $b\in\ints$.
Falta provar que $k^{t+1}$ também é impar.
Calculando,
$$
\alignat2
k^{t+1}
&= k k^t               \qqby{definição de exponenciação} \\
&= (2a + 1) (2b + 1)   \qqby{hipoteses}    \\
&= 4ab + 2a + 2b + 1   \\
&= 2(2ab + a + b) + 1.
\endalignat
$$
Logo, como $2ab + a + b\in\ints$, $k^{t+1}$ é impar.
\qed

\endsection
%%}}}

%%{{{ Strong induction 
\section O princípio da indução finita forte (PIFF).
\label{Strong_induction}

\note.
O seguinte princípio parece mais forte que o PIF.
Na verdade, nos naturais, os dois princípios são equivalentes:

\theorem Princípio da indução finita forte (PIFF).
\tdefined{PIFF}
\iiseealso{PIFF}{indução}
\tdefined{indução}[forte]
\iisee{princípio}[da indução finita forte]{indução forte}
\label{FSIP}
Seja $P(n)$ uma propriedade de naturais.
Se para todo $k\in\nats$,
a hipótese que $P(i)$ é verdade para todo $i<k$
implica que $P(k)$ também é,
então $P(n)$ é verdade para todo $n\in\nats$.

\note.
Esquematicamente o PIFF:
$$
\lforall
    {k\in\nats}
    {\vphantom{\bigg(}\Big(\lforall {i < k} {P(i)}\Big) \limplies P(k)}
\implies
\lforall
    {n\in\nats}
    {P(n)}.
$$

\endsection
%%}}}

%%{{{ The well-ordering principle 
\section O princípio da boa ordem (PBO).
\label{The_wellordering_principle}%

\definition Elemento mínimo.
\tdefined{mínimo}%
\sdefined {\min {\holed A}} {mínimo do \holed A}%
Seja $A$ um conjunto ordenado.
Um elemento $m\in A$ é chamado
\dterm{(elemento) mínimo do $A$}
sse
$m$ é menor de todos os outros elementos do $A$.
Quando o conjunto $A$ possui elemento mínimo,
escrevemos $\min A$ para o denotar:
$$
m = \dsym{\min A} \defiff m\in A \;\land\; \lforall {a\in A} {a \neq m \limplies m < a}.
$$

Note que necessariamente o mínimo dum conjunto $A$ pertence no $A$.
Para justificar a definição do símbolo $\min A$, \emph{devemos} provar o seguinte:

\exercise Unicidade de mínimo.
Um conjunto não pode ter mais que um elemento mínimo.

\hint
Suponha que tem dois mínima diferentes
e aplicando a definição de ``mínimo''
e propriedades de $<$,
chega numa contradição.

\hint
Pela transitividade, $a<b$ e $b<a$ implicam uma contradição.

\endexercise

\exercise.
Seja $U$ um conjunto unitário ordenado.
Prove que ele tem elemento mínimo.

\endexercise

\exercise.
Seja $A$ um conjunto ordenado, e um subconjunto finito $A_0\finsubseteq A$,
com $A_0\neq\emptyset$.
O $A_0$ possui elemento mínimo.

\hint
Indução no tamanho do $A_0$.

\endexercise

\theorem Princípio da boa ordem (PBO).
\tdefined{PBO}%
\tdefined{princípio}[da boa ordem]%
\label{WOP}%
\iiseealso{PBO}{princípio da boa ordem}%
Cada subconjunto não vazio do\/ $\nats$ possui mínimo.
\sketch.
Seja $P(n)$ a propriedade que cada subconjunto $A\subseteq\nats$
que possui elementos menores ou iguais a $n$ tem mínimo.
Vamos mostrar por indução que para todo $n$, $P(n)$.
\qes

\exercise.
Quais dos $\ints$, $\rats$, $\rats_{>0}$, $\rats_{\geq0}$, $\reals$,
satisfázem a propriedade de boa ordem?

\endexercise

\exercise.
Seja $a\in\reals$.
Quais dos $\rats_{\geq a}$, $\reals_{\geq a}$,
e $\set{ 2^{-n} \st n \in\nats, n \leq a}$
satisfázem a propriedade de boa ordem?

\endexercise

\theorem.
\label{no_int_between_0_and_1}%
Não existe inteiro $k$ tal que\/ $0 < k < 1$.
\sketch.
Suponha que existe um tal inteiro $k$.
Então o conjunto $C=\set{c\in\ints\st 0 < c < 1}$ de todos os ``contraexemplos''
não é vazio.
Aplique o PBO para tomar seu menor elemento, e ache um outro contraexemplo,
ainda menor, chegando assim numa contradição.
\qes

\exercise.
Prove o \ref{no_int_between_0_and_1} usando indução.

\hint
Nenhum inteiro negativo satisfaz $0 < m < 1$.
Então para provar que nenhum inteiro fica estritamente entre $0$ e $1$, basta provar
que todos os não-negativos $n$ satisfazem $n=0$ ou $n\geq 1$

\hint
Seja
$
P(n) \defiff \text{$n=0$ ou $n\geq1$}
$.

\hint
A base é trivial.

\hint
Para o passo indutivo, tomando um $k\in\nats$ tal que $P(k)$, separa tua prova
em dois casos, dependendo da razão que o $P(k)$ seja verdade.

\endexercise

\exercise.
Sejam $a,b\in\ints$ com $ab=1$.
Prove que $a=\pm1$ e $b=\pm1$.

\endexercise

\theorem Indução, forma com conjuntos.
\tdefined{indução}[forma com conjuntos]
\label{PIF_set_form}
Seja $A\subseteq\nats$ tal que $0\in A$ e $n+1\in A$ para todo $n\in A$.
$A=\nats$.
\sketch.
Caso contrario, existeriam ``contraexemplos'', ou seja, naturais que não pertencem no $A$.
Aplique a PBO para escolher o menor tal contraexemplo, e chega num absurdo.
\qes

\exercise.
Prove que se um subconjunto $A$ de inteiros tem elementos maiores que um número fixo $n_0$,
então existe o $\min\set{a\in A\st n_0 < a}$.

\endexercise

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ prob: every_finite_set_of_reals_has_min_and_max 
\problem.
\label{every_finite_set_of_reals_has_min_and_max}%
Cada conjunto finito e não vazio $A\subseteq\reals$ possui
elemento mínimo $\min A$ e máximo $\max A$.

\hint
Indução no número de elementos do $A$.

\endproblem
%%}}}

%%{{{ prob: triminos 
\problem Triminôs.
\label{triminos}%

\endproblem
%%}}}

%%{{{ prob: induction_iff_strong_induction 
\problem.
\label{induction_iff_strong_induction}%
\ii{PIF}%
\ii{PIFF}%
$\text{PIF} \iff \text{PIFF}$.

\endproblem
%%}}}

%%{{{ prob: where_is_the_base_of_strong_induction 
\problem Cadê a base da indução forte?.
\label{where_is_the_base_of_strong_induction}%
Seguindo o teorema acima, parece que não precisamos provar uma ``base''
na indução forte.
Critique a seguinte afirmação:
``\emph{Quando quero provar um teorema da forma
$\forall n P(n)$
usando indução, eu preciso mostrar uma(s) base(s)
$P(0), P(1), \dotsc, P(b)$
e depois provar o $P(k+1)$,
dado apenas umas $b+1$ hipoteses:
$P(k), P(k-1), \dotsc, P(k-b)$.
No outro lado, usando indução forte eu preciso mostrar menos
coisas---não tenho que mostrar nenhuma base---,
e, alem disso, no meu esforço para provar o $P(k+1)$,
eu não vou ter apenas umas poucas hipoteses, mas
todos os $P(i)$ para $i<k+1$!
Como os dois princípios são equivalentes no $\nats$,
eu vou sempre usar indução forte.}''

\hint Quantos $i\in\nats$ satisfazem $i < 0$?

\endproblem
%%}}}

%%{{{ prob: ackermann_function 
\problem.
\label{ackermann_function}%
Considere a função recursiva $\alpha : \nats^2 \to \nats$ definida pelas equações:
$$
\align
\alpha(0,x)     &= x+1                      \tag{K1}\\
\alpha(n+1,0)   &= \alpha(n,1)              \tag{K2}\\
\alpha(n+1,x+1) &= \alpha(n,\alpha(n+1, x)))\tag{K3}  
\endalign
$$
\beginil
\item{(i)} Calcule o valor $\alpha(3,2)$, indicando para cada passo qual equação foi usada.
\item{(ii)} Prove que para todo $x\in\nats$, $\alpha(1,x) = x + 2$.
\item{(iii)} Prove que para todo $x\in\nats$, $\alpha(2,x) = 2x + 3$.
\endil
A função $\alpha$ é conhecida como função de \Ackermann{}Ackermann,
e vamos a encontrar novamente bem depois, no~\ref{Recursive_functions}.

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

Mais informações sobre indução e indução forte,
veja o~\cite[Cap.~6]{velleman}.
Sobre o princípio da boa ordem e indução,
veja o~\cite[\S\S1.4--1.5]{babybm}

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Functional programming 
\chapter Programação funcional.

%%{{{ Problems 
\problems.

%%{{{ prob: stretch_countdown_take 
{%
\def\stretch{\namedfun{stretch}}
\def\countdown{\namedfun{countdown}}
\def\take{\namedfun{take}}
\problem.
Defina as funções com equações (recursivas):
$$
\xalignat3
\stretch    &\eqtype \nats \to [\nats] \to [\nats] &
\countdown  &\eqtype \nats \to [\nats] &
\take       &\eqtype \nats \to [\nats] \to [\nats].\\
\endxalignat
$$
Exemplos de uso:
$$
\align
\stretch\ 3 [2,8]       &= [2,2,2,8,8,8]    \\
\stretch\ 2 [1,9,8,3]   &= [1,1,9,9,8,8,3,3]\\
\countdown\ 3           &= [3,2,1,0]        \\
\countdown\ 1           &= [1,0]            \\
\take\ 3\ [2,3,5,7,11]  &= [2,3,5]          \\
\take\ 8\ [0,1,2,4]     &= [0,1,2,4]
\endalign
$$

\endproblem
}
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{huttonhaskell},
\cite{lyah};
\cite{birdthinking},
\cite{thompsonhaskell};
\cite{birdfphaskell}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Enumerative combinatorics 
\chapter Combinatória enumerativa.

%%{{{ Counting principles 
\section Princípios de contagem.

%%{{{ Informally 
\note Informalmente.
Queremos contar todas as maneiras possíveis para algo acontecer,
certas configurações, certos objetos ser escolhidos, ou ordenados, etc.
Baseamos nossas idéia em dois princípios de contagem:
da \emph{adição} e da \emph{multiplicação}.
\endgraf
{O princípio da adição, informalmente:}
Se podemos grupar todos esses objetos em grupos \emph{distintos},
tais que cada objeto pertence em \emph{exatamente um} grupo,
o número total dos objetos é igual o somatório dos tamanhos dos grupos.
\endgraf
{O princípio da multiplicação, informalmente:}
Se cada configuração pode ser descrita completamente em $n$ passos,
onde para o primeiro passo temos $a_1$ opções,
para o segundo passo temos $a_2$ opções, etc., e
\emph{em cada passo a quantidade das opções disponíveis
não depende nas escolhas anteriores},
então existem em total $a_1a_2\dotsb a_n$ configurações possíveis.
%%}}}

%%{{{ principle: principle_of_addition 
\principle da adição.
\label{principle_of_addition}%
\tdefined{princípio}[da adição]
Seja $A$ conjunto finito, e $A_1,\dotsc,A_n$ subconjuntos dele tais que cada elemento $a\in A$, pertence em \emph{exatamente} um dos $A_i$.
Logo,
$$
|A| = \sum_{i=1}^n |A_i|.
$$
%%}}}

%%{{{ principle: principle_of_multiplication 
\principle da multiplicação.
\label{principle_of_multiplication}%
\tdefined{princípio}[da multiplicação]
Sejam $A_1,\dotsc,A_n$ conjuntos finitos.
Logo
$$
|A_1\times\dotsb\times A_n| = |A_1|\dotsb|A_n|.
$$
%%}}}

%%{{{ eg 
\example.
De quantas maneiras podemos escrever um string de tamanho $3$\dots
\item{(i)} Usando o alfabeto
$$
\set{\txt A, \txt B, \txt C, \dotsc, \txt X, \txt Y, \txt Z}?
$$
\item{(ii)} Usando o mesmo alfabeto, mas proibindo o mesmo caractere se repetir no string?

\solution
Consideramos a formação de cada string em passos, caractere a caractere.
Temos 3 posições para colocar os caracteres:
$
\underline{\phantom{\txt Z}}
\;
\underline{\phantom{\txt Z}}
\;
\underline{\phantom{\txt Z}}
\;
$.
\endgraf
Para a questão (i), temos:
$26$ maneiras para escolher o primeiro caractere,
$26$ para o segundo, e
$26$ para o último:
$$
\underbrace{
\underline{\phantom{\txt Z}}
}_{26}
\;
\underbrace{
\underline{\phantom{\txt Z}}
}_{26}
\;
\underbrace{
\underline{\phantom{\txt Z}}
}_{26}
\;.
$$
A escolha em cada passo não é afeitada por as escolhas dos passos anteriores.
Logo, pelo princípio da multiplicação tem
$$
26\ntimes 26\ntimes 26 = 26^3
$$
strings possíveis.
\endgraf
Para a questão (ii), temos:
$26$ maneiras para escolher o primeiro caractere,
$25$ para o segundo (todos menos aquele que escolhemos no passo anterior), e
$24$ para o último (similarmente):
$$
\underbrace{
\underline{\phantom{\txt Z}}
}_{26}
\;
\underbrace{
\underline{\phantom{\txt Z}}
}_{25}
\;
\underbrace{
\underline{\phantom{\txt Z}}
}_{24}
\;.
$$
Agora a escolha em cada passo realmente \emph{é afeitada} por as escolhas
dos passos anteriores!
Por exemplo, se no primeiro passo escolher o caractere $\txt C$, para
o segundo passo as opções incluem o caractere $\txt A$; 
mas se no primeiro passo escolher o caractere $\txt A$, as opções para o segundo
mudam: não temos essa opção mais.
\emph{Mesmo assim, podemos usar o princípio da multiplicação!}
Por quê?
As escolhas dos passos anteriores afeitam \emph{quais} são as escolhas do passo atual,
mas não afeitam \emph{quantas} elas são!
Por isso, chegamos no resultado aplicando mais uma vez o princípio da multiplicação:
temos
$$
26\ntimes 25\ntimes 24
$$
maneiras possíveis.
\endexample
%%}}}

%%{{{ x: 4 gifts for 3 kids 
\exercise.
Temos $4$ presentes e queremos dar para $3$ crianças tal que cada criança vai
receber apenas um presente.
\item{(i)} De quantas maneiras podemos disribuir os presentes para as crianças?
\item{(ii)} O que muda se as crianças são $4$?  Explique.

\endexercise
%%}}}

%%{{{ x: in how many ways can we write strings of length 2 using ABCD 
\exercise.
De quantas maneiras podemos escrever strings de tamanho $2$ usando o alfabeto
$$
\set{\txt A, \txt B, \txt C, \txt D},
$$
tais que as letras aparecem em ordem que concorda com a do alfabeto?
Por exemplo os string $\txt A \txt C$, $\txt B \txt B$, e $\txt C \txt D$ são aceitáveis,
mas os $\txt D \txt C$ e $\txt B \txt A$, não.

\hint
Cuidado: aqui a \emph{quantidade} das opções da segunda escolha, depende sim na escolha
anterior!

\hint
Separa os strings possíveis em colecções e conta os strings de cada colecção separadamente,
somando no final (princípio de adição) para achar o resultado.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Permutations and combinations 
\section Permutações e combinações.
\label{Permutations_and_combinations}%

\question. De quantas maneiras podemos escolher $r$ objetos de $n$?

Essa questão é bastante ambígua;
por exemplo:
Os $n$ objetos são todos distintos?
Podemos repetir o mesmo objeto na nossa escolha?

\definition.
\label{comb_perm_totperm}%
\sdefined {\totperm {\holed n}} {o número de permutações (totais) de \holed n objetos}%
\sdefined {\perm {\holed n} {\holed r}} {o número de $\holed r$-permutações de \holed n objetos}%
\sdefined {\comb {\holed n} {\holed r}} {o número de $\holed r$-combinações de \holed n objetos}%
Usamos os símbolos:
$$
\align
\totperm n &:\quad\text{o número de permutações totais de $n$ objetos}\\
\perm n r  &:\quad\text{o número de $r$-permutações de $n$ objetos}\\
\comb n r  &:\quad\text{o número de $r$-combinações de $n$ objetos}
\endalign
$$
Onde entendemos que:
\beginol
\li os $n$ objetos são distíntos;
\li não podemos os repetir.
\endol
Observe que as permutações totais são apenas casos especiais de $r$-permutações.
Na literatura encontramos $r$-permutações também com o nome \dterm{arranjos},
mas nos vamos evitar esse termo aqui para evitar confusão.

\proposition Permutações totais.
\label{total_permutations}
\tdefined{permutação}[total]
\iisee{arranjo}{permutação}
$$
\totperm n = {n!}.
$$

\proposition Permutações.
\tdefined{permutação}
$$
\perm n r = \frac {n!} {(n-r)!}.
$$

\proposition Combinações.
\tdefined{combinação}
$$
\comb n r = \frac {n!} {(n-r)!\stimes r!}.
$$

\example.
10 amigos têm vontade viajar com um carro de 5 vagas.
De quantas maneiras diferentes 5 deles podem entrar no carro?
Considere que o que diferencia mesmo a configuração são apenas a posição
do motorista e do copiloto.

\solution
Vamos ver dois jeitos diferentes para contar essas configurações:
\endgraf
\proofstyle{\indent Jeito 1:}
Escrevendo
$$
\comb {10} 1
\ntimes
\comb 9 1
\ntimes
\comb 8 3
$$
já é meio auto-explicativo: formamos cada configuração em passos:
{(i)}      escolher o motorista;
{(ii)}     escolher o copiloto;
{(iii)}    escolher os passangeiros de trás.
\endgraf
\proofstyle{\indent Jeito 2:}
Outra método para formar cada configuração seria:
{(i)}      escolher os 5 que vão entrar no carro;
{(ii)}     escolher qual vai ser o motorista;
{(iii)}    escolher qual vai ser o copiloto.
pensando assim chegamos no cálculo
$$
\underbrace{\comb {10} 5}_{\text{(i)}}
\ntimes
\underbrace{\comb 5 1}_{\text{(ii)}}
\ntimes
\underbrace{\comb 4 1}_{\text{(iii)}}.
$$
\endgraf
Olhando para os dois cálculos
$$
\comb {10} 1 \ntimes \comb 9 1 \ntimes \comb 8 3
\askeq
\comb {10} 5 \ntimes \comb 5 1 \ntimes \comb 4 1
$$
não é óbvio que seus valores são iguais.  Calculamos
$$
\alignat2
\comb {10} 1 \ntimes \comb 9 1 \ntimes \comb 8 3
&= 10 \ntimes 9 \ntimes \frac {8!} {5!\stimes3!}
&&= \frac {10!} {5!\stimes3!}
\\
\comb {10} 5 \ntimes \comb 5 1 \ntimes \comb 4 1
&= \frac {10!} {5!\stimes 5!} \ntimes 5 \ntimes 4
&&= \frac {10!} {5!\stimes 3!}
\endalignat
$$
e respondemos (felizmente) que em total temos
$$
\frac {10!} {5!\stimes3!}
= \frac{10 \ntimes 9 \ntimes 8\ntimes7\ntimes6} { 3! }
= 10 \ntimes 9 \ntimes 8\ntimes7
= 5040
$$
configurações diferentes.
\endexample

\endsection
%%}}}

%%{{{ Permutations in a circle 
\section Permutações cíclicas.

\example.
\label{circle_dance_of_8}
$8$ pessoas querem dançar uma dança em qual
todos precisam formar um ciclo pegando as mãos
(e olhando para o interior do ciclo).
Em quantas configurações diferentes essa dança pode começar?

\solution
Vamos resolver esse problema seguindo duas idéias bem diferentes:
\endgraf
\proofstyle{\indent Idéia~1.}
Consideramos primeiro a questão:
``\emph{de quantas maneiras podemos permutar as $8$ pessoas numa ordem?}''
Respondemos $8!$, o número das permutações totais de $8$ objetos
(sabendo que hipercontamos para o problema original).
Mas podemos calcular que cada resposta do problema original,
corresponde em exatamente $8$ respostas do problema novo
(uma para cada ``circular shift'').
Então basta só dividir a ``hiperconta'' por $8$, e chegamos
no resultado final: $8! / 8$, ou seja, $7!$.
\endgraf
\proofstyle{\indent Idéia~2.}
\emph{Fixamos uma pessoa como ``determinante'' da configuração;}
a idéia sendo que para comparar duas configurações nos vamos
começar com o determinante, e depois comparar em ordem fixa
o resto da configuração
(por exemplo indo cada vez de uma pessoa
para quem tá no lado direito dela).
Assim, para cada permutação total das 7 outras pessoas,
temos uma permutação circular das 8 e vice-versa,
ou seja, a resposta final é $7!$.
\endexample

\midinsert
\hfil
\tikzpicture[scale=0.8]%%{{{
\draw (0,0) circle (2cm);
\foreach \t in {0,45,90,135,180,225,270,315}
    \node[circle,fill=white] (a\t) at (\t:2cm) {$\phantom{p_0}$};
\node[circle,fill=white] at (a0)   {$p_0$};
\node[circle,fill=white] at (a45)  {$p_1$};
\node[circle,fill=white] at (a90)  {$p_2$};
\node[circle,fill=white] at (a135) {$p_3$};
\node[circle,fill=white] at (a180) {$p_4$};
\node[circle,fill=white] at (a225) {$p_5$};
\node[circle,fill=white] at (a270) {$p_6$};
\node[circle,fill=white] at (a315) {$p_7$};
\endtikzpicture
%%}}}
\hfil
\tikzpicture[scale=0.8]%%{{{
\draw (0,0) circle (2cm);
\foreach \t in {0,45,90,135,180,225,270,315}
    \node[circle,fill=white] (a\t) at (\t:2cm) {$\phantom{a_0}$};
\node[circle,fill=white] at (a315)  {$p_0$};
\node[circle,fill=white] at (a0)    {$p_1$};
\node[circle,fill=white] at (a45)   {$p_2$};
\node[circle,fill=white] at (a90)   {$p_3$};
\node[circle,fill=white] at (a135)  {$p_4$};
\node[circle,fill=white] at (a180)  {$p_5$};
\node[circle,fill=white] at (a225)  {$p_6$};
\node[circle,fill=white] at (a270)  {$p_7$};
\endtikzpicture
%%}}}
\hfil
\endgraf\centerline{Uma configuração do~\refn{circle_dance_of_8} representada em dois jeitos diferentes no papel.}
\endinsert

Generalizando concluimos que:

\proposition.
As configurações circulares diferentes de $n$ objetos, $n>0$ são
$$
(n-1)!.
$$

\exercise.
O que mudará na contagem do~\ref{circle_dance_of_8},
se cada dançador pode olhar ou para o interior ou para o exterior do círculo?

\hint
Começando com a mesma resposta ($7!$) do~\ref{circle_dance_of_8},
claramente nos hipocontamos---mas quanto?

\hint
Considere uma configuração do~\ref{circle_dance_of_8}.
Com quantas configurações do problema atual ela corresponde?

\endexercise

\exercise.
O que mudará na contagem do~\ref{circle_dance_of_8},
se temos $4$ mulheres e $4$ homens e as regras da dança
mandam alternar os sexos na configuração?

\hint
Construa cada configuração em passos.

\hint
Primeiramente, esqueça os homens (ou as mulheres)
e coloca as $4$ mulheres (ou os $4$ homens)
num ciclo.
De quantas maneiras pode escolher o resto para
entrar no círculo?

\endexercise

\exercise.
Temos $8$
miçangas
diferentes, e queremos pôr todas
numa
corrente
para criar uma pulseira.
Quantas maneiras diferentes temos para o criar?

\hint
Se tu achar o problema igual com o~\ref{circle_dance_of_8},
tu hipercontarás\dots Quanto?

\hint
Veja a figura.
Pode explicar por que as três representações
correspondem na mesma configuração?
\topinsert
\centerline{
\tikzpicture[scale=0.8]%%{{{
\draw (0,0) circle (2cm);
\foreach \t in {0,45,90,135,180,225,270,315}
    \node[circle,fill=white] (a\t) at (\t:2cm) {$\phantom{a_0}$};
\node[circle,fill=red!33]       at (a0)   {$a_0$};
\node[circle,fill=green!33]     at (a45)  {$a_1$};
\node[circle,fill=blue!33]      at (a90)  {$a_2$};
\node[circle,fill=cyan!33]      at (a135) {$a_3$};
\node[circle,fill=magenta!33]   at (a180) {$a_4$};
\node[circle,fill=yellow!33]    at (a225) {$a_5$};
\node[circle,fill=orange!33]    at (a270) {$a_6$};
\node[circle,fill=brown!33]     at (a315) {$a_7$};
\endtikzpicture
%%}}}
\hfil
\tikzpicture[scale=0.8]%%{{{
\draw (0,0) circle (2cm);
\foreach \t in {0,45,90,135,180,225,270,315}
    \node[circle,fill=white] (a\t) at (\t:2cm) {$\phantom{a_0}$};
\node[circle,fill=red!33]       at (a315)  {$a_0$};
\node[circle,fill=green!33]     at (a0)    {$a_1$};
\node[circle,fill=blue!33]      at (a45)   {$a_2$};
\node[circle,fill=cyan!33]      at (a90)   {$a_3$};
\node[circle,fill=magenta!33]   at (a135)  {$a_4$};
\node[circle,fill=yellow!33]    at (a180)  {$a_5$};
\node[circle,fill=orange!33]    at (a225)  {$a_6$};
\node[circle,fill=brown!33]     at (a270)  {$a_7$};
\endtikzpicture
%%}}}
\hfil
\tikzpicture[scale=0.8]%%{{{
\draw (0,0) circle (2cm);
\foreach \t in {0,45,90,135,180,225,270,315}
    \node[circle,fill=white] (a\t) at (\t:2cm) {$\phantom{a_0}$};
\node[circle,fill=red!33]       at (a315)  {$a_0$};
\node[circle,fill=green!33]     at (a270)  {$a_1$};
\node[circle,fill=blue!33]      at (a225)  {$a_2$};
\node[circle,fill=cyan!33]      at (a180)  {$a_3$};
\node[circle,fill=magenta!33]   at (a135)  {$a_4$};
\node[circle,fill=yellow!33]    at (a90)   {$a_5$};
\node[circle,fill=orange!33]    at (a45)   {$a_6$};
\node[circle,fill=brown!33]     at (a0)    {$a_7$};
\endtikzpicture
%%}}}
}
\botcaption{}
\emph{Apenas uma} das configurações da pulseira, representada em três desenhos.
\endcaption
\endinsert

\endexercise

\endsection
%%}}}

%%{{{ Together or separated 
\section Juntos ou separados.

\example.
\label{dinner_of_8_with_couple}
Suponha que $8$ pessoas $A,B,C,D,E,F,G,H$ querem sentar num bar
mas $C$ e $D$ querem sentar juntos.
De quantas maneiras isso pode acontecer?

\solution
\emph{Vamos imaginar que $C$ e $D$ são uma pessoa, chamada $CD$.}
Nos perguntamos de quantas maneiras as 7 pessoas $A,B,CD,E,F,G,H$ podem sentar
numa mesa de bar com $7$ banquinhos.
A resposta é os permutações totais de tamanho 7, ou seja, $7!$.
Mas para cada configuração desse problema,
correspondem \emph{duas} configurações do problema original, porque os
$C$ e $D$ podem sentar em duas ordens diferentes juntos.
A resposta final:
$7! \ntimes 2$.
\endexample

\exercise.
Suponha que 8 pessoas $A,B,C,D,E,F,G,H$ querem jantar numa mesa de bar.
Em quantas configurações diferentes eles podem sentar se\dots:
\item{(1)} os $C$ e $D$ e $E$ querem sentar juntos;
\item{(2)} os $F$ e $G$ não podem sentar juntos;
\item{(3)} as duas restrições (1) e (2).

\hint
\item{(1)} Como no \ref{dinner_of_8_with_couple},
           considere o problema onde $C$, $D$, e $E$ são uma pessoa só.
\item{(2)} Conte o complementar e subtraia do total sem restrição;
\item{(3)} Conte as configurações em quais $C$, $D$, e $E$ sentam juntos e subtraia
           as configurações onde, alem disso, $F$ e $G$ também sentam juntos.

\solution
(1) Como no \ref{dinner_of_8_with_couple}, traduzimos o problema para um onde
$C$, $D$, e $E$, são uma pessoa---vamos a chamar de $CDE$---e as
$6$ pessoas $A,B,CDE,F,G,H$ querem jantar numa mesa de bar com 6 banquinhos.
Cada solução desse problema corresponde em tantas configurações quantas as $3$ pessoas
$C$, $D$, $E$ podem sentar numa ordem, ou seja $\totperm 3$ configurações.
A resposta final:
$$
\totperm 6 \ntimes \totperm 3 = 6!\stimes3! = 6!\stimes 6
$$
\endgraf
(2) Contamos o complementar:
todas as maneiras onde $F$ e $G$ sentam juntos ($7!\ntimes 2$),
e o tiramos de todas as maneiras sem restrição ($8!$):
$$
\totperm 8 - \totperm 7 \ntimes \totperm 2
= 8! - 7!\ntimes 2! = 7!(8 - 2)
= 7!\stimes 6
$$
(3) Já achamos quantas maneiras tem onde $C$, $D$, e $E$ sentam juntos: $6!\stimes6$.
Disso, precisamos subtrair as configurações onde $F$ e $G$ também sentam juntos:
para satisfazer as duas restrições, consideramos as $5$ ``pessoas''
$A,B,CDE,FG,H$, quais podem sentar numa mesa de bar de tamanho $5$ de
$$
\totperm 5 \stimes \totperm 3 \stimes \totperm 2
= 5! \stimes 3! \stimes 2!
= 5! \stimes 6 \stimes 2
= 6! \stimes 2
$$
maneiras.
A resposta final então é
$$
6!\stimes6 - 6!\stimes2 = 6!(6-2) = 6! \stimes 4.
$$

\endexercise

Generalizando:

\proposition.
O número das permutações totais de $m$ objetos distintos com a restrição que
certos $c$ deles tem que estar consecutivos é
$$
(m-c+1)! \stimes c!.
$$

\endsection
%%}}}

%%{{{ Permutations of things not all distinct 
\section Permutações de objetos não todos distintos.

\question.
De quantas maneiras podemos permutar $n$ objetos se
eles não são todos distíntos?

\example.
\label{pessimissimo}
Conte todas as palavras feitas por permutações das 12 letras da palavra
$$
\txt{PESSIMISSIMO}.
$$

\solution
Vamos contar em dois jeitos diferentes:
\endgraf
\proofstyle{Idéia 1:}
Construimos cada palavra possível ``em passos'',
usando o princípio da multplicação para achar o número total.
$$
\alignat 2
\text{Começamos com 12 espaços:}
\qquad&
\underline{\phantom {\txt M}} \ 
\underline{\phantom {\txt I}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt I}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt I}} \ 
\underline{\phantom {\txt P}} \ 
\underline{\phantom {\txt O}} \ 
\underline{\phantom {\txt E}} \ 
\underline{\phantom {\txt M}}
\\
\text{escolhemos onde colocar o ${\txt P}$:}
\qquad&
\underline{\phantom {\txt M}} \ 
\underline{\phantom {\txt I}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt I}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt I}} \ 
          {         {\txt P}} \ 
\underline{\phantom {\txt O}} \ 
\underline{\phantom {\txt E}} \ 
\underline{\phantom {\txt M}}
&\qquad&
\text{tivemos $\comb {12} 1$ opções;}
\\
\text{depois o ${\txt E}$:}
\qquad&
\underline{\phantom {\txt M}} \ 
\underline{\phantom {\txt I}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt I}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt S}} \ 
\underline{\phantom {\txt I}} \ 
          {         {\txt P}} \ 
\underline{\phantom {\txt O}} \ 
          {         {\txt E}} \ 
\underline{\phantom {\txt M}}
&\qquad&
\text{tivemos $\comb {11} 1$ opções;}
\\
\text{depois os 4 ${\txt S}$:}
\qquad&
\underline{\phantom {\txt M}} \ 
\underline{\phantom {\txt I}} \ 
          {         {\txt S}} \ 
          {         {\txt S}} \ 
\underline{\phantom {\txt I}} \ 
          {         {\txt S}} \ 
          {         {\txt S}} \ 
\underline{\phantom {\txt I}} \ 
          {         {\txt P}} \ 
\underline{\phantom {\txt O}} \ 
          {         {\txt E}} \ 
\underline{\phantom {\txt M}}
&\qquad&
\text{tivemos $\comb {10} 4$ opções;}
\\
\text{depois os 3 ${\txt I}$:}
\qquad&
\underline{\phantom {\txt M}} \ 
          {         {\txt I}} \ 
          {         {\txt S}} \ 
          {         {\txt S}} \ 
          {         {\txt I}} \ 
          {         {\txt S}} \ 
          {         {\txt S}} \ 
          {         {\txt I}} \ 
          {         {\txt P}} \ 
\underline{\phantom {\txt O}} \ 
          {         {\txt E}} \ 
\underline{\phantom {\txt M}}
&\qquad&
\text{tivemos $\comb 6 3$ opções;}
\\
\text{depois os 2 ${\txt M}$:}
\qquad&
          {         {\txt M}} \ 
          {         {\txt I}} \ 
          {         {\txt S}} \ 
          {         {\txt S}} \ 
          {         {\txt I}} \ 
          {         {\txt S}} \ 
          {         {\txt S}} \ 
          {         {\txt I}} \ 
          {         {\txt P}} \ 
\underline{\phantom {\txt O}} \ 
          {         {\txt E}} \ 
          {         {\txt M}}
&\qquad&
\text{tivemos $\comb 3 2$ opções;}
\\
\text{e finalmente o ${\txt O}$:}
\qquad&
          {         {\txt M}} \ 
          {         {\txt I}} \ 
          {         {\txt S}} \ 
          {         {\txt S}} \ 
          {         {\txt I}} \ 
          {         {\txt S}} \ 
          {         {\txt S}} \ 
          {         {\txt I}} \ 
          {         {\txt P}} \ 
          {         {\txt O}} \ 
          {         {\txt E}} \ 
          {         {\txt M}}
&\qquad&
\text{tivemos $\comb 1 1$ opção.}
\endalignat
$$
Pelo princípio da multiplicação, a resposta é o produto
$$
\align
\underbrace{\comb {12} 1}_{\dsize {\txt P}}
\underbrace{\comb {11} 1}_{\dsize {\txt E}}
\underbrace{\comb {10} 4}_{\dsize4{\txt S}}
\underbrace{\comb {6}  3}_{\dsize3{\txt I}}
\underbrace{\comb {3}  2}_{\dsize2{\txt M}}
\underbrace{\comb {1}  1}_{\dsize {\txt O}}
&=
\frac
{12!}
{\cancel{11!}\stimes 1!}
\frac
{\cancel{11!}}
{\cancel{10!}\stimes 1!}
\frac
{\cancel{10!}}
{\cancel{6!}\stimes 4!}
\frac
{\cancel{6!}}
{\cancel{3!}\stimes 3!}
\frac
{\cancel{3!}}
{\cancel{1!}\stimes 2!}
\frac
{\cancel{1!}}
{0!\stimes 1!}\\
&=
\frac
{12!}
{1!
\stimes 1!
\stimes 4!
\stimes 3!
\stimes 2!
\stimes 1!
}
=
\frac
{12!}
{
4!
\stimes 3!
\stimes 2!
}.
\endalign
$$
\endgraf
\proofstyle{Idéia 2:}
Contamos as maneiras se todas as letras fossem distintas,
por exemplo marcando cada letra com índices:
$$
{\txt P}_1\ 
{\txt E}_1\ 
{\txt S}_1\ 
{\txt S}_2\ 
{\txt I}_1\ 
{\txt M}_1\ 
{\txt I}_2\ 
{\txt S}_3\ 
{\txt S}_4\ 
{\txt I}_3\ 
{\txt M}_2\ 
{\txt O}_1\,.
$$
Sabemos que são $12!$ e que
assim temos \emph{hipercontado} para nosso problema.
Por exemplo, a palavra 
$
{\txt M}
{\txt I}
{\txt S}
{\txt S}
{\txt I}
{\txt S}
{\txt S}
{\txt I}
{\txt P}
{\txt O}
{\txt E}
{\txt M}
$
corresponde em várias palavras do problema novo;
escrevemos três delas aqui como exemplos:
$$
{\txt M}\ 
{\txt I}\ 
{\txt S}\ 
{\txt S}\ 
{\txt I}\ 
{\txt S}\ 
{\txt S}\ 
{\txt I}\ 
{\txt P}\ 
{\txt O}\ 
{\txt E}\ 
{\txt M}
\ 
\transto
\ 
\left\{
\gathered
{\txt M}_1\ 
{\txt I}_1\ 
{\txt S}_1\ 
{\txt S}_2\ 
{\txt I}_2\ 
{\txt S}_3\ 
{\txt S}_4\ 
{\txt I}_3\ 
{\txt P}_1\ 
{\txt O}_1\ 
{\txt E}_1\ 
{\txt M}_2
\\
{\txt M}_2\ 
{\txt I}_1\ 
{\txt S}_1\ 
{\txt S}_2\ 
{\txt I}_2\ 
{\txt S}_3\ 
{\txt S}_4\ 
{\txt I}_3\ 
{\txt P}_1\ 
{\txt O}_1\ 
{\txt E}_1\ 
{\txt M}_1
\\
{\txt M}_2\ 
{\txt I}_1\ 
{\txt S}_4\ 
{\txt S}_3\ 
{\txt I}_2\ 
{\txt S}_2\ 
{\txt S}_1\ 
{\txt I}_3\ 
{\txt P}_1\ 
{\txt O}_1\ 
{\txt E}_1\ 
{\txt M}_1
\\
\vdots
\endgathered
\quad\qquad
\right\}
\ \text{\dots quantas?}
$$
Mas é fácil calcular quanto hipercontamos:
\emph{cada} palavra do problema original corresponde em exatamente tantas palavras
quantas as maneiras de permutar cada grupo de letras ``subindicadas'' entre si,
ou seja:
$$
\underbrace{1!}_{{\txt P}} \ntimes
\underbrace{1!}_{{\txt E}} \ntimes
\underbrace{4!}_{{\txt S}} \ntimes
\underbrace{3!}_{{\txt I}} \ntimes
\underbrace{2!}_{{\txt M}} \ntimes
\underbrace{1!}_{{\txt O}}
$$
maneiras.
Para responder então, basta dividir o número da ``hipercontagem'' por esse:
$$
\frac
{12!}
{4!\stimes 3!\stimes 2!}.
$$
\moveqedup
\endexample

\exercise.
Escolhendo outra ordem de colocar as letras
na \proofstyle{Idéia 1} do~\ref{pessimissimo}
nossas opções em cada passo seriam diferentes.
Explique porque podemos usar o princípio da multiplicação mesmo assim.

\hint
Presta atenção na frase
``\emph{em cada passo a quantidade das opções disponíveis
não depende nas escolhas anteriores}''.

\solution
O imporante é que em cada passo, qual das nossas disponíveis opções
será escolhida, não vai afeitar a quantidade das nossas opções no passo seguinte.
Isso é realmente valido nesse caso.
Se escolher colocar as letras em outra ordem, por exemplo a
$
{\txt S},
{\txt E},
{\txt I},
{\txt P},
{\txt O},
{\txt M}
$, teriamos quantidades diferentes para cada passo sim,
\emph{mas}\/:
cada uma das nossas escolhas, não afeitaria a quantidade das escolhas próximas.
Com essa ordem, chegamos no mesmo resultado (com um cálculo que de longe aparece diferente):
$$
\align
\underbrace{\comb {12} 4}_{\dsize4{\txt S}}
\underbrace{\comb {8}  1}_{\dsize {\txt E}}
\underbrace{\comb {7}  3}_{\dsize3{\txt I}}
\underbrace{\comb {4}  1}_{\dsize {\txt P}}
\underbrace{\comb {3}  1}_{\dsize {\txt O}}
\underbrace{\comb {2}  2}_{\dsize2{\txt M}}
&=
\frac
{12!}
{\cancel{8!}\stimes 4!}
\frac
{\cancel{8!}}
{\cancel{7!}\stimes 1!}
\frac
{\cancel{7!}}
{\cancel{4!}\stimes 3!}
\frac
{\cancel{4!}}
{\cancel{3!}\stimes 1!}
\frac
{\cancel{3!}}
{\cancel{2!}\stimes 1!}
\frac
{\cancel{2!}}
{0!\stimes 2!}\\
\vphantom{
\underbrace{\comb {12} 4}_{\dsize4{\txt S}}
\underbrace{\comb {8}  1}_{\dsize {\txt E}}
\underbrace{\comb {7}  3}_{\dsize3{\txt I}}
\underbrace{\comb {4}  1}_{\dsize {\txt P}}
\underbrace{\comb {3}  1}_{\dsize {\txt O}}
\underbrace{\comb {2}  2}_{\dsize2{\txt M}}
}
&=
\frac
{12!}
{4!
\stimes 1!
\stimes 3!
\stimes 1!
\stimes 1!
\stimes 2!
}\\
&=
\frac
{12!}
{
4!
\stimes 3!
\stimes 2!
}.
\endalign
$$

\endexercise

\endsection
%%}}}

%%{{{ Binomial coefficients 
\section Binomial e seus coeficientes.

\theorem Binomial.
\ii{teorema}[binomial]%
\iisee{binomial}[teorema]{teorema binomial}%
\label{binomial_theorem}%
Sejam $x,y\in\ints$ e $n\in\nats$.
$$
\align
(x+y)^n
&= \binom n 0 x^n + \binom n 1 x^{n-1}y + \dotsb + \binom n {n-1} xy^{n-1} + \binom n n y^n\\
&= \sum_{i=0}^n \binom n i x^{n-i}y^i.
\endalign
$$
\sketch.
Queremos achar quantas vezes o termo $x^{n-r}y^r$ aparece na expansão do binomial.
Escrevendo
$$
(x+y)^n = \underbrace{(x+y)(x+y)\dotsb(x+y)}_{\text{$n$ vezes}}
$$
observamos que para cada das $\comb n r$ maneiras de escolher $r$ dos termos acima,
corresponde um termo $x^{n-r}y^r$:
``escolhe quais dos termos do produto vão oferecer seu $y$
(o resto dos termos oferecerá seus $x$'s)''.
Isso justifica os coeficientes $\binom n r$.
Por exemplo, para $n=7$ e $r=4$, a escolha
$$
(x+y)^7
=
(x+y)
\underbrace{(x+y)}_{\text{``$y$''}}\,
(x+y)
\underbrace{(x+y)}_{\text{``$y$''}}
\underbrace{(x+y)}_{\text{``$y$''}}\,
(x+y)
\underbrace{(x+y)}_{\text{``$y$''}}
$$
corresponde no produto
$xyxyyxy = x^3y^4$, e cada diferente escolha das $\binom 7 4$
correspondará com uma maneira diferente para formar o $x^3y^4$.
\qes

\endsection
%%}}}

%%{{{ Number of subsets 
\section Número de subconjuntos. 
\label{Number_of_subsets}%

\question.
Quantos subconjuntos dum conjunto finito existem?

\note Idéia 1.
\label{subset_count_using_strings}
Começamos com um exemplo de um conjunto $A$ de tamanho 6:
$$
A = \set{a, b, c, d, e, f}.
$$
Uns subconjuntos de $A$ são os:
$$
\set{a,d,e},
\qquad
\emptyset,
\qquad
\set{a},
\qquad
\set{b,c,e,f},
\qquad
A,
\qquad
\set{f},
\qquad
\dotsc
$$
Queremos contar todos os subconjuntos de $A$.
Vamos \emph{traduzir o problema} de contar os subconjuntos do $A$
para um problema que involve $n$-tuplas de dois símbolos ``0'' e ``1'', ``sim'' e ``não'', ``$\in$'' e ``$\notin$'', etc.
(Obviamente \emph{quais} são esses símbolos não afeita nada; o que importa é
que são dois símbolos distintos.)
Podemos associar agora cada dessas tuplas (ou strings) de tamanho $n$ para um
subconjunto de $A$, e vice-versa, chegando numa correspondência entre as duas
colecções de objetos.
Naturalmente associamos, por exemplo,
$$
\def\Y{1}
\def\N{0}
\underbrace{
\matrix
a  & b  & c  & d  & e  & f \\
\Y & \N & \N & \Y & \Y & \N\\
\N & \N & \N & \N & \N & \N\\
\Y & \N & \N & \N & \N & \N\\
\N & \Y & \Y & \N & \Y & \Y\\
\Y & \Y & \Y & \Y & \Y & \Y\\
\N & \N & \N & \N & \N & \Y\\
\vdots&
\vdots&
\vdots&
\vdots&
\vdots&
\vdots
\endmatrix
}_{\text{Strings de tamanho 6 do alfabeto $\set{\N,\Y}$}}
\quad\bitrans\quad
\underbrace{
\matrix
\format
\c\\
\\
\set{a,d,e}\\
\emptyset\\
\set{a}\\
\set{b,c,e,f}\\
A\\
\set{f}\\
\vdots
\endmatrix
}_{\text{Subconjuntos de $A$}}
$$
e verificamos que realmente cada configuração do problema original de subconjuntos
corresponde exatamente numa configuração do problema novo dos strings e vice-versa.
\endgraf
\emph{O que ganhamos?}
Sabemos como contar todos esses strings: são $2^6$.
Concluimos que os subconjuntos do $A$ são $2^6$ também.

Generalizando essa idéia chegamos no resultado:

\proposition.
\label{number_of_subsets_of_finite_set}
Seja $A$ conjunto finito.
$$
\card{\pset A} = 2^{\card A}.
$$

\note Idéia 2.
\label{subset_count_by_grouping}
Um outro jeito para contar todos os subconjuntos dum dado conjunto $A$, seria
os separar em grupos baseados no seu tamanho.
Assim, percebos que esses subconjuntos são naturalmente divididos em $n+1$ colecções:
subconjuntos com $0$ elementos, com $1$ elemento, \dots, com $n$ elementos.
\endgraf
\emph{O que ganhamos?}
Sabemos como contar os elementos de cada uma dessas colecções:
para formar um subconjunto de tamanho $r$, precisamos escolher $r$ dos $n$ elementos,
ou seja, existem $\comb n r$ subconjuntos de tamanho $r$.
Agora, pelo princípio da adição basta apenas somar:
são
$\sum_{i=0}^n \comb n i$.
\endgraf
\emph{Qual o problema?}
Comparando essa solução com a do item~\refn{subset_count_using_strings},
aqui temos a dificuldade de realmente calcular todos os $n$ números $\comb n i$
para os somar.
O~\ref{sum_of_all_binomial_coefficients} mostre que na verdade,
não é nada dificil calcular o somatório diretamente sem nem
calcular nenhum dos seus termos separadamente!

\proposition.
Seja $A$ conjunto finito.
$$
\card{\pset A} = \sum_{i=0}^n \comb n i,\qquad\text{onde $n = \card A$}.
$$


Combinando as duas proposições chegamos num resultado interessante:

\corollary.
Para todo $n\in\nats$,
$$
\sum_{i=0}^n \binom n i
= \binom n 0 + \binom n 1 + \dotsb + \binom n {n-1} + \binom n n
= 2^n
$$

\exercise.
\label{sum_of_all_binomial_coefficients}
Esqueça o corolário e prove que:
$$
\alignat 2
\sum_{i=0}^n \binom n i
&= \binom n 0 + \binom n 1 + \binom n 2 + \dotsb + \binom n n
&&= 2^n\\
\sum_{i=0}^n (-1)^i \binom n i
&=\binom n 0 - \binom n 1 + \binom n 2 - \dotsb + (-1)^n \binom n n
&&= 0
\endalignat
$$

\hint
Teorema binomial~\refn{binomial_theorem}.

\hint
Cada somatório é apenas um caso especial do teorema binomial.

\hint
Toma $x = y = 1$ no teorema para resolver o primeiro.

\hint
Toma $x = 1$ e $y = -1$ para resolver o segundo.

\endexercise

\endsection
%%}}}

%%{{{ Pascal's triangle 
\section O triângulo de Pascal.

\note As primeiras potências do binomial.
Calculamos:
$$
\align
(x+y)^0 &= 1\\
(x+y)^1 &= x   + y\\
(x+y)^2 &= x^2 + 2 xy    + y^2\\
(x+y)^3 &= x^3 + 3 x^2y  + 3 xy^2     + y^3\\
(x+y)^4 &= x^4 + 4 x^3y  + 6 x^2y^2   + 4xy^3      + y^4\\
(x+y)^5 &= x^5 + 5 x^4y  + 10 x^3y^2  + 10 x^2y^3  + 5 xy^4     + y^5\\
(x+y)^6 &= x^6 + 6 x^5y  + 15 x^4y^2  + 20 x^3y^3  + 15 x^2y^4  + 6 xy^5    + y^6\\
(x+y)^7 &= x^7 + 7 x^6y  + 21 x^5y^2  + 35 x^4y^3  + 35 x^3y^4  + 21 x^2y^5 + 7 xy^6    + y^7\\
(x+y)^8 &= x^8 + 8 x^7y  + 28 x^6y^2  + 56 x^5y^3  + 70 x^4y^4  + 56 x^3y^5 + 28 x^2y^6 + 8 xy^7 + y^8
\endalign
$$

\note O triângulo de Pascal.
\tdefined{triângulo}[de Pascal]
Tomando os coeficientes acima criamos o triângulo seguinte,
conhecido como \emph{triângulo de \Pascal[triângulo]{}Pascal}:%
$$
\matrix
\format
\;\c\; &
\;\c\; &
\;\c\; &
\;\c\; &
\;\c\; &
\;\c\; &
\;\c\; &
\;\c\; &
\;\c\; &
\;\c\; &
\;\c\; \\
1\\
1&1\\
1&2&1\\
1&3&3&1\\
1&4&6&4&1\\
1&5&10&10&5&1\\
1&6&15&20&15&6&1\\
1&7&21&35&35&21&7&1\\
1&8&28&56&70&56&28&8&1\\
\;\vdots\;&
\phantom{00}&
\phantom{00}&
\phantom{00}&
\phantom{00}&
\phantom{00}&
\phantom{00}&
\phantom{00}&
\phantom{00}&
\ddots
\endmatrix
$$

Observando o triângulo, percebemos que com umas exceções---quais?---cada
número é igual à soma de dois números \emph{na linha em cima}:
aquele que fica na mesma posição, e aquele que fica na posição anterior.
(Consideramos os ``espaços'' no triângulo como se fossem $0$'s.)

\exercise.
Escreva essa relação formalmente.

\hint
O $\binom a b$ está na linha $a$, na posição $b$
(começando contar com 0).

\solution
Temos as equações:
$$
\left.
\aligned
\binom 0 0          &= 1\\
\binom 0 r          &= 0\\
\binom n r          &= \binom {n-1} r + \binom {n-1} {r-1}
\endaligned
\right\}
\quad
\text{equivalentemente}
\quad
\left\{
\aligned
\binom 0     0      &= 1\\
\binom 0     {r+1}  &= 0\\
\binom {n+1} {r+1}  &= \binom n {r+1} + \binom n r.
\endaligned
\right.
$$

\endexercise

\theorem.
\label{combinations_recursive_equation}
Para todos inteiros positivos $n$ e $r$ positivos temos:
$$
\comb n r           = \comb {n-1} r + \comb {n-1} {r-1}.
$$
\sketch.
Lembramos que $\comb n r$ é o número das maneiras que podemos
escolher $r$ de $n$ objetos.
Fixe um dos $n$ objetos e denota-lo por $s$,
para agir como ``separador'':
separamos as maneiras de escolher em dois grupos:
aquelas que escolhem (entre outros) o $s$ e aquelas que não o escolhem.
Contamos cada colecção separadamente e somamos (princípio da adição)
para achar o resultado:
$$
\comb n r
= \underbrace{\comb {n-1} r}_{\text{escolhas sem $s$}}
+ \underbrace{\comb {n-1} {r-1}}_{\text{escolhas com $s$}}.
$$
\qes

\exercise.
Prove o~\ref{combinations_recursive_equation} para todos os $n,r\in\nats$
com $0<r<n$, usando como definição do símbolo $\comb n r$ a
$$
\comb n r = \frac {n!} {(n-r)!\stimes r!}.
$$

\hint
Prove diretamente usando apenas a definição de fatorial.

\solution
Sejam $r,n\in\nats$ com $0<r<n$.
Calculamos:
$$
\alignat 4
\intertext{$\comb n r = \comb {n-1} r + \comb {n-1} {r-1}$}
&\iff\quad& \frac {n!} {(n-r)!\stimes r!} &= \frac {(n-1)!} {(n-1-r)!\stimes r!}              &\!\!{}+{}\ & \frac {(n-1)!} {(n-1-(r-1))!\stimes (r-1)!} &\qquad&\qquad\\
&\iff\quad& n! &= \frac {(n-1)!\stimes(n-r)!\stimes r!} {(n-r-1)!\stimes r!}                  &\!\!{}+{}\ & \frac {(n-1)!\stimes(n-r)!\stimes r!} {(n-r)!\stimes (r-1)!}\\
&\iff\quad& n! &= \frac {(n-1)!\stimes(n-r)!\stimes\cancel{r!}} {(n-r-1)!\stimes \cancel{r!}} &\!\!{}+{}\ & \frac {(n-1)!\stimes\cancel{(n-r)!}\stimes r!} {\cancel{(n-r)!}\stimes (r-1)!}\\
&\iff\quad& n! &= \frac {(n-1)!\stimes(n-r)\!\cancel{\stimes!\stimes}} {\cancel{(n-r-1)!}}    &\!\!{}+{}\ & \frac {(n-1)!\stimes r\cancel{\stimes!\stimes}} {\cancel{(r-1)!}}\\
&\iff\quad& n! &= {(n-1)!\stimes(n-r)} &\!\!{}+{}\ & {(n-1)!\stimes r} \\
&\iff\quad& n! &= {(n-1)!\stimes((n-r) + r)}\\
&\iff\quad& n! &= {(n-1)!\stimes n}\\
&\iff\quad& n! &= n!
\endalignat
$$

\endexercise

\exercise.
\emph{Redefina} o símbolo $\comb n r$ para todo $n,r\in\nats$
recursivamente com
$$
\align
\comb 0 0          &= 1\\
\comb 0 r          &= 0\\
\comb n r          &= \comb {n-1} r + \comb {n-1} {r-1},
\endalign
$$
e prove que para todo $n,r\in\nats$,
$\comb n r = \dfrac {n!} {(n-r)!\stimes r!}$\,.

\hint
Indução.

\endexercise

\endsection
%%}}}

%%{{{ Counting recursively 
\section Contando recursivamente.

\exercise.
\label{sequences_of_twos_and_threes}
Defina uma função $f : \nats\to\nats$ que conta as seqüências feitas por os números 2 e 3 com soma sua entrada.
Quantas seqüências de $2$'s e $3$'s existem cujos termos somam em $17$?

\hint
Recursão.

\hint
Separe as seqüências em dois grupos: aquelas que começam com 2, e aquelas que começam com 3.

\hint
Cuidado com a ``base'' $f(0)$.  Quantas seqüências de 2 e 3, somam em $0$?

\hint
Para calcular o valor de $f(17)$, \emph{não} use a definição recursiva ``top-down'', mas ``bottom-up'': calcule os valores em seqüência linear
$f(0), f(1), f(2), \dotsc$ até o valor desejado.

\endexercise

\exercise.
\label{sequences_of_twos_and_threes_restricted}
Defina uma função $g : \nats\to\nats$ que conta as seqüências feitas por os números 2 e 3 com soma sua entrada, em quais aparecem os dois números (2 e 3).
Quantas seqüências de $2$'s e $3$'s existem cujos termos somam em $18$?

\hint
Use a $f$ do~\ref{sequences_of_twos_and_threes}.

\hint
Quando $g(n) \neq f(n)$?

\hint
Considere os casos:
(1) $n$ não pode ser escrito nem como $n = 2 + 2 + \dotsb + 2$, nem como $n = 3 + 3 + \dotsb + 3$;
(2) $n$ pode ser escrito como $n = 2 + 2 + \dotsb + 2$, e como $n = 3 + 3 + \dotsb + 3$ também;
(3) nenhum dos casos (1)--(2).

\hint
$
g(n) =
\knuthcases{
\cdots\vphantom{f(n)}\cr
\cdots\vphantom{f(n)}\cr
\cdots\vphantom{f(n)}
}
$

\endexercise

\exercise Dirigindo na cidade infinita (sem destino).
\label{infinite_city_1}
No ``meio'' duma ``cidade infinita'', tem um motorista no seu carro.
Seu carro tá parado numa intersecção onde tem 3 opções:
virar esquerda; dirigir reto; virar direita.
No seu depósito tem $a$ unidades de combustível,
e sempre gasta $1$ para dirigir até a próxima intersecção.
De quantas maneiras diferentes ele pode dirigir até seu combustível acabar?
(Veja na figura, dois caminhos possíveis com $a=12$.)
\noindent
\midinsert
\noindent
\centerline{
\hfill
\tikzpicture[scale=0.666]%%{{{
%
\foreach \i in {-4,-3,-2,-1,0,1,2,3,4}
  \draw [-] (\i,-2.5) -- (\i,4.5);
\foreach \j in {-2,-1,0,1,2,3,4}
  \draw [-] (-4.5,\j) -- (4.5,\j);
\draw[rounded corners,line width=2mm,color=blue!40] (0,0) -- (0,1) -- (0,2) -- (-1,2) -- (-1,1) -- (-1,0) -- (-1,-1) -- (-2,-1) -- (-3,-1) -- (-3,0) -- (-3,1) -- (-2,1) -- (-2,2);
\draw[rounded corners,line width=2mm,color=green!40] (0,0) -- (1,0) -- (2,0) -- (3,0) -- (3,1) -- (3,2) -- (3,3) -- (3,4) -- (4,4) -- (4,3) -- (4,2) -- (3,2) -- (2,2);
\node[circle,fill=gray!20] (CR)  at (0,0) {$C$};
%
\endtikzpicture
%%}}}
\hfill
\tikzpicture[scale=0.666]%%{{{
%
\foreach \i in {-4,-3,-2,-1,0,1,2,3,4}
  \draw [-] (\i,-2.5) -- (\i,4.5);
\foreach \j in {-2,-1,0,1,2,3,4}
  \draw [-] (-4.5,\j) -- (4.5,\j);
\draw[rounded corners,line width=2mm,color=blue!40] (0,0) -- (-1.8,0) -- (-1.8,2);
\draw[rounded corners,line width=2mm,color=cyan!60] (0,0) -- (4,0) -- (4,2) -- (-3, 2) -- (-3,3) -- (-2,3) -- (-2,2);
\draw[rounded corners,line width=2mm,color=green!40] (0,0) -- (0,-1) -- (-2.1,-1) -- (-2.1,2);
\node[circle,fill=gray!20] (CR)  at (0,0) {$C$};
\node[circle,fill=gray!20] (DN)  at (-2,2) {$D$};
%
\endtikzpicture
%%}}}
\hfill
}
%\caption{Fig.~1}
\endgraf\centerline{Caminhos possíveis para os exercícios~\refn{infinite_city_1} e~\refn{infinite_city_2} respectivamente.}
%\endcaption
\endinsert

\hint
Sem recursão!

\hint
Em cada intersecção tem $3$ opções: $\mathtt L$, $\mathtt F$, $\mathtt R$.

\solution
Em cada das $a$ intersecções que ele encontra ele tem $3$ opções.
Logo, ele pode seguir $3^a$ caminhos diferentes dirigindo até seu combustível acabar.

\endexercise

\exercise Dirigindo na montanha infinita.
\label{infinite_mountain}
No ``meio'' duma montanha de altura infinita, tem um motorista no seu carro.
Seu carro tá parado numa intersecção onde tem 4 opções:
dirigir subindo (gasta $4$ unidades de combutível);
dirigir descendo (gasta $1$);
dirigir na mesma altura clockwise (gasta $2$);
dirigir na mesma altura counter-clockwise (gasta $2$).
No seu depósito tem $a$ unidades de combistível.
De quantas maneiras diferentes ele pode dirigir até seu combustível acabar?
\ignore{
\midinsert
\tikzpicture[scale=2]
\axis[
hide axis,
domain=0:1,
y domain=0:-2*pi,
xmin=-1.5, xmax=1.5,
ymin=-1.5, ymax=1.5, zmin=-1.2, zmax=-1.2,
samples=10,
samples y=40,
z buffer=sort,
]
\addplot3[mesh,gray]
({1.1*x*cos(deg(y))},{1.1*x*sin(deg(y))},{-x});
\endaxis
\endtikzpicture
\endinsert
}

\hint
Recursão.

\hint
Seja $f(a)$ o número de caminhos diferentes que o motorista pode seguir com $a$ unidades de combustível.

\hint
Separa todos os caminhos possíveis em 3 grupos, dependendo na primeira escolha do motorista.
Conta o número de caminhos em cada grupo separadamente (recursivamente!),
e e use o princípio da adição para contar quantos são todos.

\endexercise

\exercise Dirigindo na cidade infinita (com destino).
\label{infinite_city_2}
No ``meio'' duma ``cidade infinita'', tem um motorista no seu carro.
Seu carro tá parado numa intersecção onde tem 4 opções:
dirigir na direção do norte; do leste; do sul; do oeste.
No seu depósito tem $c$ unidades de combustível
e sempre gasta $1$ para dirigir até a próxima intersecção.
De quantas maneiras diferentes ele pode dirigir até chegar no teu destino,
que fica numa distância $y$ unidades para norte e $x$ para leste?
Considere que números negativos representam descolamento para a direção oposta.
(Veja na figura onde o carro $C$ tem destino $D$, ou seja, seu descolamento
desejado é de $x=-2$, $y=2$.)

\hint
Recursão.

\hint
Seja $f(a,x,y)$ o número de caminhos diferentes que acabam com descolamento total de $y$ unidades para norte e $x$ para leste, para um motorista que tem $a$ unidades de combustível no seu carro.

\hint
Separa todos os caminhos possíveis em 4 grupos, dependendo na primeira escolha do motorista.
Conta o número de caminhos em cada grupo separadamente (recursivamente!),
e e use o princípio da adição para contar quantos são todos.

\endexercise

\endsection
%%}}}

%%{{{ Solutions of equations in integers 
\section Soluções de equações em inteiros.

\endsection
%%}}}

%%{{{ Combinations with repetitions 
\section Combinações com repetições. 

\endsection
%%}}}

%%{{{ The inclusion--exclusion principle 
\section O princípio da inclusão--exclusão.
\label{Inclusion_exclusion_principle}%

\exercise.
42 passangeiros estão viajando num avião.
\beginul
\li 11 deles não comem beef.
\li 10 deles não comem peixe.
\li 12 deles não comem frango.
\li Os passangeiros que não comem nem beef nem frango são 6.
\li O número de passangeiros que não comem nem beef nem peixe, é o mesmo com o número de passangeiros que não comem nem peixe nem frango.
\li Os passangeiros que não comem nada disso são 3.
\li Os passangeiros que comem tudo são 22.
\endul
\endgraf
\noindent
Quantos são os passangeiros que não comem nem beef nem peixe?

\endexercise

\endsection
%%}}}

%%{{{ Elementary probability 
\section Probabilidade elementar.

\endsection
%%}}}

%%{{{ Derrangements 
\section Desarranjos.

\endsection
%%}}}

%%{{{ The pigeonhole principle 
\section O princípio da casa dos pombos.

\endsection
%%}}}

%%{{{ Generating functions and recurrence relations 
\section Funções geradoras e relações de recorrência.

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ prob 
\problem.
Uma turma de 28 alunos tem 12 mulheres e 16 homens.
\beginol
\li De quantas maneiras podemos escolher 5 desses alunos, para formar um time de basquete?
(Considere que as posições de basquete não importam).
\li De quantas maneiras podemos escolher 6 desses alunos, para formar um time de volei, tal que o time tem pelo menos 4 homens?
(Considere que as posições de volei não importam).
\li De quantas maneiras podemos escolher 11 desses alunos, para formar um time de futebol, tal que o time tem exatamente 3 mulheres, e um homem para goleiro?
(Considere que a única posição de futebol que importa é do goleiro.)
\li De quantas maneiras podemos escolher 3 times, um para cada esporte, sem restrição de sexo?
\endol

\endproblem
%%}}}

%%{{{ prob 
\problem.
Uma noite, depois do treino 3 times (uma de basquete, uma de vólei, e uma de
futebol), foram beber num bar que foi reservado para eles.
Como os jogadores de cada time querem sentar juntos,
o dono arrumou duas mesas cíclicas, uma com 5 e outra com 6 cadeiras, e 11 cadeiras no bar.
\endgraf
De quantas maneiras diferentes eles podem sentar?
(Considere que nas mesas cíclicas o que importa é apenas quem tá no lado de quem, mas no bar o que importa é a posição da cadeira mesmo.)

\endproblem
%%}}}

%%{{{ prob 
\problem.
Considere os inteiros $1,2,\dotsc, 30$.
Quantas das suas $30!$ permutações totais têm a propriedade que
não aparecem múltiplos de $3$ consecutivamente?

\hint
Construa cada configuração em passos e use o princípio da multiplicação.

\hint
Coloque os não-múltiplos de 3 primeiramente numa ordem, deixando espaços entre-si
para os múltiplos de 3.

\hint
Escolhe 10 dos 21 lugares possíveis para colocar os múltiplos de 3.

\solution
Primeiramente vamos esquecer os múltiplos de 3.
O resto dos (20) números pode ser permutado de
$20!$ maneiras.
Para qualquer dessa maneira, temos $\comb {21} {10}$
opções para escolher em quais $10$ das $20+1$ possíveis posições vamos colocar os múltiplos de 3,
e para cada escolha, correspondem $10!$ diferentes permutações dos múltiplos de 3 nessas $10$ posições.
Finalmente,
$$
\underbrace{\phantom(20!\phantom)}_{\text{ordena os não-múltiplos}}\ntimes \underbrace{\comb {21} {10}}_{\text{escolhe as posições dos múltiplos}}\ntimes \underbrace{\phantom(10!\phantom)}_{\text{escolhe a ordem dos múltiplos}}
$$
das $30!$ permutações têm a propriedade desejada.

\endproblem
%%}}}

%%{{{ prob 
\problem.
Numa turma de $28$ alunos
precisamos formar duas comissões de $5$ e $6$ membros.
Cada comição tem seu presidente, seu vice-presidente, e seus membros normais.
De quantas maneiras podemos formar essas comissões\dots
\beginol
\li\dots sem restrições (cada um aluno pode participar nas duas comissões simultaneamente)?
\li\dots se nenhum aluno pode participar simultaneamente nas duas comissões?
\li\dots se os dois (únicos) irmãos entre os alunos não podem participar na mesma comissão,
e cada aluno pode participar simultaneamente nas duas?
\endol

\endproblem
%%}}}

%%{{{ prob: nikos 
\problem.
\label{nikos}
Na figura abaixo temos um mapa (as linhas correspondem em ruas).
Nikos quer caminhar do ponto $A$ para o ponto $B$, \emph{o mais rápido possível}.
\beginol
\li De quantas maneiras ele pode chegar?
\li Se ele precisa passar pelo ponto $S$?
\li Se ele precisa passar pelo ponto $S$ mas quer evitar o ponto $N$?
\endol
\noindent
\midinsert
\noindent
\tikzpicture[scale=0.666]%%{{{
%
\foreach \i in {0,1,2,3,4,5,6,7,8,9}
  \foreach \j in {0,1,2,3,4,5,6,7,8}
    \node (a\i) at (\i,\j) {};
\foreach \i in {0,1,2,3,4,5,6,7,8,9}
  \draw [-] (\i,0) -- (\i,8);
\foreach \j in {0,1,2,3,4,5,6,7,8}
  \draw [-] (0,\j) -- (9,\j);
\draw [rounded corners,line width=2mm,color=green!50] (0,0) -- (0,2) -- (3,2) -- (3,4) -- (7,4) -- (7,5) -- (8,5) -- (8,7) -- (9,7) -- (9,8);
\node[circle,fill=gray!20]  (SW)    at (-0.3,-0.3) {$A$};
\node[circle,fill=gray!20]  (NE)    at (9.3,8.3)   {$B$};
\node[circle,             inner sep=2pt,fill=green!30] (nice)  at (3,2.5)     {{\niness S}};
\node[star,star points=17,inner sep=2pt,fill=red!30]   (boom)  at (6.5,5)     {{\niness N}};
%
\endtikzpicture
%%}}}
\tikzpicture[scale=0.666]%%{{{
%
\foreach \i in {0,1,2,3,4,5,6,7,8,9}
  \foreach \j in {0,1,2,3,4,5,6,7,8}
    \node (a\i) at (\i,\j) {};
\foreach \i in {0,1,2,3,4,5,6,7,8,9}
  \draw [-] (\i,0) -- (\i,8);
\foreach \j in {0,1,2,3,4,5,6,7,8}
  \draw [-] (0,\j) -- (9,\j);
\draw [rounded corners,line width=2mm,color=red!50] (0,0) -- (0,2) -- (3,2) -- (3,4) -- (5,4) -- (5,5) -- (7,5) -- (7,7) -- (8,7) -- (8,8) -- (9,8);
\node[circle,fill=gray!20] (SW)  at (-0.3,-0.3) {$A$};
\node[circle,fill=gray!20] (NE)  at (9.3,8.3) {$B$};
\node[circle,             inner sep=2pt,fill=green!30] (nice)  at (3,2.5)     {{\niness S}};
\node[star,star points=17,inner sep=2pt,fill=red!30]   (boom)  at (6.5,5)     {{\niness N}};
%
\endtikzpicture
%%}}}
%\caption{Fig.~1}
\endgraf\centerline{Um caminho aceitável e um inaceitável no caso (3) do \ref{nikos}.}
%\endcaption
\endinsert

\endproblem
%%}}}

%%{{{ prob 
\problem.
Num jogo de lotéria, tem os números de $1$ até $60$:
$$
\matrix
    01&02& 03 &04 &05 &06 &07 &08 &09 &10\\
    11&12& 13 &14 &15 &16 &17 &18 &19 &20\\
    21&22& 23 &24 &25 &26 &27 &28 &29 &30\\
    31&32& 33 &34 &35 &36 &37 &38 &39 &40\\
    41&42& 43 &44 &45 &46 &47 &48 &49 &50\\
    51&52& 53 &54 &55 &56 &57 &58 &59 &60
\endmatrix
$$
Os organizadores do jogo, escolhem aleatoriamente 6 números
deles (sem repetições).
Esses 6 números são chamados ``a megasena''.
Um jogador marca pelo menos 6 números na sua
lotéria e se conseguir ter marcados todos os 6 da megasena, ganha.

(Marcando mais que 6 números,
as chances do jogador aumentam, mas o preço da lotéria aumenta também.)

(1)
Um jogador marcou $6$ números.
Qual a probabilidade que ele ganhe?

(2)
Uma jogadora marcou $9$ números.
Qual a probabilidade que ela ganhe?

(3)
Generalize para um jogo com $N$ números, onde $w$ deles são escolhidos,
e com um jogador que marcou $m$ números, sendo $w\leq m \leq N$.

\solution
(1)
Apenas uma escolha é a certa, então a probabilidade de ganhar é:
    $$
    \dfrac 1 {\comb {60} 6}
    = \dfrac{6!\stimes 54!} {60!}
    = \dfrac {6!} {55 \ntimes 56 \ntimes 57 \ntimes 58 \ntimes 59 \ntimes 60}
    = \dfrac {1} {11\ntimes 14\ntimes 19\ntimes 29\ntimes 59\ntimes 10}
    = \dfrac 1 {50063860}\,.
    $$
\endgraf
\noindent
(2)
Para ganhar, com certeza acertamos nos 6 números da megasena,
então temos que contar todas as maneiras de escolher os 3 outros números dos 9 que escolhemos:
    $$
    \dfrac {\comb {60-6} {9-6}} {\comb {60} 9}
    = \dfrac {\comb {54} 3} {\comb {60} 9}
    = \dfrac {54!\stimes \cancel{51!}\stimes 9!} {\cancel{51!} \stimes 3!\stimes 60!}
    = \dfrac {4\ntimes 5 \ntimes 6 \ntimes 7 \ntimes 8 \ntimes 9} {55\ntimes 56\ntimes 57\ntimes 58\ntimes 59 \ntimes 60}
    = \dfrac 3 {1787995}\,.
    $$
\endgraf
\noindent
(3)
Generalizando a solução do (2), a probabilidade é
$$
\align
\frac
{\comb {N-w} {m-w}}
{\comb N m}
&=
\frac
{(N-w)! \stimes (N-m)! \stimes m!}
{((N-w)-(m-w))! \stimes (m-w)! \stimes N!}\\
&=
\frac
{(N-w)! \stimes (N-m)! \stimes m!}
{((N\cancel{{}-{}w}-m\cancel{{}+w}))! \stimes (m-w)! \stimes N!}\\
&=
\frac
{(N-w)! \stimes \cancel{(N-m)!} \stimes m!}
{\cancel{(N-m)!} \stimes (m-w)! \stimes N!}\\
&=
\frac
{(N-w)! \stimes m!}
{(m-w)! \stimes N!}\\
&=
\prod_{i=0}^{w-1}
\frac
{m-i}
{N-i}\,.
\endalign
$$

\endproblem
%%}}}

%%{{{ prob: frogs 
\problem.
\label{frogs}
Aleco e Bego são dois sapos.
Eles estão na frente de uma escada com 11 degraus.
No 6o degrau, tem Cátia, uma cobra, com fome.
Aleco pula 1 ou 2 degraus para cima.
Bego, 1, 2 ou 3.  E ele é tóxico: se Cátia o comer, ela morre na hora.
\midinsert
\tikzpicture[scale=0.666]%%{{{
%
\node[star,star points=17,fill=red!30,inner sep=3pt]    (boom) at (6.75,6.25) {\phantom{\niness C}};
\node[                                             ]    (catia) at (6.666,6.333) {{\niness C}};
\node[circle,fill=green!40]  (aleco) at (-0.333,0.5) {{\niness A}};
\node[circle,fill=blue!30]   (bego)  at (-1.75,0.5) {{\niness B}};
\draw [->,color=green!50,line width=1mm] (aleco) to [bend left=70] (2.333,2);
\draw [->,color=blue!50,line width=1mm] (bego)  to [bend left=66] (1.666,1);
\draw [->,color=green!50,line width=1mm] (aleco) to [bend left=60] (1.333,1);
\draw [->,color=blue!50,line width=1mm] (bego)  to [bend left=62] (2.666,2);
\draw [->,color=blue!50,line width=1mm] (bego)  to [bend left=60] (3.5,3);
\foreach \i in {1,2,3,4,5,6,7,8,9,10,11} {
  \path[fill=gray!10]
    (\i,\i) -- (\i,\i-1) -- (15,\i-1) -- (15,\i) -- (\i,\i);
  \node[circle,fill=black,inner sep=0pt] (b\i) at (\i,\i)   {};
  \node[circle,fill=black,inner sep=0pt] (e\i) at (\i+1,\i) {};
  \node[circle,fill=black,inner sep=0pt] (d\i) at (\i,\i-1) {};
  \node[                  inner sep=0pt] (s\i) at (\i+0.5,\i) {};
  \draw [-,line width=0.2mm] (b\i) -- (e\i);
  \draw [-,line width=0.2mm] (b\i) -- (d\i);
  \node[                  inner sep=0pt] (t\i) at (\i+0.5,\i-0.3) {\i};
}
\draw [-] (-3,0) -- (1,0);
\draw [-] (12,11) -- (15,11);
%\foreach \j in {0,1,2,3,4,5,6,7,8}
%  \draw [-] (0,\j) -- (9,\j);
%  \draw [line width=2mm,color=green!50] (0,0) -- (0,2) -- (3,2) -- (3,4) -- (7,4) -- (7,5) -- (8,5) -- (8,7) -- (9,7) -- (9,8);
%\node[circle,fill=gray!20]  (SW)    at (-0.3,-0.3) {$A$};
%\node[circle,fill=gray!20]  (NE)    at (9.3,8.3)   {$B$};
%\node[circle,fill=green!30] (nice)  at (3,2.5)     {{\niness S}};
%\node[circle,fill=red!30]   (boom)  at (6.5,5)     {{\niness N}};
%
\endtikzpicture
%%}}}
%\caption{Fig.~2}
\endgraf\centerline{Os dois sapos do~\ref{frogs} e suas possibilidades para começar.}
%\endcaption
\endinsert
\item{(1)} Por enquanto, Cátia está dormindo profundamente.
\itemitem{a.} De quantas maneiras Aleco pode subir a escada toda?
\itemitem{b.} De quantas maneiras Bego pode subir a escada toda?
\item{(2)} Cátia acordou!
\itemitem{a.} De quantas maneiras Aleco pode subir a escada toda?
\itemitem{b.} De quantas maneiras Bego pode subir a escada toda?
\item{(3)} Bego começou subir a escada\dots{}
Qual é a probabilidade que Cátia morra?
(Considere que antes de começar,
ele já decidiu seus saltos e não tem percebido a existência da cobra.)
\ignore{
\item{(4)} O que muda na questão (3) se ao invés de decidir seu caminho desde o
início, Bega decida cada vez aleatoriamente (com probabilidades iguais) qual
dos 3 possíveis saltos ele vai fazer?
\item{(5)}
Generalize o problema (4)~para o caso onde a escada
tem uma infinidade de degraus e Cátia fica no degrau $k$.
}

\hint Recursão.

\hint
Sejam $a(n)$ e $b(n)$ o número de maneiras que Aleco e Bego
podem subir uma escada de $n$ degraus, respectivamente.

\hint
Grupe as maneiras em colecções (para aplicar o princípio da adição),
olhando para o primeiro salto.

\solution
Sejam $a(n)$ e $b(n)$ o número de maneiras que Aleco e Bego
podem subir uma escada de $n$ degraus, respectivamente.
Cada maneira do Aleco pode começar com 2 jeitos diferentes:
salto de 1 degrau, ou salto de 2 degraus.
Cada maneira do Bego pode começar com 3 jeitos diferentes:
salto de 1, de 2, ou de 3 degraus.
Observe que, por exemplo, se Bego começar com um pulo de 2
degraus, falta subir uma escada de $n-2$ degraus.
Pelo princípio da adição então, temos as equações recursivas:
$$
\xalignat 2
a(n) &= a(n-1) + a(n-2)                & b(n) &= b(n-1) +  b(n-2) +  b(n-3)
\intertext{validas para $n\geq 2$ e $n \geq 3$ respectivamente.
Devemos definir os casos básicos de cada função recursiva:
$n=0,1$ para a $a(n)$, e $n=0,1,2$ para a $b(n)$:}
     &                                 & b(0) &= 1\qquad\explanation{fica}\\
a(0) &= 1 \qquad\explanation{fica}     & b(1) &= 1\qquad\explanation{pula $1$}\\
a(1) &= 1 \qquad\explanation{pula $1$} & b(2) &= 2\qquad\explanation{pula $1+1$; ou pula $2$}\\
a(n) &= a(n-1) +  a(n-2)               & b(n) &= b(n-1) +  b(n-2) +  b(n-3)
\endxalignat
$$
Calculamos os 11 primeiros valores:
$$
\matrix
a:\quad& \overbrace {1}^{a(0)}, & 1, & 2, & 3, & 5, & \phantom08,  & 13, & 21, & 34, & \phantom055,  & \phantom089,  & \overbrace {144}^{a(11)}, &\dotsc\\
b:\quad& \underbrace{1}_{b(0)}, & 1, & 2, & 4, & 7, & 13,          & 24, & 44, & 81, & 149, & 274, & \underbrace{504}_{b(11)}, &\dotsc
\endmatrix
$$
Agora temos tudo que precisamos para responder facilmente nas questões do problema.
\endgraf
\item{(1)} Precisamos apenas os valores $a(11)$ e $b(11)$:
\itemitem{a.} De $a(11) = 144$ maneiras.
\itemitem{b.} De $b(11) = 504$ maneiras.
\item{(2)} Usamos ``$n\to m$'' para ``pula diretamente do degrau $n$ para o degrau $m$'' e ``$n\transto m$'' para ``vai do degrau $n$ para o degrau $m$ pulando num jeito''.
\itemitem{a.} Para conseguir subir, Aleco necessariamente precisa chegar no degrau 5, saltar até o degrau 7, e depois continuar até o degrau 11.  Formamos cada maneira então em passos, e usando o princípio da multiplicação achamos que Aleco tem
$$
\underbrace{a(5)}_{0 \transto 5} \ntimes
\underbrace{\phantom(1\phantom)}_{5 \to 7} \ntimes
\underbrace{a(4)}_{7 \transto 11}
=
8 \ntimes 1 \ntimes 5
= 40
$$
maneiras de subir a escada toda.
\itemitem{b.} 
Para o Bego a situação não é tão simples, porque ele pode evitar a cobra de vários jeitos.
Vamos grupar eles assim:
(i)   aqueles onde ele pulou a cobra com salto de tamanho 2;
(ii)  aqueles onde ele pulou a cobra com salto de tamanho 3 desde o degrau 5;
(iii) aqueles onde ele pulou a cobra com salto de tamanho 3 desde o degrau 4.
Contamos as maneiras em cada grupo como na questão anterior, e no final as somamos (princípio da adição) para achar a resposta final: Bego tem
$$
\overbrace{
\underbrace{b(5)}_{0 \transto 5} \ntimes
\underbrace{\phantom(1\phantom)}_{5 \to 7} \ntimes
\underbrace{b(4)}_{7 \transto 11}
}^{\text{grupo (i)}}
+
\overbrace{
\underbrace{b(5)}_{0 \transto 5} \ntimes
\underbrace{\phantom(1\phantom)}_{5 \to 8} \ntimes
\underbrace{b(3)}_{8 \transto 11}
}^{\text{grupo (ii)}}
+
\overbrace{
\underbrace{b(4)}_{0 \transto 4} \ntimes
\underbrace{\phantom(1\phantom)}_{4 \to 7} \ntimes
\underbrace{b(4)}_{7 \transto 11}
}^{\text{grupo (iii)}}
=
13 \ntimes 7 + 
13 \ntimes 4 + 
7 \ntimes 7 
=
192
$$
maneiras de subir a escada toda.
\item{(3)}
Pela definição, a probabilidade que Cátia morra é a fracção
$$
\frac
{\text{todas as maneiras em quais Bego pisou no degrau 6}}
{\text{todas as maneiras possíveis}}\,,
$$
ou seja,
$$
\frac
{504-192}
{504}
=
\frac
{312}
{504}
=
\frac
{156}
{252}
=
\frac
{78}
{126}
=
\frac
{39}
{63}
=
\frac
{13}
{21}
\,.
$$

\endproblem
%%}}}

%%{{{ prob: band_maker 
\problem.
\label{band_maker}%
Temos $6$ músicos disponíveis, onde cada um toca:
\endgraf
\halign{
\hfil# & #\hfil & \hfil# & #\hfil\cr
Alex:       &violão, guitarra, baixo& Daniel:     &guitarra\cr
Bill:       &bateria                & Eduardo:    &piano, teclado, violão, fláuto\cr
Claudia:    &saxofone, clarineto    & Fagner:     &guitarra, baixo, teclado\cr
}

\noindent
(Considere que uma banda precisa \emph{pelo menos um membro},
todos os membros duma banda \emph{precisam tocar pelo menos algo na banda},
e que cada banda é diferenciada pelos músicos e
suas funções.
Por exemplo: uma bande onde Alex toca o violão (apenas) e Bill a bateria,
é diferente duma banda onde
Alex toca o violão \emph{e} a guitarra, e Bill a bateria,
mesmo que seus membros podem ser os mesmos.

\item{(1)}
Quantas bandas diferentes podemos formar?
\item{(2)}
Quantas bandas diferentes podemos formar com a restrição que nenhum
músico tocará mais que um instrumento na banda (mesmo se em geral sabe tocar mais)?
\item{(3)}
Quantas bandas diferentes podemos formar onde todos os
músicos fazem parte da banda?

\solution
(1):
$2^{14}-1$: para cada músico e cada instrumento, temos 2 opções: ``sim'' ou ``não''.
Tiramos $1$ porque hipercontamos (a ``banda vazia'').
\endgraf
\medskip
\noindent
(2):
Cada músico que toca $i$ instrumentos tem $i+1$ opções (a extra $+1$ corresponde no ``não participar na banda''):
podemos formar $4 \ntimes 2 \ntimes 3 \ntimes 2 \ntimes 5 \ntimes 4 - 1$ bandas, onde de novo tiramos 1 para excluir a ``banda vazia''.
\endgraf
\medskip
\noindent
(3):
Cada músico que toca $i$ instrumentos tem $2^i - 1$ opções (tirando a opção de ``não tocar nada'').  Então podemos formar $7\ntimes 1 \ntimes 3 \ntimes 1 \ntimes 15 \ntimes 7$ bandas.

\endproblem
%%}}}

%%{{{ prob 
\problem.
De quantas maneiras podemos escrever um string ternário
(usando o alfabeto $\set{0, 1, 2}$)
de tamanho 7,
tais que \emph{não aparece neles o substring $00$}.
\endgraf
Por exemplo:
$$
\align
0112220                                           &\qquad\text{é um string aceitável;}\\
2\underline{00}1\underline{0\overline0}\overline0 &\qquad\text{não é.}
\endalign
$$

\hint
Recursão.

\hint
Seja $a(n)$ o número dos strings ternários de tamanho $n$ tais que não aparece
neles o substring ${00}$.

\hint
Defina a $a(n)$ e depois calcule o $a(7)$, calculando em ordem os
$a(0),a(1),\dotsc,a(7)$.

\solution
Seja $a(n)$ o número dos strings ternários de tamanho $n$ tais que não aparece
neles o substring ${00}$.
Queremos achar o $a(7)$.
\endgraf
Observe que:
$$
\align
    a(0) &= 1 \qqqquad\explanation{o string vazio: ``$\,$''}\\
    a(1) &= 3 \qqqquad\explanation{os strings: ``$0$'', ``$1$'', e ``$2$''}\\
    a(n) &=
      \underbrace{a(n-1)}_{1\ldots}
    + \underbrace{a(n-1)}_{2\ldots}
    + \underbrace{a(n-2)}_{{01}\ldots}
    + \underbrace{a(n-2)}_{{02}\ldots}\\
         &= 2a(n-1) + 2a(n-2)\\
         &= 2(a(n-1) + a(n-2))
\endalign
$$
Então calculamos os primeiros $8$ termos da seqüência:
$$
1,\quad 3,\quad 8,\quad 22,\quad 60,\quad 164,\quad 448,\quad \underbrace{1224}_{a(7)}.
$$

\endproblem
%%}}}

%%{{{ prob: pessimissimo 
\problem.
\label{pessimissimo}%
Contar todas as palavras feitas por permutações das 12 letras da palavra
$$
\txt{PESSIMISSIMO}
$$
onde\dots
\item{(1)}
A palavra começa com $\txt P$.
\item{(2)}
Todos os $\txt I$ aparecem \emph{juntos}.
\item{(3)}
Os $\txt M$ aparecem \emph{separados}.
\item{(4)}
Nenhum dos $\txt S$ aparece ao lado de outro $\txt S$.

\hint
Para o (4), seria diferente se a restrição fosse
``os $\txt S$ não aparecem todos juntos''.

\solution
(1):
Como somos obrigados começar a palavra com ${\txt P}$,
precisamos apenas contar as permutações das letras da palavra
$
\txt{ESSIMISSIMO}
$,
que sabemos que são
$$
\frac
{11!}
{4!\stimes3!\stimes 2!}.
$$
\endgraf
\medskip
\noindent
(2):
Podemos considerar que temos apenas um $I$:
$
\dfrac
 {10!}
 {4!\stimes  2!}
$
\endgraf
\medskip
\noindent
(3):
Contamos em quantas palavras eles aparecem juntos,
e usando princípio da adição, os subtraimos das permutações sem restrição.
$$
\underbrace{
\,
\dfrac
 {12!}
 {4!\stimes  3!\stimes  2!}
\,
}_{\text{todas}}
 -
\underbrace{
\,
\dfrac
 {11!}
 {4!\stimes  3!}
\,
}_{\text{$\txt M$ juntos}}
$$
\endgraf
\noindent(4):
Construimos cada dessas palavras em passos.
Primeiramente escolhemos uma das permutações da palavra sem os ${\txt M}$'s:
$$
\phantom{\underline{\phantom{{\txt M}}}}*
\phantom{\underline{\phantom{{\txt M}}}}*
\phantom{\underline{\phantom{{\txt M}}}}*
\phantom{\underline{\phantom{{\txt M}}}}*
\phantom{\underline{\phantom{{\txt M}}}}*
\phantom{\underline{\phantom{{\txt M}}}}*
\phantom{\underline{\phantom{{\txt M}}}}*
\phantom{\underline{\phantom{{\txt M}}}}*
\phantom{\underline{\phantom{{\txt M}}}}
$$
(temos 
$
\dfrac
{8!}
{3!\stimes 2!}
$
opções).
\endgraf
\medskip
No próximo passo escolemos em qual das $9$ posições possíves colocamos os $M$:
$$
\underline{\phantom{{\txt M}}}*
\underline{\phantom{{\txt M}}}*
\underline{\phantom{{\txt M}}}*
\underline{\phantom{{\txt M}}}*
\underline{\phantom{{\txt M}}}*
\underline{\phantom{{\txt M}}}*
\underline{\phantom{{\txt M}}}*
\underline{\phantom{{\txt M}}}*
\underline{\phantom{{\txt M}}}
$$
Pelo princípio da multiplicação então, temos
$
\dfrac
{8!}
{3!\stimes 2!}
\cdot
\comb 9 4
$
palavras que satisfazem essa restrição.

\endproblem
%%}}}

%%{{{ prob 
\problem.
De quantas maneiras podemos escrever um string usando o alfabeto
de 26 letras
$$
\txt A, \txt B, \txt C, \dotsc, \txt X, \txt Y, \txt Z,
$$
tais que as vogais aparecem na ordem estrita alfabética, e as consoantes na órdem oposta?
(As vogais sendo as letras $\txt A$, $\txt E$, $\txt I$, $\txt O$, $\txt U$, $\txt Y$.)
{Por exemplo:}
$$
\align
\txt{TEDUCY}    &\qquad\text{é um string aceitável};\\
\txt{DETUCY}    &\qquad\text{não é ($\txt D \not> \txt T$)};\\
\txt{TEDUCA}    &\qquad\text{não é ($\txt U \not< \txt A$)}.
\endalign
$$
\item{(1)} \dots se os strings são de tamanho 26 e os vogais aparecem todos juntos;
\item{(2)} \dots se os strings são de tamanho 12 e aparecem todos os vogais;
\item{(3)} \dots se os strings são de tamanho 3;
\item{(4)} \dots se os strings são de tamanho $\ell$, com $0\leq\ell\leq 26$.

\solution
(1)
Como a ordem das consoantes e das vogais é predeterminada e as vogais devem aparecer juntas,
a única escolha que precisamos fazer é onde colocar as vogais, e temos $21$ possíveis posições.
Então existem $21$ tais strings.
\endgraf
\noindent
(2)
$$
\underbrace{\comb {20} 6}_{\text{\eightrm consoantes}},
\underbrace{\comb {12} 6}_{\text{\eightrm suas posições}}.
$$
\endgraf
\noindent
(3)
Separamos todos os strings que queremos contar em quatro grupos e contamos cada um separadamente:
$$
{
\overbrace{
\underbrace{\comb {20} 3}_{\text{as c.}}
}^{\text{3 c., 0 v.}}
}
+
{
\overbrace{
\underbrace{\comb {20} 2}_{\text{as c.}}
\underbrace{\comb 6 1}_{\text{a v.}}
\underbrace{\comb 3 2}_{\text{pos.~c.}}
}^{\text{2 c., 1 v.}}
}
+
\overbrace{
\underbrace{\comb {20} 1}_{\text{a c.}}
\underbrace{\comb 6 2}_{\text{as v.}}
\underbrace{\comb 3 1}_{\text{pos.~c.}}
}^{\text{1 c., 2 v.}}
+
\overbrace{
\underbrace{\comb 6 3}_{\text{as v.}}
}^{\text{0 c., 3 v.}}.
$$
Podemos descrever o resultado numa forma mais uniforme e mais fácil para generalizar:
$$
\sum_{i=0}^3
\underbrace{\comb {20} {3-i}}_{\text{as $3-i$ c.}}
\underbrace{\comb 6 i}_{\text{as $i$ v.}}
\underbrace{\comb 3 i}_{\text{pos.~v.}}
=
\sum_{\Sb c+v=3\\ c,v\in\nats\endSb}
\underbrace{\comb {20} c}_{\text{as c.}}
\underbrace{\comb 6 v}_{\text{as v.}}
\underbrace{\comb 3 v}_{\text{pos.~v.}}
$$
\endgraf
\noindent
(4)
Seguindo a última forma do (3), temos
$$
\sum_{i=0}^{\ell}
\underbrace{\comb {20} {\ell-i}}_{\text{as $\ell-i$ c.}}
\underbrace{\comb 6 i}_{\text{as $i$ v.}}
\underbrace{\comb {\ell} i}_{\text{pos.~v.}}
$$
maneiras.  O somatório pode ser escrito também assim:
$$
\sum
\bigg\{
\underbrace{\comb {20} c}_{\text{as c.}}
\underbrace{\comb 6 v}_{\text{as v.}}
\underbrace{\comb {\ell} v}_{\text{pos.~v.}}
\ \Big|\ 
c+v=\ell, \ 0\leq c \leq 20, \ 0\leq v \leq 6, \ c,v\in\nats
\bigg\}.
$$
Note que como o conjunto acima é finito,
a adição é comutativa e associativa; logo, nosso somatório é bem definido.

\endproblem
%%}}}

%%{{{ prob: roulette_multiple_balls 
\problem.
\label{roulette_multiple_balls}
Numa roleta dum cassino tem ``pockets'' (ou ``casas'') numerados com:
$$
00, 0, 1, 2, \dotsc, 36
$$
e cada um deles é suficientemente profundo para caber até 8 bolinhas.
O crupiê joga 8 bolinas na roleta no mesmo tempo.
De quantas maneiras elas podem cair nos pockets se\dots
\item{(1)}\dots as bolinhas são distintas e não importa sua ordem dentro um pocket.
\item{(2)}\dots as bolinhas são todas iguais.
\endgraf

\solution
\noindent
(1) São permutações com repetições: $38 ^ 8$.
\endgraf
\noindent
(2) São combinações com repetições: $\comb {38 + 8 - 1} 8 = \comb {45} 8$.

\endproblem
%%}}}

%%{{{ prob 
\problem.
De quantas maneiras podemos escrever um string usando
letras do alfabeto $\set{\txt A, \txt B, \txt C, \txt D}$,
tais que \emph{cada letra é usada exatamente duas vezes
mas não aparece consecutivamente no string}?
Por exemplo:
$$
\align
\txt{ABADCDBC}                      &\qquad\text{é um string aceitável;}\\
\txt{ABAC$\underline{\txt{DD}}$BC}  &\qquad\text{não é.}
\endalign
$$

\hint
Inclusão--exclusão.

\hint
Considere as propriedades:
$$
\xalignat 4
 \alpha  &: \text{aparece o $\txt{AA}$}
&\beta   &: \text{aparece o $\txt{BB}$}
&\gamma  &: \text{aparece o $\txt{CC}$}
&\delta  &: \text{aparece o $\txt{DD}$}.
\endxalignat
$$

\solution
Seja $N$ o número de permutações totais das létras
e defina as 4 propriedades
$$
\xalignat 4
 \alpha  &: \text{aparece o $\txt{AA}$}
&\beta   &: \text{aparece o $\txt{BB}$}
&\gamma  &: \text{aparece o $\txt{CC}$}
&\delta  &: \text{aparece o $\txt{DD}$}.
\endxalignat
$$
Procuramos o número dos strings de tamanho 8 que não tenham nenhuma dessas 4 propriedades.
Assim que calcular os $N(\alpha),\dotsc,N(\alpha,\beta,\gamma,\delta)$
o princípio da inclusão--exclusão, vai nos dar o número que procuramos.
\endgraf
Observamos que
$$
\gather
N(\alpha) =N(\beta) =N(\gamma) =N(\delta)\\
N(\alpha,\beta) =N(\alpha,\gamma) = \dotsb = N(\gamma,\delta)\\
N(\alpha,\beta,\gamma) = \dotsb = N(\beta,\gamma,\delta).
\endgather
$$
\endgraf
Calculamos os
$$
\align
N
&= \frac {8!} {2!\stimes 2!\stimes 2!\stimes 2!} = 2520\\
N(\alpha)
&= \frac {7!} {2!\stimes 2!\stimes 2!} = \frac {7!} 8 = 7\ntimes 6 \ntimes 5 \ntimes 3 = 630\\
N(\alpha,\beta)
&= \frac {6!} {2!\stimes 2!} = \frac {6!} 4 = 180 \\
N(\alpha,\beta,\gamma)
&= \frac {5!} {2!} = \frac {5!} 2 = 60 \\
N(\alpha,\beta,\gamma,\delta)
&= {4!} = 24.
\endalign
$$
\endgraf
Para responder, temos
$$
\gather
    N
    - \comb 4 1 N(\alpha)
    + \comb 4 2 N(\alpha,\beta)
    - \comb 4 3 N(\alpha,\beta,\gamma)
    + N(\alpha,\beta,\gamma,\delta)\\
    =
    2520 - 4\ntimes 630 + 6\ntimes 180 - 4\ntimes 60 + 24
    =
    864
\endgather
$$
tais permutações.

\endproblem
%%}}}

%%{{{ prob: parity_respecting_strings_mutual_recursion 
\problem.
\label{parity_respecting_strings_mutual_recursion}
De quantas maneiras podemos escrever um string binário
(usando o alfabeto $\set{0, 1}$) de tamanho 12,
tais que: 
\beginol
\li os $0$'s aparecem apenas em grupos maximais de tamanho par;
\li os $1$'s aparecem apenas em grupos maximais de tamanho impar.
\endol
Por exemplo:
$$
\align
{000000111001}                         &\qquad\text{é um string aceitável;}\\
{100\underline{11}001\underline{000}1} &\qquad\text{não é.}
\endalign
$$

\hint
Separe os strings em dois grupos, aqueles que terminam em $0$ e aqueles que terminam em $1$,
e conta os strings de cada grupo usando recursão.

\hint
Sejam $a(n)$ e $b(n)$ o número de strings binários de tamánho $n$ que terminam em $0$ e em $1$ respectivamente.

\endproblem
%%}}}

%%{{{ prob: xyzzy_lemmings 
\problem.
\label{xyzzy_lemmings}%
\def\MM{\ensuremath{\mathtt{M}}}
\def\FB{\ensuremath{\mathtt{F}}}
\def\ST{\ensuremath{\mathtt{B}}}
Xÿźźÿ o Mago Bravo decidiu matar todos os lemmings que ele guarda no seu quintal.
Seus feitiços são os:
\beginul
\li ``magic missile'', que mata 2 lemmings simultaneamente, e gasta 1 ponto ``mana'';
\li ``fireball'', que mata 3 lemmings simultaneamente, e gasta 2 pontos ``mana''.
\endul
\noindent
Alem dos feitiços, Xÿźźÿ pode usar seu bastão para matar
os lemmings (que não custa nada, e mata 1 lemming com cada batida).
\endgraf
Suponha que o mago \emph{nunca} lançará um feitiço que mataria mais lemmings do
que tem (ou seu quintal vai se queimar).
Ele tem $m$ pontos ``mana'' e existem $n$ lemmings no seu quintal.
Em quantas maneiras diferentes ele pode destruir todos os lemmings se\dots
\beginol
\li os lemmings são indistinguíveis?
\li os lemmings são distinguíveis?
\li os lemmings são distinguíveis e cada vez que Xÿźźÿ mata um usando seu bastão,
ele \emph{ganha} um ponto de ``mana''?
\endol
\noindent
(Para os casos que os lemmings são distinguíveis,
o mago escolhe também \emph{quais} dos lemmings ele matará cada vez.)

\hint
Recursão.

\hint
Seja $f(m,n)$ o número de maneiras que Xÿźźÿ pode matar todos os $n$ lemmings,
começando com $m$ pontos de mana.

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ History 
\history.

Pascal não foi o primeiro de estudar o ``triângulo aritmético'',
cuja existência e sua relação com a teorema binomial já eram
conhecidas desde uns séculos antes do seu nascimento.
Mesmo assim, seu estudo
\emph{``Traité du triangle arithmétique, avec quelques autres petits traitez
sur la mesme matière''},
publicado no ano \oldstyle{1654} (depois da sua morte)
popularizou o triângulo e suas diversas aplicações e
propriedades~(\cite{pascaltriangle}).

\endhistory
%%}}}

%%{{{ Further reading 
\further.

Veja o~\cite{nivencount}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Number theory I: divisibility 
\chapter Teoria de números I: divisibilidade.

%%{{{ Factorization 
\section Fatorização.

\question.
\emph{Dado um inteiro positivo $n$, como podemos ``o quebrar'' em blocos de construção?}

\note.
Vamos primeiramente responder nessa questão com outra:
\emph{Qual seria nosso ``cimento''?}
Tome como exemplo o número $n=28$.
Usando $+$ para o construir com blocos, podemos o quebrar:
$$
\align
28 &= 16 + 12.
\intertext{E agora quebramos esses dois blocos:}
   &= \overbrace{10 + 6}^{16} + \overbrace{11 + 1}^{12};
\intertext{e esses:}
   &= \overbrace{3 + 7}^{10} + \overbrace{3 + 3}^{6} + \overbrace{4 + 7}^{11} + 1
\intertext{e o $1$ não é mais ``quebrável''.
Nesse quesito, ele é um bloco atómico, um ``tijolo''.
Repetimos esse processo até chegar num somatório cujos termos são todos tijolos:}
 &= \underbrace{1 + 1 + 1 + 1 + \dotsb + 1}_{\text{$28$ termos}}.
\endalign
$$
O leitor é convidado pensar sobre as próximas observações:
\beginol
\li
Começando com qualquer inteiro positivo $n$,
depois um \emph{finito} número de passos, o processo termina:
nenhum dos termos que ficam pode ser quebrado.
\li
Existe apenas um tipo de bloco atómico: o $1$.
Podemos então formar qualquer número $n$ começando com $n$ tijolos ($n$ $1$'s)
e usando a operação $+$ para os juntar.
\li
Não faz sentido considerar o $0$ como tijolo, pois escrevendo o $1$ como
$$
1 = 1 + 0 \qqqqtext{ou}
1 = 0 + 1
$$
não conseguimos o ``quebrar'' em peças menores.  Pelo contrario,
ele aparece novamente, da mesma forma, no lado direito.
\endol

\exercise.
\label{partitioning_restricted_best_strategy}
Qual é a melhor estratégia para desconstruir o $n$ em $1$'s conseguindo
o menor número de passos possível?  Quantos passos precisa?
Suponha que em cada passo tu tens que escolher apenas \emph{um} termo (não
atómico) e decidir em quais duas partes tu o quebrarás.

\hint
Olha na forma final do somatório.
O que acontece em cada passo?

\solution
Todas as estratégias são iguais: em cada passo, um $+$ é adicionado,
e todas terminam no mesmo somatório com $n$ $1$'s e $n-1$ $+$'s.
Então começando com qualquer número $n$, depois de $n-1$ passos chegamos
na sua forma $n = 1+1+\dotsb +1$.

\endexercise

\exercise.
Prove formalmente tua resposta no~\ref{partitioning_restricted_best_strategy}.

\hint
Como nos livramos dos pontos informais ``$\dotsb$''?

\hint
Indução.

\hint
Seja $steps(x)$ o número de passos necessários para quebrar o $x$ em $1$'s.

\endexercise

\note ``$\,\ntimes\,$'' ao invés de ``$\,+\,$''.
Vamos agora usar como cimento a operação $\ntimes$,
ilustrando o processo com o número $2016$:
\goodbreak
$$
\align
2016
&= 12 \ntimes 168
\intertext{e repetimos\dots}
&= \overbrace{4\ntimes 3}^{12} \ntimes \overbrace{28 \ntimes 6}^{12}
\intertext{e agora vamos ver:
o $4$ pode se quebrado sim ($2\ntimes2$), mas o $3$?
Escrever $3 = 3\ntimes 1$ com certeza não é um jeito aceitável para quebrar o $3$
em blocos de construção ``mais principais'': o lado direto é mais complexo!
Quebrando com $\ntimes$ então, o $3$ é um bloco atómico, um tijolo!
Continuando:}
&= \overbrace{2\ntimes 2}^{4}{} \ntimes 3 \ntimes (7\ntimes 4) \ntimes (2\ntimes3)\\
&= 2\ntimes 2 \ntimes 3 \ntimes 7 \ntimes \overbrace{2\ntimes2}^4{} \ntimes 2\ntimes3
\intertext{onde todos os fatores são atómicos.
Podemos construir o número $2016$ então assim:}
2016 &= 2\ntimes 2 \ntimes 3 \ntimes 7 \ntimes 2\ntimes2 \ntimes 2\ntimes3,
\endalign
$$
usando os tijolos 2, 3, e 7, e a operação de multiplicação.
Nos vamos definir formalmente esses tijolos (são os \ii{primo}[informalmente]\dterm{primos},~\ref{prime}),
e estudar suas propriedades.

Ilustrando com o mesmo número $2016$, um outro caminho para processar seria o seguinte:
$$
\align
2016
&= 48 \ntimes 42 \\
&= \overbrace{8 \ntimes 6}^{48} \ntimes \overbrace{6\ntimes 7}^{42}\\
&= \overbrace{2\ntimes 4}^{8} \ntimes \overbrace{2\ntimes 3}^{6} \ntimes \overbrace{2\ntimes 3}^{6}{}\ntimes 7\\
&= 2 \ntimes \overbrace{2\ntimes 2}^{4}{} \ntimes 2\ntimes 3 \ntimes 2\ntimes 3\ntimes 7
\intertext{então no final temos:}
2016&= 2 \ntimes 2 \ntimes 2 \ntimes 2 \ntimes 3 \ntimes 2 \ntimes 3 \ntimes 7.
\endalign
$$

\exercise.
\label{fundamental_theorem_of_arithmetic_omen}
O que tu percebes sobre as duas desconstruções?:
$$
\align
2016 &= 2\ntimes 2 \ntimes 3 \ntimes 7 \ntimes 2\ntimes2 \ntimes 2\ntimes3;\\
2016 &= 2 \ntimes 2 \ntimes 2 \ntimes 2 \ntimes 3 \ntimes 2 \ntimes 3 \ntimes 7.
\endalign
$$

\solution
Esquecendo a ordem que os fatores parecem, são iguais:
cada construção precisa os mesmos blocos atómicos (o $2$, o $3$, e o $7$),
e cada um deles foi usado o mesmo número de vezes:
$2016 = 2^5 3^2 7$.

\endexercise

\exercise.
\label{factorize_some_integers}%
Fatorize os inteiros $15$, $16$, $17$, $81$, $100$, $280$, $2015$, e $2017$
em fatores primos.

\solution
Calculamos:
$$
\alignat 4
15   &= 3 \ntimes 5 \qquad&  17   &= 17          \qquad& 100  &= 2^2\ntimes 5^2           \qquad& 2015 &= 5\ntimes 13\ntimes 31  \\
16   &= 2^4         \qquad&  81   &= 3^4         \qquad& 280  &= 2^3 \ntimes 5 \ntimes 7  \qquad& 2017 &= 2017.
\endalignat
$$

\endexercise

\codeit FactorNaive.
\label{program_factor_naive}
Escreva um programa que mostra para cada entrada, sua fatorizações em primos.
Executa teu programa para verificar tuas respostas no~\ref{factorize_some_integers}.
\endcodeit

\question.
Usando adição, nos precisamos apenas um tipo de tijolo para construir qualquer
inteiro positivo: o $1$.
Usando a multiplicação nos já percebemos que vários tipos são necessários; mas quantos?

\note.
A pergunta e sua resposta não são triviais!
Recomendo para ti, tentar responder e \emph{provar} tua afirmação.
Logo vamos encontrar a resposta (de Euclides)
que é um dos teoremas mais famosos e importantes na história de matemática
(\ref{primes_is_infinite}).

No fim do capítulo chegamos no resultado principal
que esclareçará o~\ref{fundamental_theorem_of_arithmetic_omen}:
o Teorema Fundamental de Aritmética (\refn{fundamental_theorem_of_arithmetic}),
ilustrado (parcialmente) já por \Euclid{}Euclides
(circa~\oldstyle{300}~a.C.)~nos seus \Euclid[Elementos]\emph{Elementos}
de Euclides\Euclid~\cite{elements}
e provado completamente e formalmente por \Gauss{}Gauss
(no ano \oldstyle{1798}) no seu
\emph{Disquisitiones Arithmeticæ}\Gauss[Disquisitiones Arithmiticæ]~\cite{disquisitiones}.

\endsection
%%}}}

%{{{ Divisibility 
\section Divisibilidade.

\definition Divisibilidade.
\label{divides}%
\tdefined{divide}%
\tdefined{divisor}%
\tdefined{multiplo}%
\tdefined{divisível}%
\sdefined {\holed a\divides \holed b} {\holed a divide \holed b}%
Sejam $a,b\in\ints$.
Digamos que \dterm{o $a$ divide o $b$} (ou \dterm{o $b$ é divisível por $a$}), sse existe $b = ak$ para algum $k\in\ints$.
Nesse caso, escrevemos $a\divides b$.
Em símbolos:
$$
a\divides b \defiff \lexists {k\in\ints} {b = ak}.
$$
Os \dterm{divisores} do $a$ são todos os inteiros $d$ tais que $d \divides a$.
Naturalmente, usamos a notação $a\ndivides b$ quando $a$ não divide $b$.

\example. $3 \divides 12$, porque $12 = 3 \ntimes 4$ e $4\in\ints$, mas
$8 \ndivides 12$, porque nenhum inteiro $u$ satisfaz $12 = 8u$.
\endexample

\exercise Propriedades da divisibilidade.
\label{divides_properties}
Sejam $a,b,x,y,m\in\ints$.
Prove que:
\doublecolumns
\beginol
\li[1_is_the_bottom_of_divides] $1 \divides a$
\li[0_is_the_top_of_divides] $a \divides 0$
\li $a \divides b \implies a \divides bx$
\li $a \divides b \implies a \divides -b \mland -a \divides b$
\li $a \divides b \mland a \divides c \implies a \divides b + c$
\li $a \divides b \mland a \divides c \implies a \divides bx + cy$
\li $a \divides b \mland b \neq 0 \implies \abs a \leq \abs b$
\li se $m\neq0$ então: $a \divides b \!\iff\! ma \divides mb$.
\endol
\singlecolumn

\hint Aplique a definição do $\divides$.

\endexercise

\exercise Mais propriedades da divisibilidade.
\label{divides_is_almost_antisymmetric}%
\label{divides_is_a_partial_order_on_nats}%
Para todos $a,b,c\in\ints$,
$$
\alignat 2
&a \divides a                                           &&\text{(reflexividade)}\\
&a \divides b \mland b \divides c \implies a \divides c &&\text{(transitividade)}\\
&a \divides b \mland b \divides a \implies \abs a = \abs b.   &&
\intertext{
Se $a,b\in\nats$, a terceira propriedade fica mais forte:
}
&a \divides b \mland b \divides a \implies a = b        &\quad&\text{(antissimetria)}.
\endalignat
$$

\endexercise

\proposition.
\label{wrong_property_of_product_dividing_common_multiple}
Sejam $a,b,m\in\ints$.  Se $a \divides m$ e $b \divides m$, então $ab \divides m$.
\wrongproof.
Como $a\divides m$, pela definição de $\divides$, existe $u\in\ints$ tal que
$a = mu$.  Similarmente, como $b\divides m$, existe $v\in\ints$ tal que
$b = mv$.  Multiplicando as duas equações por partes, temos
$$
ab = (mu)(mv) = m(umv),
$$
e como $umv\in\ints$, $ab \divides m$.
\mistaqed

\exercise.
Ache o erro na prova acima e \emph{prove} que a proposição é falsa!

\hint Presta atenção na definição do $\divides$.

\hint Procure um contraexemplo onde $a$ e $b$ tem um fator em comun.

\solution
O erro fica na aplicação da definição de $a \divides b$\thinspace:
ao invés de $\lexists {k\in\ints} {b = ak}$,
a prova usou $\lexists {k\in\ints} {a = bk}$.
\endgraf
Para ver que a proposição realmente é falsa, considere o contraexemplo seguinte:
$$
a = 6,\qquad
b = 15,\qquad
m = 30.
$$
Realmente temos
$6  \divides 30$ e 
$15 \divides 30$,
mas
$6\ntimes 15 = 90 \ndivides 30$.

\endexercise

\note.
Nos encontramos a ``versão correta'' da proposição falsa acima no
item~\refn{wrong_property_of_product_dividing_common_multiple}
depois (\ref{product_of_coprimes_divides_common_multiple}).

\exercise.
\label{implications_with_divisibility_of_linear_combinations}
Sejam $a,b,c\in\ints$.
Para cada afirmação abaixo, prove-a ou desprove-a:
$$
\alignat2
\text{(i)}   &\qquad& a \divides \phantom1b + c\phantom1                          &\implies a \divides b \mland a \divides c\\
\text{(ii)}  &\qquad& a \divides b + c \mland a \divides \phantom1b - c\phantom2  &\implies a \divides b                    \\
\text{(iii)} &\qquad& a \divides b + c \mland a \divides \phantom1b + 2c          &\implies a \divides b                    \\
\text{(iv)}  &\qquad& a \divides b + c \mland a \divides 2b + 2c                  &\implies a \divides b                    \\
\text{(v)}   &\qquad& a \divides b + c \mland a \divides 2b + 3c                  &\implies a \divides 3b + 2c\,.
\endalignat
$$

\solution
A (ii) é falsa: um contraexemplo seria o $a = 2$, $b = c = 1$.
Realmente, temos
$$
2 \divides 1 + 1 = 2 \mland 2 \divides 1 - 1 = 0,
\qqtext{mas}
2\ndivides 1.
$$
\endgraf
A (iii) é verdadeira:
$$
\left.
\aligned
        a\divides b + c \implies a\divides 2b + 2c\\
                                 a\divides \phantom1b + 2c
\endaligned
\right\}
\implies
a \divides \underbrace{(2b + 2c) - (b + 2c)}_{\dsize b}.
$$

\endexercise

\definition Primo.
\label{prime}
\tdefined{primo}
\tdefined{composto}
\iiseealso{composto}{primo}
\iiseealso{primo}{composto}
Seja $p\in\nats$, com $p \geq 2$.
Chamamos o $p$ \dterm{primo} sse $p$ é divisível apenas por $\pm 1$ e $\pm p$.
Caso contrario, ele é \dterm{composto}.

\exercise.
O $0$ é primo?  Composto?
O $1$ é primo?  Composto?

\solution
Nenhum dos dois é nem primo nem composto: a definição começa declarando
$p$ como um natural tal que $p \geq 2$.
Logo, não é aplicável nem para o 0 nem para o 1.

\endexercise

\exercise.
\label{2_is_the_only_even_prime}
2 é o único primo par.

\endexercise

\exercise.
Usando uma fórmula de lógica, defina diretamente o que significa que
um $n\in\nats\setminus\set 1$ é composto.

\solution
Seja $n\in\nats$.
$$
\namedpred{Composite}(n) \defiff
\lexists {a,b\in\nats\setminus\set{0,1}} { n = ab }.
$$

\endexercise

{\input knuthprimes
\example.
\label{first_primes}%
Os primeiros 31 primos são os \primes{31}.
\endexample
}

\exercise.
\label{in_primes_divides_means_equals}
Sejam $p$, $q$ primos, com $p\divides q$.
Mostre que $p=q$.

\endexercise

\exercise.
\label{every_composite_number_is_divisible_by_a_prime}
Seja $b$ composto.  Prove que $b$ tem um divisor primo $d\leq \sqrt b$.

\endexercise

\codeit factor.
\label{program_factor}
Use o~\ref{every_composite_number_is_divisible_by_a_prime}
para melhorar teu programa do~\ref{program_factor_naive}.
\endcodeit

\endsection
%%}}}

%%{{{ The division algorithm 
\section O algoritmo da divisão.

\lemma Divisão de Euclides.
\label{euclidean_division}%
\Euclid[lema da divisão]%
\iisee{divisão}{Euclides}%
Dados inteiros $a$ e $b$ com $b>0$, existem inteiros $q$ e $r$ tais que:
$$
a = bq + r,
\qquad
0\leq r < b.
\eqdef{division}
$$
Alem disso, os $q$ e $r$ são \emph{determinados unicamente}.
\sketch.
\endgraf
\proofstyle{Existência:}
Considera a seqüência infinita:
$$
\ldots,~
-3b + r,~
-2b + r,~
-b + r,~
r,~
b + r,~
2b + r,~
3b + r,~
\ldots
$$
Observe que ela tem elementos não-negativos e, aplicando a PBO, considera o menor deles.
\endgraf
\proofstyle{Unicidade:}
    Suponha que $a=bq+r=bq'+r'$
    para alguns $q,r,q',r'\in\ints$ tais que satisfazem as restrições
    $0\leq r < b$ e $0\leq r' < b$.
    Mostre que $r=r'$ e $q=q'$.
\qes

Por causa dessa existência e unicidade, podemos definir:

\definition Divisão.
\tdefined{divisão}%
\tdefined{quociente}[divisão]%
\tdefined{resto}[divisão]%
\sidx[see]{quociente}{divisão} 
Dados $a,b\in\ints$ com $b>0$, chamamos os inteiros $q$ e $r$ que satisfazem
a~\eqref{division}
Chamamos o $q$ o \dterm{quociente} e o $r$ o
\dterm{resto} da divisão de $a$ por $b$.

\exercise.
\label{n_divides_exactly_one_of_n_consecutive_integers}
Seja $n\in\nats$ positivo.  Se $a_0,a_1,\dotsc,a_{n-1}$ são $n$ inteiros consecutivos,
então $n\divides a_i$ para um único $i\in\set{0,\dots,n-1}$.

\hint
Seja $a=a_0$.  Assim $a_i = a + i$.

\hint
Divida o $a$ por $n$ e, olhando para o resto $r$,
ache o certo $i$ tal que $n\divides a_i$.

\hint
Para a unicidade, ache o resto da divisão de $n$ por o aleatorio $a_j$.

\endexercise

\exercise.
Prove que para todo $n\in\ints$, se $3\ndivides n$
então $3 \divides n^2 - 1$.

\hint
Ou fatorize o $n^2-1$ e use o~\ref{n_divides_exactly_one_of_n_consecutive_integers},
ou considere os dois casos possíveis dependendo dos restos da divisão de $n$ por $3$.

\endexercise

\definition Conjunto fechado sobre $+$.
\label{closed_under_addition}%
    Seja $A$ conjunto de números que satisfaz a propriedade:
    $$
    a,b \in A \implies a+b \in A.
    $$
    Digamos que $A$ é \dterm{fechado} sobre $+$.

\exercise.
O $\emptyset$ e o $\set{0}$ são fechados sobre $+$.

\endexercise

\exercise.
Generalize a noção acima para definir a noção
``conjunto fechado sobre $f$'',
onde $f$ é uma operação no $A$ de aridade qualquer.

\endexercise

\exercise.
Quais dos conjuntos abaixo são fechados sobre $+$, quais sobre $-$, e quais sobre $\cdot$?
$$
\aligned
    U &= \set{0}\\
    W &= \set{0,1}\\
    P &= \set{1,2,4,8,16,\dotsc}\\
    I &= \set{1,1/2,1/4,1/8,1/16,\dotsc}
\endaligned
\quad
\aligned
    A &= \set{0,4,6,10,12,16,18,22,24,\dotsc}\\
    B &= \set{0,2,4,6,8,10,12,\dotsc}\\
    C &= \set{\dotsc,-9,-6,-3,0,3,6,9,\dotsc}\\
    D &= \set{\dotsc,-8,-5,-2,1,4,7,10,\dotsc}.
\endaligned
$$

\endexercise

\exercise.
Defina os conjuntos infinitos do exercício anterior sem usar ``$\ldots$\!''.

\endexercise

\exercise.
O $\rats$ é fechado sobre quais das quatro operações binárias: $+$, $-$, $\cdot$, $\div$?
E o $\rats\setminus\set0$?

\endexercise

\exercise.
Prove que se um conjunto é fechado sobre $-$, ele tem que ser fechado sobre $+$ também, mas não o converso!

\endexercise

Um conjunto de inteiros fechado sobre $-$ (e $+$), não tem muita liberdade na ``forma'' dele.
O teorema seguinte mostra a forma geral de todos eles.

\theorem.
\label{form_of_closed_under_minus}
Seja $S\subseteq\ints$, com $S\neq\emptyset$, $S$ fechado sobre $-$ (e logo, sobre $+$ também).
Prove que $S=\set 0$ ou $S$ possui um mínimo elemento positivo $m$ e $S = \set{ km \st k \in\ints}$.

\exercise.
Sem usar disjunção, escreva uma frase equivalente com a conclusão do
\ref{form_of_closed_under_minus}, e explique porque ela é equivalente.

\hint Existe $n\in\nats$ tal que $S = \set{ kn \st k\in\ints}$.

\endexercise

\endsection
%%}}}

%%{{{ The greatest common divisor 
\section O máximo divisor comum.

\definition.
\label{a_gcd}%
Sejam $a,b\in\ints$.
O inteiro $d$ é \dterm{um máximo divisor comum (m.d.c.)} dos $a$~e~$b$,
sse $d$~é~um divisor comum e um multiplo de todos os divisores comuns.
Em símbolos:
\endgraf\vskip 1ex\noindent
\line{\hfill
$
d = \dsym{\gcd a b}
\defiff
\underbrace{
d \divides a
\;\land\;
d \divides b
}_{\text{divisor comun}}
\;\land\;
\underbrace{
\lforall c {c\divides a \;\land\; c\divides b \implies c\divides d}
}_{\text{``máximo''}}.
$
\hfil\mistake}

\exercise.
A~\ref{a_gcd} tem um erro: o símbolo $\gcd a b$ não foi bem definido!
O que precisamos provar para definir realmente o símbolo $\gcd a b$?

\solution
Duas coisas:
\endgraf
\proofstyle{Existência:}
\emph{para todos inteiros $a$, $b$, existe inteiro $d$ que satisfaz as relações acima.}
\endgraf
\proofstyle{Unicidade:}
\emph{se $d$, $d'$, são inteiros que satisfazem essas relações, então $d=d'$.}

\endexercise

\proposition.
Sejam $a,b\in\ints$.  Se $d,d'\in\ints$ são máximos divisores comum
dos $a$ e $b$, então $d=\pm d'$.
\sketch.
Aplicamos a definição de m.d.c.~para cada um dos $d$ e $d'$,
para chegar em $d\divides d'$ e $d'\divides d$.
\qes
\proof.
Suponha que $d,d'$ são m.d.c.'s de $a$ e $b$.
Como $d$ é um m.d.c., todos os divisores em comum dos $a$ e $b$ o dividem.
Mas, como $d'$ é um divisor em comum, então $d'\divides d$.
Simetricamente concluimos que $d\divides d'$.
Logo $d = \pm d'$ (por~\ref{divides_is_almost_antisymmetric}).
\qed

\corollary.
Sejam $a,b\in\ints$.
Existe único $d\in\nats$ tal que $d$ é um m.d.c.~de $a$ e~$b$.

Agora podemos definir o símbolo $\gcd a b$:

\definition O máximo divisor comum.
\label{gcd}
\sidx[see]{máximo divisor comum}{mdc}
\tdefined{mdc}
Sejam $a,b\in\ints$.
$$
d = \dsym{\gcd a b}
\defiff
\underbrace{
d \divides a
\;\land\;
d \divides b
}_{\text{divisor comun}}
\;\land\;
\underbrace{
d\in\nats
\;\land\;
\lforall c {\paren{c\divides a \mland c\divides b} \implies c\divides d}
}_{\text{o máximo}}
\sdefined{\gcd {\holed a} {\holed b}}{o máximo divisor comum de \holed a e \holed b}
$$

\theorem.
\label{gcd_as_linear_combination}%
\label{gcd_divides_any_linear_combination}%
\tdefined{combinação linear}%
Sejam $a,b\in\ints$.
Então existe $d\in\nats$ que satisfaz a definição de $\gcd a b$,
ele pode ser escrito como \dterm{combinação linear}
dos $a$ e $b$, com coeficientes inteiros; ou seja,
$$
d = sa + tb,
\qquad
\text{para alguns $s,t\in\ints$}.
$$
Alem disso, o $\gcd a b$ divide qualque combinação linear dos $a$ e $b$.
\sketch.
Considere o conjunto $L$ de todas as combinações lineares.
Prove que existe $n_0\in\nats$ tal que $L = \set{ kn_0 \st k\in\ints }$.
Verifique que $\gcd a b = n_0$.
\qes

\exercise.
Verifique se a forma do $\gcd a b$ como combinação linear dos $a$ e $b$
é unicamente determinada.

\hint
Não é.  Mostre um contraexemplo.

\solution
Toma $3$ e $4$.  Temos $\gcd 4 3 = 1$, mas:
$$
\aligned
1 &= (-2)\ntimes 4 + 3\ntimes 3\\
1 &= \phantom{(-}4\phantom{)}\ntimes 4 - 5\ntimes 3.
\endaligned
$$

\endexercise

\proposition.
\label{gcd_of_comparable}
$a\divides b \implies \gcd a b = a$.
Especificamente, $\gcd a 0 = a$.
\sketch.
Precisamos apenas verificar as condições da definição de m.d.c., que seguem por
as propriedades de $\divides$ que já provamos.
\qes

\exercise.
\label{gcd_signs}
$
\gcd a b
=
\gcd a {-b}
=
\gcd {-a} {b}
=
\gcd b a
$.

\endexercise

\exercise.
\label{gcd_of_two_is_gcd_of_one_plus_sum}
Sejam $a,b\in\ints$.
Prove que
$$
\gcd a b = \gcd a {a+b}.
$$

\hint
Lembre a definição de m.d.c.\,.

\hint
Talvez as propriedades seguintes são úteis:
\beginul
\li para todos $x,y\in\nats$, $x\divides y \mland y\divides x \implies x = y$;
\li para todos $a,x,y\in\ints$, $a\divides x \mland a\divides y \implies a \divides {x+y}$.
\endul

\solution
\proofstyle{Idéia 1:}
Sejam $d = \gcd a b$ e $d' = \gcd a {a + b}$.
Pela definição, $d$ é divisor comum dos $a$ e $b$,
então $d\divides a $ e $d\divides b$, e logo $d \divides a + b$.
Temos então que $d$ é um divisor comum dos $a$ e $a + b$, e, pela definição de mdc,
como $d' = \gcd a {b+c}$, temos $d'\divides d$.
Similarmente, $d\divides d'$.
Então $|d| = |d'|$ e como ambós são naturais (parte da definição de $\gcd x y$), temos:
$$
\gcd a b = d = d' = \gcd a {a + b}.
$$
\endgraf
\proofstyle{Idéia 2:}
Seja $d = \gcd a b$.  Vamos mostrar que $d = \gcd a {a + b}$.
Pela definição, $d\geq0$ e é divisor comum dos $a$ e $b$,
então $d\divides a$ e $d\divides b$, e logo $d \divides a + b$.
Temos então que $d\geq0$ e é um divisor comum dos $a$ e $a + b$, e, pela definição de mdc,
falta só provar que cada divisor comum deles divide o $d$.
Seja $c\in\ints$ tal que $c\divides a$ e $c \divides {a+b}$.
Logo, $c\divides a - (a+b)=-b$.  Concluimos que $c\divides b$, então
$c$ é um divisor comum dos $a$ e $b$, então $c\divides d$ pela definição do $d$
como m.d.c.~dos $a$ e $b$.

\endexercise

\lemma Lema de Euclides.
\label{euclid_lemma}
\Euclid[lema]
Sejam $a,b\in\ints$ e $p$ primo.
Se $p \divides ab$, então $p\divides a$ ou $p\divides b$.
\sketch.
Suponha que $p\ndivides a$.  Logo o $\gcd a p = 1$ pode ser escrito como combinação linear de $a$ e $p$:
$$
1 = as + pt,    \qquad\text{para uns $s,t\in\ints$}.
$$
Multiplica os dois lados por $b$, e explica por que necessariamente $p\divides b$.
\qes
\proof.
Suponha que $p\ndivides a$.  Logo o $\gcd a p = 1$ pode ser escrito como combinação linear de $a$ e $p$,
ou seja, existem $s,t\in\ints$ tais que:
$$
\align
1 &= as + pt.
\intertext{Multiplicando os dois lados por $b$, temos:}
b &= asb + ptb.
\endalign
$$
Observe que como $p\divides ab$, segue que $p\divides asb$ (por~\ref{divides_properties}).
Obviamente $p\divides ptb$ também.
Logo, $p\divides asb + ptb = b$.
\qed

\theorem.
\label{coprime_with_a_part_of_a_product_must_divide_the_other_part_to_divide_the_product}
Se $\gcd d a = 1$ e $d \divides ab$, então $d \divides b$.
\sketch.
A prova é practicamente a mesma com aquela do~\ref{euclid_lemma}:
lá nós precisamos da primalidade do $p$ apenas para
concluir que $\gcd a p = 1$.
Aqui temos diretamente a hipótese $\gcd a d = 1$.
\qes
\proof.
Seja $a,b,d\in\ints$, tais que
$\gcd d a = 1$ e $d \divides ab$.
Como $\gcd a d = 1$, podemos o escrever como combinação linear dos $a$ e $d$:
$$
1 = sa + td,\qquad\text{para alguns $s,t\in\ints$}.
$$
Multiplicando por $b$, ganhamos
$$
b = sab + tdb,
$$
e argumentando como na prova do~\ref{euclid_lemma}
concluimos que $d \divides b$.
\qed

\corollary.
\label{product_of_coprimes_divides_common_multiple}
Se $a\divides m$, $b\divides m$, e $\gcd a b = 1$, então $ab\divides m$.
\proof.
Como $a\divides m$, temos $m = au$ para algum $u\in\ints$.
Mas $b\divides m=au$, e como $\gcd b a = 1$, temos $b\divides u$
(por~\ref{coprime_with_a_part_of_a_product_must_divide_the_other_part_to_divide_the_product}).
Então $bv = u$ para algum $v\in\ints$.
Substituindo, $m = au = a(bv) = (ab)v$, ou seja, $ab \divides m$.
\qed

\theorem Euclid.
\label{primes_is_infinite}%
\Euclid[infinidade de primos]%
Existe uma infinidade de primos.
\sketch.
Para qualquer conjunto finito de primos
$P = \set{p_1,\dotsc,p_n}$, considere o número
$p_1\dotsb p_n + 1$ e use-lo para achar um primo fora do $P$.
\qes
\proof.
Para qualquer conjunto finito de primos
$P = \set{p_1,\dotsc,p_n}$,
observe que o número $p=p_1\dotsb p_n + 1$ não é divisivel por nenhum dos $p_i$'s
(porque $p_i\divides p$ e $p_i\divides p_1\dotsb p_n$ implicam
$p\divides 1$, absurdo).
Então, como $p\geq 2$, ou o $p$ é primo e $p\not\in P$,
ou $p$ é divisivel por algum primo $q \not\in P$
(por~\ref{every_composite_number_is_divisible_by_a_prime}).
Nos dois casos, existe pelo menos um primo fora do $P$.
\qed

\endsection
%%}}}

%%{{{ The Euclidean algorithm 
\section O algoritmo de Euclides.

\note Idéia.
Sejam $a,b$ inteiros positivos.
Como achamos o $\gcd a b$?
Nos vamos aplicar o lemma da divisão~(\refn{euclidean_division}) repetetivamente,
até chegar em resto $0$:
$$
\matrix
\format
\r\;    &\;\c\;  & \; \c \;                   & \l      & \;\c\; & \c      & \qquad\qquad\l          \\
a       &   =    & b                          & q_0     &  +     & r_0,    & 0\leq r_0 < b           \\
b       &   =    & r_0                        & q_1     &  +     & r_1,    & 0\leq r_1 < r_0         \\
r_0     &   =    & r_1                        & q_2     &  +     & r_2,    & 0\leq r_2 < r_1         \\
r_1     &   =    & r_2                        & q_3     &  +     & r_3,    & 0\leq r_3 < r_2         \\
        & \vdots &                            &         &        &         & \hfil\vdots\hfil        \\
r_{n-3} &   =    & r_{n-2}                    & q_{n-1} &  +     & r_{n-1},& 0\leq r_{n-1} < r_{n-2} \\
r_{n-2} &   =    & \boxed{\mathstrut r_{n-1}} & q_n     &  +     & \underbrace{r_n}_0,      & 0 = r_n < r_{n-1}.      
\endmatrix
$$
O $\gcd a b$ estará na posição marcada acima.
Vamos agora descrever o algoritmo formalmente, e provar
(informalmente e formalmente) sua corretude!

\algorithm Euclides.
\label{euclidean_algorithm}%
\tdefined{algoritmo}[de Euclides]%
\Euclid[algoritmo]%
\endgraf
\noindent%
{\def\Euclid{\algorithmstyle{Euclid}}%
\centerline{$\Euclid(a,b)$}
{\hrule width \hsize height 1pt\relax}
\vskip4pt
\algospec
 INPUT: $a,b\in\nats$
OUTPUT: $\gcd a b$
\endspec
\beginol
\li Se $b=0$, retorna $a$.
\li Retorna $\Euclid(b,r)$, onde $r = a \bmod b$.
\endol
{\hrule width \hsize height 1pt\relax}
}

\example.
\label{euclidean_algorithm_example}
Ache o $\gcd {101} {73}$ com o algoritmo de Euclides.

\solution
Sabendo que os dois números são primos, fica imediato que eles são coprimos entre si também:
a reposta é 1.

Aplicando o algoritmo de Euclides, para achar o $\gcd {101} {73}$, dividimos o $101$ por $73$:
$$
\alignat 2
101 &= 73 \ntimes \underbrace{\phantom 1}_{\text{quociente}} + \underbrace{\phantom{28}}_{\text{resto}},      &\qquad&0 \leq \underbrace{\phantom{28}}_{\text{resto}} < 73
\intertext{e sabemos que assim reduziremos o problema para o alvo de achar o $\gcd {73} {\text{resto}}$.  Pensando, achamos os valores:}
101 &= 73 \ntimes \underbrace{1}_{\text{quociente}} + \underbrace{28}_{\text{resto}},      &\quad&0 \leq \underbrace{28}_{\text{resto}} < 73 
\intertext{ou seja, $\gcd {101} {73} = \gcd {73} {28}$.  Então, repetimos:}
73 &= 28 \ntimes \underbrace{{2}}_{\text{quociente}} + \underbrace{{17}}_{\text{resto}},      &&0 \leq \underbrace{17}_{\text{resto}} < 28
\intertext{ou seja, $\gcd {73} {28} = \gcd {28} {17}$.  Repetimos:}
28 &= 17 \ntimes \underbrace{1}_{\text{quociente}} + \underbrace{11}_{\text{resto}},      &&0 \leq \underbrace{11}_{\text{resto}} < 17
\intertext{ou seja, $\gcd {28} {17} = \gcd {17} {11}$.  Repetimos:}
17 &= 11 \ntimes \underbrace{1}_{\text{quociente}} + \underbrace{6}_{\text{resto}},      &&0 \leq \underbrace{6}_{\text{resto}} < 11
\intertext{ou seja, $\gcd {17} {11} = \gcd {11} 6$.  Repetimos:}
11 &= 6 \ntimes \underbrace{1}_{\text{quociente}} + \underbrace{5}_{\text{resto}},      &&0 \leq \underbrace{5}_{\text{resto}} < 6
\intertext{ou seja, $\gcd {11} 6 = \gcd 6 5$.  Repetimos:}
6 &= 5 \ntimes \underbrace{1}_{\text{quociente}} + \underbrace{1}_{\text{resto}},      &&0 \leq \underbrace{1}_{\text{resto}} < 5
\intertext{ou seja, $\gcd 6 5 = \gcd 5 1$.  Como $\gcd 5 1 = 1$, nem precisamos repetir, mas vamos mesmo assim:}
5 &= \boxed 1 \ntimes \underbrace{5}_{\text{quociente}} + \underbrace{0}_{\text{resto}}.      &&
\endalignat
$$

Mais compactamente, os passos são:
$$
\matrix
\format
\r  & \c    & \c       & \l        & \l & \c    & \l  & \c     & \c & \c       & \c & \c    & \c & \c     & \r            & \c    & \l          \\
101 & {}={} & 73       & {}\ntimes{} & 1  & {}+{} & 28, & \qquad & 0  & {}\leq{} & 28 & {}<{} & 73 & \qquad & \gcd{101}{73} & {}={} & \gcd{73}{28}\\
73  & {}={} & 28       & {}\ntimes{} & 2  & {}+{} & 17, &        & 0  & {}\leq{} & 17 & {}<{} & 28 &        & \gcd{73 }{28} & {}={} & \gcd{28}{17}\\
28  & {}={} & 17       & {}\ntimes{} & 1  & {}+{} & 11, &        & 0  & {}\leq{} & 11 & {}<{} & 17 &        & \gcd{28 }{17} & {}={} & \gcd{17}{11}\\
17  & {}={} & 11       & {}\ntimes{} & 1  & {}+{} & 6,  &        & 0  & {}\leq{} & 6  & {}<{} & 11 &        & \gcd{17 }{11} & {}={} & \gcd{11}{6 }\\
11  & {}={} & 6        & {}\ntimes{} & 1  & {}+{} & 5,  &        & 0  & {}\leq{} & 5  & {}<{} & 6  &        & \gcd{11 }{6 } & {}={} & \gcd{6 }{5 }\\
6   & {}={} & 5        & {}\ntimes{} & 1  & {}+{} & 1,  &        & 0  & {}\leq{} & 1  & {}<{} & 5  &        & \gcd{6  }{5 } & {}={} & \gcd{5 }{1 }\\
5   & {}={} & \boxed 1 & {}\ntimes{} & 5  & {}+{} & 0   &        &    &          &    &       &    &        & \gcd{5  }{1 } & {}={} & \gcd{1 }{0 } = \boxed 1.
\endmatrix
$$
\moveqedup
\endexample

\remark.
\def\Euclid{\algorithmstyle{Euclid}}%
Podemos utilizar o algoritmo de Euclides para achar o $\gcd a b$
onde $a,b\in\ints$ também,
graças ao~\ref{gcd_signs}:
$(a,b) = (\abs a, \abs b) = \Euclid(\abs a, \abs b)$.

\exercise.
Usando o algoritmo de Euclides, ache os:
(i) $\gcd {108} {174}$; 
(ii) $\gcd {2016} {305}$.

\solution
(i) Para o $\gcd {108} {174} = \gcd {174} {108}$ calculamos:
$$
\matrix
\format
\r  & \c    & \c       & \l        & \l & \c    & \l    & \c     & \c & \c       & \c & \c    & \c & \c     & \r             & \c    & \l            \\
174 & {}={} & 108      & {}\ntimes{} & 1  & {}+{} &{66},  & \qquad & 0  & {}\leq{} & 66 & {}<{} & 108& \qquad & \gcd{174}{108} & {}={} & \gcd{108}{66 }\\
108 & {}={} & 66       & {}\ntimes{} & 1  & {}+{} &{42},  &        & 0  & {}\leq{} & 42 & {}<{} & 66 &        &                & {}={} & \gcd{66 }{42 }\\
66  & {}={} & 42       & {}\ntimes{} & 1  & {}+{} &{24},  &        & 0  & {}\leq{} & 24 & {}<{} & 42 &        &                & {}={} & \gcd{42 }{24 }\\
42  & {}={} & 24       & {}\ntimes{} & 1  & {}+{} &{18},  &        & 0  & {}\leq{} & 18 & {}<{} & 24 &        &                & {}={} & \gcd{24 }{18 }\\
24  & {}={} & 18       & {}\ntimes{} & 1  & {}+{} &{6 },  &        & 0  & {}\leq{} & 6  & {}<{} & 18 &        &                & {}={} & \gcd{18 }{6  }\\
18  & {}={} & \boxed 6 & {}\ntimes{} & 3  & {}+{} &{0 }   &        &    &          &    &       &    &        &                & {}={} & \gcd{6  }{0  } = \boxed 6.
\endmatrix
$$
\endgraf
\noindent
(ii) Calculamos:
$$
\matrix
\format
\r  & \c    & \c       & \l        & \l & \c    & \l     & \c     & \c & \c       & \c & \c    & \c & \c     & \r              & \c    & \l            \\
2016& {}={} & 305      & {}\ntimes{} & 6  & {}+{} &{186},  & \qquad & 0  & {}\leq{} &186 & {}<{} &305 & \qquad & \gcd{2016}{305} & {}={} & \gcd{305}{186}\\
305 & {}={} & 186      & {}\ntimes{} & 1  & {}+{} &{119},  &        & 0  & {}\leq{} &119 & {}<{} &186 &        &                 & {}={} & \gcd{186}{119}\\
186 & {}={} & 119      & {}\ntimes{} & 1  & {}+{} &{67 },  &        & 0  & {}\leq{} &67  & {}<{} &119 &        &                 & {}={} & \gcd{119}{67 }\\
119 & {}={} & 67       & {}\ntimes{} & 1  & {}+{} &{52 },  &        & 0  & {}\leq{} &52  & {}<{} &67  &        &                 & {}={} & \gcd{67 }{52 }\\
67  & {}={} & 52       & {}\ntimes{} & 1  & {}+{} &{15 },  &        & 0  & {}\leq{} &15  & {}<{} &52  &        &                 & {}={} & \gcd{52 }{15 }\\
52  & {}={} & 15       & {}\ntimes{} & 3  & {}+{} &{7  },  &        & 0  & {}\leq{} &7   & {}<{} &15  &        &                 & {}={} & \gcd{15 }{7  }\\
15  & {}={} & 7        & {}\ntimes{} & 2  & {}+{} &{1  },  &        & 0  & {}\leq{} &1   & {}<{} &7   &        &                 & {}={} & \gcd{7  }{1  }\\
7   & {}={} & \boxed 1 & {}\ntimes{} & 7  & {}+{} &{0  }   &        &    &          &    &       &    &        &                 & {}={} & \gcd{1  }{0  } = \boxed 1.
\endmatrix
$$
%$$
%\matrix
%\format
%\r  & \c    & \c       & \l        & \l & \c    & \l     & \c     & \c & \c       & \c & \c    & \c & \c     & \r              & \c    & \l            \\
%    & {}={} &          & {}\ntimes{} &    & {}+{} &{   },  & \qquad & 0  & {}\leq{} &    & {}<{} &    & \qquad & \gcd{    }{   } & {}={} & \gcd{   }{   }\\
%    & {}={} &          & {}\ntimes{} &    & {}+{} &{   },  &        & 0  & {}\leq{} &    & {}<{} &    &        &                 & {}={} & \gcd{   }{   }\\
%    & {}={} & \boxed 1 & {}\ntimes{} &    & {}+{} &{   }   &        &    &          &    &       &    &        &                 & {}={} & \gcd{   }{   } = .
%\endmatrix
%$$

\endexercise

\codeit.
\label{implement_euclidean_algorithm}
Implemente o algoritmo de Euclides e verifique tuas soluções nos exercícios anteriores.
\endcodeit

\codeit.
\label{implement_verbose_euclidean_algorithm}
Implemente um modo ``verbose'' no teu programa
do~\ref{implement_euclidean_algorithm},
onde ele mostra todas as equações e desigualdades, e não apenas o resultado final.
\endcodeit

\lemma Euclides.
\label{euclid_gcd_lemma}
Se $a,b\in\ints$ com $b > 0$, então $\gcd a b = \gcd b r$,
onde $r$ o resto da divisão de $a$ por $b$.
\wrongproof.
Dividindo o $a$ por $b$, temos $a = bq + r$.
Vamos mostrar que qualquer inteiro $d$ satisfaz a equivalência:
$$
\align
d \divides a
\mland
d \divides b
&\iff
d \divides b
\mland
d \divides r.\\
\intertext{Realmente, usando as propriedades~\refn{divides_properties}, temos:}
d \divides a
\mland
d \divides b
&\implies
d\divides \overbrace{a - bq}^{\dsize r}\\
d\divides \underbrace{bq + r}_{\dsize a}
&\impliedby
d \divides b
\mland
d \divides r.
\endalign
$$
Isso mostra que os divisores em comum dos $a$ e $b$, e dos $b$ e $r$ são os mesmos,
ou, formalmente:
$$
\set{c\in\ints\st c\divides a \mland c\divides b}
=
\set{c\in\ints\st c\divides b \mland c\divides r}.
$$
Logo,
$$
\alignat 2
\gcd a b
&= \max\set{c\in\ints\st c\divides a \mland c\divides b}    \qqby{def.~$\gcd a b$}\\
&= \max\set{c\in\ints\st c\divides b \mland c\divides r}    \qqby{provado acima}\\
&= \gcd b r                                                 \qqby{def.~$\gcd b r$}
\endalignat
$$
que mostra a corretude do algoritmo.
\mistaqed

\exercise.
Qual é o problema com a prova do~\ref{euclid_gcd_lemma}?

\solution
A definição do maior divisor comum $(a,b)$ não foi ``o maior divisor comum dos $a$ e $b$''.
Lembre-se~\ref{gcd}.  Veja também o~\ref{gcd_alternative_definition}.

\endexercise

\theorem Algorítmo de Euclides.
\label{euclidean_algorithm_correctness}
O~\ref{euclidean_algorithm} é correto.
\proof.
Precisamos provar duas coisas: \emph{terminação\/}\/ e \emph{corretude}.
\endgraf
\proofstyle{Corretude.}
Se o algoritmo precisou $n$ passos, temos que verificar:
Temos
$$
\gcd a b
= \gcd b {r_0}
= \gcd {r_0} {r_1}
= \gcd {r_1} {r_2}
= \dotsb
= \gcd {r_{n-1}} {r_n}
= \gcd {r_n} 0
= r_n.
$$
Todas as igualdades exceto a última seguem por causa do~\ref{euclid_gcd_lemma};
a última por causa da~\ref{gcd_of_comparable}.
\endgraf
\proofstyle{Terminação.}
Note que a seqüência de restos $r_0, r_1, \ldots$ é estritamente
decrescente, e todos os seus termos são não negativos:
$$
0\leq \dotsb < r_2 < r_1 < r_0 < b.
$$
Logo, essa seqüência não pode ser infinita.
Realmente, o tamanho dela não pode ser maior que $b$,
então depois de no máximo $b$ passos, o algorítmo terminará.
\qed

\exercise.
\label{euclidean_algorithm_proof_why_informal}
Nenhuma das duas partes da prova do~\ref{euclidean_algorithm_correctness}
é completamente formal.  Explique porque.
(Veja também os~\refs{euclidean_algorithm_correctness_formal_proof_by_induction}--\refn{euclidean_algorithm_correctness_formal_proof_by_wop}.)

\hint ${}\dotsb{}$

\hint ${}\dotsb{}$

\solution
São os ``${}\dotsb{}$'' mesmo!

\endexercise

\note Passos do algoritmo de Euclides.
Como o exercício seguinte mostra, o algoritmo de Euclides
é bem mais eficiente do que nós mostramos acima:
depois dois passos, as duas entradas, nos piores dos casos,
são reduzidas para metade.

\exercise.
Se $a \geq b$, então $r < a/2$, onde $r$ o resto da divisão de $a$ por $b$.

\hint Separe os casos: ou $b > a/2$ ou $b \leq a/2$.

\hint Qual seria o resto em cado caso?

\hint Num caso, dá para achar exatamente o resto.
No outro, use a restrição que o resto satisfaz.

\solution
\case{Caso $b > a/2$:}
Então $r = a-b < a/2$.
\case{Caso $b < a/2$:}
Então $r < b < a/2$.

\endexercise

\endsection
%%}}}

%%{{{ The extended Euclidean algorithm 
\section O algoritmo estendido de Euclides.

\note.
Nos já provamos que o m.d.c.~$\gcd a b$ de dois inteiros $a$ e $b$
pode ser escrito como uma combinação linear deles, mas como podemos
realmente \emph{achar}\/ inteiros $s,t\in\ints$ que satisfazem a
$$
\gcd a b = as + bt,     \qquad s,t\in\ints?
$$
Supresamente a resposta já está ``escondida'' no mesmo algoritmo de Euclides!

\algorithm Algoritmo estendido de Euclides.
\label{extended_euclidean_algorithm}
\Euclid[algoritmo estendido]
\tdefined{algoritmo}[estendido de Euclides]
\algospec
 INPUT: $a,b\in\ints$, $b>0$
OUTPUT: $s,t\in\ints$ tais que $\gcd a b = as + bt$.
\endspec

\example.
Escreva o $\gcd {101} {73}$ como combinação linear dos $101$ e $73$.

\solution
Primeiramente, precisamos aplicar o algoritmo de Euclides para achar o m.d.c.,
como no~\ref{euclidean_algorithm_example},
mas vamos também resolver cada equação por o seu resto:
$$
\matrix
\format
\r  & \c    & \c       & \l          & \l & \c    & \l & \c           & \r & \c    & \c & \c    &\c & \c         & \c  \\
101 & {}={} & 73       & {}\ntimes{} & 1  & {}+{} & 28 & \qquad\qquad &28  & {}={} &101 & {}-{} &   &{}       {} & 73 \\
73  & {}={} & 28       & {}\ntimes{} & 2  & {}+{} & 17 &              &17  & {}={} &73  & {}-{} & 2 &{}\ntimes{} & 28 \\
28  & {}={} & 17       & {}\ntimes{} & 1  & {}+{} & 11 &              &11  & {}={} &28  & {}-{} &   &{}       {} & 17 \\
17  & {}={} & 11       & {}\ntimes{} & 1  & {}+{} & 6  &              &6   & {}={} &17  & {}-{} &   &{}       {} & 11 \\
11  & {}={} & 6        & {}\ntimes{} & 1  & {}+{} & 5  &              &5   & {}={} &11  & {}-{} &   &{}       {} & 6  \\
6   & {}={} & 5        & {}\ntimes{} & 1  & {}+{} & 1  &              &1   & {}={} &6   & {}-{} &   &{}       {} & 5  \\
5   & {}={} & \boxed 1 & {}\ntimes{} & 5  & {}+{} & 0. &              &    &       &    &       &    &          &     \\
\endmatrix
$$
Utilizando as equações no lado direto, de baixo para cima, calculamos:
$$
\def\hl#1{\underline{#1}}
\alignat 2
1 &= \hl6 - \hl5                                           &\quad&\text{(6 e 5)   }\\
  &= \hl6 - (\hl{11} - \hl6)
   = \hl6 - \hl{11} + \hl6
   = -\hl{11} + 2\ntimes \hl6                                   &&\text{(11 e 6)  }\\
  &= -\hl{11} + 2\ntimes (\hl{17} - \hl{11})
   = -\hl{11} + 2\ntimes \hl{17} - 2\ntimes \hl{11}
   = 2\ntimes \hl{17} - 3\ntimes \hl{11}                        &&\text{(17 e 11) }\\
  &= 2\ntimes \hl{17} - 3\ntimes (\hl{28} - \hl{17})
   = 2\ntimes \hl{17} - 3\ntimes \hl{28} + 3\ntimes 17
   = -3\ntimes \hl{28} + 5\ntimes \hl{17}                       &&\text{(28 e 17) }\\
  &= -3\ntimes \hl{28} + 5\ntimes (\hl{73} - 2\ntimes \hl{28})
   = -3\ntimes \hl{28} + 5\ntimes \hl{73} - 10\ntimes \hl{28}
   = 5\ntimes \hl{73} -13\ntimes \hl{28}                        &&\text{(73 e 28) }\\
  &= 5\ntimes \hl{73} -13\ntimes (\hl{101} - \hl{73})
   = 5\ntimes \hl{73} -13\ntimes \hl{101} + 13\ntimes \hl{73}
   = -13\ntimes \hl{101} + 18\ntimes \hl{73}                    &&\text{(101 e 73)}
\endalignat
$$
No lado direto mostramos nosso progresso, no sentido de ter conseguido
escrever o m.d.c.~como combinação linear de quais dois números.
Sublinhamos os inteiros que nos interessam para não perder nosso foco.
Em cada nova linha, escolhemos o menor dos dois números sublinhados,
e o substituimos por a combinação linear que temos graças ao algoritmo de Euclides.
Obviamente, essa notação e metodologia não tem nenhum sentido matematicamente
falando.  Serve apenas para ajudar nossos olhos humanos.
\endgraf
Achamos então $s,t\in\ints$ que satisfazem a equação $1 = sa + tb$:
são os $s = -13$ e $t = 18$.
\endexample

\exercise.
Usando o algoritmo estendido de Euclides, escreve:
(i) o $\gcd {108} {174}$ como combinação linear dos 108 e 174; 
(ii) o $\gcd {2016} {305}$ como combinação linear dos 2016 e 305.

\endexercise

\endsection
%%}}}

%%{{{ The sieve of Eratosthenes 
\section O crivo de Eratostenes.

\question.
Como podemos achar todos os primos até um dado limitante $b\in\nats$?

\Eratosthenes[crivo]%
\noindent
Eratostenes (276--194 a.C.)~conseguiu responder com sua metodo conhecida como
o ``crivo de Eratostenes''.
Antes de descrever o seu algoritmo formalmente, vamos aplicar sua idéia
para achar todos os primos menores ou iguais que $b=128$.

{%
\def\co#1{\phantom{#1}}%
\def\ci#1{\underline{#1}}%
Primeiramente liste todos os números de $2$ até $b=128$:
$$
\matrix
\format
~\r  &~\r  &~\r   &~\r   &~\r   &~\r   &~\r   &~\r   &~\r   &~\r   &~\r   &~\r   &~\r   &~\r   &~\r   &~\r   \\
   {   }&   {  2}&   {   3}&   {   4}&   {   5}&   {   6}&   {   7}&   {   8}&   {   9}&   {  10}&   {  11}&   {  12}&   {  13}&   {  14}&   {  15}&   {  16}\\
   { 17}&   { 18}&   {  19}&   {  20}&   {  21}&   {  22}&   {  23}&   {  24}&   {  25}&   {  26}&   {  27}&   {  28}&   {  29}&   {  30}&   {  31}&   {  32}\\
   { 33}&   { 34}&   {  35}&   {  36}&   {  37}&   {  38}&   {  39}&   {  40}&   {  41}&   {  42}&   {  43}&   {  44}&   {  45}&   {  46}&   {  47}&   {  48}\\
   { 49}&   { 50}&   {  51}&   {  52}&   {  53}&   {  54}&   {  55}&   {  56}&   {  57}&   {  58}&   {  59}&   {  60}&   {  61}&   {  62}&   {  63}&   {  64}\\
   { 65}&   { 66}&   {  67}&   {  68}&   {  69}&   {  70}&   {  71}&   {  72}&   {  73}&   {  74}&   {  75}&   {  76}&   {  77}&   {  78}&   {  79}&   {  80}\\
   { 81}&   { 82}&   {  83}&   {  84}&   {  85}&   {  86}&   {  87}&   {  88}&   {  89}&   {  90}&   {  91}&   {  92}&   {  93}&   {  94}&   {  95}&   {  96}\\
   { 97}&   { 98}&   {  99}&   { 100}&   { 101}&   { 102}&   { 103}&   { 104}&   { 105}&   { 106}&   { 107}&   { 108}&   { 109}&   { 110}&   { 111}&   { 112}\\
   {113}&   {114}&   { 115}&   { 116}&   { 117}&   { 118}&   { 119}&   { 120}&   { 121}&   { 122}&   { 123}&   { 124}&   { 125}&   { 126}&   { 127}&   { 128.}
\endmatrix
$$
Agora começa com o primeiro número na lista, o $2$, e apaga todos os maiores múltiplos dele:
$$
\matrix
\format
~\r &~\r &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r   \\
   {   }&   {  2}&   {   3}&\co{   4}&   {   5}&\co{   6}&   {   7}&\co{   8}&   {   9}&\co{  10}&   {  11}&\co{  12}&   {  13}&\co{  14}&   {  15}&\co{  16}\\
   { 17}&\co{ 18}&   {  19}&\co{  20}&   {  21}&\co{  22}&   {  23}&\co{  24}&   {  25}&\co{  26}&   {  27}&\co{  28}&   {  29}&\co{  30}&   {  31}&\co{  32}\\
   { 33}&\co{ 34}&   {  35}&\co{  36}&   {  37}&\co{  38}&   {  39}&\co{  40}&   {  41}&\co{  42}&   {  43}&\co{  44}&   {  45}&\co{  46}&   {  47}&\co{  48}\\
   { 49}&\co{ 50}&   {  51}&\co{  52}&   {  53}&\co{  54}&   {  55}&\co{  56}&   {  57}&\co{  58}&   {  59}&\co{  60}&   {  61}&\co{  62}&   {  63}&\co{  64}\\
   { 65}&\co{ 66}&   {  67}&\co{  68}&   {  69}&\co{  70}&   {  71}&\co{  72}&   {  73}&\co{  74}&   {  75}&\co{  76}&   {  77}&\co{  78}&   {  79}&\co{  80}\\
   { 81}&\co{ 82}&   {  83}&\co{  84}&   {  85}&\co{  86}&   {  87}&\co{  88}&   {  89}&\co{  90}&   {  91}&\co{  92}&   {  93}&\co{  94}&   {  95}&\co{  96}\\
   { 97}&\co{ 98}&   {  99}&\co{ 100}&   { 101}&\co{ 102}&   { 103}&\co{ 104}&   { 105}&\co{ 106}&   { 107}&\co{ 108}&   { 109}&\co{ 110}&   { 111}&\co{ 112}\\
   {113}&\co{114}&   { 115}&\co{ 116}&   { 117}&\co{ 118}&   { 119}&\co{ 120}&   { 121}&\co{ 122}&   { 123}&\co{ 124}&   { 125}&\co{ 126}&   { 127}&\co{ 128}
\endmatrix
$$
Toma o próximo número que está ainda na lista, o $3$, e faça a mesma coisa:
$$
\matrix
\format
~\r &~\r &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r   \\
   {   }&   {  2}&   {   3}&\co{   4}&   {   5}&\co{   6}&   {   7}&\co{   8}&\co{   9}&\co{  10}&   {  11}&\co{  12}&   {  13}&\co{  14}&\co{  15}&\co{  16}\\
   { 17}&\co{ 18}&   {  19}&\co{  20}&\co{  21}&\co{  22}&   {  23}&\co{  24}&   {  25}&\co{  26}&\co{  27}&\co{  28}&   {  29}&\co{  30}&   {  31}&\co{  32}\\
\co{ 33}&\co{ 34}&   {  35}&\co{  36}&   {  37}&\co{  38}&\co{  39}&\co{  40}&   {  41}&\co{  42}&   {  43}&\co{  44}&\co{  45}&\co{  46}&   {  47}&\co{  48}\\
   { 49}&\co{ 50}&\co{  51}&\co{  52}&   {  53}&\co{  54}&   {  55}&\co{  56}&\co{  57}&\co{  58}&   {  59}&\co{  60}&   {  61}&\co{  62}&\co{  63}&\co{  64}\\
   { 65}&\co{ 66}&   {  67}&\co{  68}&\co{  69}&\co{  70}&   {  71}&\co{  72}&   {  73}&\co{  74}&\co{  75}&\co{  76}&   {  77}&\co{  78}&   {  79}&\co{  80}\\
\co{ 81}&\co{ 82}&   {  83}&\co{  84}&   {  85}&\co{  86}&\co{  87}&\co{  88}&   {  89}&\co{  90}&   {  91}&\co{  92}&\co{  93}&\co{  94}&   {  95}&\co{  96}\\
   { 97}&\co{ 98}&\co{  99}&\co{ 100}&   { 101}&\co{ 102}&   { 103}&\co{ 104}&\co{ 105}&\co{ 106}&   { 107}&\co{ 108}&   { 109}&\co{ 110}&\co{ 111}&\co{ 112}\\
   {113}&\co{114}&   { 115}&\co{ 116}&\co{ 117}&\co{ 118}&   { 119}&\co{ 120}&   { 121}&\co{ 122}&\co{ 123}&\co{ 124}&   { 125}&\co{ 126}&   { 127}&\co{ 128}
\endmatrix
$$
Repeta o processo (o próximo agora seria o $5$) até não tem mais números para tomar.
Os números que ficarão são todos os primos até o $128$:
$$
\matrix
\format
~\r &~\r &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r   \\
   {   }&   {  2}&   {   3}&\co{   4}&   {   5}&\co{   6}&   {   7}&\co{   8}&\co{   9}&\co{  10}&   {  11}&\co{  12}&   {  13}&\co{  14}&\co{  15}&\co{  16}\\
   { 17}&\co{ 18}&   {  19}&\co{  20}&\co{  21}&\co{  22}&   {  23}&\co{  24}&\co{  25}&\co{  26}&\co{  27}&\co{  28}&   {  29}&\co{  30}&   {  31}&\co{  32}\\
\co{ 33}&\co{ 34}&\co{  35}&\co{  36}&   {  37}&\co{  38}&\co{  39}&\co{  40}&   {  41}&\co{  42}&   {  43}&\co{  44}&\co{  45}&\co{  46}&   {  47}&\co{  48}\\
   { 49}&\co{ 50}&\co{  51}&\co{  52}&   {  53}&\co{  54}&\co{  55}&\co{  56}&\co{  57}&\co{  58}&   {  59}&\co{  60}&   {  61}&\co{  62}&\co{  63}&\co{  64}\\
\co{ 65}&\co{ 66}&   {  67}&\co{  68}&\co{  69}&\co{  70}&   {  71}&\co{  72}&   {  73}&\co{  74}&\co{  75}&\co{  76}&   {  77}&\co{  78}&   {  79}&\co{  80}\\
\co{ 81}&\co{ 82}&   {  83}&\co{  84}&\co{  85}&\co{  86}&\co{  87}&\co{  88}&   {  89}&\co{  90}&   {  91}&\co{  92}&\co{  93}&\co{  94}&\co{  95}&\co{  96}\\
   { 97}&\co{ 98}&\co{  99}&\co{ 100}&   { 101}&\co{ 102}&   { 103}&\co{ 104}&\co{ 105}&\co{ 106}&   { 107}&\co{ 108}&   { 109}&\co{ 110}&\co{ 111}&\co{ 112}\\
   {113}&\co{114}&\co{ 115}&\co{ 116}&\co{ 117}&\co{ 118}&   { 119}&\co{ 120}&   { 121}&\co{ 122}&\co{ 123}&\co{ 124}&\co{ 125}&\co{ 126}&   { 127}&\co{ 128}
\endmatrix
$$
Tomando o $7$:
$$
\matrix
\format
~\r &~\r &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r   \\
   {   }&   {  2}&   {   3}&\co{   4}&   {   5}&\co{   6}&   {   7}&\co{   8}&\co{   9}&\co{  10}&   {  11}&\co{  12}&   {  13}&\co{  14}&\co{  15}&\co{  16}\\
   { 17}&\co{ 18}&   {  19}&\co{  20}&\co{  21}&\co{  22}&   {  23}&\co{  24}&\co{  25}&\co{  26}&\co{  27}&\co{  28}&   {  29}&\co{  30}&   {  31}&\co{  32}\\
\co{ 33}&\co{ 34}&\co{  35}&\co{  36}&   {  37}&\co{  38}&\co{  39}&\co{  40}&   {  41}&\co{  42}&   {  43}&\co{  44}&\co{  45}&\co{  46}&   {  47}&\co{  48}\\
\co{ 49}&\co{ 50}&\co{  51}&\co{  52}&   {  53}&\co{  54}&\co{  55}&\co{  56}&\co{  57}&\co{  58}&   {  59}&\co{  60}&   {  61}&\co{  62}&\co{  63}&\co{  64}\\
\co{ 65}&\co{ 66}&   {  67}&\co{  68}&\co{  69}&\co{  70}&   {  71}&\co{  72}&   {  73}&\co{  74}&\co{  75}&\co{  76}&\co{  77}&\co{  78}&   {  79}&\co{  80}\\
\co{ 81}&\co{ 82}&   {  83}&\co{  84}&\co{  85}&\co{  86}&\co{  87}&\co{  88}&   {  89}&\co{  90}&\co{  91}&\co{  92}&\co{  93}&\co{  94}&\co{  95}&\co{  96}\\
   { 97}&\co{ 98}&\co{  99}&\co{ 100}&   { 101}&\co{ 102}&   { 103}&\co{ 104}&\co{ 105}&\co{ 106}&   { 107}&\co{ 108}&   { 109}&\co{ 110}&\co{ 111}&\co{ 112}\\
   {113}&\co{114}&\co{ 115}&\co{ 116}&\co{ 117}&\co{ 118}&\co{ 119}&\co{ 120}&   { 121}&\co{ 122}&\co{ 123}&\co{ 124}&\co{ 125}&\co{ 126}&   { 127}&\co{ 128}
\endmatrix
$$
Tomando o $11$:
$$
\matrix
\format
~\r &~\r &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r  &~\r   \\
   {   }&   {  2}&   {   3}&\co{   4}&   {   5}&\co{   6}&   {   7}&\co{   8}&\co{   9}&\co{  10}&   {  11}&\co{  12}&   {  13}&\co{  14}&\co{  15}&\co{  16}\\
   { 17}&\co{ 18}&   {  19}&\co{  20}&\co{  21}&\co{  22}&   {  23}&\co{  24}&\co{  25}&\co{  26}&\co{  27}&\co{  28}&   {  29}&\co{  30}&   {  31}&\co{  32}\\
\co{ 33}&\co{ 34}&\co{  35}&\co{  36}&   {  37}&\co{  38}&\co{  39}&\co{  40}&   {  41}&\co{  42}&   {  43}&\co{  44}&\co{  45}&\co{  46}&   {  47}&\co{  48}\\
\co{ 49}&\co{ 50}&\co{  51}&\co{  52}&   {  53}&\co{  54}&\co{  55}&\co{  56}&\co{  57}&\co{  58}&   {  59}&\co{  60}&   {  61}&\co{  62}&\co{  63}&\co{  64}\\
\co{ 65}&\co{ 66}&   {  67}&\co{  68}&\co{  69}&\co{  70}&   {  71}&\co{  72}&   {  73}&\co{  74}&\co{  75}&\co{  76}&\co{  77}&\co{  78}&   {  79}&\co{  80}\\
\co{ 81}&\co{ 82}&   {  83}&\co{  84}&\co{  85}&\co{  86}&\co{  87}&\co{  88}&   {  89}&\co{  90}&\co{  91}&\co{  92}&\co{  93}&\co{  94}&\co{  95}&\co{  96}\\
   { 97}&\co{ 98}&\co{  99}&\co{ 100}&   { 101}&\co{ 102}&   { 103}&\co{ 104}&\co{ 105}&\co{ 106}&   { 107}&\co{ 108}&   { 109}&\co{ 110}&\co{ 111}&\co{ 112}\\
   {113}&\co{114}&\co{ 115}&\co{ 116}&\co{ 117}&\co{ 118}&\co{ 119}&\co{ 120}&\co{ 121}&\co{ 122}&\co{ 123}&\co{ 124}&\co{ 125}&\co{ 126}&   { 127}&\co{ 128}
\endmatrix
$$
E podemos já parar aqui, certos que os números que ainda ficam na lista, são todos os primos desejados.
}

\exercise.
Por quê?

\endexercise

\exercise.
\label{eratosthenian_algorithm}
Escreva formalmente o algoritmo do Eratostenes.

\endexercise

\codeit.
\label{implement_eratosthenian_algorithm}
Implemente o algoritmo de Eratostenes e use-lo para achar todos os primos até o $1024$.
\endcodeit

\endsection
%%}}}

%%{{{ The fundamental theorem of arithmetic 
\section O teorema fundamental da aritmética.

\theorem fundamental da aritmética (Euclides, Gauss).
\ii{teorema}[fundamental da aritmética]%
\Gauss{}%
\Euclid{}%
\label{fundamental_theorem_of_arithmetic}%
Todo $n\in\nats$ com $n > 1$, pode ser escrito como um produtório de primos.
Essa expressão é única se desconsiderar a ordem dos fatores do produtório.
\proof.
Seja $n\in\nats$ com $n > 1$.
\endgraf
\proofstyle{Existência:}
\ii{indução}[forte]
Usamos indução forte (veja~\refn{Strong_induction}).
Caso que $n$ seja primo, trivialmente ele mesmo é o produtório de primos (produtório de tamanho 1).
Caso contrário, $n = ab$, para uns $a,b\in\nats$ com $1<a<n$ e $1<b<n$,
logo podemos assumir (hipoteses indutivas) que cada um deles pode ser
escrito na forma desejada:
$$
\alignat 2
a &= p_1p_2\dotsb p_{k_a},          &\quad& \text{para alguns $p_i$'s primos;}\\
b &= q_1q_2\dotsb q_{k_b},          &\quad& \text{para alguns $q_j$'s primos.}
\endalignat
$$
Então temos
$$
n = ab = (p_1p_2\dotsb p_{k_a})(q_1q_2\dotsb )
       = p_1p_2\dotsb p_{k_a}q_1q_2\dotsb q_{k_b}
$$
que realmente é um produtório de primos.
\endgraf
\proofstyle{Unicidade:}
Suponha que para alguns primos $p_i$'s e $q_j$'s, e uns $s,t\in\nats$, temos:
$$
\align
n &= p_1 p_2 \dotsc p_s,\\
n &= q_1 q_2 \dotsc q_t.
\endalign
$$
Vamos mostrar que $s = t$ e que para todo $i\in\set{1,\dotsc,s}$,  $p_i = q_j$.
Temos
$$
p_1 p_2 \dotsc p_s = q_1 q_2 \dotsc q_t,
$$
e $p_1$ é primo que divide o lado esquerdo, então divide também o lado direito:
$$
p_1 \divides q_1 q_2 \dotsc q_t.
$$
Pelo Lema de Euclides\Euclid~\ref{euclid_lemma}, $p_1\divides q_{j_1}$ para algum $j_1$.
Mas o $q_{j_1}$, sendo um dos $q_j$'s, também é primo.
Logo $p_1 = q_{j_1}$ (veja~\ref{in_primes_divides_means_equals}).
Cancelando o $p_1$, temos:
$$
p_2 \dotsc p_s = q_1 q_2 \dotsc q_{j_1 - 1} q_{j_1 + 1} q_t,
$$
Agora repetimos até um dos dois lados não ter mais fatores primos.
Necessariamente, isso vai acontecer ``simultaneamente'' nos dois lados
(caso contrario teriamos um produtório
de primos igual com 1, impossível), ou seja: $s = t$.
Note que as equações $p_i = q_{j_i}$ mostram a unicidade desejada.
\qed

Graças o teorema fundamental da aritmética podemos definir a:

\definition Representação canónica de inteiros.
\label{canonical_representation_of_ints}
\tdefined{representação canónica}[de inteiros]
Seja $0\neq n\in\ints$.
Sua \dterm{representação canónica} é o produtório
$$
n =
(\pm 1)
\prod_{i=1}^k
p_i^{a_i}
=
(\pm 1)
p_1^{a_1}
p_2^{a_2}
\dotsb
p_k^{a_k},
$$
onde os $p_1 < p_2 < \cdots < p_k$'s são primos, e $a_i\in\nats_{>0}$ para $i=1,\dotsc,k$.
\endgraf
\label{canonical_complete_representation}%
Observe que se relaxar a restrição nos exponentes tal que $a_i\in\nats$,
cada $n\in\ints$ ($n\neq 0$) pode ser representado (também únicamente) como o produtório
$$
n =
(\pm 1)
\prod_{i=0}^k
p_i^{a_i}
=
(\pm 1)
p_0^{a_0}
p_1^{a_1}
\dotsb
p_k^{a_k},
$$
onde agora os $p_0 < p_1 < \cdots < p_k$ são \emph{todos os $k+1$ primeiros primos},
sendo então $p_0 = 2$, e $p_k$ o maior primo divisor do $n$.
Chamamos essa forma a \dterm{representação canónica completa} do $n$.
(Veja também o~\ref{encoding_of_finite_sequences}.)

\exercise.
\label{canonical_representation_with_int_exponents}
O que acontece se relaxar a restrição nos exponentes ainda mais?: $a_i\in\ints$.

\endexercise

\endsection
%%}}}

%%{{{ Open problems 
\section Problemas em aberto.
\label{Open_problems_in_number_theory}%

\conjecture Goldbach.
\label{goldbach_conjecture}%
\Goldbach{}

\conjecture Twin primes.
\label{twin_primes_conjecture}%

\conjecture Legendre.
\label{legendre_conjecture}%
\Legendre{}

\conjecture Collatz.
\label{collatz_conjecture}%
\Collatz{}

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ prob: p_divides_comb_p_r 
\problem.
\label{p_divides_comb_p_r}
Para todo $p$ primo, e todo $r\in\set{1,\dotsc,p-1}$,
$$
p \divides \comb p r.
$$

\hint
$\comb p r \in\ints$, $r < p$, e $p-r < p$.

\endproblem
%%}}}

%%{{{ prob 
\problem.
(Generalização do~\ref{implications_with_divisibility_of_linear_combinations}.)
Para quais $u,v\in\ints$, a afirmação
$$
a \divides b + c \mland a \divides ub + vc \implies a \divides xb + yc \quad \text{para todos $x,y\in\ints$}
$$
é válida?

\endproblem
%%}}}

%%{{{ prob 
\problem.
Prove que para todo $n\in\nats$, $\gcd {F_n} {F_{n+1}} = 1$,
onde $F_n$ é o $n$-ésimo termo da seqüência Fibonacci\Fibonacci[seqüência]{}~(\ref{fibonacci}).

\hint
Tu já resolveu o~\ref{gcd_of_two_is_gcd_of_one_plus_sum}, certo?

\solution
Vamos provar o pedido por indução.
Para $n=0$ temos
$$
    \gcd {F_0} {F_1} = \gcd 0 1 = 1.
$$
Seja $k\in\nats$ tal que $\gcd {F_k} {F_{k+1}} = 1$.
Precisamos mostrar que $\gcd {F_{k+1}} {F_{k+2}} = 1$.
Calculando,
$$
\alignat 2
\gcd {F_{k+1}} {F_{k+2}}
    &= \gcd {F_{k+1}} {F_{k+1} + F_k}   \qqby{pela definição da $F_n$}\\
    &= \gcd {F_{k+1}} {F_k}             \qqby{pelo~\ref{gcd_of_two_is_gcd_of_one_plus_sum}, com $a\asseq F_{k+1},\ b\asseq F_k$}\\
    &= \gcd {F_k} {F_{k+1}}             \qqby{propriedade de mdc}\\
    &= 1                                \qqby{pela hipótese indutiva}.
\endalignat
$$

\endproblem
%%}}}

%%{{{ prob 
\problem.
Seja $n\in\nats$, $n>1$.
Entre $n$ e $n!$ existe primo.

\hint
Olha para o $n!-1$.

\hint
Se $n!-1$ não é primo, toma um dos seus primos divisores, $p$.

\hint
Necessariamente $p > n$.

\endproblem
%%}}}

%%{{{ prob 
\problem.
Seja $n\in\nats$.
Ache $n$ consecutivos números compostos.

\hint
$!$

\hint
$m!+2$.

\hint
$m!+3$\dots

\hint
$m!+m$.

\endproblem
%%}}}

%%{{{ prob 
\problem.
Existe uma infinidade de primos ``da forma $4n+3$'', ou seja, o conjunto
$$
\set{4n+3 \st n\in\nats,\ \text{$4n+3$ primo}}
$$
é infinito.

\hint
Esquecendo o $2$, todos os primos são da forma $4n+1$ ou $4n+3$.
Suponha que $p_1, p_2,\dotsc, p_k$ ($k\in\nats$)
são todos os primos da segunda forma.

\hint
O que Euclides faria?

\hint
Tente achar (criar) um número da mesma forma tal que nenhum dos $p_i$ o divide.

\hint
$N = 4p_1p_2\dotsb p_k - 1$.

\hint
$N$ não pode ter apenas divisores da forma $4n+1$.

\endproblem
%%}}}

%%{{{ prob: WOP_iff_PFI 
\problem.
\label{WOP_iff_PFI}%
$\text{PBO} \iff \text{PIF}$.

\hint
Para provar a \rldir, considere o predicado
``todos os conjuntos $A$ com $k\in A$ para algum natural $k\leq n$ têm mínimo'',
ou o ``todos os conjuntos $A$ com $n\in A$ têm mínimo''.

\hint
Prove que todos os naturais satisfazem o predicado que tu consideraste.
(Para um dos dois, tu precisará indução \emph{forte}.)

\solution
Nos já provamos a direção \lrdir.

\endproblem
%%}}}

%%{{{ gcd_alternative_definition 
\problem {Definição alternativa de m.d.c.}.
\label{gcd_alternative_definition}%
Uma definição alternativa do m.d.c.~é a seguinte:
{\it Sejam $a,b\in\ints$.
O m.d.c.~dos $a$ e $b$ é o maior dos divisores em comum de $a$ e $b$.}
Ache um problema com essa definição, corrige-o, e depois compare
com a~\ref{gcd}.

\hint
O que acontece se $a=b=0$?
O que acontece se pelo menos um dos $a$ e $b$ não é o $0$?

\solution
Se $a=b=0$, o símbolo $\gcd a b$ não é definido,
porque todo $n\in\nats$ é um divisor em comum,
mas como o $\nats$ não tem um elemento máximo,
não existe o maior deles.
\endgraf
Precisamos restringir a definição para ser aplicável
apenas nos casos onde pelo menos um dos $a$ e $b$
não é o $0$ (escrevemos isso curtamente: $ab\neq 0$).
Assim, quando a nova definição é aplicável, ela realmente
defina o mesmo número, fato que segue pelas propriedades:
$$
\align
\gcd x 0 = 0 &\implies x = 0\\
x \divides y \mland y \neq 0 &\implies \abs x \leq \abs y.
\endalign
$$

\endproblem
%%}}}

%%{{{ prob 
\problem Contando os passos.
O que muda no~\ref{partitioning_restricted_best_strategy}
se em cada passo podemos quebrar todos os termos que aparecem?
Qual é a melhor estratégia, e quantos passos são necessários?

\hint
Tente quebrar o $10$ usando várias estratégias.
O que tu percebes?

\hint
Qual é o maior termo e como ele muda depois cada passo?

\solution
Agora a estratégia ótima seria quebrar cada termo ``no meio''.
Assim, para o $10$ temos:
$$
\align
10 &= 5 + 5\\
   &= (2 + 3) + (2 + 3)\\
   &= [(1 + 1) + (1 + 2)] + [(1 + 1) + (1 + 2)]\\
   &= 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1
\endalign
$$
em apenas $4$ pássos.
Depois cada passo, se o maior termo fosse o $m$, agora é o $\ceil {\frac m 2}$.
Precisamos tantos passos quantas vezes que podemos dividir o $n$ por $2$ até
chegar na unidade $1$: precisamos $\ceil {\log_2(n)}$ passos.

\endproblem
%%}}}

%%{{{ prob: euclidean_algorithm_correctness_formal_proof_by_induction 
\problem.
\label{euclidean_algorithm_correctness_formal_proof_by_induction}%
\def\Euclid{\algorithmstyle{Euclid}}%
Como tu percebeu resolvendo o~\ref{euclidean_algorithm_proof_why_informal},
nenhuma das duas partes da prova do~\ref{euclidean_algorithm_correctness}
foi formal.
Prove completamente formalmente as duas partes usando indução.

\hint Precisa expressar o alvo na forma $\lforall n {P(n)}$ para um certo predicado $P$.

\hint
\def\Euclid{\algorithmstyle{Euclid}}%
``\emph{Para todo $x\in\ints$, o $\Euclid(x,n)$ termina com o resultado certo}.''

\hint O que significaria $P(0)$?  $P(b)$?

\hint Ser forte é coisa boa.

\solution
\def\Euclid{\algorithmstyle{Euclid}}%
Seja o predicado
$$
P(n) \defiff \lforall {x\in\ints} {\text{$\Euclid(x,n)$ termina com $\gcd x n$}}
$$
Vamos provar que $\lforall {n\in\nats} {P(n)}$ por indução forte.
Seja $k\in\nats$ tal que $P(i)$ é válido para todo $i<k$ (hipótese indutiva).
Precisamos provar o $P(k)$, ou seja, que
\emph{para todo $x\in\ints$, $\Euclid(x,k)$ termina e $\Euclid(x,k) = \gcd x k$}.
Seja $x\in\ints$, e aplica o $\Euclid(x,k)$ para um passo.
Se $k=0$, a computação termina imediatamente com o resultado $x$, que é correto
(\refn{gcd_of_comparable}).
Se $k>0$, o algoritmo manda reduzir sua computação para a computação do $\Euclid(k,r)$,
onde $r = x \bmod k < k$.  Seguindo o~\ref{euclid_gcd_lemma} $\gcd x k = \gcd k r$, então
falta verificar que o $\Euclid(k,r)$ termina mesmo com $\gcd k r$,
que é verdade pela hipótese indutiva porque $r < k$ e logo $P(r)$ é válido.

\endproblem
%%}}}

%%{{{ prob: euclidean_algorithm_correctness_formal_proof_by_wop 
\problem.
\label{euclidean_algorithm_correctness_formal_proof_by_wop}%
Prove completamente formalmente as duas partes
do~\ref{euclidean_algorithm_correctness} usando o princípio da boa ordem.

\hint
Considera as duas partes separamente:
qual conjunto é o não vazio em cada parte?

\hint
Vai pelo absurdo.

\hint
O que seria um contraxemplo para cada parte?
\emph{O que acontece se existem contraexemplos?}

\hint 
\def\Euclid{\algorithmstyle{Euclid}}%
Sobre sua terminação:
Considere o menor $m$ tal que o $\Euclid(x,m)$ não termina
para algum $x\in\ints$.

\hint
\def\Euclid{\algorithmstyle{Euclid}}%
Sobre sua corretude:
Considere o menor $m$ tal que o $\Euclid(x,m)$
termina com resultado errado par algum $x\in\ints$.
Mas mostre primeiro a terminação.

\solution
\def\Euclid{\algorithmstyle{Euclid}}%
Provamos cada parte separamente:
\endgraf
\smallskip
\proofstyle{Terminação.}
Para chegar num absurdo, suponha que existem contraexemplos:
\emph{inteiros $c\geq0$, tais que o $\Euclid(a,c)$
não termina para algum $x\in\ints$.}
Seja $m$ o menor deles (PBO):
$$
m = \min\set{c \in\nats \st \lexists {x\in\ints} {\text{\Euclid(x,c) não termina}}}.
$$
Logo, para algum certo $a\in\ints$, temos que $\Euclid(a,m)$ não termina.
Com certeza $m\neq 0$, porque nesse caso o algoritmo termina imediatamente.
Logo $m > 0$ e aplicando o $\Euclid(a,m)$ para apenas um passo
a sua computação é reduzida no computação do $\Euclid(m,r)$,
onde $r = a \bmod m < m$, \emph{e agora precisamos mostrar que o
$\Euclid(m,r)$ termina para chegar num absurdo}.
Pela escolha do $m$ como \emph{mínimo} dos contraexemplos,
o $r$ não pode ser contraexemplo também.
Em outras palavras, o $\Euclid(x,r)$ realmente termina para qualquer $x$,
então para $x=m$ também, que foi o que queriamos provar.
\endgraf
\smallskip
\proofstyle{Corretude.}
Para chegar num absurdo, suponha que existem contraexemplos:
\emph{inteiros $c\geq0$, tais que o $\Euclid(x,c)$
acha resultado errado para algum $x\in\ints$.}
Seja $m$ o menor desses contraexemplos (PBO):
$$
m = \min\set{c \in\nats \st \lexists {x\in\ints} {\Euclid(x,c) \neq \gcd x c}}.
$$
Logo, para algum certo $a\in\ints$, temos $\Euclid(a,m) \neq \gcd a m$.
Esse $m$ não pode ser $0$, porque nesse caso o algoritmo retorna sua primeira entrada $a$;
resultado correto por causa do~\ref{gcd_of_comparable}.
Então $m>0$.
Aplicamos para um passo o $\Euclid(a,m)$.
Como $m\neq 0$, o algoritmo manda realizar o segundo passo:
retornar o que $\Euclid(m,r)$, onde $r = a \bmod m < m$.
(E sabemos que o $\Euclid(m,r)$ vai retornar algo, porque
já provamos a terminação do algoritmo para todas as suas possíveis entradas!)
Para concluir, observe:
$$
\alignat 2
\Euclid(m,r) 
&= \Euclid(a,m)     \qqby{pelas instruções do algoritmo}\\
&\neq \gcd a m      \qqby{escolha dos $m$ e $a$}\\
&= \gcd m r.        \qqby{pelo~\ref{euclid_gcd_lemma}}
\endalignat
$$
Então $\Euclid(m,r) \neq \gcd m r$ e achamos um contraexemplo (o $r$)
menor que o mínimo (o $m$)---absurdo!

\endproblem
%%}}}

%%{{{ prob: encoding_of_finite_sequences 
\problem Codificação de seqüências finitas.
\label{encoding_of_finite_sequences}%
Seja $S$ o conjunto de seqüências finitas de números naturais.
Descreva uma método para ``codificar'' os elementos de $S$
com os elementos de $\nats\setminus\set0$.
Tua metodo deve ser uma \emph{revertível}, no sentido que
cada seqüência finita
$$
s = \seq{s_0,s_1,\dotsc,s_{k_s}}\in S
$$
deve corresponder em exatamente um número natural $n_s\in\nats\setminus\set0$,
e, dado esse número $n_s\in\nats_{>0}$, deveria ser possível ``extrair''
a seqüência $s$ cuja codificação é o $n_s$.
Não se preocupe se existem naturais que não são codificações de nenhuma
seqüência.

\hint Use o teorema fundamental da aritmética~(\refn{fundamental_theorem_of_arithmetic}).

\hint
Seja $p_i$ o $i$-esimo primo ($p_0 = 2$, $p_1 = 3$, $p_2 = 5$, \dots).
Como podemos escrever o aleatorio $n\in\nats$?

\hint
Olha nos exponentes na forma
$
n =
p_0^{a_0}
p_1^{a_1}
p_2^{a_2}
\cdots
p_{k_n}^{a_{k_n}}
$.

\hint
Teste tua codificação nas seqüências $\seq{1,3}$ e $\seq{1,3,0}$.
Como essas seqüências são diferentes, suas codificações devem ser diferentes também.
E a seqüência vazia $\seq{}\in S$?  

\solution
Seja
$$
p_0 < p_1 < p_2 < p_3 < \dotsb
$$
a seqüência infinita dos primos.  (Assim, $p_0 = 2$, $p_1 = 3$, $p_2 = 5$, etc.)
Seja
$$
\seq{s_0, s_1, \dotsc, s_{n-1}} \in S
$$
uma seqüência de naturais de tamanho $n$.
Vamos a codificar com o inteiro
$$
c_s
= \prod_{i=0}^{n-1} p_i^{s_i + 1}
= p_0^{s_0 + 1} p_1^{s_1 + 1} p_2^{s_2 + 1} \cdots p_{n-1}^{s_{n-1} + 1}.
$$
(Note que a seqüência vazia ($n=0$) correponde no número $1\in\nats_{>0}$.)
\endgraf
Conversamente, dado um número $c\in\nats_{>0}$ que codifica uma seqüência,
como podemos ``decodificar'' a seqüência que corresponda com ele?
Graças o teorema fundamental da aritmética~(\refn{fundamental_theorem_of_arithmetic}),
temos
$$
c = p_0^{a_0} p_1^{a_1} \cdots p_{m-1}^{a_{m-1}}.
$$
Se existe exponente $a_j = 0$, o $c$ não codifica nenhuma seqüência.
Caso contrario, todos os exponentes são positivos, e o $c$ codifica
a seqüência
$$
\seq{a_0-1, a_1-1, \dotsc, a_m-1} \in S.
$$

\endproblem
%%}}}

%%{{{ prob: canonical_representation_of_rats 
\problem Representação canónica de racionais.
\label{canonical_representation_of_rats}%
Generalize a representação canónica de inteiros para racionais.

\hint
Qual foi tua resposta no~\ref{canonical_representation_with_int_exponents}?

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

Veja o~\cite[\S\S1.6--1.8]{babybm}.

\cite{elements},
\cite{disquisitiones}.

\cite{andrewsnumber}.

\cite{nivennumbers},
\cite{hardywright}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Number theory II: congruences 
\chapter Teoria de números II: congruências.
\label{Congruences}%

%%{{{ The idea behind congruence relation 
\section A idéia da relação de congruência.

\note.
Vamos fixar um inteiro positivo $m\in\nats$.
Graças à divisão de Euclides~(\refn{euclidean_division}),
qualquer inteiro $a\in\ints$ pode ser escrito na forma
$$
a = mk + r,
\qquad
0 \leq r < m,
$$
num jeito único.
\endgraf
Enquanto investigando a (ir)racionalidade dos $\sqrt 2$, $\sqrt 3$, $\sqrt {\vphantom3 m}$,
etc., nos percebemos que foi útil separar os inteiros em classes,
``grupando'' aqueles que compartilham o mesmo resto quando divididos por $m$.
Trabalhando com essa idéia nos encontramos nosso primeiro contato com
\emph{aritmética modular}.%
\footnote{Mentira.  Não foi o primeiro não: nos somos todos acostumados com
aritmética modular mesmo sem perceber.  Um desses contatos é por causa de ter
que contar com horas e relógios, cuja aritmética não parece muito com aquela
dos inteiros.  Por exemplo: 21 + 5 = 26, mas se agora são 21h00, que horas
serão depois de 5 horas?  Nossos relógios não vou mostrar 26h00, mas 02h00.}

\endsection
%%}}}

%%{{{ Two equivalent definitions 
\section Duas definições equivalentes.

\blah.
Precisamos definir formalmente a noção de ``\emph{dois inteiros $a$ e $b$ pertencem na
mesma classe, quando separamos eles em grupos usando o inteiro $m$}''.
A primeira coisa que precisamos perceber é que essa frase é uma afirmação sobre 3 objetos.
Queremos então uma definição e uma notação que captura essa relação \emph{de aridade 3}.

\note Congruência intuitivamente (1).
Chamamos dois inteiros \dterm{congruentes} módulo um terceiro inteiro,
sse eles têm o mesmo resto, quando divididos por ele.

\note Crítica.
Primeiramente, o texto da definição é bem informal e ambíguo.
Para tirar essas ambiguidades, precisamos introduzir variáveis para
referir sobre os ``mesmos restos'':

\note Congruência intuitivamente (2).
\label{congruence_intuitive_definition}
Sejam $a,b,m\in\ints$ com $m>0$, e sejam $q_a$, $r_a$, $q_b$, e $r_b$
os inteiros determinados por as divisões:
$$
\alignat 2
a &= mq_a + r_a     &\qquad& 0 \leq r_a < m\\
b &= mq_b + r_b     &      & 0 \leq r_b < m
\endalignat
$$
Digamos que os $a$ e $b$ são \dterm{congruentes} módulo~$m$,
sse $r_a = r_b$.

\remark.
\label{from_same_remainders_to_divides_the_diference}
Olhando para dois números $a$ e $b$, congruêntes módulo~$m$,
o que podemos dizer sobre a diferença deles?
Observe:
$$
\left.
\aligned
a - b
&= (mq_a + r_a) - (mq_b + r_b)\\
&= mq_a - mq_b + r_a - r_b\\
&= m(q_a - q_b) + (r_a - r_b)\\
&= m(q_a - q_b) + 0\\
&= m(q_a - q_b)
\endaligned
\right\}
\qquad
\aligned
\text{ou seja, $m\divides a - b$.}
\endaligned
$$
Essa observação nos mostra um caminho mais curto e elegante para definir o mesmo
conceito.  É o seguinte:

\definition Congruência (Gauss).
\label{congruence}
\tdefined{congruência}
\tdefined{módulo}
\Gauss[definição de congruência]
\sdefined{\holed a \cong {\holed b} \pmod {\holed m}}{\holed a é congruente com \holed b módulo \holed m}
Sejam $a,b,m\in\ints$ com $m>0$.
Digamos que os $a$ e $b$ são \dterm{congruentes} \dterm{módulo} $m$,
sse $m \divides a - b$.
Em símbolos, escrevemos
$$
a \cong b \pmod m
\defiff m \divides a - b
$$
e lemos: \emph{o $a$ é congruente com $b$ módulo~$m$}.

\beware.
A notação de congruência as vezes iluda de ser enterpredada como se fosse
uma relação entre o lado esquerdo $L$ e o lado direito $R$, assim:
$$
\underbrace{a}_{L} \cong \underbrace{b \pmod m}_{R}.
$$
\emph{Não!}
Principalmente, o lado direito, $b \pmod m$, nem é definido, então não tem significado,
e nem faz sentido afirmar algo sobre ele.
Prestando mais atenção, percebemos que o $\hole \cong \hole$ também não foi definido!
O que nos definimos foi o:
$$
\holed u \cong \holed v \pmod {\holed w}
$$
dados $u,v,w\in\ints$ com $w>1$.

\note Intuição.
Se precisamos para algum motivo pessoal---porque sim---separar mentalmente a
notação de congruência em dois lados, o único jeito que faz algum sentido
seria o:
$$
\underbrace{\mathstrut a \cong b}_L\quad\underbrace{\!\!\pmod m}_{R}.
$$
Assim, entendemos que ``algo acontece'' (lado $L$), ``dentro algo'' (lado $R$),
onde ``algo acontece'' seria ``o $a$ \emph{parece} com $b$'',
e ``dentro algo'' seria ``módulo~$m$''.
Mas, claramente tudo isso é apenas uma guia (caso que queremos)
e nada mais que isso.  Para argumentar sobre a relação de congruência,
usamos \emph{apenas sua definição formal!}

Para ganhar o direito de usar qualquer uma das duas definições, precisamos
mostrar que são equivalentes:

\theorem Equivalência das duas definições.
Sejam $a,b,m\in\ints$ com $m>0$, e sejam $q_a, r_a, q_b, r_b\in\ints$
os números determinados por as divisões:
$$
\alignat 2
a &= mq_a + r_a     &\qquad& 0 \leq r_a < m\\
b &= mq_b + r_b     && 0 \leq r_b < m
\endalignat
$$
Temos a equivalência:
$$
a \cong b \pmod m
\iff
r_a = r_b.
$$
\sketch.
Precisamos mostrar as duas direções do \bidir.
A direção \rldir, é practicamente
a~\ref{from_same_remainders_to_divides_the_diference}.
Para a direção \lrdir, vamos mostrar que $r_a - r_b = 0$.
Usamos a hipótese e propriedades de~$\divides$
para mostrar que $m\divides r_a - r_b$,
e depois as duas desigualdades para confirmar que, com suas restrições,
o único inteiro múltiplo de $m$ que as satisfaça, é o $0$.
\qes
\proof.
Precisamos mostrar as duas direções do \bidir:
\endgraf
\lrdir:
Suponha que
$a \cong b \pmod m$, ou seja,
$m\divides a - b$.
Resolvendo as duas equações das divisões por os restos $r_a$ e $r_b$,
temos:
$$
\left.
\aligned
r_a &= a - mq_a \\
r_b &= b - mq_b 
\endaligned
\right\}
\implies
\aligned
r_a - r_b
&= (a - mq_a) - (b - mq_b)\\
&= (a - b) - (mq_a - mq_b)\\
&= (a - b) - m(q_a - q_b).
\endaligned
$$
Observe que $m\divides a-b$ e $m\divides m(q_a - q_b)$.
Então $m$ tem que dividir a diferença deles também:
$$
m\divides \underbrace{(a - b) - m(q_a - q_b)}_{\dsize r_a - r_b}
$$
Usando as duas desigualdades: $0 \leq \abs{r_a - r_b} < m$.
Como $\abs{r_a-r_b}$ é um múltiplo de $m$, concluimos que necessariamente
$0 = \abs{r_a - r_b}$, ou seja: $r_a = r_b$.
\endgraf
\rldir:
Suponha que $r_a = r_b$.
Temos:
$$
\alignat 2
a - b
&= (mq_a + r_a) - (mq_b + r_b)                 \\
&= (mq_a - mq_b) - (r_a - r_b)                 \\
&= (mq_a - mq_b) - 0            \qqby{hipótese}\\
&= m(q_a - q_b),
\endalignat
$$
e como $q_a - q_b\in\ints$,
concluimos que
$m\divides a - b$, ou seja:
$a \cong b \pmod m$.
\qed

\note A operação binária ``mod''.
Em linguagens de programação é comum encontrar o operador \emph{binário}
``mod'', frequentemente denotado com o símbolo ``\thinspace{\tt \%}\thinspace''.
Em matemática, essa função \emph{binária} (aridade 2) é mais
encontrada como $\bmod$ mesmo.
Cuidado não confundir a \emph{função}
$\bmod : \ints\times\nats_{>0} \to \nats$
com a \emph{relação} $a \cong b \pmod m$.
Faz sentido escrever:
$$
69 \bmod 5 = 4.
$$
Isso significa apenas que o resto da divisão de 69 por 5, é 4.
No outro lado, nenhuma das expressões abaixo tem significado!:
$$
69 \pmod 5 = 4
\qquad\qquad
4 = 69 \pmod 5
$$

\exercise.
Explique o tipo da função $\bmod : \ints\times\nats_{>0} \to \nats$.

\hint Qual seria o valor de $4 \bmod 0$?

\solution
Por~\ref{euclidean_division},
precisamos $a\in\ints$ e $b\in\nats_{>0}$ para definir a divisão
de $a$ por $b$.

\endexercise

\exercise mod vs mod.
\label{mod-vs-mod}
Para cada uma das expressões abaixo uma das 3 opções é valida:
(a) ela denota um termo;
(b) ela denota uma afirmação; ou
(c) ela não tem significado.
Para cada expressão, decida qual é a opção certa e:
se for a (a), ache o seu valor (objeto);
se for a (b), ache o seu valor (de verdade).
\doublecolumns
\beginol
\li $69 \pmod 5 = 4$
\li $12 = 3 \pmod 8 $
\li $12 \cong 20 \pmod 4 $
\li $8 \pmod 3 \cong 12$
\li $108 \cong 208 \pmod {(43 \bmod 30)}$
\li $x \bmod 4 = 2 \implies x \cong 0 \pmod 2$
\li $5^{192 \bmod 3}$
\li $13\pmod 8 \cong 23 \pmod {18}$
\endol
\singlecolumn

\solution
Vamo lá:
\beginol
\li $69 \pmod 5 = 4$ não significa nada.
\li $12 = 3 \pmod 8$ não significa nada.%
\footnote{Se o $=$ fosse $\cong$, então significaria que $8 \divides 12 - 3 = 9$ (que é falso).}
\li $12 \cong 20 \pmod 4$ significa que $4 \divides 12 - 20 = -8$, que é verdade.
\li $8 \pmod 3 \cong 12$ não significa nada.
\li $108 \cong 208 \pmod {(43 \bmod 30)}$ significa que $43\bmod 30 \divides 108 - 208$, e para achar se é verdade ou não, calculamos $43\bmod 30 = 13$, e $108 - 208 = -100$ e substituimos: $13 \divides -100$, que é falso.
\li $\lforall {x\in\ints} {x \bmod 4 = 2 \limplies x \cong 0 \pmod 2}$ denota a afirmação que para todo $x\in\ints$, se $x \bmod 4 = 2$ então $x \cong 0 \pmod 2$, que é verdade:
seja $x\in\ints$ tal que $x \bmod 4 = 2$.  Logo $x = 4k + 2 = 2(2k + 1)$ para algum $k\in\ints$, ou seja, $2 \divides x = x - 0$.
\li $5^{192 \bmod 3}$ é o número 5 elevado ao resto da divisão de 192 por 3.  Como $3 \divides 192$ (por quê?  1 + 9 + 2 = 12; 1 + 2 = 3; veja~\ref{divisibility_criterion_3}), temos $192 \bmod 3 = 0$, então o valor da expressão é o número $5^0 = 1$.
\li $13\pmod 8 \cong 23 \pmod {18}$ não significa nada.
\endol

\endexercise

\note Notação.
Talvez ficaria mais intuitivo (e menos confúso), usar uma notação como a
$$
a \cong_m b \defiff m \divides a - b
$$
que aparece mais fiel na sua semántica.
Mas a notação que é usada internacionalmente, é aquela que nos definimos
e nos vamos ficar consistentemente fieis nela!

\endsection
%%}}}

%%{{{ The relation congruence modulo $m$ 
\section A relação de congruência módulo~$m$.

%%{{{ Fixing an $m$ 
\note Fixando um $m$.
Se fixar um inteiro $m>0$, então a expressão
$$
\holed a \cong \holed b \pmod m
$$
tem duas variáveis livres: a $a$ e a $b$.
Assim, a ``congruência módulo~$m$'' é uma relação binária,
cujas propriedades investigamos agora.
%%}}}

%%{{{ thm: congruence_mod_m_is_an_eqrel 
\theorem.
\label{congruence_mod_m_is_an_eqrel}%
Fixe um inteiro $m > 0$.
Para todos os $a,b\in\ints$,
temos:
$$
\xxalignat 2
(1)\quad&a \cong a \pmod m                             &&\textrm{(reflexividade)}\\
(2)\quad&a \cong b \pmod m \mland b \cong c \pmod m
\implies
a \cong c \pmod m                                      &&\textrm{(transitividade)}\\
(3)\quad&a \cong b \pmod m \implies b \cong a \pmod  m &&\textrm{(simetria)}.
\endxxalignat
$$
\sketch.
Todas são facilmente provadas aplicando diretamente
a definição de congruência módulo~$m$ (\refn{congruence})
e as propriedades básicas da $\divides$.
\qes
\proof.
(1) Obvio por que $m\divides a - a = 0$.
(2) Pela hipótese temos $m\divides a-b$ e $m\divides b-c$.
Então pelo~\ref{divides_properties} $m\divides (a-b) + (b-c) = a-c$.
(3) Pela hipótese temos $m\divides a - b$\thinspace; logo (\refn{divides_properties} de novo) $m\divides -(a - b) = b - a$.
\qed
%%}}}

%%{{{ remark: equivalence relation 
\remark.
\ii{relação}[de equivalência]%
Uma relação que satisfaz essas três propriedades é chamada
\dterm{relação de equivalência}~(\refn{Equivalence_relations_and_partitions}).
Estudamos relações no~\ref{Relations}.  Paciência!
%%}}}

\endsection
%%}}}

%%{{{ Modular arithmetic 
\section Aritmética modular.

\property.
\label{modular_arithmetic_properties}
Se $a \cong b \pmod m$, então para todo $x\in\ints$ temos:
$$
(1)\quad a + x \cong b + x   \pmod m;
\quad\enspace
(2)\quad ax \cong bx         \pmod m;
\quad\enspace
(3)\quad -a \cong -b         \pmod m.
$$
\sketch.
Todas seguem facilmente pela definição (\refn{congruence}) de congruência módulo~$m$.
\qes

\beware.
\label{wrong_cancellation_law_modulo_m}
O lei de cancelamento, mesmo valido nas igualdades,
não é valido nas congruências em geral.
Por exemplo,
$3\ntimes 2 \cong 3\ntimes 8 \pmod {18}$,
mas não podemos cancelar os $3$ nos dois lados:
$2 \ncong 8 \pmod {18}$.

Felizmente, o teorema seguinte mostra quando realmente podemos cancelar:

\theorem Lei de cancelamento módulo $m$.
\label{cancellation_law_modulo_m}
Seja $c\in\ints$ tal que $\gcd c m = 1$.
$$
ca\cong cb\pmod m
\implies
a \cong b \pmod m.
$$
\sketch.
Multiplicamos tudo por $c^{-1}$, cuja existência (módulo~$m$) é garantida
pela hipótese (aplicando o~\ref{find_inverse_modulo_m}).
\qes
\proof.
Como $\gcd c m = 1$, existe $c^{-1}$ (módulo~$m$) então:
$$
\align
ca\cong cb\pmod m
&\implies          c^{-1}c a\cong          c^{-1}c b\pmod m\\
&\implies \phantom{c^{-1}c}a\cong \phantom{c^{-1}c}b\pmod m.
\endalign
$$
\moveqedup
\qed

\exercise.
Aplicando as definições e propriedades de congruência e da relação $\divides$,
ache uma outra prova do~\refn{cancellation_law_modulo_m}.

\solution
Pela hipótese $m\divides ca - cb = c(a - b)$.
Mas $\gcd m c = 1$, então
(pelo~\ref{coprime_with_a_part_of_a_product_must_divide_the_other_part_to_divide_the_product})
$m\divides a - b$, ou seja, $a \cong b \pmod m$.

\endexercise

\exercise.
\label{from_mod_m_to_mod_am}
Suponha que $x \cong t \pmod m$, e seja $a$ um inteiro positivo.
O que podemos concluir sobre o $x$ módulo~$ma$?

\hint
Use as definições de congruência (\refn{congruence}) e de $\divides$ (\refn{divides})
para escrever o $x$ na forma $x = mk + t$ para algum $k\in\ints$.

\hint
Agora divida o $k$ por $a$.

\solution
Pela definição de congruência (\refn{congruence}) e de $\divides$ (\refn{divides}) temos que:
$$
\align
x &= mk + t, \quad\text{para algum $k\in\ints$}.
\intertext{Dividindo o $k$ por $a$,
temos $k = aq + i$, onde $q,i\in\ints$ e $0\leq i < a$.  Substituindo:}
x &= m(aq + i) + t\\
  &= maq + (mi + t).
\intertext{Logo, chegamos nas $a$ congruências}
x &\cong mi + t \pmod{ma}, \quad\text{para $i=0,\dotsc,a-1$},
\endalign
$$
e $x$ tem que satisfazer (exatamente) uma delas.

\endexercise

\exercise De igualdades para congruências.
\label{from_equality_to_congruence}
Seja $a,b\in\ints$.  Se $a = b$, então $a\cong b\pmod m$ para qualquer inteiro $m\in\nats$.

\endexercise

\endsection
%%}}}

%%{{{ Divisibility criteria 
\section Critéria de divisibilidade.
\ii{divisibilidade}[critéria]%

\criterion Divisibilidade por 10$^k$.
\label{divisibility_criterion_powers_of_10}
Um inteiro $c\neq 0$ é divisível por $10^k$
sse
o $c$ escrito em base decimal
termina com $k$ dígitos 0.

\criterion Divisibilidade por $2$ ou $5$.
\label{divisibility_criterion_2}
\label{divisibility_criterion_5}
Seja $m\in\set{2, 5}$.
Um inteiro $c$ é divisível por $m$
sse
o valor do último dígitos do $c$ (em base decimal) é $m$.

\criterion Divisibilidade por 3 ou 9.
\label{divisibility_criterion_3}
\label{divisibility_criterion_9}
Seja $m\in\set{3, 9}$.
Um inteiro $c$ é divisível por $m$
sse
o somatório dos valores dos dígitos do $c$ (em base decimal) é
divisível por $m$.

\criterion Divisibilidade por 4, 20, 25, 50.
\label{divisibility_criterion_4}
\label{divisibility_criterion_20}
\label{divisibility_criterion_25}
\label{divisibility_criterion_50}
Seja $m\in\set{4, 20, 25, 50}$.
Um inteiro $c$ é divisível por $m$
sse
o número formado por os \oldstyle{2} últimos dígitos do $c$ (em base decimal)
é divisível por $m$.

\criterion Divisibilidade por 11.
\label{divisibility_criterion_11}
Um inteiro $c$ é divisível por $11$
sse
o somatório dos valores dos dígitos do $c$ (em base decimal) em posição par
menos o somatório dos valores dos seus dígitos em posição impar
é divisível por $11$.

\exercise Divisibilidade por 6.
\label{divisibility_criterion_6}
Ache um critério (para o sistema decimal) para divisibilidade por 6.

\hint $6 = 2\ntimes 3$

\solution
Observe que por causa do~\ref{product_of_coprimes_divides_common_multiple}, temos:
$$
6\divides c
\iff
2 \divides c
\mland
3 \divides c.
$$
Logo, aplicamos os critéria de divisibilidade por $2$ e por $3$.

\endexercise

\criterion Divisibilidade por 8.
\label{divisibility_criterion_8_wrong}
Um número $c$ é divisível por 8 sse ele satisfaz
os critéria de divisibilidade por $2$ e $4$.
\wrongproof.
Observe que por causa do~\ref{product_of_coprimes_divides_common_multiple}, temos:
$$
8 \divides c
\iff
2 \divides c
\mland
4 \divides c.
$$
Logo, aplicamos os critéria de divisibilidade por $2$ e por $4$.
\mistaqed

\exercise.
Ache o erro no~\ref{divisibility_criterion_8_wrong},
e compare com a solução do~\ref{divisibility_criterion_6}.

\hint Veja o~\ref{product_of_coprimes_divides_common_multiple}.

\solution
Como $\gcd 4 2 = 4 \neq 1$, não podemos aplicar
o~\ref{product_of_coprimes_divides_common_multiple}.
Um contraexemplo:
$2 \divides 12$ e $4 \divides 12$, mas $2\ntimes 4 = 8 \ndivides 12$.

\endexercise

\exercise.
Ache um critério (no sistema decimal) para divisibilidade por 8,
e generalize para divisibilidade por $2^k$

\hint $8 = 2^3$, e $2 \divides 10$.

\hint $2 \divides 10 \implies 2^3 \divides 10^3$.

\endexercise

\exercise.
Ache um critério (no sistema decimal) para divisibilidade por $2^x5^y$, onde $x,y\in\nats$.

\hint Os $2$ e $5$ são divisores de $10$.

\endexercise

\endsection
%%}}}

%%{{{ Inverses modulo $m$ 
\section Inversos módulo~$m$.

\definition Inverso módulo $m$.
\tdefined{inverso}[multiplicativo módulo~$m$]
\sdefined{{\holed a}^{-1}}{o inverso (multiplicativo) do $\holed a$ (módulo~$m$)}
\label{inverse_modulo_m}
Seja $a,a',m\in\ints$.
Chamamos $a'$ \dterm{um inverso (multiplicativo) de $a$ módulo~$m$},
sse
$$
aa' \cong 1 \pmod m.
$$
Se existe inverso do $a$, o denotamos com $a^{-1}$ (dado um módulo~$m$).\mistake

\exercise.
Qual o problema com a definição do $a^{-1}$?

\solution
Para o símbolo $a^{-1}$ ser bem-definido, precisamos mostrar que, caso que
existe um inverso, ele é único, que nos realmente mostramos
no~\ref{inverse_modulo_m_uniqueness}.

\endexercise

Podemos falar sobre \emph{o} inverso (ao invés de \emph{um} inverso) graças ao teorema seguinte:

\theorem Unicidade do inverso.
\label{inverse_modulo_m_uniqueness}
Sejam $a,m\in\ints$.
Se $b,b'\in\ints$ satisfazem a $ax \cong 1 \pmod m$, então $b \cong b' \pmod m$.
\proof.
Como
$$
ab  \cong 1 \pmod m \qquad\mland\qquad ab' \cong 1 \pmod m,
$$
pela transitividade e reflexividade da congruência módulo~$m$, temos:
$$
ab \cong ab' \pmod m.
$$
Pela~\ref{modular_arithmetic_properties}, podemos multiplicar os dois lados por $b$:%
\footnote{Nada especial sobre $b$ contra o $b'$.  Poderiamos multiplicar por qualquer inverso do $a$ aqui.}
$$
bab \cong bab' \pmod m.
$$
Daí,
$(ba)b \cong (ba)b' \pmod m$,
ou seja $b \cong b' \pmod m$.
\qed

\example.
O inverso de $2$ módulo~$9$ é o $5$, porque $2\ntimes 5 = 10 \cong 1 \pmod 9$.
\endexample

Como o exemplo seguinte mostra, os inversos não existem sempre:

\example.
O $4$ não tem inverso módulo~$6$.

\solution
Podemos verificar com força bruta:
$$
\align
4 \ntimes 1 = \phantom04    &\cong 4 \pmod 6\\
4 \ntimes 2 = \phantom08    &\cong 2 \pmod 6\\
4 \ntimes 3 = 12            &\cong 0 \pmod 6\\
4 \ntimes 4 = 16            &\cong 4 \pmod 6\\
4 \ntimes 5 = 20            &\cong 2 \pmod 6
\endalign
$$
\moveqedup
\endexample

O teorema seguinte esclariza a situação:

\theorem Inverso módulo $m$.
\label{find_inverse_modulo_m}
Sejam $a,m\in\ints$.
$$
\text{$a$ tem inverso módulo~$m$}
\iff
\gcd a m = 1.
$$
\proof.
Precisamos mostrar as duas direções do \bidir.
\endgraf
\lrdir:
Escrevemos o $\gcd a m = 1$ como combinação\ii{combinação linear} linear dos $a$ e $m$
(sabemos que é possivel por \ref{gcd_as_linear_combination}, e, até melhor construtível
graças ao algoritmo estendido de Euclides,~\ref{extended_euclidean_algorithm}):
$$
\alignat 2
1 &= sa + tm, &&\qquad\text{para alguns $s,t\in\ints$.}
\intertext{Então temos:}
1 &\cong sa + tm    &&\pmod m\\
  &\cong sa + 0     &&\pmod m\\
  &\cong sa         &&\pmod m.
\endalignat
$$
Acabamos de achar um inverso de $a$ módulo~$m$: o $s$.
\endgraf
\rldir:
Seja $b$ um inverso de $a$ módulo~$m$; em outras palavras:
$$
ab \cong 1 \pmod m,
$$
ou seja, $m \divides ab - 1$, e $mu = ab - 1$ para algum $u\in\ints$.
Conseguimos escrever
$$
1 = um - ba,
$$
a combinação linear dos $a$ e $m$.
Pelo~\ref{gcd_divides_any_linear_combination}, $\gcd a m \divides 1$,
logo $\gcd a m = 1$.
\qed

\endsection
%%}}}

%%{{{ The Chinese remainder theorem 
\section O teorema chinês do resto.

\theorem Teorema chinês do resto.
\ii{teorema}[chinês do resto]
\iisee{chinês}[teorema do resto]{teorema chinês}
\ii{sistema}[de congruências]
\ii{congruência}[sistema]
\label{chinese_remainder_theorem}
Sejam $a_1,\dotsc,a_k,m_1,\dotsc,m_k\in\ints$,
com os $m_i$'s coprimos dois a dois:
$$
\lforall {i,j\in\set{1,\dotsc,k}} {i\neq j \limplies \gcd {m_i} {m_j} = 1}.
$$
Então existe $x\in\ints$ que satisfaz o sistema de congruências
$$
\align
x &\cong    a_1    \pmod {m_1}\\
x &\cong    a_2    \pmod {m_2}\\
  &\eqvdots                   \\
x &\cong    a_k    \pmod {m_k}.
\endalign
$$
Alem disso, a solução do sistema é única módulo~$m_1\dotsb m_k$.
\sketch.
\proofstyle{Existência:}
Seja
$$
\align
M   &\asseq \prod_{i=1}^k m_i = m_1m_2\dotsb m_k
\intertext{e, para todo $i\in\set{1,\dotsc,k}$, defina o}
M_i &\asseq \prod_{\Sb j=1\\j\neq i\endSb}^k m_j
     = m_1\dotsb m_{i-1}m_{i+1}\dotsb m_k
     = \frac M {m_i}.
\endalign
$$
Observe que $M_i$ é invertível módulo~$m_i$,
então seja $B_i$ o seu inverso.
Verificamos que o inteiro
$$
x =
\sum_{i=1}^k
a_i M_i B_i
$$
satisfaz todas as $k$ congruências,
e é então uma solução do sistema.
\endgraf
\proofstyle{Unicidade:}
Suponha que $x'\in\ints$ é uma solução do sistema.
Usando a definição de congruência e propriedades
de $\divides$, mostramos que $x' \cong x \pmod M$.
\qes

\example.
Ache todos os inteiros $x\in\ints$ que satisfazem o sistema de congruências:
$$
\align
x &\cong 2 \pmod 9\\
x &\cong 1 \pmod 5\\
x &\cong 2 \pmod 4.
\endalign
$$

\solution
Observamos primeiramente que os módulos $9$, $5$, e $4$ realmente são coprimos
dois a dois.  Então, pelo teorema chinês do resto,
o sistema realmente tem solução.
Seguindo sua método---e usando os mesmos nomes para as variáveis como
no~\ref{chinese_remainder_theorem} mesmo---calculamos os:
$$
\xalignat2
M_{\phantom0}   &= 9\ntimes5\ntimes4 = 180  &      &               \\
M_1 &= \phantom{9\ntimes{}}5\ntimes4 = 20   &  B_1 &\cong 5 \pmod 9\\
M_2 &= 9\phantom{{}\ntimes5}\ntimes4 = 36   &  B_2 &\cong 1 \pmod 5\\
M_3 &= 9\ntimes5\phantom{{}\ntimes4} = 45   &  B_3 &\cong 1 \pmod 4, 
\endxalignat
$$
onde os invérsos $B_i$'s podemos calcular usando o algoritmo estendido de
Euclides~(\refn{extended_euclidean_algorithm}) como na prova
do~\ref{find_inverse_modulo_m}), mas nesse caso, sendo os módulos tão pequenos
fez mas sentido os achar testando, com ``força bruta''.
Então, graças ao teorema chinês, as soluções são exatamente os inteiros $x$ que satisfazem
$$
\alignat2
x &\cong a_1M_1B_1 + a_2M_2B_2 + a_3M_3B_3                                      &&\pmod M\\
  &\cong 2 \ntimes 20\ntimes 5 + 1 \ntimes 36\ntimes 1 + 2 \ntimes 45\ntimes 1  &&\pmod {180}\\
  &\cong 200 + 36 + 90                                                          &&\pmod {180}\\
  &\cong 146                                                                    &&\pmod {180}.
\endalignat
$$
Para resumir, as soluções do sistema são todos os elementos do
$\set{ 180k + 146 \st k\in\ints }$.
\endexample

\example.
Ache todos os inteiros $x\in\ints$ com $\abs x < 64$ que satisfazem o sistema de congruências:
$$
\align
x  &\cong 1 \pmod 3\\
3x &\cong 1 \pmod 4\\
4x &\cong 2 \pmod 5.
\endalign
$$

\solution
Para aplicar o teorema chinês do resto precisamos os $3$, $4$, e $5$ coprimos dois a dois,
que realmente são.
Mas observe que o sistema não está na forma do teorema;
aí, não podemos o aplicar diretamente.
Nosso primeiro alvo então seria transformar a segunda e a terceira congruência para
equivalentes, na forma necessária para aplicar o teorema.
Na segunda vamos nos livrar do fator $3$, e na terceira do fator $4$.
Como $\gcd 3 4 = 1$,%
\footnote{Qual ``4'' foi esse?}
o $3$ é invertível módulo~$4$.
Como o $3\cong -1 \pmod 4$, temos diretamente que $3^{-1} \cong -1 \pmod 4$.
Similarmente achamos o inverso $4^{-1} \cong -1 \pmod 4$.
Então temos:
$$
\left.
\aligned
x  &\cong 1 \pmod 3\\
3x &\cong 1 \pmod 4\\
4x &\cong 2 \pmod 5
\endaligned
\right\}
\iff
\left\{
\aligned
x  &\cong \phantom{1^{-1}}1 \pmod 3\\
3^{-1}3x &\cong 3^{-1}1 \pmod 4\\
4^{-1}x &\cong 4^{-1}2 \pmod 5
\endaligned
\right\}
\iff
\left\{
\aligned
x &\cong \phantom{-}1 \pmod 3\\
x &\cong -1 \pmod 4\\
x &\cong -2 \pmod 5.
\endaligned
\right.
$$
Agora sim, podemos aplicar o teorema chinês.
Usando os mesmos nomes para as variáveis
como no~\ref{chinese_remainder_theorem}, calculamos:
$$
\xalignat2
M_{\phantom0}   &= 3\ntimes4\ntimes5              = 60 &     &               \\
M_1             &= \phantom{3\ntimes{}}4\ntimes5  = 20 & B_1 &\cong 2 \pmod 3\\
M_2             &= 3\phantom{{}\ntimes4}\ntimes5  = 15 & B_2 &\cong 3 \pmod 4\\
M_3             &= 3\ntimes4\phantom{{}\ntimes5}  = 12 & B_3 &\cong 3 \pmod 5, 
\endxalignat
$$
onde os invérsos $B_1$ e $B_2$ calculamos percebendo que
$20\cong-1 \pmod 3$ e $15\cong-1 \pmod 4$, e o $B_3$ com força bruta mesmo.
Pronto: as soluções do sistema são exatamente os inteiros $x$ que satisfazem:
$$
\alignat 3
x &\cong a_1M_1B_1 + a_2M_2B_2 + a_3M_3B_3                            &&\pmod M\\
  &\cong 2\ntimes20\ntimes1 + 3\ntimes15\ntimes3 + 3\ntimes12\ntimes3 &&\pmod {60}\\
  &\cong 40 + 135 + 108                                               &&\pmod {60}\\
  &\cong 40 + 15 + 108                                                &&\pmod {60}\qqby{$135\cong15\pmod{60}$}\\
  &\cong 55 + 48                                                      &&\pmod {60}\qqby{$108\cong48\pmod{60}$}\\
  &\cong -5 + 48                                                      &&\pmod {60}\qqby{$\phantom055\cong-5\pmod{60}$}\\
  &\cong 43                                                           &&\pmod {60}.
\endalignat
$$
Logo, o conjunto de todas as soluções do sistema é o $\set{ 60k + 43 \st k\in\ints }$.
Facilmente verificamos que os únicos dos seus elementos que satisfazem nossa
restrição $\abs x < 64$ são os inteiros obtenidos pelos valores de $k = 0$ e $-1$:
$x_1 = 43$, $x_2 = -17$.
\endexample

\exercise ``entre si'' vs ``dois a dois''.
\label{coprime_vs_pairwise_coprime}
Considere as frases:
\beginol
\li Os inteiros $a_1, a_2, \dotsc, a_n$ são coprimos entre si.
\li Os inteiros $a_1, a_2, \dotsc, a_n$ são coprimos dois a dois.
\endol
\noindent São equivalentes?
Se sim, prove as duas direções da equivalência; se não, ache um contraexemplo.

\hint
Não são equivalentes.

\hint
Procure um contraexemplo com três inteiros.

\solution
Os $2$, $4$, $5$ são coprimos entre si (têm m.d.c.~1) mas mesmo assim não são coprimos dois a dois:
$\gcd 2 4 = 2$.

\endexercise

\exercise.
Acha as soluções dos seguinte sistemas de congruências:
$$
\xalignat2
\text{(1)}\quad&
\left\{
\aligned
x  &\cong 3\phantom0 \pmod 4\\
5x &\cong 1\phantom0 \pmod 7\\
x  &\cong 2\phantom0 \pmod 9
\endaligned
\right.
&
\text{(2)}\quad&
\left\{
\aligned
x  &\cong 3\phantom0 \pmod 3\\
3x &\cong 3\phantom0 \pmod 4\\
4x &\cong 2\phantom0 \pmod 5\\
5x &\cong 1\phantom0 \pmod 7.
\endaligned
\right.
\endxalignat
$$

\endexercise

O exercício seguinte te convida descobrir que o teorema chinês pode ser aplicado
em casos mais gerais do que aparece inicialmente!

\exercise.
Resolva os sistemas de congruências:
$$
\xalignat2
\text{(1)}\quad&
\left\{
\aligned
5x &\cong 2\phantom0  \pmod 6\\
x  &\cong 13 \pmod {15}\\
x  &\cong 2\phantom0  \pmod 7
\endaligned
\right.
&
\text{(2)}\quad&
\left\{
\aligned
x  &\cong 2\phantom0  \pmod 6\\
x  &\cong 13 \pmod {15}\\
x  &\cong 2\phantom0  \pmod 7.
\endaligned
\right.
\endxalignat
$$

\hint Observe que não podes aplicar o teorema chinês diretamente: $\gcd 6 {15} > 1$.

\hint Tente substituir a congruência $5x \cong 2  \pmod 6$ com um sistema equivalente, de \emph{duas} congruências.

\hint Mostre que para qualquer $a\in\ints$,
$$
\left.
a \cong 2 \pmod 6
\right\}
\iff
\left\{
\aligned
a &\cong 0 \pmod 2\\
a &\cong 2 \pmod 3.
\endaligned
\right.
$$

\hint
Não todos os sistemas de congruências tem soluções.
(Acontéce quando temos restrições contraditórias.)
Nesse exercício um dos dois sistemas não tem solução.

\endexercise

\endsection
%%}}}

%%{{{ Euler's totient function 
\section A função totiente de Euler.

\definition Função totiente de Euler.
\iisee{totiente}{função totiente}
\iisee{Euler}[função]{função totiente}
\Euler[função totiente]
\tdefined{função}[totiente de Euler]
\sdefined{\totsym} {a função totiente de Euler}
\label{euler_phi_function}
Seja inteiro $n>0$.
Definimos
$$
\tot n \defeq \sizeof {\set { i \in \set{1,\dotsc,n} \st \gcd i n = 1 } }.
$$
Em palavras, $\tot n$ é o número dos inteiros entre $1$ e $n$ que são coprimos com $n$.

\exercise.
Calcule os valores da $\tot n$ para $n=1,2,3,4,8,11,12,16.$

\endexercise

\property.
\label{tot_of_prime}
$\text{$p$ primo} \implies \tot p = p-1.$
\proof.
Como $p$ é primo, ele é coprimo com todos os $1,\dotsc,p-1$.
E como $\gcd p p = p \neq 1$, pela definição da $\totsym$ temos
$\tot p = p-1$.
\qed

\exercise.
\label{number_of_multiples_of_a_until_ai}
Quantos multiplos de $a$ existem no $\set{1,2,\dotsc,a^i}$?

\endexercise

\exercise.
\label{tot_of_power_of_prime}
$
\text{$p$ primo} \implies
\tot {p^a} = p^a - p^{a-1} = p^{a-1} (p-1)
$.

\hint Use a definição de $\totsym$ e o~\ref{number_of_multiples_of_a_until_ai}.

\solution
Seguindo a definição de $\totsym$, vamos contar todos os números
no $\set{1,2,\dotsc,p^i}$ que são coprimos com $p^i$.
Quantos não são?
Observe que como $p$ é primo,
os únicos que não são coprimos com ele,
são os múltiplos de $p$.
Pelo~\ref{number_of_multiples_of_a_until_ai} temos a resposta.

\endexercise

\exercise.
\label{sum_of_tots_of_powers_of_prime}
Sejam $p$ primo e $k\in\ints$.  Calcule o valor do somatório
$\sum_{i=0}^k \tot {p^i}$.

\hint Calcule o valor de cada termo aplicando o~\ref{tot_of_power_of_prime}.

\endexercise

\exercise.
\label{tot_of_product_of_primes}
$\text{$p,q$ primos, $p\neq q$} \implies \tot {pq} = (p-1)(q-1)$.

\endexercise

\theorem.
\iisee{multiplicativa}{função multiplicativa}
\tdefined{função}[multiplicativa]
\label{tot_is_multiplicative}
A função $\totsym$ é \dterm{multiplicativa}:
$$
\gcd m n = 1 \implies \tot {mn} = \tot m \tot n.
$$

\corollary.
Se $n\geq 2$, então
$$
\tot n
= n \!\!\prod_{\Sb\text{$p$ primo}\\p \divides n\endSb}\!\!\left(1-\frac 1 p\right)
= n
\left(1-\frac 1 {p_1}\right)
\left(1-\frac 1 {p_2}\right)
\dotsb
\left(1-\frac 1 {p_k}\right),
$$
onde os $p_i$'s são todos os primos divisores de $n$.
\sketch.
Escrevemos o $n$ na sua representação canónica pelo teorema fundamental da aritmética~(\refn{fundamental_theorem_of_arithmetic}), e aplicamos repetetivamente o~\ref{tot_is_multiplicative}.
\qes
\proof.
Pelo teorema fundamental da aritmética~(\refn{fundamental_theorem_of_arithmetic}),
seja $n \eqass p_0^{a_0} p_1^{a_1} \dotsb p_k^{a_k}$ a representação canónica
\ii{representação canónica} do $n$.  Calculamos:
$$
\alignat2
\tot n
&= \tot {p_0^{a_0} p_1^{a_1} \dotsb p_k^{a_k}}              \\
&= \tot {p_0^{a_0}} \tot{p_1^{a_1}} \dotsb \tot{p_k^{a_k}}  \qqby{\ref{tot_is_multiplicative}}\\
&=
p_0^{a_0}\paren{1 - \frac 1 {p_0}}
p_1^{a_1}\paren{1 - \frac 1 {p_1}}
\dotsb
p_k^{a_k}\paren{1 - \frac 1 {p_k}}                          \qqby{\ref{tot_of_power_of_prime}}\\
&=
p_0^{a_0}p_1^{a_1}\dotsb p_k^{a_k}
\paren{1 - \frac 1 {p_0}}\paren{1 - \frac 1 {p_1}}\dotsb\paren{1 - \frac 1 {p_k}}\\
&=
n
\paren{1 - \frac 1 {p_0}}\paren{1 - \frac 1 {p_1}}\dotsb\paren{1 - \frac 1 {p_k}}.
\endalignat
$$
\moveqedup
\qed

\exercise.
$a\divides b \implies \tot a \divides \tot b$.

\endexercise

\exercise.
$
\tot {2n} =
\knuthcases{
2\tot n,& $n$ é par \cr
\tot n, & $n$ é impar.
}
$

\endexercise

\exercise.
\label{tot_is_par_for_n_greater_than_2}
$\tot n$ é par para todo $n\geq 3$.

\hint Os inverso aparecem ``em pares''.  Mas uns são emparelhados com eles
mesmo, sendo seus próprios inversos (por exemplo, o inverso de 1, é o 1, módulo
qualquer $m$).

\hint Escreva o $n$ na sua representação canónica pelo teorema fundamental da aritmética~(\refn{fundamental_theorem_of_arithmetic}).

\hint
Aplica o~\ref{tot_is_multiplicative} e o~\ref{tot_of_power_of_prime}.

\hint
Ou o $2$ aparece nos fatores primos do $n$, ou não.

\endexercise

\endsection
%%}}}

%%{{{ Theorems of Euler and Fermat 
\section Teoremas de Euler e de Fermat.

\theorem Euler.
\label{euler_congruence_theorem}%
\Euler[teorema]%
Sejam $a,m\in\ints$ com $\gcd a m = 1$.
Então
$$
a^{\tot m} \cong 1 \pmod m.
$$
\sketch.
Considere o conjunto
$$
\align
 R &=\set{r_1, r_2, \dotsc, r_{\tot m}}
\intertext{de todos os inteiros $r$ com $1 \leq r \leq m$, e $\gcd r m = 1$, e o conjunto}
aR &= \set{ar \st r \in R}\\
   &= \set{ar_1, ar_2, \dotsc, ar_{\tot m}}.
\endalign
$$
Observamos agora que (módulo~$m$) os $ar_1,ar_2,\dotsc,ar_{\tot m}$
são apenas uma permutação dos $r_1,r_2,\dotsc,r_{\tot m}$.
Logo os seus produtórios são congruentes:
$$
(ar_1)(ar_2)\dotsb (ar_{\tot m})
\cong
r_1r_2\dotsb r_{\tot m}
\pmod m.
$$
Trabalhando na última congruência chegamos na congruência desejada.
\qes

\corollary Fermat.
\label{fermat_little_theorem_1}%
\Fermat[teorema]%
\ii{teorema}[pequeno Fermat]%
Sejam $p$ primo e $a\in\ints$ com $\gcd a p = 1$.
Então
$$
a^{p-1} \cong 1 \pmod p.
$$
\sketch.
O resultado é imediato usando o teorema de Euler
(\refn{euler_congruence_theorem}) e a~\ref{tot_of_prime}.
\qes
\proof.
Como $p$ é primo, sabemos que $\tot p = p-1$, então temos:
$$
\alignedat 2
a^{p-1}
&= a^{\tot m}       \qqby{\ref{tot_of_prime}} \\
&\cong 1 \pmod m.   \qqby{\ref{euler_congruence_theorem}}
\endalignedat
$$
\qed

\corollary Fermat.
\label{fermat_little_theorem_2}%
\Fermat[teorema]%
\ii{teorema}[pequeno Fermat]%
Sejam $p$ primo e $a\in\ints$.
Então
$$
a^p \cong a \pmod p.
$$
\sketch.
Considere dois casos: $\gcd a p = 1$ ou $\gcd a p > 1$.
No primeiro usamos o~\ref{fermat_little_theorem_1}.
No segundo, necessariamente temos $0\cong a^p\cong a \pmod p$.
\qes
\proof.
Temos dois casos:
\endgraf
\case{Caso $\gcd a p$ = 1}:
Pelo~\ref{fermat_little_theorem_1} temos:
$$
\align
a^{p-1} &\cong 1 \pmod p
\intertext{e multiplicando por $a$,}
a^p     &\cong a \pmod p.
\endalign
$$
\case{Caso $\gcd a p$ > 1}:
Nesse caso, como $p$ é primo, necessariamente $p\divides a$,
ou seja, $a \cong 0 \pmod p$,
logo $a^p \cong 0 \pmod p$.
Agora pela transitividade e
simetria da $congruência$ módulo~$m$, finalmente temos:
$a^p \cong a \pmod p$
\qed

\note Resumindo os três teoremas.
Esquematicamente:
$$
\alignat 4
\text{$\gcd a m = 1$}
&\implies{}
&a^{\tot m} &&{}\cong 1 & \pmod m
&\qqqquad&\text{Euler, (\refn{euler_congruence_theorem})}
\\
\text{$p$ primo}
&\implies{}
&a^{p-1} &&{}\cong 1& \pmod p
&\qqqquad&\text{Fermat, (\refn{fermat_little_theorem_1})}
\\
\left.
\aligned
\text{$p$ primo}\\
\gcd a p = 1
\endaligned
\right\}
&\implies{}
&a^p &&{}\cong a &\pmod p
&\qqqquad&\text{Fermat, (\refn{euler_congruence_theorem})}.
\endalignat
$$

\example.
\label{last_digit_of_big_number_example}
Ache o último dígito do $2^{800}$.

\solution
Procuramos um $y$ tal que $2^{800}\cong y \pmod {10}$
(por quê?).
Usando o teorema de Fermat~(\ref{fermat_little_theorem_1}) temos:
$$
\align
2^4 &\cong 1 \pmod 5,
\intertext{logo}
2^{800} = (2^4)^{200} &\cong 1 \pmod 5.
\endalign
$$
Então módulo~$10$ temos duas possibilidades (por quê?):
$$
2^{800} \cong
\knuthcases{
1 \pmod {10}\cr
6 \pmod {10}.\cr
}
$$
Podemos já eliminar a primeira porque $2^{800}$ é par.
Finalmente, o último dígito de $2^{800}$ é o $\digit6$.
\endexample

\exercise.
Responda no primeiro ``por quê?'' do~\ref{last_digit_of_big_number_example}.

\hint Escreva o inteiro como somatório baseado na sua forma decimal.

\hint Divide ele por 10.

\solution
Para o número $n$ escrito em base decimal como $\delta_k\delta_{k-1}\dotsb \delta_1\delta_0$,
temos:
$$
\align
n
&= d_0 + 10d_1 + 100d_2 + \dotsb 10^{k-1}d_{k-1} + 10^kd_k\\
&= \underbrace{d_0}_{\text{resto}} + 10\underbrace{(d_1 + 10d_2 + \dotsb 10^{k-2}d_{k-1} + 10^{k-1}d_k)}_{\text{quociente}},
\endalign
$$
onde $d_i$ é o correspondente valor do dígito $\delta_i$.
(Evitamos aqui confundir o ``dígito'' com seu valor usando notação diferente
para cada um, para enfatisar a diferença entre os dois conceitos.)

\endexercise

\exercise.
Responda no segundo também, e ache um outro caminho para chegar no resultando, usando
o teorema chinês do resto (\ref{chinese_remainder_theorem}).

\hint Qual a solução do sistema
$$
\align
x &\cong 1 \pmod 5\\
x &\cong 0 \pmod 2?
\endalign
$$

\solution
Podemos ou aplicar o teorema chinês (\ref{chinese_remainder_theorem}) no sistema de congruências
$$
\align
x &\cong 1 \pmod 5\\
x &\cong 0 \pmod 2,
\endalign
$$
ou, como $5\divides 10$, usar diretamente o~\ref{from_mod_m_to_mod_am},
para concluir que $x = 10k + 5i + 1$, onde $i=0,1$.

\endexercise

\exercise.
Ache o resto da divisão de $41^{75}$ por $3$.

\hint Procure $y$ tal que $41^{75} \cong y \pmod 3$.

\hint $\gcd {41} 3 = 1$.

\hint $41^{75} = 41^{74}\ntimes 41$.

\hint Fermat.

\solution
Como $\gcd {41} 3 = 1$, pelo teorema de Fermat (\ref{fermat_little_theorem_1})
temos
$$
41^{\tot 3} = 41^2 \cong 1 \pmod 3,
$$
e agora dividindo o $75$ por $2$, temos $75 = 2\ntimes 37 + 1$, então:
$$
\alignat 3
41^2 \cong 1 \pmod 3 &\implies (41^2)^{37}  &&\cong \phantom01  &&\pmod 3    \\
                     &\implies 41^{74}      &&\cong \phantom01  &&\pmod 3    \\
                     &\implies 41^{74}41    &&\cong 41 &&\pmod 3    \\
                     &\implies 41^{75}      &&\cong 41 &&\pmod 3    \\
                     &\implies 41^{75}      &&\cong \phantom02  &&\pmod 3.
\endalignat
$$
Outro jeito para escrever exatamente a mesma idéia,
mas trabalhando ``de fora pra dentro'', seria o seguinte:
$$
\alignat 2
41^{75} &= 41^{2\ntimes 37 + 1}\\
        &= 41^{2 \ntimes 37} 41\\
        &= (41^2)^{37} 41\\
        &\cong  1^{37} 41       &&\pmod 3\\
        &\cong  41              &&\pmod 3\\
        &\cong  2               &&\pmod 3.
\endalignat
$$
Então $41^{75} \bmod 3 = 2$.

\endexercise

\endsection
%%}}}

%%{{{ Exponentiation 
\section Exponenciação.

\endsection
%%}}}

%%{{{ Cryptography 
\section Criptografía.

%%{{{ The idea of cryptography 
\TODO A idéia da criptografia.
%%}}}

%%{{{ Public-key cryptography 
\TODO Criptografia ``public-key''.
%%}}}

%%{{{ RSA encryption and decryption 
\TODO RSA criptografia e descriptografia.

%%{{{ thm 
\theorem.
Sejam $e, M\in\ints$ com $\gcd e {\tot M} = 1$,
e seja $d$ um inverso de $e$ módulo~$\tot M$: $ed \cong 1 \pmod {\tot M}$.
Para cada $m$ com $\gcd m M = 1$,
$$
\paren{m^e}^d \cong m \pmod M.
$$
\proof.
Observe primeiramente que:
$$
\alignat 2
ed \cong 1 \pmod {\tot M}
&\iff \tot M \divides ed - 1                    \qqby{\ref{congruence}}\\
&\iff \lexists {k\in\ints} {k\tot M = ed - 1}.  \qqby{\ref{divides}}
\endalignat
$$
Seja $k\in\ints$ então um tal $k$, e agora resolvendo por $ed$:
$$
ed = k\tot M + 1.
\eqdef{rsa_ed_equality}
$$
Calculamos:
$$
\alignat 2
\paren{m^e}^d
&= m^{ed}                   \\
&= m^{k\tot M + 1}          \qqby{por~\eqref{rsa_ed_equality}}\\
&= m^{k\tot M} m            \qqby{def.~de exponenciação}\\
&= \paren{m^k}^{\tot M} m   \\
&\cong m  \pmod M,          \qqby{por teorema de Euler~\refn{euler_congruence_theorem}}
\endalignat
$$
onde no último pásso precisamos a hipótese que $m$ e $\tot M$ são coprimos
e logo, $m^k$ e $\tot M$ também são: $\gcd m {\tot M} = \gcd {m^k} {\tot M} = 1$.
\qed
%%}}}

%%{{{ x 
\exercise.
O que acontece se $m$ e $\tot M$ não são coprimos?

\endexercise
%%}}}
%%}}}

\endsection
%%}}}

%%{{{ Digital signatures 
\section Assinaturas digitais.

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ prob 
\problem.
Prove numa linha o~\ref{odd_to_any_power_is_odd}:
{\proclaimstyle
para todo $n\in\nats$ e todo impar $k\in\ints$, $k^n$ é impar.}

\endproblem
%%}}}

%%{{{ prob 
\problem.
(Generalização do~\ref{odd_to_any_power_is_odd}.)
Sejam $a\in\ints$ e $m\in\nats$.
Prove numa linha que para todo $n\in\nats$, existe $b\in\ints$ tal que $(am + 1)^n = bm + 1$.

\endproblem
%%}}}

%%{{{ prob 
\problem.
Prove que para todo $m\in\nats$, o produto de $m$ consecutivos inteiros é divisível por $m!$.

\endproblem
%%}}}

%%{{{ prob: freshmans_dream 
\problem O sonho do calouro.
\label{freshmans_dream}%
\ii{sonho do calouro}%
Seja $p$ primo, $x,y\in\ints$.
$$
(x + y)^p \cong x^p + y^p \pmod p.
$$

\hint
Use o teorema binomial~\refn{binomial_theorem}.

\hint
Use o \ref{p_divides_comb_p_r}.

\solution
Temos
$$
\alignat 2
(x + y)^p
&= \sum_{i=0}^p \binom p i x^{p-i}y^i    \qqby {por~\ref{binomial_theorem}}\\
&= \binom p 0 x^p + \sum_{i=1}^{p-1} \binom p i x^{p-i}y^i + \binom p p y^p   \qqby{$p\geq2$}  \\
&= x^p + \sum_{i=1}^{p-1} \binom p i x^{p-i}y^i + y^p     \\
&= x^p + \sum_{i=1}^{p-1} p c_i x^{p-i}y^i + y^p, \quad\text{para algum $c_i\in\ints$}  \qqby{por~\ref{p_divides_comb_p_r}}  \\
&= x^p + p \sum_{i=1}^{p-1} c_i x^{p-i}y^i + y^p      \\
&\cong x^p + y^p \pmod p.
\endalignat
$$

\endproblem
%%}}}

%%{{{ prob: little_fermat_new_proof 
\problem.
\label{little_fermat_new_proof}%
Ache uma nova prova, \emph{por indução}, do teorema de Fermat~\refn{fermat_little_theorem_2}:
\endgraf\noindent
{\sl Para todo primo $p$ e todo $a\in\ints$},
$$
a^p \cong a \pmod p.
$$
(Note que $a\in\ints$ e não $a\in\nats$.)

\hint
Use o sonho de calouro (\ref{freshmans_dream}).

\endproblem
%%}}}

\ignore{

%%{{{ prob 
\problem.
Prove que
$$
\tot {mn}
=
{\tot m \tot n}
\frac
d
{\tot d}
,\qquad\text{onde $d={\gcd m n}$}.
$$
Note quantas e quais das propriedades que já provamos são casos especiais dessa!

\endproblem
%%}}}

%%{{{ prob 
\problem.
Sejam $p,q$ primos com $p\neq q$.  Prove que
$$
p^{q-1} + q^{p-1} \cong 1 \pmod {pq}.
$$

\hint
O que seria o $p^{q-1} + q^{p-1}$ módulo~$p$?  E módulo~$q$?

\hint
China.

\endproblem
%%}}}

%%{{{ prob 
\problem.
Ache uma generalização do problema anterior,
aplicável para inteiros $a,b$ com $\gcd a b = 1$:

\hint Nesse caso \emph{não} temos
$$
a^{b-1} + b^{a-1} \cong 1 \pmod {ab}.
$$

\hint $p-1 = \tot p$ para qualquer primo $p$.

\hint
Prove que:
$$
a^{\tot b} + b^{\tot a} \cong 1 \pmod {ab}.
$$

\endproblem
%%}}}

}% ignore

\endproblems
%%}}}

%%{{{ Further reading 
\further.

Veja o~\cite[\S1.9]{babybm}.

\cite{disquisitiones}.

\cite{nivennumbers},
\cite{hardywright}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Sets 
\chapter Conjuntos.
\label{Sets}%

%%{{{ chapintro: sets like assembly 
\chapintro
Nesse capítulo estudamos um ``tipo'' de objeto, o tipo de \emph{conjuntos}.
Como nos vamos apreciar no~\ref{Axiomatic_set_theory},
os conjuntos e sua linguagem têm um papel importante para a fundação
de matemática.
Podemos traduzir todas as definições e relações matemáticas nessa
linguagem.  Nesse sentido, parece como uma ``assembly'', uma linguagem
``low-level'' onde podemos ``compilar'' toda a matemática, em tal modo
que cada definição, cada afirmação, cada teorema que provamos,
no final das contas, todos podem ser traduzidos para definições,
afirmações, teoremas e provas, que envolvem apenas conjuntos
e a relação primitiva de \emph{pertencer}.
E \emph{nada} mais!
%%}}}

%%{{{ Concept, notation, equality 
\section Conceito, notação, igualdade.
\tdefined{conjunto}%

%%{{{ Q: What does it mean to be a set? 
\question.
O que significa ser conjunto?
%%}}}

\blah.
\Cantor{}Cantor deu a seguinte resposta:

%%{{{ pseudodf: set 
\pseudodefinition.
\label{set_pseudodefinition}%
\tdefined{conjunto}[definição intuitiva]%
Um \dterm{conjunto} $A$ é a colecção numa totalidade
de certos objetos (definidos e separados) da nossa intuição ou mente, que chamamos de \dterm{elementos} de $A$.
%%}}}

%%{{{ x: set_pseudodefined 
\exercise.
Qual é o problema principal com a definição acima?

\solution
O que é uma ``colecção (numa totalidade)''?
Cuidado: para responder nessa pergunta
tu não podes usar a palavra ``conjunto'', pois assim teria uma
definição circular.
Em outras palavras, definimos a palavra ``conjunto'' em termos da palavra
``colecção'', que no final das contas, é algo sinónimo.

\endexercise
%%}}}

%%{{{ Primitive notions 
\note Noções primitivas.
\ii{noção primitiva}%
Aceitamos apenas duas \emph{noções primitivas}\/:
$$
\gathered
\text{ser conjunto}\\
\Set(\dhole)
\endgathered
\qqqquad
\gathered
\text{pertencer}\\
\dhole\in\dhole
\endgathered
$$
%%}}}

%%{{{ Convention: family, colection, agglomerate, and fonts 
\note Convenção.
\tdefined{família}%
\tdefined{colecção}%
\tdefined{aglomerado}%
Usamos os termos \dterm{família}, \dterm{colecção}, \dterm{aglomerado}, etc.\ como
sinónimos da palavra ``conjunto''.
Mesmo assim, seguindo uma práctica comum, quando temos conjuntos de conjuntos
dizemos ``família de conjuntos'', e depois ``colecção de famílias'', etc.
Com o mesmo motivo (de facilitar nossos olhos ou ouvidos humanos), as vezes
mudamos a font que usamos para denotar esses conjuntos.
Por exemplo, usando $A,B,C$ para denotar certos conjuntos,
usamos $\scr A, \scr B, \scr C$ para denotar famílias deles,
etc.
%%}}}

%%{{{ df: set_notation 
\definition Notação de conjuntos.
\label{set_notation}%
\tdefined{conjunto}[notação]%
\tdefined{conjunto}[homogêneo]%
\tdefined{conjunto}[heterogêneo]%
\tdefined{homogeneidade}%
\tdefined{heterogeneidade}%
A notação mais simples para denotar um conjunto é usar
``chaves'' (os símbolos~`$\{$'~e~`$\}$') e listar todos os seus elementos dentro.
Por exemplo:
$$
\xalignat2
A &=\set {0,1}                          &E &=\set {2,3,\set{5,7}, \set{\set{2}}}\\
B &=\set {\nats, \ints, \rats, \reals}  &F &=\set {\mathrm{Thanos}}\\
C &=\set {2}                            &G &=\set {1,2,4,8,16,31,A,B,\nats}\\
D &=\set {2,3,5,7}                      &H &=\set {\mathrm{Thanos}, \mathrm{Natal}, \set{E,\set{F,G}}}
\endxalignat
$$
Chamamos os conjuntos cujos elementos são ``do mesmo tipo'' \dterm{homogêneos},
e os outros \dterm{heterogêneos}.
Deixamos ambíguo o que significa ``do mesmo tipo'', mas, naturalmente, consideramos
os $A, B, C, D, F$ homogêneos e os $E, G, H$ heterogêneos.
%%}}}

%%{{{ Dealing with more complicated sets 
\blah.
Todos os conjuntos que acabamos de escrever aqui são \emph{finitos},
seus elementos são conhecidos, e ainda mais são poucos e conseguimos os listar todos.
Nenhuma dessas três propriedades é garantida!
Se não temos a última fica impráctico listar todos elementos,
e quando não temos uma das duas primeiras, é plenamente impossível.
Considere por exemplo os conjuntos seguintes:
$$
\align
X &= \text{o conjunto de todos os números reais entre 0 e 1}\\
Y &= \text{o conjunto dos assassinos do Richard \Montague{}Montague}\\
Z &= \text{o conjunto de todos os números naturais menores que $2^{256!}$}.
\endalign
$$
%%}}}

%%{{{ set_builder 
\definition Set-builder.
\label{set_builder}%
\label{definite_condition}%
\tdefined{set comprehension}%
\tdefined{condição definitiva}%
\sdefined {\setst {\holed x} {\text{\thole}}} {o conjunto de todos os $\holed x$ tais que \thole}%
\iisee{set-builder}{set comprehension}%
Uma notação diferente e bem útil é chamada
\dterm{set comprehension} ou notação \dterm{set-builder},
onde escrevemos
$$
\setst x {\text{\thole$x$\thole}}
$$
para denotar <<o conjunto de todos os objetos $x$ tais que \thole$x$\thole>>.
\footnote{Na literatura aparece também o símbolo~`\,$:$\,'~em vez
do~`$\st$'~que usamos aqui.}
Entendemos que no lado direito escrevemos o \dterm{filtro},
uma \emph{condição definitiva},
e não algo ambíguo ou algo subjetivo.  Por exemplo, não podemos escrever 
algo do tipo
$$
\setst p { \text{$p$ é uma pessoa linda} }.
$$
Mas como podemos formalizar o que é uma \dterm{condição definitiva}?
Bem, concordamos escrever apenas algo que podemos (se precisarmos e se quisermos)
descrever usando uma fórmula de FOL $\phi(x)$ onde possivelmente aparece
a variável $x$ livre e todos os símbolos da FOL tem interpretações bem definidas.%
\footnote{Pouco mais sobre isso no~\ref{fol_filter_by_fraenkel_and_skolem}.}
Chegamos então na forma
$$
\setst x {\phi(x)}.
$$
A notação set-builder é bem mais poderosa do que acabamos de mostrar,
pois nos permite utilisar \emph{termos} mais complexos na sua parte esquerda,
e não apenas uma variável.
Vamos investigar isso e mais variações logo na~\ref{full_setbuilder}.
%%}}}

%%{{{ What we need to specify for each new type 
\note Tipos.
Cada vez que introduzimos um novo tipo de objetos,
devemos especificar:
\beginol
\li Quando dois objetos desse tipo são \emph{iguais}?
\li Qual é o ``interface'' desses objetos?
\endol
%%}}}

%%{{{ Black boxes 
\note Black boxes.
\label{blackbox_set}%
\tdefined{black box}%
\tdefined{white box}%
\iiseealso{white box}{black box}%
\iiseealso{black box}{white box}%
\tdefined{black box}[de conjunto]%
\iisee{conjunto!como black box}{black box}%
O conceito de \dterm{black box} é muito útil para descrever certos tipos diferentes.
A idéia é que queremos descrever o que realmente determina um objeto desse tipo,
e \emph{esconder} os detalhes ``de implementação'', apresentado apenas seu ``interface''.
Podemos então pensar que um conjunto $A$ é um black box que tem apenas uma
entrada onde podemos botar qualquer objeto $x$ desejamos, e tem como única
``saida'' uma luz que pode piscar ``sim'' ou ``não'' (correspondende nos casos
$x\in A$ e $x\notin A$ respectivamente).
$$
\tikzpicture
\tikzi blackboxset;
\endtikzpicture
$$
Usamos o termo \emph{black} box para enfatisar que não temos como ``olhar dentro''
desse aparelho, dessa caixa, e ver o que acontece assim que botar uma entrada;
nossa única informação será a luz da caixa que vai piscar ``sim'', ou ``não''.
Quando temos acesso nos ``internals'' da caixa a gente chama de \dterm{white box}
ou \dterm{transparent box}; mas não vamos precisar o uso desse conceito nesse texto.
\endgraf
A única \emph{estrutura interna} de um conjunto é a capabilidade de
\emph{decidir se dois elementos $x,y$ do conjunto são iguais ou não}.
%%}}}

\question.
Quando dois conjuntos são iguais?
\spoiler.

%%{{{ pseudodf: set_eq_pseudodefinition 
\pseudodefinition.
\label{set_eq_pseudodefinition}%
Consideramos dois conjuntos $A,B$ \dterm{iguais} sse não tem como diferenciar
eles como black boxes.  Em outras palavras, para cada objeto $x$
que vamos dar como entrada para cada um deles, eles vão concordar:
ou os dois vão piscar ``sim'', ou os dois vão piscar ``não''.
O ``slogan'' aqui é:
$$
\text{\emph{um conjunto é determinado por seus membros}}.
$$
%%}}}

%%{{{ defining_sets 
\note Definindo conjuntos.
Para determinar então um conjunto $A$, precisamos dizer exatamente
quando um objeto arbitrário $x$ pertence nele.
As notações que viermos até agora realmente deixam isso claro;
mas um outro jeito muito útil para \emph{definir} um certo conjunto $A$,
seria apenas preencher o
$$
x \in A  \defiff  \text{\xlthole}
$$
com alguma \ii{condição definitiva}condição definitiva
(veja~\ref{definite_condition}).
\endgraf
Concluimos que as duas formas seguintes de definir um conjunto $A$,
são completamente equivalentes:
$$
\xalignat2
x &\in A \defiff \text{\lthole}
&
A &\defeq \setst x {\text{\lthole}}.
\endxalignat
$$
As duas afirmações tem exatamente o mesmo efeito:
definir o mesmo conjunto $A$.
Qual das duas usamos, será mais questão de gosto ou de contexto.
%%}}}

%%{{{ note: order_and_multiplicity 
\note Ordem e multiplicidade.
\label{order_and_multiplicity}%
\ii{conjunto}[ordem de membros]%
\ii{conjunto}[multiplicidade]%
Considere os conjuntos seguintes:
$$
\xalignat3
A&=\set{2,3},&
B&=\set{3,2},&
C&=\set{3,2,2,2,3}
\endxalignat
$$
Observe que $A = B = C$.
Ou seja, esses não são três conjuntos, mas apenas \emph{um} conjunto
denotado em três jeitos diferentes.
O ``dispositivo'' conjunto não sabe nem de \dterm{ordem}
nem de \dterm{multiplicidade} dos seus membros.
Não podemos perguntar a um conjunto
<<qual é teu \emph{primeiro} elemento?>>, nem 
<<quantas vezes o tal elemento pertence em ti?>>.
Lembre o conjunto como black box!
Seu único interface aceita qualquer objeto,
e responda apenas com um pleno ``sim'' ou ``não''.
Logo encontramos outros tipos de ``recipientes'',
onde as informações de ordem e de multiplicidade são preservadas:
multisets~(\refn{Multisets}), tuplas~(\refn{Tuples}), e seqüências~(\refn{Sequences}).
Bem depois vamos estudar \emph{conjuntos ordenados} (\ref{Posets}).
%%}}}

\blah.
Logo vamos formalizar a~\ref{set_eq_pseudodefinition}.
Mas antes disso, vamos discutir sobre dois conceitos de igualdade diferentes.

\endsection
%%}}}

%%{{{ Intension vs. Extension 
\section Intensão vs{.}~extensão.
\label{Intension_vs_extension_in_sets}%

%%{{{ Consider four extensionally equal sets 
\blah.
Condidere os conjuntos
$$
\align
P &= \setst d {\text{$d$ é um divisor primo de $2^{256!}$}}\\
Q &= \setst p {\text{$p$ é primo e par}}\\
R &= \setst x {\text{$x$ é raiz real do polinómio $x^3 - 8$}}\\
S &= \set {2}.
\endalign
$$
%%}}}

%%{{{ Q: what_are_the_extensions_of_these_four_sets} 
\question.
\label{what_are_the_extensions_of_these_four_sets}%
Quais são os membros de cada um dos conjuntos acima?
%%}}}

%%{{{ A: thinking a bit, they're all the same set 
\blah Resposta.
\emph{Pensando um pouco} percebemos que esses quatro conjuntos
consistem em exatamente os mesmos membros, viz.~o número $2$ e nada mais.
Lembrando na idéia de black box, realmente não temos como diferenciar
entre esses black boxes.
Começando com o $S$, é direto que ele responda ``sim'' apenas no número $2$
e ``não'' em todos os outros objetos.
Continuando com os $P,Q,R$, realmente temos que o único objeto que satisfaz
seus fíltro é o número $2$.
%%}}}

%%{{{ Intension description 
\note.
\label{intension_description}%
\tdefined{extensão}%
\tdefined{intensão}%
\tdefined{igualdade}[extensional]%
\tdefined{igualdade}[intensional]%
Como comporta o $S$?
Recebendo sua entrada $a$, ele a compara com o $2$ para ver se $a=2$ ou não,
e responde ``sim'' ou ``não'' (respectivamente) imediatamente.
E o $R$?
Recebendo sua entrada $a$, ele verifica se $a$ é uma raiz do $x^3 - 8$.
Substituindo então o $x$ por $a$, elevando o $a$ ao $3$ e subtraindo $8$,
se o resultado for $0$ responda ``sim''; caso contrario, ``não''.
E o $Q$?
Recebendo sua entrada $a$, ele verifica se $a$ é primo, e se $a$ e par.
Se as duas coisa acontecem, ele responda ``sim''; caso contrario, ``não''.
E o $P$?
Recebendo sua entrada $a$, ele verifica se $a\divides 2^{256!}$ e se $a$ é
um número primo.
Se as duas coisa acontecem, ele responda ``sim''; caso contrario, ``não''.
\endgraf
Acabamos de descrever a \dterm{intensão} de cada conjunto, tanto aqui
quanto na~\ref{what_are_the_extensions_of_these_four_sets}.
Mas, sendo black boxes, dados esses conjuntos $P,Q,R,S$,
não conseguimos os diferenciar, pois a única interação que sua interface
permite é botar objetos $a$ como entradas, e ver se pertencem ou não.
Falamos então que \dterm{extensionalmente} os quatro conjuntos
são iguais, mas \dterm{intensionalmente}, não.
Usamos os termos \dterm{igualdade extensional} e \dterm{igualdade intensional}.
E para abusar a idéia de black box:
provavelmente o black box $Q$ demora mais para responder, ou fica mais quente,
ou faz mais barulho, etc., do que o $S$.
\endgraf
Quando definimos um conjunto simplesmente listando todos os seus membros,
estamos escrevendo sua \dterm{extensão}.  E nesse caso, a intensão é a mesma.
Quando usamos a notação builder com um fílter, estamos mostrando a \dterm{intensão}
do conjunto.  Nesse caso as duas noções podem ser tão diferentes, que nem
sabemos como achar sua extensão!
%%}}}

%%{{{ eg: number_theory_conjectures_set_intension 
\example.
\label{number_theory_conjectures_set_intension}%
Revise a~\ref{Open_problems_in_number_theory} e considere os conjuntos
$$
\align
T &\defeq
\setstt p {$p$ e $p+2$ são prímos}\\
L &\defeq
\setstt n {$n \in \nats_{>0}$ e não existe primo entre $n^2$ e $(n+1)^2$}\\
G &\defeq
\setstt n {$n \in \nats_{>1}$ e $2n=p+q$ para alguns primos $p,q$}\\
C &\defeq
\setstt n {$n \in \nats_{>0}$ e a seqüência Collatz começando com $n$ nunca pega o valor $1$}.
\endalign
$$
Sobre o $T$ não sabemos se são finitos ou não!
Sobre o $G$, não sabemos se $G = \nats_{>1}$ ou não!
E, sobre os $L$ e $C$ nem sabemos se eles têm elementos ou não,
ou seja não sabemos nem se $L=\emptyset$ nem se $C=\emptyset$!
\endexample
%%}}}

\blah.
Fechando essa secção lembramos que em conjuntos (e em matemática em geral)
usamos igualdade `$=$' como igualdade extensional.

\endsection
%%}}}

%%{{{ Relations between sets and how to define them 
\section Relações entre conjuntos e como as definir.

%%{{{ df: set_eq 
\definition Igualdade de conjuntos.
\label{set_eq}%
Definimos
$$
A = B \defiff \forall x \paren{ x\in A \liff x\in B }.
$$
%%}}}

%%{{{ df: subconjunto 
\definition.
\label{subconjunto}%
\tdefined{subconjunto}%
\tdefined{subconjunto}[próprio]%
\sdefined{\holed A \subseteq \holed B} {$\holed A$ é um subconjunto de $\holed B$}%
O conjunto $A$ é um \dterm{subconjunto} de $B$ sse todos os membros de
$A$ pertencem em $B$.
Em símbolos:
$$
\align
A \subseteq B
&\defiff
\lforall {x\in A} {x\in B}\\
&\abbriff
\forall x \paren{ x \in A \limplies x \in B }
\endalign
$$
Se $B$ tem elementos que não pertencem no $A$, chamamos o $A$
\dterm{subconjunto próprio} de $B$, e escrevemos $A \subsetneq B$.
%%}}}

%%{{{ x: eq_implies_subseteq 
\exercise.
\label{eq_implies_subseteq}%
$A = B \implies A \subseteq B$.

\endexercise
%%}}}

%%{{{ x: eq_using_subsets 
\exercise.
\label{eq_using_subsets}%
$A = B \iff A \subseteq B \mland B \subseteq A$

\endexercise
%%}}}

%%{{{ x: define_subsetneq 
\exercise.
\label{define_subsetneq}%
Defina com uma fórmula o $A\subsetneq B$.

\hint
Já definimos o $\subseteq$, então podemos o usar!

\solution
$
A \subsetneq B
\defiff
A \subseteq B \land A \neq B.
$
\quad
(Lembre-se que $A \neq B \abbreq \lnot(A = B)$.)

\endexercise
%%}}}

%%{{{ notation of subsets 
\beware.
O uso dos símbolos $\subseteq$, $\subset$, e $\subsetneq$ não é muito padronizado:
encontramos textos onde usam $\subseteq$ e $\subset$ para ``subconjunto''
e ``subconjunto próprio'' respectivamente; outros usam $\subset$ e $\subsetneq$.
Assim o símbolo $\subset$ é usado com dois significados diferentes.
Por isso usamos $\subseteq$ e $\subsetneq$ aqui, evitando completamente
o uso do ambíguo $\subset$.
%%}}}

%%{{{ notation: supset_sugar 
\note Notação.
\label{supset_sugar}%
Seguindo uma práctica comum que involve símbolos ``direcionais'' de relações
binárias como os $\rightarrow$, $\leq$, $\subseteq$, etc., introduzimos os:
$$
\xalignat2
A \supseteq B  & \defiff B \subseteq A &
A \supsetneq B & \defiff B \subsetneq A
\endxalignat
$$
%%}}}

\endsection
%%}}}

%%{{{ Empty, universal, singletons 
\section Vazio, universal, singletons.

%%{{{ df: empty 
\definition Vazio.
\label{empty}%
\tdefined{vazio}%
Um conjunto é \dterm{vazio} sse ele não contem nenhum elemento.
Formalmente, definimos o predicado unário
$$
\Empty(A) \defiff \forall x (x \notin A).
$$
%%}}}

%%{{{ df: singleton 
\definition Singleton.
\label{singleton}%
Um conjunto é \dterm{singleton} (ou \dterm{unitário}) sse ele contem
exatamente um elemento.
Formulamente,
$$
\Singleton(A)
\defiff
\exists x
\paren{x \in A}
\mland
\lforall {u,v \in A} { u = v }.
$$
%%}}}

%%{{{ x: compare_altdef_of_singleton 
\exercise.
\label{compare_altdef_of_singleton}%
Decida se a afirmação seguinte pode servir como definição de singleton:
$$
\Singleton(A)
\askiff
\exists a
\paren{ a \in A \land \forall x \paren{ x \in A \limplies x = a } }.
$$

\hint
Substitua a fórmula longa com uma equivalente aproveitando
uns açúcares sintácticos dos quantificadores $\forall, \exists$.

\hint
Escrevemos a fórmula
$$
\exists a
\paren{ a \in A \land \forall x \paren{ x \in A \limplies x = a } }.
$$
como
$$
\pexists {a \in A}
\lforall {x \in A} { x = a }.
$$

\endexercise
%%}}}

%%{{{ df: emptyset 
\definition.
\sdefined {\emptyset} {o conjunto vazio}%
\label{emptyset_symbol}%
Denotamos o conjunto vazio por $\emptyset$.
\mistake
%%}}}

%%{{{ x: what_is_wrong_with_the_emptyset_definition 
\exercise.
\label{what_is_wrong_with_the_emptyset_definition}%
Na~\ref{emptyset_symbol} roubamos!
Resolva o crime.

\hint
``o''

\solution
Como não provamos a unicidade do vazio não podemos usar o artigo
definido ``o'', e conseqüentemente, não podemos usar um símbolo
para \emph{o} denotar.  Seria mal-definido.

\endexercise
%%}}}

%%{{{ Parallelism with Singleton(-) to emphasize error 
\note.
Para apreciar ainda mais a gravidade do erro:
se apenas a definição de $\Empty(\dhole)$ fosse suficiente
para introduzir a notação $\emptyset$ para denotar ``o conjunto vazio'',
poderiamos também escolher um símbolo para denotar ``o conjunto unitário'':
$$
\align
\text{$\Empty(\dhole)$ definido}
&\quad\leadsto\quad \text{<<Denotamos o conjunto vazio por $\emptyset$.>>}\\
\text{$\Singleton(\dhole)$ definido}
&\quad\leadsto\quad \text{<<Denotamos o conjunto unitário por $\cancel{1}$.>>}
\endalign
$$
Qual de todos---quantos são?---os conjuntos unitários seria o $\cancel{1}$?
Essa ambiguidade não é permitida em matemática.
%%}}}

%%{{{ x: how_many_singletons 
\exercise.
\label{how_many_singletons}%
Quantos são mesmo?

\solution
Infinitos!  Pois, para cada objeto $x$ já temos um singleton $\set{x}$.
E agora o singleton dele $\set{\set{x}}$, e dele, e dele, \dots

\endexercise
%%}}}

%%{{{ x: naive_uniqueness_of_emptyset 
\exercise Unicidade do vazio.
\label{naive_uniqueness_of_emptyset}%
Supondo que existe pelo menos um conjunto vazio, mostre sua unicidade.
Em outras palavras, prove que:
$$
\text{\emph{se $A,B$ são vazios, então $A = B$.}}
$$
Não use reductio ad absurdum.

\hint
Suponha que $A,B$ são vazios.
Qual é teu alvo agora?

\hint
Teu alvo é mostrar que $A = B$.
Para fazer isso é necessário lembrar a definição de $=$ nos conjuntos (\refn{set_eq}).

\solution
Suponha que $A,B$ são vazios.
Preciso mostrar $A=B$, ou seja, que $\forall x( x\in A \liff x \in B )$.
Seja $x$ um objeto arbitrário.
Pela definição de vazio, as duas afirmações $x \in A$ e $x \in B$ são
falsas, e logo a equivalência $(x\in A \liff x\in B)$ verdadeira,
que foi o que queremos provar.

\endexercise
%%}}}

%%{{{ x: naive_uniqueness_of_emptyset_absurdum 
\exercise.
\label{naive_uniqueness_of_emptyset_absurdum}%
Ache uma prova diferente, essa vez usando reductio ad absurdum.

\hint
Suponha que $A,B$ são vazios.
Queremos mostrar que $A = B$.
Então suponha o contrario ($A \neq B$) pera chegar num absurdo.

\hint
Qual é teu alvo agora?
Achar um absurdo qualquer!
Como podemos usar o fato de $A \neq B$?
Lembre-se que $A \neq B$ é apenas uma abreviação para $\lnot(A = B)$.

\solution
Suponha que $A,B$ são vazios.
Queremos provar que $A = B$.
Para chegar num absurdo, suponha que $A \neq B$.
Logo, pela definição de igualdade, temos
que existe $x$ tal que:
$x \in A$ mas $x \notin B$; ou $x \in B$ mas $x \notin A$.
As duas alternativas chegam num absurdo:
a primeira pois $A$ é vazio e logo $x \notin A$, e similarmente
a segunda pois $B$ é vazio e logo $x \notin B$.

\endexercise
%%}}}

%%{{{ df: universal 
\definition Universal.
\tdefined{universal}[conjunto]%
\iiseealso{universo}{universal}%
\label{universal}%
Um conjunto é \dterm{universal} sse todos os objetos pertencem nele.
Formalmente,
$$
\Universal(A) \defiff \forall x(x \in A).
$$
%%}}}

%%{{{ x: naive_uniqueness_of_universet 
\exercise.
\label{naive_uniqueness_of_universet}
Supondo que existe um conjunto universal, mostre sua unicidade.

\endexercise
%%}}}

%%{{{ df: universet 
\definition.
\label{universet_symbol}%
\sdefined {\universet} {o conjunto universal}%
Denotamos o conjunto universal por $\universet$.
%%}}}

%%{{{ Q: How do we use a fact that a set is nonempty? 
\question.
Como podemos usar um fato do tipo $D\neq \emptyset$ em nossas provas?
O que ganhamos realmente?
%%}}}
\spoiler.

%%{{{ A: We can pick an element from it! 
\blah Resposta.
Ganhamos o direito de escrever ``Seja $d\in D$.''
Em outras palavras: de tomar um elemento de $D$;
de declarar uma variável (não usada) para denotar um elemento de $D$.
%%}}}

%%{{{ warning: letting_in_empty_like_division_by_0 
\warning.
\label{letting_in_empty_like_division_by_0}%
Quando temos um conjunto $A$, escrever ``seja $x \in A$''
seria errado se não sabemos que $A \neq \emptyset$.
É um erro parecido quando dividimos uma expressão de aritmética
por $x$, ou apenas escrever uma expressão como a $a/x$,
sem saber que $x\neq 0$.
Como em aritmética precisamos separar em casos
(caso $x = 0$ e caso $x\neq 0$) e os tratar em formas diferentes,
precisamos fazer a mesma coisa trabalhando com conjuntos:
caso $A \neq \emptyset$, achamos uma prova onde podemos
realmente declarar uma variável não-usada para declarar
um elemento de $A$;
caso $A = \emptyset$, achamos uma prova
diferente---e na maioria das vezes essa caso vai ser trivial
para provar.
%%}}}

\endsection
%%}}}

%%{{{ Some simple proofs 
\section Umas provas simples.

%%{{{ x: yes_no_depends_emptyset_arbitraryset 
\exercise.
\label{yes_no_depends_emptyset_arbitraryset}
Seja $A$ um conjunto.
Responda para cada uma das afirmações em baixo com
{``sim''},
{``não''}, ou
{``depende''}:
$$
\xalignat8
\emptyset &\in       \emptyset;&
\emptyset &\in       A        ;&
\emptyset &\subseteq \emptyset;&
\emptyset &\subseteq A        ;&
A         &\in       \emptyset;&
A         &\in       A        ;&
A         &\subseteq \emptyset;&
A         &\subseteq A        . 
\endxalignat
$$

\endexercise
%%}}}

%%{{{ beware: claiming yes/no/depends without proof isn't much 
\beware.
Nossa intuição muitas vezes nos engana, e por isso apenas responder no jeito
que o~\ref{yes_no_depends_emptyset_arbitraryset} pediu não vale muita coisa.
Precisamos provar todas essas respostas.  Para cada uma das oito afirmações
então, precisamos dizer:
\beginul
\li {``sim''} e \emph{provar} a afirmação;
\li {``não''} e \emph{refutar} a afirmação;
\li {``depende''} e \emph{mostrar} pelo menos dois casos:
um onde a afirmação é verdadeira, e outro onde ela é falsa.
Idealmente nesse último caso queremos determinar quando a afirmação é verdadeira,
achando condições \emph{suficientes} e/ou \emph{necessárias}.
\endul
\noindent
Vamos fazer tudo isso agora.
%%}}}

%%{{{ x: attack_order 
\exercise.
\label{attack_order}%
Em qual ordem tu escolharia ``atacar'' essas afirmações?

\endexercise
%%}}}

%%{{{ prop: A_notin_emptyset 
\proposition.
\label{A_notin_emptyset}
Para todo conjunto $A$, $A \notin \emptyset$.
\proof.
Seja $A$ conjunto.  Agora diretamente pala definição de vazio
tomando $x\asseq A$, temos $A \notin \emptyset$.
\qed
%%}}}

%%{{{ cor: emptyset_notin_emptyset 
\corollary.
\label{emptyset_notin_emptyset}%
$\emptyset \notin \emptyset$.
\proof.
Essa afirmação é apenas um \emph{caso especial} de~\ref{A_notin_emptyset}:
tome $A \asseq \emptyset$.
\qed
%%}}}

%%{{{ x: emptyset_notin_emptyset_direct_proof 
\exercise.
\label{emptyset_notin_emptyset_direct_proof}%
Prove o~\ref{emptyset_notin_emptyset} diretamente, sem usar a~\ref{A_notin_emptyset}.

\hint
Quais noções são involvidas nessa afirmação?
Quais são as definições delas?

\endexercise
%%}}}

%%{{{ prop: A_subseteq_A 
\proposition.
\label{A_subseteq_A}%
Para todo conjunto $A$, temos $A \subseteq A$.
\proof.
Seja $A$ conjunto.  Suponha que $a \in A$.
Agora precisamos mostrar $a\in A$, algo que já temos.
\qed
%%}}}

%%{{{ x: A_subseteq_A_quickest_proof 
\exercise.
Pode achar uma prova com menos passos?

\solution
A fórmula que queremos provar é uma tautologia lógica!

\endexercise
%%}}}

%%{{{ cor: emptyset_subseteq_emptyset 
\corollary.
\label{emptyset_subseteq_emptyset}%
$\emptyset\subseteq\emptyset$.
\proof.
Caso especial da~\ref{A_subseteq_A} tomando $A\asseq \emptyset$,
pois $\emptyset$ é um conjunto.
\qed
%%}}}

%%{{{ prop: emptyset_subseteq_A 
\proposition.
\label{emptyset_subseteq_A}%
Para todo conjunto $A$, temos $\emptyset \subseteq A$.
\sketch.
Para chegar num absurdo suponha que tem um contraexemplo: um conjunto $A$ tal que $\emptyset\nsubseteq A$.
Daí achamos rapidamente o absurdo desejado lembrando a definição de $\nsubseteq$.
Sem usar reductio ad absurdum, vamos acabar querendo provar que uma implicação é verdadeira.
Mas cuja premissa é falsa, algo que garanta a vericidade da implicação!
\qes
%%}}}

%%{{{ x: emptyset_subseteq_A_does_not_imply_A_subseteq_A_and_vv 
\exercise.
\label{emptyset_subseteq_A_does_not_imply_A_subseteq_A_and_vv}%
Podemos ganhar a~\ref{A_subseteq_A} como corolário da~\refn{emptyset_subseteq_A}
ou vice-versa?  Explique.

\solution
Não; nenhuma das duas proposições implica a outra.
Da $A\subseteq A$ não podemos substituir o $A$ com nenhum conjunto para chegar na $\emptyset\subseteq A$.
Nem como o $\emptyset$, pois ele teria sido substituito selectivamente em apenas na sua primeira instância, algo que obviamente não podemos fazer.
(Similarmente $x = x$ para todos os números $x$ mas não podemos concluir disso que $0 = x$ para todos os $x$.)
Da $\emptyset\subseteq A$ não podemos chegar na $A \subseteq A$, pois precisamos substituir a constante $\emptyset$ por a variável $A$.
(Similarmente $0 + x = x$ para todos os números $x$, mas não podemos concluir que $x + x = x$.)

\endexercise
%%}}}

%%{{{ prop: emptyset_in_A_sometimes 
\proposition.
\label{emptyset_in_A_sometimes}%
Existe uma infinidade de conjuntos $A$ que satisfazem a $\emptyset \in A$
e uma infinidade de conjuntos $A$ que nco a satisfazem.
%%}}}

%%{{{ prop: A_subseteq_emptyset_iff_A_eq_emptyset 
\proposition.
\label{A_subseteq_emptyset_iff_A_eq_emptyset}%
O único subconjunto do $\emptyset$ é ele mesmo.
Em outras palavras:
$$
A \subseteq \emptyset
\iff
A = \emptyset.
$$
%%}}}

\blah.
Agora falta apenas uma afirmação para examinar: $A \in A$?

%%{{{ x: can_you_find_an_irregular_set 
\exercise.
\label{can_you_find_an_irregular_set}%
Consegues mostrar algum conjunto com a propriedade que ele pertence nele mesmo?
Ou seja, podes achar um conjunto $A$ tal que $A\in A$?

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ More set-builder 
\section Mais set-builder.
\label{full_setbuilder}%

%%{{{ blah section intro 
\blah.
Já encontramos a versão mais simples de set comprehension
(ou notação set-builder) que nos permite escrever
$$
\setstt { x } {\thole$x$\thole}
$$
onde $x$ é uma variável, e $\text{\thole$x$\thole}$
uma afirmação onde pode aparecer essa variável $x$.
Essa notação é bem mais flexível que isso.
Por exemplo
$$
\setst {p^n + x} {\text{$p$ é primo, $n$ é ímpar, e $x\in[0,1)$}}
$$
seria o conjunto de todos os números reais que podem ser escritos na forma
$p^n + x$ para algum primo $p$, algum ímpar $n$, e algum real $x$ com $0 \leq x < 1$.
\endgraf
Finalmente, mais uma extensão dessa notação é que usamos
$$
\setstt {x \in A} {\thole$x$\thole}
\defeq
\setst {x} {x \in A \mland \text{\thole$x$\thole}}.
$$
%%}}}

%%{{{ x: why_treat_x_in_A_sugar_separately 
\exercise.
\label{why_treat_x_in_A_sugar_separately}%
Por quê a notação
$$
\setst {x \in A} {\text{\thole$x$\thole}}
$$
não é apenas um caso especial da notação que nos permite escrever
termos na parte esquerda de set-builder?

\hint
O ``$x \in A$'' é um termo?

\solution
Pois o ``$x \in A$'' não é um termo, mas uma proposição (afirmação).

\endexercise
%%}}}

%%{{{ x: div_mul_pow_of_12_and_m_setbuilder_practice 
\exercise.
\label{div_mul_pow_of_12_and_m_setbuilder_practice}%
Usando a notação set-builder defina os conjuntos
$D_{12}$, $M_{12}$, e $P_{12}$
de todos os divisores, todos os múltiplos, e todas as potências de $12$.
Generalize para um inteiro $m$.
Identifique quais variáveis que aparecem na tua resposta são livres e quais são ligadas.

\solution
$$
\xalignat2
D_{12} &\defeq \setst {n \in \ints} {n \divides 12}  &
D_m    &\defeq \setst {n \in \ints} {n \divides m}   \\
M_{12} &\defeq \setst {12n}  {n \in \ints}           &
M_m    &\defeq \setst {mn}   {n \in \ints}           \\
P_{12} &\defeq \setst {12^n} {n \in \nats}           &
P_m    &\defeq \setst {m^n}  {n \in \nats}
\endxalignat
$$
Onde aparece a variável `$m$', ela está livre, e
onde aparece a variável `$n$', ela está ligada.

\endexercise
%%}}}

%%{{{ x: set_builder_map_size_limit 
\exercise.
\label{set_builder_map_size_limit}%
Seja $T = \set{u,v}$ um conjunto com dois elementos $u,v$.
Definimos um conjunto $A$ pela
$$
A \defeq \setst {f(n,m)} {n,m \in T}
$$
Quantos elementos tem o $A$?

\hint
Primeiramente calcule a extensão do $A$:
$$
A = \set{ \dots?\dots }.
$$

\solution
Calculando a extensão de $A$ achamos:
$$
A = \set{ f(u,u), f(u,v), f(v,u), f(v,v) }.
$$
Então o $A$ tem \emph{no máximo} $4$ elementos---mas pode acontecer que tem menos (veja~\ref{set_builder_map_exercise}).

\endexercise
%%}}}

%%{{{ x: set_builder_map_exercise 
\exercise.
\label{set_builder_map_exercise}%
Escreve a extensão do conjunto
$$
B \defeq \setst {n^2 + m^2} {n,m \in \set{1,3}}.
$$

\solution
Calculamos:
$$
\align
B
&= \setst {n^2 + m^2} {n,m \in \set{1,3}}\\
&= \set{ 1^2 + 1^2, 1^2 + 3^2, 3^2 + 1^2, 3^2 + 3^2 }\\
&= \set{ 2, 10, 10, 18 }\\
&= \set{ 2, 10, 18 }.
\endalign
$$

\endexercise
%%}}}

%%{{{ x: rich_set_builder_sugar 
\exercise.
Mostre como a notação ``mais rica'' de
$$
\setst {t(x_1, \dotsc, x_n)} {\phi(x_1,\dotsc,x_n)}
$$
pode ser definida como açúcar sintáctico se temos já a notação de
comprehensão que permite apénas uma variável no lado esquerdo.
Aqui considere que o $t(x_1,\dotsc, x_n)$ é um termo que pode ser
bem complexo, formado por outros termos complexos, etc., e onde
possivelmente aparecem as variáveis $x_1,\dotsc,x_n$.

\hint
Precisa descrever (definir) o conjunto
$$
\align
\setst {t(x_1, \dotsc, x_n)} {\phi(x_1,\dotsc,x_n)} &\\
\intertext{com uma notação que já temos:}
\setst {t(x_1, \dotsc, x_n)} {\phi(x_1,\dotsc,x_n)}
&\defeq
\dots?
\endalign
$$

\hint
$$
\setst {t(x_1, \dotsc, x_n)} {\phi(x_1,\dotsc,x_n)}
\defeq
\setst x {\text{\thole?\thole}}
$$

\solution
$
\setst {t(x_1, \dotsc, x_n)} {\phi(x_1,\dotsc,x_n)}
\defeq
\setst x { \exists x_1\dotsb\exists x_n \paren{ x = t(x_1,\dotsc,x_n) \land \phi(x_1,\dotsc,x_n)}}.
$

\endexercise
%%}}}

%%{{{ beware: variable-binding in set-builder 
\beware.
As variáveis que aparecem na parte esquerda de set-builder,
são \emph{ligadores}\ii{ligador}~que ligam com as correspondentes variáveis livres
que aparecem na afirmação na parte direita (filtro).
Então cuidado com o uso dessas variáveis pois é fácil escrever
algo que mesmo que realmente determina um conjunto,
não é o conjunto desejado!
%%}}}

%%{{{ x: variable_binding_in_setbuilder_exercise 
\exercise.
\label{variable_binding_in_setbuilder_exercise}%
Para cada um dos conjuntos em baixo,
decida se sua definição realmente é correta.
Caso que sim, determina a extensão do conjunto definido.
Caso que não, explique qual é o problema com a definição.
Em todas elas, considere que nosso universo é o $\reals$.
$$
\align
A &= \setstt x {$\sqrt{x^2 + 2} \mland x \in \reals$}\\
B &= \setstt x {$\sqrt{x^2 + 2}$ para algum $x\in \reals$}\\
C &= \setstt t {$\sqrt{x^2 + 2} = t$ para algum $x\in \reals$}\\
D &= \setstt x {$\sqrt{x^2 + 2} = x$ para algum $x\in \reals$}\\
E &= \setstt x {$\sqrt{x^2 + 2} = x$ para todo $x\in \reals$}\\
F &= \setstt x {$\sqrt{t^2 + 2} = x$ para todo $t\in \reals$}\\
G &= \setstt x {$\sqrt{t^2 + 2} = x$ para algum $t\in \reals$}.
\endalign
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Operations on sets and how to define them 
\section Operações entre conjuntos e como as definir.

%%{{{ Operações 
\note Operações.
Lembramos que uma operação num tipo de objetos
mapeia certos objetos desse tipo (suas entradas)
para \emph{exatamente um} objeto desse tipo (sua saida).
%%}}}

%%{{{ Definindo operações 
\note Definindo operações.
Então como podemos \emph{definir uma operação} nos conjuntos?
O que precisamos deixar claro?
Como a saida (ou o ``resultado'') duma operação, no final das contas,
é um conjunto, basta determinar esse conjunto para quaisquer entradas aceitáveis pela operação.
E como determinamos um conjunto?
Para começar, podemos usar um dos jeitos que já encontramos para definir um conjunto $A$:
$$
\xalignat2
A       &\defeq \setst x {\text{\thole$x$\thole}} &
x \in A &\defiff \text{\thole$x$\thole}.
\endxalignat
$$
Bora definir umas operações conhecidas para aquecer.
%%}}}

%%{{{ df: union_def 
\definition.
\label{union_def}%
\tdefined{união}%
\sdefined {\holed A \union \holed B} {a união dos $A$ e $B$}%
Sejam $A,B$ conjuntos.  Definimos
$$
A \union B \defeq \setst x {\text{$x \in A$ ou $x\in B$}}
$$
Alternativamente, podemos definir a mesma operação na seguinte forma equivalente:
$$
x \in A \union B \defiff \text{$x \in A$ ou $x\in B $}.
$$
Chamamos o $A \union B$ a \dterm{união} dos $A$ e $B$.
%%}}}

%%{{{ df: inter_def 
\definition.
\label{inter_def}%
\tdefined{intersecção}%
\sdefined {\holed A \inter \holed B} {a intersecção dos $A$ e $B$}%
Sejam $A,B$ conjuntos.  Definimos
$$
x \in A \inter B \defiff x \in A \mland x\in B.
$$
Chamamos o $A\inter B$ a \dterm{intersecção} dos $A$ e $B$.
%%}}}

%%{{{ x: inter_altdef
\exercise.
\label{inter_altdef}%
Defina a operação $\inter$ usando a notação set-builder.

\solution
Qualquer uma das definições seguintes serve:
$$
\align
A \inter B &\defeq \setst {x} {x \in A \mland x\in B}\\
A \inter B &\defeq \setst {x\in A} {x\in B}\\
A \inter B &\defeq \setst {x\in B} {x\in A}
\endalign
$$

\endexercise
%%}}}

%%{{{ df: disjoint_sets 
\definition.
\label{disjoint_sets}%
\tdefined{disjuntos}%
Sejam $A,B$ conjuntos.
Chamamos os $A$ e $B$ \dterm{disjuntos}
sse não tem nenhum elemento em comum.
Em símbolos,
$$
\text{$A,B$ disjuntos} \defiff A \inter B = \emptyset.
$$
%%}}}

%%{{{ beware: type_errors 
\beware Type errors.
\label{type_errors}%
Não confunda o uso dos $\defeq$ e $\defiff$ (nem dos $=$ e $\iff$).
Usamos $=$ para denotar \emph{igualdade} entre dois \emph{objetos},
e usamos $\iff$ para denotar que as \emph{afirmações} que
aparecem nos dois lados são \emph{equivalentes}.
No mesmo jeito que não podemos escrever
$$
\xalignat3
2 + 3 &\iff 5 &&\text{nem} & x \leq y &\;=\; x + 1 \leq y + 1\\
\intertext{não podemos escrevemos também}
A \setminus B &\iff A \inter \compl B &&\text{nem} & A \subsetneq B &\;=\; A \subseteq B \land A \neq B.\\
\intertext{O que queriamos escrever nesses casos seria:}
2 + 3 &= 5                           &&& x \leq y &\iff x+1 \leq y + 1\\
A \setminus B &= A \inter \compl B &&& A \subsetneq B &\iff A \subseteq B \land A \neq B.
\endxalignat
$$
%%}}}

\TODO Diagramas de Venn e suas limitações.

\blah.
Continuamos com mais operações, incluindo nossa primeira operação unária.

%%{{{ df: complement_def 
\definition.
\label{complement_def}%
\tdefined{complemento}%
\sdefined {\compl{\holed A}} {o complemento de $A$}%
Seja $A$ conjunto.  Definimos
$$
\compl A \defeq \setst x {x\notin A}
$$
Chamamos o $\compl A$ o \dterm{complemento} de $A$.
%%}}}

%%{{{ df: setminus_def 
\definition.
\label{setminus_def}%
\tdefined{complemento}[relativo]%
\sdefined {\holed A \setminus \holed B} {o complemento relativo de $B$ no $A$}%
Sejam $A,B$ conjuntos.
$$
A \setminus B
\defeq
\setst { x\in A } {x \notin B}
$$
Chamamos o conjunto $A\setminus B$ o \dterm{complemento relativo} de $B$ no $A$,
e pronunciamos o $A\setminus B$ como <<$A$ \emph{menos} $B$>> ou <<$A$ \emph{fora} $B$>>.
%%}}}

%%{{{ x: setminus_practice 
\exercise.
\label{setminus_practice}%
Calcule (a extensão d)os conjuntos:
\doublecolumns
\beginol
\li $\set{0,1,2,3,4} \setminus \set{4,1}$
\li $\set{0,1,2,3,4} \setminus \set{7,6,5,4,3}$
\li $\set{0,1,2} \setminus \nats$
\li $\nats \setminus \set{0,1,2}$
\li $\nats \setminus \ints$
\li $\set{\set{0,1}, \set{1,2}, \set{0,2}} \setminus \set{0,1}$
\li $\set{\set{0,1}, \set{1,2}, \set{0,2}} \setminus \set{0,1,2}$
\li $\set{\set{0,1}, \set{1,2}, \set{0,2}} \setminus \set{\set{0,1,2}}$
\li $\set{\set{0,1}, \set{1,2}, \set{0,2}} \setminus \set{\set{1,2}}$
\li $\set{\set{0,1}, \set{1,2}} \setminus \set{\set{1}}$
\li $\set{7,\emptyset} \setminus \emptyset$
\li $\set{7,\emptyset} \setminus \set{\emptyset}$
\li $\reals \setminus 0$
\li $\reals \setminus \set{0}$
\li $\set{1,\set{1}, \set{\set{1}}, \set{\set{\set{1}}}} \setminus 1$
\li $\set{1,\set{1}, \set{\set{1}}, \set{\set{\set{1}}}} \setminus \set{\set{1}}$
\endol
\singlecolumn

\hint
Não siga tua intuição; siga fielmente a definição!

\solution
\beginol
\li $\set{0,1,2,3,4} \setminus \set{4,1} = \set{0,2,3}$
\li $\set{0,1,2,3,4} \setminus \set{7,6,5,4,3} = \set{0,1,2}$
\li $\set{0,1,2} \setminus \nats = \emptyset$
\li $\nats \setminus \set{0,1,2} = \set{3,4,5,6,\dotsc} = \setst {n \in \nats} {n \geq 3}$
\li $\nats \setminus \ints = \emptyset$
\li $\set{\set{0,1}, \set{1,2}, \set{0,2}} \setminus \set{0,1} = \set{\set{0,1}, \set{1,2}, \set{0,2}}$
\li $\set{\set{0,1}, \set{1,2}, \set{0,2}} \setminus \set{0,1,2} = \set{\set{0,1}, \set{1,2}, \set{0,2}}$
\li $\set{\set{0,1}, \set{1,2}, \set{0,2}} \setminus \set{\set{0,1,2}} = \set{\set{0,1}, \set{1,2}, \set{0,2}}$
\li $\set{\set{0,1}, \set{1,2}, \set{0,2}} \setminus \set{\set{1,2}} = \set{\set{0,1}, \set{0,2}}$
\li $\set{\set{0,1}, \set{1,2}} \setminus \set{\set{1}} = \set{\set{0,1}, \set{1,2}}$
\li $\set{7,\emptyset} \setminus \emptyset = \set{7,\emptyset}$
\li $\set{7,\emptyset} \setminus \set{\emptyset} = \set{7}$
\li $\reals \setminus 0 = \reals$
\li $\reals \setminus \set{0} = (-\infty,0)\union(0,+\infty)$
\li $\set{1,\set{1}, \set{\set{1}}, \set{\set{\set{1}}}} \setminus 1 = \set{1,\set{1}, \set{\set{1}}, \set{\set{\set{1}}}}$
\li $\set{1,\set{1}, \set{\set{1}}, \set{\set{\set{1}}}} \setminus \set{\set{\set{1}}} = \set{1,\set{1}, \set{\set{\set{1}}}}$
\endol

\endexercise
%%}}}

%%{{{ x: setminus_equalities_practice 
\exercise.
\label{setminus_equalities_practice}%
Sejam $A,B$ conjuntos.
Para cada uma das afirmações em baixo: prove se é verdadeira;
refuta se é falsa; mostre um exemplo e um contraexemplo
se depende nos $A,B$ (e tente determinar exatamente quando é verdadeira).
$$
\xalignat3
(1)  \quad& \emptyset \setminus \emptyset = \emptyset       &
(5)  \quad& A \setminus A = A                               &
(9)  \quad& A \setminus B = B                               \\
(2)  \quad& A \setminus \emptyset         = A               &
(6)  \quad& A \setminus A = \emptyset                       &
(10) \quad& A \setminus B                   = B \setminus A \\
(3)  \quad& \emptyset \setminus A         = \emptyset       &
(7)  \quad& A \setminus B = \emptyset                       &
(11) \quad& A \setminus \set{B}             = A             \\
(4)  \quad& \set{\emptyset} \setminus A   = \emptyset       &
(8)  \quad& A \setminus B = A                               &
(12) \quad& \set{A,B} \setminus (A\union B) = \emptyset     
\endxalignat
$$

\endexercise
%%}}}

%%{{{ df: symdiff_def 
\definition.
\label{symdiff_def}%
\tdefined{diferença simétrica}%
\sdefined {\holed A \symdiff \holed B} {a diferença simétrica dos $A$ e $B$}%
Sejam $A,B$ conjunto.  Definimos
$$
x \in A \symdiff B \defiff \text{$x$ pertence em exatamente um dos $A,B$}.
$$
Chamamos o $A \symdiff B$ a \dterm{diferença simétrica} dos $A$ e $B$.
%%}}}

%%{{{ eg: symdiff_example 
\example.
\label{symdiff_example}%
Calculamos os conjuntos:
\beginul
\li $\set{0,1,2,3} \symdiff \set{1,2,4,8} = \set{0,3,4,8}$
\li $\set{\set{0,1}, \set{1,2}} \symdiff \set{0,1,2} = \set{ \set{0,1}, \set{1,2}, 0, 1, 2 }$
\li $\set{\set{0,1}, \set{1,2}} \symdiff \set{\set{0,1},\set{0,2}} = \set{ \set{0,2}, \set{1,2} }$
\li $(-2,1) \symdiff (-1,2) = (-2,-1] \union [1,2)$
\endul
\endexample
%%}}}

%%{{{ x: what_is_A_symdiff_A_and_A_symdiff_emptyset 
\exercise.
\label{what_is_A_symdiff_A_and_A_symdiff_emptyset}%
Dado $A$ conjunto, calcule os conjuntos $A\symdiff A$ e $A \symdiff \emptyset$.

\endexercise
%%}}}

%%{{{ An intuition about symmetric difference 
\note Uma intuição sobre a diferença simétrica.
Pensando pouco nas definições de
$$
A \symdiff B
\qqqquad
A = B
$$
concluimos que a diferença simétrica de dois conjuntos tem exatamente
todos os \dterm{testemunhos}\ii{testemunho}\ que mostram que
os conjuntos são diferentes.
O que podes concluir então assim que souberes que $A \symdiff B = \emptyset$?
(Veja o~\ref{when_A_symdiff_B_is_empty}.)
%%}}}

\endsection
%%}}}

%%{{{ Proving equalities and inclusions 
\section Provando igualdades e inclusões.

%%{{{ x: simple_inclusion_practice_proof 
\exercise.
Prove ou refute a afirmação:
$$
\text{\emph{para todos os conjuntos $A,B,C$,
se $A \subseteq B$ e $A \subseteq C$, então $A \subseteq B \inter C$}.}
$$

\solution
Vou provar a afirmação.
\endgraf
Suponha que $A \subseteq B$ e $A \subseteq C$.
Tome um $a \in A$.  Precisamos mostrar que $a \in B \inter C$.
Como $a \in A$ e $A \subseteq B$, temos $a \in B$;
e como $a \in A$ e $A \subseteq C$, temos $a \in C$.
Logo $a \in B\inter C$, pela definição de $B\inter C$.

\endexercise
%%}}}

%%{{{ x: simple_inclusion_practice_refutation 
\exercise.
Prove ou refute a afirmação:
$$
\text{\emph{para todos os conjuntos $A,B,C$,
se $A \subsetneq B$ e $A \subsetneq C$, então $A \subsetneq B \inter C$.}}
$$

\solution
Vou refutar a afirmação com um contraexemplo.
Tome
$$
\align
A &\asseq \set { 2 }\\
B &\asseq \set { 1,2 }\\
C &\asseq \set { 2,3 }.
\endalign
$$
Realmente $A \subsetneq B$ e $A \subsetneq C$, mas mesmo assim $A = B\inter C$.

\endexercise
%%}}}

%%{{{ prop: set_de_morgan 
\proposition.
\label{set_de_morgan}%
\ii{dualidade}%
Para todos os conjuntos $A,B,C$,
$$
\align
C \setminus (A \union B) &= (C \setminus A) \inter (C \setminus B)\\
C \setminus (A \inter B) &= (C \setminus A) \union (C \setminus B).
\endalign
$$
\proof Prova (usando fórmulas).
Sejam $A,B,C$ conjuntos.  Temos:
$$
\alignat2
x \in C \setminus (A \union B)
&\iff x \in C \land \lnot (x \in A \union B)                        \qqby{def.~$\setminus$}\\
&\iff x \in C \land \lnot (x \in A \lor x \in B)                    \qqby{def.~$\union$}\\
&\iff x \in C \land (x \notin A \land x \notin B)                   \qqby{De Morgan}\\
&\iff (x \in C \land x \notin A) \land (x \in C \land x \notin B)   \qqby{lógica}\\
&\iff (x \in C \setminus A) \land (x \in C \setminus B)             \qqby{def.~$\setminus$}\\
&\iff x \in (C \setminus A) \inter (C \setminus B)                  \qqby{def.~$\inter$}
\endalignat
$$
Logo
$
C \setminus (A \union B)
=
(C \setminus A) \inter (C \setminus B)
$
pela definição de igualdade de conjuntos.
A prova da outra igualdade é similar:
trocamos apenas os $\union$ com os $\inter$, e os $\lor$ com os $\land$!
\qed
%%}}}

%%{{{ x: set_de_morgan_nat_lang 
\exercise.
Escreva uma prova em linguagem natural da~\ref{set_de_morgan}.

\solution
Mostramos as duas inclusões separadamente:
\endgraf
\lrdirset:
Tome $x \in C \setminus (A \union B)$.
Daí $x \in C$ e $x \notin (A \union B)$, ou seja $x\notin A$ e $x \notin B$.
Como $x \in C$ e $x\notin A$, temos $x\in C\setminus A$, e,
similarmente $x\in C\setminus B$.
Logo chegamos no desejado $x\in (C\setminus A) \inter (C\setminus B)$.
\endgraf
A inclusão inversa \rldirset\ é similar.

\endexercise
%%}}}

%%{{{ prop: symdiff_altdef1 
\proposition.
Sejam $A,B$ conjuntos.  Logo,
$$
A \symdiff B
=
(A \setminus B) \union (B \setminus A)
$$
\sketch.
Antes de começar, traduzimos os dois lados:
<<em exatamente um dos dois>> na esquerda,
<<no primeiro mas não no segundo ou no segundo mas não no primeiro>> na direita.
Faz sentido que os dois conjuntos são iguais, pois as duas frases são equivalentes!
Mas para provar formalmente a afirmação, mostramos as duas direções
$$
\xalignat3
A \symdiff B &\subseteq (A \setminus B) \union (B \setminus A) && \mland &
A \symdiff B &\supseteq (A \setminus B) \union (B \setminus A)
\endxalignat
$$
separadamente, usando as definições de $\subseteq$ e $\supseteq$.
\qes
%%}}}

%%{{{ prop: symdiff_altdef2 
\proposition.
Sejam $A,B$ conjuntos.  Logo,
$$
A \symdiff B
=
(A \union B) \setminus (A \inter B).
$$
\sketch.
Novamente, começamos pensando nos dois lados e suas intensões:
<<em exatamente um dos dois>> na esquerda;
<<em pelo menos um dos dois, mas não nos dois>> na direita.
As duas frases são equivalentes, mas vamos mostrar formalmente
a igualdade desses conjuntos, mostrando novamente as
``$\subseteq$'' e ``$\supseteq$'' separadamente.
\qes
%%}}}

\note.
No~\refn{symdiff_def} eu dei uma definição elementária,
para determinar o conjunto $A\symdiff B$.
De fato, seria até melhor \emph{definir} a operação $\symdiff$ usando uma das
duas expressões acima.

%%{{{ x: when_A_symdiff_B_is_empty 
\exercise.
\label{when_A_symdiff_B_is_empty}%
Prove ou refute a afirmação:
$$
\text{\emph{para todo conjunto $A,B$,
se $A\symdiff B = \emptyset$,
então $A = B$}}.
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Cardinality 
\section Cardinalidade.

%%{{{ df: naive_cardinality 
\definition.
\label{naive_cardinality}%
\tdefined{cardinalidade}[ingenuamente]%
\sdefined {\card {\holed A}} {a cardinalidade de $\holed A$}%
Seja $A$ um conjunto.
A \dterm{cardinalidade} de $A$ é a quantidade de elementos de $A$.
Denotamos-la por $\card A$:
$$
\card A \defeq \knuthcases{
    n,      & se $A$ é finito com exatamente $n$ membros distintos\cr
    \infty, & se $A$ é infinito.
}
$$
%%}}}

\blah.
Nos capítulos~\refn{Cantors_paradise} e~\refn{Axiomatic_set_theory}
vamos \emph{refinar} essa notação pois como \Cantor{}Cantor percebeu,
o segundo caso na~\ref{naive_cardinality} é \emph{bem}, \emph{bem}, \emph{bem}
mais rico do que aparece!

%%{{{ prop: cardinality_of_union_of_finite_sets 
\property.
\label{cardinality_of_union_of_finite_sets}%
Sejam $A,B$ conjuntos finitos.
Logo
$$
\card{A\union B} \leq \card A + \card B.
$$
\sketch.
Pelo princípio da inclusão--exclusão
(\refn{Inclusion_exclusion_principle})
temos
$$
\card{A\union B} = \card A + \card B - \card{A \inter B}
$$
e como uma cardinalidade não pode ser negativa, segue desigualdade desejada.
\qes
%%}}}

%%{{{ x: cardinality_of_union_of_disjoint_finite_sets 
\exercise.
\label{cardinality_of_union_of_disjoint_finite_sets}%
Determine quando temos $=$ na desigualdade da~\ref{cardinality_of_union_of_finite_sets}.

\solution
Exatamente quando $A,B$ são disjuntos.
Em símbolos,
$$
\card{A\union B} = \card A + \card B
\iff
A \inter B = \emptyset.
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Powerset 
\section Powerset.

%%{{{ df: powerset_def 
\definition.
\label{powerset_def}%
\tdefined{powerset}%
\iisee{conjunto}[de partes]{powerset}%
\sdefined {\pset{\holed A}} {o powerset de $\holed A$ (conjunto de partes)}%
Seja $A$ conjunto.
Chamamos o \dterm{powerset} (ou \dterm{conjunto de partes}, ou
\dterm{conjunto potência}) de $A$,
denotado por $\pset A$, é o conjunto de todos os subconjuntos de $A$.
Formalmente:
$$
X \in \pset A \defiff X \subseteq A.
$$
%%}}}

%%{{{ x: cardinality_of_poweset_of_finite_set 
\exercise.
\label{cardinality_of_poweset_of_finite_set}%
Seja $A$ conjunto finito.  Qual a cardinalidade do $\pset A$?

\solution
Já resolvemos isso na~\ref{Number_of_subsets}!
Concluimos que:
$$
\card{\pset A} = 2^{\card A}.
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Big union; big intersections 
\section União grande; intersecção grande.

%%{{{ intro 
\blah.
Generalizamos agora as operações binárias de união e intersecção para suas
versões arbitrárias, as operações unitárias $\Union\dhole$ e $\Inter\dhole$.
Antes de dar uma definição, mostramos uns exemplos.
Esses operadores são mais interessantes e úteis quando são aplicados em
conjunto cujos membros são conjuntos também, pois---coloquiamente
falando---eles correspondem na união e na intersecção dos seus membros.
%%}}}

%%{{{ eg: Union_Inter_example 
\example.
\label{Union_Inter_example}%
Aplicamos as operações $\Union$ e $\Inter$ nos conjuntos seguintes:
$$
\align
\Union \set{ \set{1,2,4,8}, \set{0,2,4,6}, \set{2,10} } &= \set{0,1,2,4,6,8,10}\\
\Inter \set{ \set{1,2,4,8}, \set{0,2,4,6}, \set{2,10} } &= \set{2}\\
\Union \set{ \nats, \ints, \rats, \reals }              &= \reals\\
\Inter \set{ \nats, \ints, \rats, \reals }              &= \nats\\
\Union \set{ 2, 3, \set{4,5}, \set{4,6} }               &= \set{4,5,6}\\
\Inter \set{ 2, 3, \set{4,5}, \set{4,6} }               &= \emptyset
\endalign
$$
\endexample
%%}}}

%%{{{ df: Union_def 
\definition.
\label{Union_def}%
\label{Inter_def}%
\tdefined{união}[grande]%
\tdefined{intersecção}[grande]%
\sdefined {\Union \holed {\scr A}} {a união de $\holed{\scr A}$}%
\sdefined {\Inter \holed {\scr A}} {a intersecção de $\holed{\scr A}$}%
Seja $\scr A$ um conjunto.
$$
\align
x \in \Union \scr A
&\defiff
\text{$x$ pertence em algum dos membros do $A$}\\
x \in \Inter \scr A
&\defiff
\text{$x$ pertence em todos os membros do $A$}.
\intertext{Equivalentemente com fórmulas,}
x \in \Union \scr A
&\defiff
\lexists {A \in \scr A} {x \in A}\\
x \in \Inter \scr A
&\defiff
\lforall {A \in \scr A} {x \in A}.
\endalign
$$
Chamamos o $\Union\scr A$ a \dterm{união} de $\scr A$, e o $\Inter\scr A$
a \dterm{intersecção} de $\scr A$.
%%}}}

%%{{{ x: union_and_inter_from_Union_and_Inter_sugar 
\exercise.
\label{union_and_inter_from_Union_and_Inter_sugar}%
Defina os operadores binários $\union$ e $\inter$ como açúcar sintáctico
definido pelos operadores unários $\Union$ e $\Inter$ respectivamente.

\solution
Sejam $A,B$ conjuntos.
Botamos
$$
\xalignat2
A \union B &\defeq \Union\set{A,B} &
A \inter B &\defeq \Inter\set{A,B}.
\endxalignat
$$

\endexercise
%%}}}

%%{{{ x: iterate_pset_and_Union_on_emptyset 
\exercise.
\label{iterate_pset_and_Union_on_emptyset}%
Calcule os conjuntos:
$$
\pset\emptyset,
\qquad \pset\pset\emptyset,
\qquad \pset\pset\pset\emptyset,
\qquad \Union \emptyset,
\qquad \Union\Union \emptyset.
$$

\solution
Calculamos pelas definições de $\pset$ e $\Union$:
$$
\align
\pset\emptyset &= \set { \emptyset }\\
\pset\pset\emptyset &= \set { \emptyset, \set{\emptyset} }\\
\endalign
$$

\endexercise
%%}}}

%%{{{ x: Inter_emptyset 
\exercise.
\label{Inter_emptyset}%
Calcule o $\Inter\emptyset$.

\hint
Siga a definição e nada mais!

\endexercise
%%}}}

%%{{{ note: intuition_about_Inter_Union_powerset_and_set_braces 
\note.
\label{intuition_about_Inter_Union_powerset_and_set_braces}
Bem, bem, bem informalmente podemos dizer que: a operação $\Union$ tire o nivel
mais externo de chaves; a $\Inter$ também mas jogando fora bem mais elementos
(aqueles que não pertencem em todos os membros do seu argumento); e o $\pset$
bote todas as chaves em todas as combinações possíveis para ``o nivel mais
próximo''.
%%}}}

%%{{{ x: card_of_set_its_Union_and_its_Inter_comparison 
\exercise.
\label{card_of_set_its_Union_and_its_Inter_comparison}%
Ache conjuntos finitos $A,B$ tais que
$$
\xalignat2
&0 < \card { \Inter A } < \card A < \card { \Union A } &
&0 < \card B < \card { \Inter B } < \card { \Union B }.
\endxalignat
$$

\solution
Tome
$$
\xalignat2
A &\asseq \set{ \set{ 1,2,3 },   \set{ 3,4,5 }   } &&(0 < 1 < 2 < 4)\\
B &\asseq \set{ \set{ 1,2,3,4 }, \set{ 2,3,4,5 } } &&(0 < 2 < 3 < 5).
\endxalignat
$$

\endexercise
%%}}}

%%{{{ x: inter_subseteq_union_for_nondisjoint_families 
\exercise.
Sejam $\scr A, \scr B$ famílias de conjuntos
com $\scr A \inter \scr B \neq \emptyset$.
Prove ou refute a afirmação:
$$
\Inter\scr A \subseteq \Union\scr B.
$$

\hint
A afirmação é verdadeira.  Prove!

\hint
Como usarás a hipótese $\scr A \inter \scr B \neq \emptyset$?

\hint
Use as definições de $\Inter$ e $\Union$.

\solution
Vamos provar a afirmação.
Suponha $x \in \Inter\scr A$\fact1.
Para mostrar que $x \in \Union\scr B$, basta achar um membro da $\scr B$ em que o $x$ pertence.
Seja $W \in \scr A \inter \scr B$ (sabemos que $\scr A \inter \scr B \neq \emptyset$).
Logo $W \in \scr A$\fact2~e $W \in \scr B$ (def.~$\inter$).
Pelas \byfact1,\byfact2 temos $x\in W$,
e como $W \in \scr B$, temos o desejado $x \in \Union\scr B$.
\endgraf
(Obs.: demonstramos assim um $W$ tal que
$\Inter\scr A \subseteq W \subseteq \Union\scr B$.)

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Tuples 
\section Tuplas.
\label{Tuples}%

\blah.
Começamos com a ideia de \dterm{par ordenado}, ou seja,
um par de objetos onde um deles é considerado primeiro
e o outro segundo.
Naturalmente, podemos generalizar a idéia de par ordenado,
cujo tamanho é $2$, para um conceito correspondente de tamanho $n$,
onde $n$ é qualquer número natural.  Oi, tuplas!

%%{{{ Notation and terminology 
\note Notação e terminologia.
Denotamos o par ordenado dos objetos $a$ e $b$ pelo $\tupa{a, b}$
ou $\tupp{a, b}$.
Em geral, usamos as notações $\tupa{a_0, a_1, \dotsc, a_{n-1}}$
e~$\tupp{a_0, a_1, \dotsc, a_{n-1}}$ para tuplas de tamanho~$n$.
Quando queremos enfatisar o tamanho da tupla, falamos de
\dterm{$n$-tupla}.
Assim, um par ordenado é uma $2$-tupla.
%%}}}

%%{{{ Interface and equality 
\note Interface e igualdade.
Precisamos descrever qual é o ``interface primitivo'' desse novo
tipo, e o que significa $=$ entre tuplas.
Nosso único interface dada uma tupla de tamanho $n$, é que podemos
pedir seu $i$-ésimo elemento, onde $0 \leq i < n$.
Conversamente, para criar uma tupla de tamanho $n$, basta ter
$n$ objetos $a_0, a_1, \dotsc, a_{n-1}$ (distintos ou não).
Consideramos que duas tuplas são iguais se elas
``concordam em cada posição''.
Sem aspas, chegamos nas definições:
%%}}}

%%{{{ df: projections 
\definition Projecções.
Definimos as operações $\pi_i$ chamadas \dterm{projecções}, tais que
para todos os $x,y$, temos
$$
\xalignat2
\pi_0\tup{x,y} &= x &
\pi_1\tup{x,y} &= y
\endxalignat
$$
e similarmente para tuplas de tamanho $n$.
%%}}}

%%{{{ df: tuple_equality 
\definition Igualdade.
Definimos
$$
\align
\tup{x,y} = \tup{x',y'}
&\defiff
x = x' \mland y = y'
\intertext{Generalizando,}
\tup{a_0,a_1,\dotsc,a_n} = \tup{b_0,b_1,\dotsc,b_m}
&\defiff
m = n
\mland
\text{$a_i = b_i$ para todo $i\in\set{0,\dotsc,n}$}
\endalign
$$
%%}}}

\endsection
%%}}}

%%{{{ Cartesian product 
\section Produto cartesiano.
\label{Cartesian_product}%

%%{{{ df: cartesian_product 
\definition.
\label{cartesian_product}%
\tdefined{produto cartesiano}%
\sdefined{{\holed A} \times {\holed B}}{o produto cartesiano dos \holed A e \holed B}%
Sejam $A,B$ conjuntos.
$$
A \times B \defeq \setst {\tup{a,b}} {a\in A,\ b\in B}
$$
%%}}}

%%{{{ x: times_distributes_over_union_and_inter 
\exercise.
\label{times_distributes_over_union_and_inter}
Sejam $A,B,C$ conjuntos.  Prove que:
$$
\align
A \times (B \union C) &= (A \times B) \union (A\times C)\\
A \times (B \inter C) &= (A \times B) \inter (A\times C).
\endalign
$$

\solution
Vamos provar a
$$
A \times (B \union C) = (A \times B) \union (A\times C).
$$
Mostramos as duas inclusões separadamente:
\endgraf
\lrdirset:
Seja $w \in A \times (B\union C)$.
Logo $w = \tup{a,d}$ para algum $a \in A$ e algum $d\in B\union C$ (def.~$\times$).
Logo $d\in B$ ou $d \in C$ (def.~$\union$).
Caso $d \in B$, temos $w = \tup{a,d} \in A \times B$ (def.~$\times$).
Caso $d \in C$, temos $w = \tup{a,d} \in A \times C$ (def.~$\times$).
Nos dois casos concluimos que $w \in (A \times B) \union (A\times C)$ pela definição de $\union$.
\endgraf
\rldirset:
Seja $w \in (A \times B) \union (A\times C)$.
Logo $w\in (A\times B)$ ou $w \in (A\times C)$ (def.~$\union$).
Caso $w \in (A \times B)$, temos $w = \tup{a,b}$ para algum $a\in A$ e algum $b\in B$ (def.$\times$).
Logo $b \in B\union C$ (pois $b\in B$) (def.~$\union$).
Logo pela definição de $\times$ temos o desejado $w = \tup{a,b} \in A \times (B\union C)$.
O caso $w \in (A \times C)$ é similar.
\endgraf
A igualdade
$$
A \times (B \inter C) = (A \times B) \inter (A\times C)
$$
é provada similarmente.

\endexercise
%%}}}

%%{{{ x: when_cartesian_commutes 
\exercise.
\label{when_cartesian_commutes}%
Suponha que $A,B\neq\emptyset$.
Escreva uma prova direta (sem usar reductio ad absurdum) do
$A \times B = B\times A \iff A = B$.

\hint
Uma direção é trivial---por quê?

\hint
Como usamos os fatos $A\neq\emptyset$ e $B\neq\emptyset$?

\endexercise
%%}}}

%%{{{ x: when_cartesian_commutes_absurdum 
\exercise.
Prove usando reductio ad absurdum a direção não-trivial
do~\ref{when_cartesian_commutes}.

\endexercise
%}}}

%%{{{ pseudodf: set_exp 
\pseudodefinition.
Sejam $A$ conjunto e $n\in\nats$ com $n\geq 2$.
$$
A^n \pseudodefeq \setstt {\tup{a_1,\dotsc,a_n}} {$a_i \in A$ para todo $2\leq i\leq n$}.
$$
%%}}}

%%{{{ messy quantifier 
\note.
Na definição acima aparece a frase ``para todo $2\leq i\leq n$''.
Qual é a variável ligada com esse ``para todo''?
Bem, $2$ é um constante, e $n$ já foi declarado, então entendemos que a
frase corresponde na quantificação:
$$
\lforall {i\in\nats} {2\leq i \leq n \limplies a_i \in A}.
$$
%%}}}

%%{{{ df: set_exp_first_recursive_definition 
\definition.
\label{set_exp_first_recursive_definition}%
Seja $A$ conjunto.
Para $n\in\nats$ com $n\geq 1$ definimos as \dterm{potências} de $A$ recursivamente pelas:
$$
\align
A^1 &= A\\
A^n &= A^{n-1} \times A \qquad \text{($n>2$)}.
\endalign
$$
%%}}}

%%{{{ Comparison with numbers (I) 
\note Comparação com números (I).
A semelhança entre a definição de potências de conjuntos e de números é gritante.
Vamos investigar.
Na~\ref{set_exp_first_recursive_definition} das duas equações recursivas
$$
\xalignat3
A^n &= A^{n-1} \times A &
A^n &= A \times A^{n-1}.
\intertext{escolhemos a primeira.  Por quê?
Observe que no caso de números, para a equação recursiva, as duas opções óbvias}
a^n &= a^{n-1} \ntimes a &
a^n &= a \ntimes a^{n-1} 
\intertext{servem e são equivalentes.
Uma explicação disso usa apenas o fato que a multiplicação de números é comutativa,
então imediatamente temos $a^{n-1} \ntimes a = a \ntimes a^{n-1}$.
Infelizmente não podemos contar nessa propriedade no caso de conjuntos,
pois já sabemos que a $\times$ não é comutativa~(\ref{when_cartesian_commutes}).
Mas as duas equações correspondem nas expressões}
a^n &= \paren{\paren{\paren{\paren{\dotsb\paren{a\ntimes a}\ntimes a}\ntimes a} \dotsb} \ntimes a} &
a^n &= \paren{a\ntimes \paren{\dotsb\paren{a\ntimes\paren{a\ntimes\paren{a \ntimes a}\dotsb}}}} &
\endxalignat
$$
que são iguais agora por causa da \emph{associatividade} da operação $\ntimes$.
%%}}}

%%{{{ Q: is times associative? 
\question.
O produto cartesiano é associativo?
%%}}}
\spoiler.

%%{{{ A: answer with another question 
\blah Resposta.
Respondemos nessa pergunta com outra:
\emph{as tuplas}
$$
\tup{a_0, \tup{a_1, a_2}}
\qquad
\tup{\tup{a_0, a_1}, a_2}
\qquad
\tup{a_0, a_1, a_2}
$$
\emph{são iguais?}
Depende.
Queremos considerar elas como se fossem iguais, pois
qualquer uma delas serve para satisfazer a especificação de tuplas:
podemos definir as $i$-ésimas projecções para cada uma,
e a igualdade vai acabar sendo satisfeita usando uma delas
sse é satisfeita usando qualquer uma das outras.
Para nos convencer que faz sentido considerar essas tuplas como iguais
pense na idéia sobre a \emph{informação} que uma tupla carrega com ela.
Agora tente ler as três tuplas em cima:
$$
\gather
\text{\emph{Primeiro o objeto $a_0$, e depois temos: primeiro o $a_1$ e depois o $a_2$.}}\\
\text{\emph{Primeiro temos: primeiro o objeto $a_0$ e depois o $a_1$; e depois temos o $a_2$.}}\\
\text{\emph{Primeiro temos o objeto $a_0$ e depois o $a_1$ e depois o $a_2$.}}
\endgather
$$
%%}}}

%%{{{ Comparison with numbers (II) 
\note Comparação com números (II).
Uma diferença entre as definições de potências de números e de conjuntos
é que no caso de conjuntos definimos o $A^n$ para todo $n \geq 1$,
mas no caso de números naturáis conseguimos uma definição mais geral,
definindo o $a^n$ para todo $n \geq 0$.
Nossa base da recursão então foi $a^0 = 1$.
Por quê $1$?
%%}}}

%%{{{ Unit 
\note Unit.
Se é para generalizar bem a definição de potências de números para o caso de
conjuntos, procuramos nosso $1$, ou seja, uma \dterm{unidade}
(também \dterm{identidade}, ou \dterm{elemento neutro})
da nossa ``multiplicação'', $\times$.
Essa unidade é chamada \dterm{unit}, e muito usada em linguagens de programação.
Vamos usar o $\tup{}$ para denotá-la.
Isso é um abuso notacional, pois $\tup{}$ também denota a tupla vazia,
que é o único membro da unit;
mas o contexto é em geral suficiente para tirar a ambigüidade.
%%}}}

\endsection
%%}}}

%%{{{ Sequences 
\section Seqüências.
\label{Sequences}%

%%{{{ df: sequence 
\definition Seqüência.
\label{sequence}%
\tdefined{seqüência}%
\sdefined {\sequence {\holed a} n} {a seqüência ${\holed a}_0,{\holed a}_1,{\holed a}_2,\dotsc$}%
A generalização de tuplas para seqüências é bem simples.
Uma $n$-tupla $\tup{a_0,\dotsc,a_{n-1}}$ tem um membro para cada uma das
$n$ posições $i = 0, \dotsc, n-1$, e nada mais.
Uma \dterm{seqüência} tem um membro para cada natrual $i \in \nats$.
Usamos a notação $\sequence a n$ para denotar a seqüência
$$
a_0, a_1, a_2, a_3, \dotsc
$$
Uma \dterm{seqüência finita} é apenas uma $n$-tupla, para algum $n\in\nats$.
%%}}}

%%{{{ Limits of sequnces 
\note.
No coração de calculus é o estudo de seqüências
de números reais.  No~\ref{Real_numbers} definimos a noção de \dterm{limite} de
uma seqüência de reais $\sequence a n$, e no~\ref{Metric_spaces}
estendemos essa idéia num contexto mais geral e abstrato, onde
os membros da seqüência não são necessariamente números reais,
mas membros de um \emph{espaço métrico}.
Nada mais por enquanto---paciência!
%%}}}

%%{{{ Sequences of sets 
\note Seqüências de conjuntos.
Mais interessante para a gente neste momento são \emph{seqüências de conjuntos}.
%%}}}

%%{{{ Q: how_would_you_define_Union_of_sequence 
\question.
\label{how_would_you_define_Union_of_sequence}%
Imagina que temos definido, para cada $n\in\nats$, um conjunto $A_n$.
Como tu definirias os conjuntos
$\Union_{n=0}^{\infty} A_n$
e 
$\Inter_{n=0}^{\infty} A_n$
?
%%}}}
\spoiler.

%%{{{ df: Union_Inter_of_sequence 
\definition.
\label{Union_Inter_of_sequence}%
Definimos os operadores unários
$\Union_{n=0}^{\infty}$ e
$\Inter_{n=0}^{\infty}$ assim:
suponha que $A_n$ é um conjunto para cada $n\in\nats$; definimos:
$$
\align
x \in \Union_{n=0}^{\infty} A_n &\defiff \lexists {n \in \nats} {x \in A_n} \\
x \in \Inter_{n=0}^{\infty} A_n &\defiff \lforall {n \in \nats} {x \in A_n}.
\endalign
$$
%%}}}

%%{{{ Union_Inter_of_sequences_as_sugar 
\exercise.
\label{Union_Inter_of_sequences_as_sugar}%
Na~\ref{Union_Inter_of_sequence} definimos \emph{elementariamente}
as operações $\Union_{n=0}^{\infty}$ e $\Inter_{n=0}^{\infty}$.
Defina-las usando as operações de $\Union$ e $\Inter$.

\solution
Seja $A_n$ uma seqüência de conjuntos.
Defina
$$
\xalignat2
\Union_{n=0}^{\infty} &\defeq \Union\setst {A_n} {n\in\nats} &
\Inter_{n=0}^{\infty} &\defeq \Inter\setst {A_n} {n\in\nats}.
\endxalignat
$$

\endexercise
%%}}}

%%{{{ prop: set_de_morgan_gen 
\proposition.
\label{set_de_morgan_gen}%
\ii{dualidade}%
Para todo conjunto $C$ e cada seqüência de conjuntos
$\set{ A_n }_n$,
$$
\align
C \setminus {\Union_{n=0}^\infty A_n} &= \Inter_{n=0}^{\infty} \paren{C \setminus A_n}\\
C \setminus {\Inter_{n=0}^\infty A_n} &= \Union_{n=0}^{\infty} \paren{C \setminus A_n}.
\endalign
$$
\proof Prova (usando fórmulas).
Sejam $C$ conjunto e $\set{ A_n }_n$ seqüência de conjuntos.
Calculamos
$$
\alignat2
x \in C \setminus \Unionl_{n=0}^{\infty}A_n
&\iff x \in C \land \lnot \biggparen{x \in \Unionl_{n=0}^{\infty}A_n}   \qqby{def.~$\setminus$}\\
&\iff x \in C \land \lnot (\exists n\in\nats)[x \in A_n]  \qqby{def.~$\Unionl_{n=0}^{\infty}$}\\
&\iff x \in C \land (\forall n\in\nats)[x \notin A_n]     \qqby{De Morgan}\\
&\iff (\forall n\in\nats)[x \in C \land x \notin A_n]     \qqby{lógica}\\
&\iff (\forall n\in\nats)[x \in C \setminus A_n]          \qqby{def.~$\setminus$}\\
&\iff x \in \Interl_{n=0}^{\infty}(C \setminus A_n).      \qqby{def.~$\Interl_{n=0}^{\infty}$}
\endalignat
$$
A prova da outra igualdade é similar:
é só trocar os $\Union$ com os $\Inter$, e os $\exists$ com os $\forall$!
\qed
%%}}}

\blah.
Observe a semelhança entre essa prova e a prova da~\ref{set_de_morgan}:
até nas justificativas de cada passo!
Realmente, a~\ref{set_de_morgan_gen} é uma generalização
da~\refn{set_de_morgan}, algo que tu provarás no exercício seguinte:

%%{{{ x: set_de_morgan_gen_indeed 
\exercise.
\label{set_de_morgan_gen_indeed}%
O que precisamos fazer para ganhar a~\ref{set_de_morgan} como um corolário
da~\refn{set_de_morgan_gen}?

\hint
Quais são os dados que precisamos ter per aplicar a~\ref{set_de_morgan_gen}?

\solution
Dados conjuntos $A,B,C$, precisamos mostrar que:
$$
C \setminus (A \union B)
=
(C \setminus A) \inter (C \setminus B).
$$
Seja $\set{A_n}_n$ a seqüência $A,B,B,B,\dotsb$, (ou seja, a seqüência definida pelas:
$A_0 = A$; e $A_i = B$ para $i > 0$).
Pela~\ref{set_de_morgan_gen} temos então:
$$
C \setminus \munderbrace{\Union_{n=0}^\infty A_n} {A \union B}
=
\munderbrace{\Inter_{n=0}^{\infty} (C \setminus A_n)} {(C\setminus A) \inter (C\setminus B)}.
$$

\endexercise
%%}}}

%%{{{ x: set_de_morgan_gen_nat_lang 
\exercise.
Escreva uma prova em linguagem natural da~\ref{set_de_morgan_gen}.

\solution
Mostramos as duas inclusões separadamente:
\endgraf
\lrdirset:
Tome $x \in C \setminus \Union_{n=0}^{\infty}A_n$,
ou seja, $x \in A_k$ para algum $k\in \nats$,
e logo $x \notin C \setminus A_k$ e daí
$x \notin \Inter_n \paren{C \setminus A_n}$
(pois não pertence no seu $k$-ésimo conjunto)
\endgraf
A inclusão inversa \rldirset\ é similar.

\endexercise
%%}}}

%%{{{ x: running_intervals_on_nats 
\exercise.
\label{running_intervals_on_nats}%
Para $n\in\nats$, defina os conjuntos de naturais
$$
\xalignat2
A_n &= \setst {i\in\nats} {i \leq n} &
B_n &= \nats\setminus A_n.
\endxalignat
$$
Calcule os conjuntos $\Union_n A_n$ e $\Inter_n B_n$.

\hint
Use as definições e/ou a~\ref{set_de_morgan_gen}.

\solution
Temos
$$
\align
a \in \Unionl_n A_n
&\iff \lexists {n\in \nats} {a\in A_n}
\iff a \in \nats \\
b \in \Interl_n B_n
&\iff \lforall {n\in \nats} {b\in B_n}
\iff \False.
\endalign
$$
Ou seja: $\Union_n A_n = \nats$ e $\Inter_n B_n = \emptyset$.
Equivalentemente ganhamos a segunda imediatamente pela primeira
e a~\ref{set_de_morgan_gen}.

\endexercise
%%}}}

%%{{{ warning: big_setops_vs_sum 
\warning.
\label{big_setops_vs_sum}%
Uma diferença importantíssima entre os operadores $\sum{}$ e $\Union$ e seus indices:
um ``somatório infinito'' não é nem associativo nem comutativo!
O seguinte teorema de \Riemann{}Riemann é bastante impressionante!
%%}}}

%%{{{ thm: riemann_rearrangement 
\theorem Riemann's rearrangement.
\label{riemann_rearrangement}%
Se uma série infinita $\sum a_i$ de reais é \emph{condicionalmente convergente},%
\footnote{Uma série $\sum a_i$ é \dterm{condicionalmente convergente}
sse ela é convergente, mas a $\sum |a_i|$ não é.}
então podemos apenas permutando seus termos criar uma nova série infinita que
converga em \emph{qualquer} $x\in[-\infty,\infty]$ que desejamos.
\sketch.
Separe as metas: (i) mostrar como criar uma série que converge num dado número $\ell$;
(ii) mostrar como criar uma série divergente.
\endgraf
Observe que como $\sum a_i$ é condicionalmente convergente, ela contem uma infinidade
de termos positivos, e uma infinidade de termos negativos.
Para o (i), fixe um $\ell\in\reals$.
Fique tomando termos positivos da série $a_i$ até seu somatório supera o $\ell$.
Agora fique tomando termos negativos da $a_i$ até seu somatório cai embaixo do $\ell$.
Agora fique tomando termos positivos até superar o $\ell$, etc.~etc.
Continuando assim conseguimos construir uma série feita por termos da $\sum a_i$ que converge no $\ell$.
\qes
\proof.
Veja~\cite[\S10.21~\&~Teorema~10.22]{apostol2}.
\qed
%%}}}

\endsection
%%}}}

%%{{{ Indexed families 
\section Famílias indexadas.
\label{Indexed_families}%

\blah.
Vamos agora generalizar o conceito de tupla para a
\dterm{família indexada}\ii{família!indexada}~por
algum conjunto $\cal I$:
$\family {a_i} {i\in \cal I}$ ou $\famst {a_i} {i\in \cal I}$.
A idéia que nos motiva é: \emph{por quê nos limitar ``acessando''
os membros de uma tupla apenas usando inteiros como indices (rótulos),
enquanto podemos ``liberar'' qualquer objeto para servir como rótulo?}
E é assim que fazemos mesmo.  Uns exemplos:

%%{{{ eg: anscestors_and_children 
\example.
\label{ancestors_and_children}%
Seja $\cal P$ o conjunto de todas as pessoas do mundo.
Definimos para cada pessoa $p\in \cal P$, os conjuntos $A_p$ e $C_p$ de todos
os ancestrais e todos os filhos de $p$, respectivamente.
Ou seja, acabamos de definir duas \emph{famílias indexadas} de conjuntos:
a $\famil A p {\cal P}$ e a $\famil C p {\cal P}$.
\endexample
%%}}}

%%{{{ eg: airports_direct_flights 
\example.
\label{airports_direct_flights}%
Seja $\cal A$ o conjunto de todos os aeroportos.
Para cada aeroporto $a\in\cal A$, seja
$$
D_a \defeq \setst { b \in \cal A } { \text{existe vôo direto de $a$ para $b$} }.
$$
Acabamos de definir uma família de conjuntos
$\famst {D_a} {a \in \cal A}$.
\endexample
%%}}}

%%{{{ eg: books_and_authors 
\example.
\label{books_and_authors}%
Seja $\cal B$ o conjunto de todos os livros.
Para cada livro $b\in\cal B$, sejam
$$
\align
A_b &\defeq \setstt a {$a$ é um autor do livro $b$}\\
W_b &\defeq \setstt w {$w$ é uma palavra que aparece no texto do livro $b$}.
\endalign
$$
\endexample
%%}}}

%%{{{ df: Union_Inter_of_family 
\definition.
\label{Union_Inter_of_family}%
Definimos os operadores unários
$\Union_{i\in\cal I}$ e
$\Inter_{i\in\cal I}$ assim:
suponha que $\famil F i {\cal I}$ é uma família de conjuntos indexada por um
conjunto de índices $\cal I$.
Definimos
$$
\xalignat2
\Union_{i\in\cal I} A_i &\defeq \lexists {i\in \cal I} {x \in A_i}&
\Inter_{i\in\cal I} A_i &\defeq \lforall {i\in \cal I} {x \in A_i}.
\endxalignat
$$
%%}}}

%%{{{ df: cartesian_product_of_indexed_family_of_sets 
\definition Produto cartesiano (família).
\label{cartesian_product_of_indexed_family_of_sets}%
Seja $\family {A_i} {i\in \cal I}$ uma família de conjuntos
indexada por um conjunto de índices $\cal I$.
$$
\Prod_{i\in \cal I} A_i \defeq
\setstt {\family {a_i} {i\in\cal I}} {$a_i\in A_i$ para todo $i\in\cal I$}.
$$
%%}}}

\endsection
%%}}}

%%{{{ Pairwise-disjointness 
\section Disjuntos dois-a-dois.

%%{{{ df: pairwise_disjoint 
\definition.
\label{pairwise_disjoint}%
Seja $\scr A$ uma família de conjuntos.
Chamamos seus membros \dterm{disjuntos dois a dois} sse nenhum deles
tem elementos em comum com nenhum outro deles.
Em símbolos:
$$
\align
\text{os conjuntos da $\scr A$ são disjuntos dois a dois}
&\defiff
\lforall {A,B \in \scr A} {A \neq B \limplies A\inter B = \emptyset }.
\intertext{Similarmente para famílias indexadas:}
\text{os conjuntos da $\famil A i {\cal I}$ são disjuntos dois a dois}
&\defiff
\lforall {i,j \in \cal I} {i\neq j \limplies A_i \inter A_j = \emptyset}.
\intertext{E logo para seqüências também:}
\text{os conjuntos da $\sequence A n$ são disjuntos dois a dois}
&\defiff
\lforall {i,j \in \nats} {i\neq j \limplies A_i \inter A_j = \emptyset}.
\endalign
$$
%%}}}

%%{{{ x: disjoint_not_pairwise_disjoint 
\exercise.
\label{disjoint_not_pairwise_disjoint}%
Ache uma família de conjuntos $\scr A$ com $\Inter \scr A = \emptyset$
mas cujos membros não são disjuntos dois a dois.

\solution
Tome
$$
\scr A \asseq \set{ \set{0,1}, \set{1,2}, \set{7} }.
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Translating propositions from and to set relations 
\section Traduzindo proposições de e para relações de conjuntos.

\blah.
Lembra os exemplos~\refn{ancestors_and_children},~\refn{airports_direct_flights},
e~\refn{books_and_authors}?
Bom.  Vamos practicar nossa fluência em cojuntos usando esses exemplos agora.

%%{{{ x: ancestors_and_children_translations 
\exercise.
\label{ancestors_and_children_translations}%
Para toda pessoa $p\in\cal P$ defina $A_p$ e $C_p$ como
no~\ref{ancestors_and_children}.
Suponha que $p,q,r$ denotam pessoas.
Traduza as afirmações descritas na linguagem de conjuntos para
linguagem natural e vice versa.
\doublecolumns
\beginol
\li $p$ e $q$ são irmãos;
\li $C_p \neq \emptyset$;
\li $p$ é filho único;
\li $p$ e $q$ são parentes;
\li $p$ e $q$ são primos de primeiro grau;
\li $r$ é filho dos $p$ e $q$;
\li $C_p \inter C_q \neq \emptyset$;
\li $A_p \subseteq A_q$;
\li $\emptyset \subsetneq C_p \subsetneq C_q$;
\li $\lexists {p\in\cal P} {p \in C_p}$.
\endol
\singlecolumn

\solution
Traduzimos:
$$
\align
\text{$p$ e $q$ são irmãos}                      &: \text{$p\neq q \mland \exists r \paren{\set{p,q}\subseteq C_r}$} \\
\text{$C_p \neq \emptyset$}                      &: \text{$p$ tem pelo menos um filho} \\
\text{$p$ é filho único}                         &: \text{$\lexists {r\in A_p} {C_r = \set{p}}$} \\
\text{$p$ e $q$ são parentes}                    &: \text{$A_p \inter A_q \neq \emptyset$} \\
\text{$p$ e $q$ são primos de primeiro grau}     &: \text{$\exists r,r'\paren{p\in C_r \mland q \in C_{r'} \mland \text{$r$ e $r'$ são irmãos}}$} \\
\text{$r$ é filho dos $p$ e $q$}                 &: \text{$r \in C_p \inter C_q$} \\
\text{$C_p \inter C_q \neq \emptyset$}           &: \text{$p$ e $q$ têm pelo menos um filho juntos} \\
\text{$A_p \subseteq A_q$}                       &: \text{$p$ é um anscestor ou irmão de $q$} \\
\text{$\emptyset \subsetneq C_p \subsetneq C_q$} &: \text{$q$ tem filho(s) com $p$ mas com outra pessoa também} \\
\text{$\lexists {p\in\cal P} {p \in C_p}$}       &: \text{existe pessoa que é seu próprio filho}.
\endalign
$$
(Tuas traduções podem variar, especialmente se tuas definições
dessas palavras são diferentes que aquelas que eu usei aqui.)

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Intervals on the real line 
\section Intervalos na reta real.

%%{{{ intervals_of_reals 
\definition Intervalos.
\label{intervals_of_reals}%
\tdefined{intervalos}[de números]%
Sejam $\alpha,\beta\in\reals$.
Definimos os \dterm{intervalos} seguintes:
$$
\xalignat2
(\alpha, \beta) &\defeq \setst {x\in\reals} {\alpha < x < \beta} &
(\alpha, \beta] &\defeq \setst {x\in\reals} {\alpha < x \leq \beta} \\
[\alpha, \beta) &\defeq \setst {x\in\reals} {\alpha \leq x < \beta} &
[\alpha, \beta] &\defeq \setst {x\in\reals} {\alpha \leq x \leq \beta}.
\endxalignat
$$
%%}}}

%%{{{ x: running_intervals_on_reals 
\exercise.
\label{running_intervals_on_reals}%
Para $n=1,2,3,\dotsc$ defina os intervalos de reais
$$
\xalignat2
F_n &= \ival[ {-1+\frac1n \,,\; 1-\frac1n} ] &
G_n &= \ival( {-1-\frac1n \,,\; 1+\frac1n} ).
\endxalignat
$$
Calcule os conjuntos $\Union_n F_n$ e $\Inter_n G_n$.

\hint
Use as definições!

\solution
Temos
$$
\align
x \in \Unionl_n F_n
&\iff \lexists {n\in \nats} {x\in F_n}
\iff x \in (-1,1) \\
x \in \Interl_n G_n
&\iff \lforall {n\in \nats} {x\in G_n}
\iff x \in [-1,1].
\endalign
$$
Ou seja: $\Union_n F_n = (-1,1)$ e $\Inter_n G_n = [-1,1]$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Generalized cartesian product 
\section Produto cartesiano generalizado.

%%{{{ ideia 
\note.
Vamos começar com
\emph{dois objetos} $a$ e $b$, nessa ordem,
ou seja com uma tupla $\tup{a,b}$.
Já sabemos como generalizar essa idéia para uma \emph{família indexada}
por um conjunto abstrato de índices $\cal I$, chegando assim
na $\famil a i {\cal I}$.
\endgraf
Agora comece com \emph{dois conjuntos} $A$ e $B$, nessa ordem,
ou seja com uma tupla $\tup{A,B}$.
Podemos formar o \emph{produto cartesiano} dela,
que em vez de escrever $\times\tup{A,B}$ escrevemos com
notação comum e infixa $A\times B$.
$$
\text{produto de $\tup{A,B}$}
= \setst {\tup{a,b}} {a \in A \mland b \in B} 
$$
Com mais detalhes:
o \emph{produto da tupla de conjuntos} $\tup{A,B}$
é \emph{o conjunto de todas as tuplas} $\tup{a,b}$ tais que seu \emph{primeiro}
membro pertence no \emph{primeiro} membro da nossa tupla de conjuntos
$\tup{A,B}$, e seu \emph{segundo} membro pertence no \emph{segundo} membro de
$\tup{A,B}$.
%%}}}

\question.
Como generalizar isso de tuplas para famílias indexadas?
Lembre-se que em famílias indexadas não existe mais essa idéia de
\emph{primeiro} e \emph{segundo} membro.
Em vez disso, temos \emph{membro no índice $i$},
um para cada $i\in\cal I$.
\spoiler.

%%{{{ in search for a generalization 
\note Procurando uma generalização.
Antes de responder na pergunta, vamos construir nosso caminho
numa forma mais metódica.
$$
\matrix
\format
\c & \quad\c\quad & \c \\
\tup{A,B} & \leadsto & A\times B \\
\famil A i {\cal I} & \leadsto & ??
\endmatrix
$$
Um passo importante é perceber que nessa situação são envolvidos
dois processos: um de ``formar o produto de coisas'',
e outro de ``generalizar de tuplas para famílias indexadas''.
Então uma imagem melhor seria o diagrama
$$
\cdopt{sep=2cm}
\tup{A,B}   \ar[r, "\text{product}"]\ar[d, "\text{generalize}"'] \| A\times B\ar[d, dashed, "\text{generalize}"]\\
\famil A i {\cal I}   \ar[r, dashed, "\text{product}"]                  \| ??
\endcd
$$
onde idealmente deveria \dterm{comutar}, que informalmente quis dizer que
os dois caminhos que nos levam de $\tup{A,B}$ para o desejado $??$
vão chegar na mesma coisa.
(Teremos muito mais a falar sobre \dterm{diagramas comutativos} nos próximos
capítulos.)
\endgraf
Assim fica mais fácil achar o $??$:
$$
\cdopt{column sep=2cm, row sep=6mm}
\tup{A,B}       \ar[r]\ar[d] \| \setst  {\tup{a,b}}     {a\in A \mland b\in B}\ar[d]\\
\tup{A_0,A_1}   \ar[r]\ar[d] \| \setst  {\tup{a_0,a_1}} {a_0\in A_0 \mland a_1\in A_1}\ar[d]\\
\tup{A_0,A_1}   \ar[r]\ar[d] \| \setstt {\tup{a_0,a_1}} {$a_i\in A_i$ para todo $i\in\set{0,1}$}\ar[d, dashed]\\
\famil A i {\cal I}   \ar[r, dashed]                          \| ??
\endcd
$$
A definição correta agora da idéia que estavamos procurando é óbvia:
$$
\text{o produto da $\famil A i {\cal I}$ é o conjunto
$\setstt {\famil a i {\cal I}} {$a_i \in A_i$ para todo $i\in\cal I$}$}.
$$
Só basta achar uma notação legal para esse conjunto, e essa escolha também é fácil.
%%}}}

%%{{{ df: gartesian porduct of an indexed family of sets 
\definition Produto cartesiano de família.
\label{cartesian_product_generalized}%
\tdefined{produto cartesiano}[generalizado]%
\sdefined
    {\prod_{\holed i\in{\holed {\cal I}}} {\holed {A_i}}}
    {o produto cartesiano da família indexada de conjuntos $\famil A i {\cal I}$.}%
Seja $\famil A i {\cal I}$ uma família indexada de conjuntos.
Definimos seu \dterm{produto cartesiano}
$$
\prod_{i\in\cal I} A_i
\defeq
\setstt {\famil a i {\cal I}} {$a_i \in A_i$ para todo $i\in\cal I$}.
$$
%}}}

\endsection
%%}}}

%%{{{ Multisets 
\section Multisets.
\label{Multisets}%
\ii{multiset}%
\iisee{bag}{multiset}%

\blah.
Coloquiamente falando, um \dterm{multiset}
(também \dterm{bag} ou \dterm{sacola}) $M$ é como um conjunto,
só que ele não pode responder apenas em perguntas do tipo
<<o objeto $x$ pertence ao $M$?>>, mas também em
<<\emph{quantas vézes pertence} o $x$ ao $M$?>>.
Seus membros continuam sem ordem, mas agora tem \dterm{multiplicidade}.
Usamos a notação
$\bag{x_0, x_1, \dots, x_n}$
para denotar multisets, ou até
$\set{x_0, x_1, \dots, x_n}$
sobrecarregando a notação $\set{\dots}$ se é claro pelo contexto
que é um multiset e não um conjunto.

\note Igualdade.
Consideramos os multisets $M$ e $M'$ iguais sse para todo $x$,
$$
\text{$x$ pertence $n$ vezes ao $M$}
\iff
\text{$x$ pertence $n$ vezes ao $M'$}.
$$

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ sequence_of_sets_inclusions_tricky_indices_1 
\problem.
\label{sequence_of_sets_inclusions_tricky_indices_1}%
Sejam $\sequence A n$ e $\sequence B n$ duas seqüências de conjuntos tais que
$$
\text{para todo $n\in\nats$, $A_n \subseteq B_{n+1}$.}
$$
Prove que:
$$
\Union_{n=0}^\infty A_n \subseteq \Union_{n=0}^{\infty} B_n.
$$

\solution
Suponha $x \in \Union_{n=0}^\infty A_n$.
Preciso mostrar que $x \in \Union_{n=0}^{\infty} B_n$,
ou seja, mostrar que $x$ pertence em pelo menos um dos $B_n$'s.
(Ou seja, procuro um $k\in \nats$ tal que $x \in B_k$.)
Seja $m\in \nats$ tal que $x \in A_m$
(pela definição de $\Union_{n=0}^\infty A_n$).
Pela hipótese, $x \in B_{m+1}$, algo que mostra que
$x \in \Union_{n=0}^{\infty} B_n$
(tome $k \asseq m+1$).

\endproblem
%%}}}

%%{{{ sequence_of_sets_inclusions_tricky_indices_2 
\problem.
\label{sequence_of_sets_inclusions_tricky_indices_2}%
Sejam $\sequence A n$ e $\sequence B n$ duas seqüências de conjuntos tais que
$$
\text{para todo número par $m$, $A_m \subseteq B_{m/2}$.}
$$
Prove que:
$$
\Inter_{n=0}^\infty A_n \subseteq \Inter_{n=0}^{\infty} B_n.
$$

\solution
Suponha $x \in \Inter_{n=0}^\infty A_n$.
Preciso mostrar que $x \in \Inter_{n=0}^{\infty} B_n$,
ou seja, provar que $x\in B_k$ para todo $k\in\nats$.
Seja $k \in \nats$.
Como $x \in \Inter_{n=0}^{\infty}A_n$, temos $x \in A_{2k}$.
Mas $A_{2k} \subseteq B_k$, logo $x \in B_k$.

\endproblem
%%}}}

%%{{{ sequence_of_sets_inclusions_counterexample 
\problem.
\label{sequence_of_sets_proper_inclusions_counterexample}%
Sejam $\sequence A n$ e $\sequence B n$ duas seqüências de conjuntos,
tais que para todo $n\in\nats$,
$A_n \subsetneq B_n$.
Podemos concluir alguma das afirmações seguintes?:
$$
\xalignat2
\Union_{n=0}^\infty A_n &\subsetneq \Union_{n=0}^{\infty} B_n &
\Inter_{n=0}^\infty A_n &\subsetneq \Inter_{n=0}^{\infty} B_n
\endxalignat
$$

\hint
Procure contraexemplos:
para cada afirmação,
defina duas seqüências $\sequence A n$ e $\sequence B n$
que satisfazem a condição do problema, e mesmo assim,
não é valida a conclusão proposta.

\solution
Vamos construir um contraexemplo para cada afirmação.
\endgraf
Considere as seqüências de conjuntos seguintes:
para todo $n\in\nats$ define
$$
A_n \eqass (-n,n)
\qqqquad
\aligned
B_0     &\asseq \emptyset\\
B_{n+1} &\asseq [-n,n].
\endaligned
$$
Observe que, realmente, para todo $n\in\nats$ temos $A_n \subsetneq B_{n+1}$:
$$
A_n = (-n,n) \subsetneq [-n,n] = B_{n+1}.
$$
Mesmo assim,
$$
\Union_{n=0}^\infty A_n = \reals = \Union_{n=0}^{\infty} B_n.
$$
\endgraf
Para refutar a segunda afirmação, considere
as seqüências de conjuntos seguintes:
para todo $n\in\nats$ defina
$$
A_n \eqass \setst {k \in \nats}  {k > n}
\qquad\qquad
B_n \eqass \setst {k \in \nats}  {k \geq n}
$$
Observe que, realmente, para todo $n\in\nats$ temos $A_n \subsetneq B_n$.
Mesmo assim,
$$
\Inter_{n=0}^\infty A_n = \emptyset = \Inter_{n=0}^{\infty} B_n.
$$

\endproblem
%%}}}

%%{{{ epsilon-dependent and n-dependent intersections 
\problem.
Para todo real $\epsilon>0$ e todo $n\in\nats$,
sejam os intervalos de reais
$$
\align
I_\epsilon &= [0,1 + \epsilon)\\
U_n &= [n,+\infty).
\endalign
$$
Calcule os conjuntos:
(i) $\Inter \set {I_\epsilon \st \epsilon>0}$;
(ii) $\Inter_{n=2}^{\infty} U_n$.

\solution
(i) $[0,1]$;
(ii) $\emptyset$.

\endproblem
%%}}}

%%{{{ arbitrary_finite_symdiff 
\problem.
\label{arbitrary_finite_symdiff}%
Sejam $n\in\nats$ com $n\geq 2$ e $n$ conjuntos
$A_1, A_2, \dotsc, A_n$.
Seja
$$
A \asseq A_1 \symdiff A_2 \symdiff \dotsb \symdiff A_n.
$$
Observe que como a operação $\symdiff$ é associativa e comutativa,
o $A$ é bem definido.
Prove que:
$$
A = \set{ a \st \text{$a$ pertence numa quantidade ímpar de $A_i$'s}}.
$$

\hint
Indução.

\solution
Provamos por indução que para todo inteiro $n \geq 2$,
$$
A_1 \symdiff A_2 \symdiff \dotsb \symdiff A_n
= \set{ a \st \text{$a$ pertence numa quantidade ímpar de $A_i$'s}}.
$$
\proofpart{Base ($n=2$):}
$x \in A_1 \symdiff A_2 \iff \text{$x$ pertence numa quantidade ímpar dos $A_1,A_2$}$ (óbvio).
\endgraf
\proofpart{Passo indutivo:}
Seja $k\in\nats$ tal que 
$$
A_1 \symdiff A_2 \symdiff \dotsb \symdiff A_k
= \set{ a \st \text{$a$ pertence numa quantidade ímpar de $A_i$'s}}.\tag{H.I.}
$$
Precisamos mostrar que:
$$
A_1 \symdiff \dotsb \symdiff A_{k+1}
= \set{ a \st \text{$a$ pertence numa quantidade ímpar dos $A_1,\dotsc,A_{k+1}$'s}}.
$$
\endgraf
(\lrdirset):
Suponha que $x\in A_1 \symdiff A_2 \symdiff \dotsb \symdiff A_{k+1}$,
ou seja, $x \in (A_1 \symdiff A_2 \symdiff \dotsb \symdiff A_k) \symdiff A_{k+1}$.
Pela definição de $\symdiff$, temos dois casos:
\endgraf
\case{Caso 1:}
$x \in A_1 \symdiff A_2 \symdiff \dotsb \symdiff A_k \mland x\notin A_{k+1}$.\CR
Pela H.I., $x$ pertence numa quantidade ímpar dos $A_1,\dotsc,A_k$, e não no $A_{k+1}$, então numa quantidade ímpar dos $A_1,\dotsc,A_{k+1}$.
\endgraf
\case{Caso 2:}
$x \notin A_1 \symdiff A_2 \symdiff \dotsb \symdiff A_k \mland x\in A_{k+1}$.\CR
Pela H.I., $x$ pertence numa quantidade par dos $A_1,\dotsc,A_k$ e no
$A_{k+1}$, então numa quantidade ímpar dos $A_1,\dotsc,A_{k+1}$.
\endgraf
\bigskip
\endgraf
(\rldirset):
Suponha que $x$ pertence numa quantidade ímpar dos $A_1,\dotsc,A_{k+1}$.
Separamos em dois casos:
\endgraf
\case{Caso 1:} $x \in A_{k+1}$.\CR
Logo $x$ pertence numa quantidade par dos $A_1,\dotsc,A_k$
e logo
$x\notin A_1\symdiff\dotsb\symdiff A_k$ (pela H.I.). 
Ou seja,
$x \in (A_1 \symdiff A_2 \symdiff \dotsb \symdiff A_k) \symdiff A_{k+1}$.
\endgraf
\case{Caso 2:} $x \notin A_{k+1}$.\CR
Nesse caso $x$ pertence numa quantidade ímpar dos $A_1,\dotsc,A_k$
e pela H.I.~temos que $x\in A_1\symdiff\dotsb\symdiff A_k$.
De novo,
$x \in (A_1 \symdiff A_2 \symdiff \dotsb \symdiff A_k) \symdiff A_{k+1}$.

\endproblem
%%}}}

%%{{{ arbitrary_finite_symdiff_gen 
\problem.
\label{arbitrary_finite_symdiff_gen}%
O que devemos mudar (e como) no~\ref{arbitrary_finite_symdiff} e sua resolução,
se apagar o ``$n \geq 2$''?

\hint
O que significa $A_1\symdiff\dotsb\symdiff A_n$ nesse caso?
Por quê?

\solution
Precisamos verificar que a expressão $A_1\symdiff\dotsb\symdiff A_n$ faz
sentido no caso que $n=0$, ou seja, definir razoavelmente a diferença simétrica
de uma seqüência vazia de conjuntos.
Formalmente verificamos que
$\emptyset\symdiff C = C = C\symdiff\emptyset$ para qualquer conjunto $C$:
$\emptyset$ é o elemento neutro da operação $\symdiff$, e logo o valor próprio
da expressão acima.
\endgraf
Na prova, a base muda para $n=0$, onde devemos apenas provar que nenhum $a$ pertence numa quantidade ímpar dos (zero) $A_i$'s, que é óbvio.

\endproblem
%%}}}

%%{{{ set_liminf_limsup 
\problem.
Seja $A$ um conjunto, e $\sequence A n$ uma seqüência de subconjuntos de $A$.
Sejam:
$$
\xalignat 2
A_* &= \Union_{i=0}^{\infty} \Inter_{j=i}^{\infty} A_j &
A^* &= \Inter_{i=0}^{\infty} \Union_{j=i}^{\infty} A_j
\endxalignat
$$
Como descreverias os elementos dos $A_*$ e $A^*$?
É verdade que um desses conjuntos é subconjunto do outro?
São iguais?  São disjuntos?

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

Podes achar boas explicações, dicas, muitos exemplos resovidos,
e exercícios e problemas para resolver no \cite[\S1.3~\&~\S2.4]{velleman}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Functions 
\chapter Funções.
\label{Functions}%

%%{{{ intro 
\chapintro
Nesse capítulo estudamos mais um \emph{tipo} importantíssimo e fundamental em
matemática: a \emph{função}.
Nosso objetivo aqui é familiarizar-nos com funções,
entender como podemos as definir, as usar, as combinar para criar novas,
operar nelas, etc.
\endgraf
Bem depois, no~\ref{Axiomatic_set_theory}, vamos nos preocupar com
a questão de \emph{como implementar} esse tipo, \emph{como fundamentar}
esse conceito---mas esqueça isso por enquanto.
Primeiramente precisamos entender bem o que é uma função e como se comporta.
%%}}}

%%{{{ Concept, notation, equality 
\section Conceito, notação, igualdade.
\label{Function_contept}%

%%{{{ unlabeled black box for function 
\note Funções como black boxes.
\tdefined{black box}[de função]%
\iisee{função!como black box}{black box}%
Começamos imaginando funções como black boxes (lembre o~\refn{blackbox_set}?)
mas esses black boxes são diferentes daqueles que usamos para conjuntos,
pois essas caixas tem uma entrada mas também uma saida própria:
$$
\tikzpicture
\tikzi blackboxfun;
\endtikzpicture
$$
%%}}}

%%{{{ df: function_pseudodefinition 
\pseudodefinition Função.
\label{function_pseudodefinition}%
\iisee{domínio}{função, domínio}%
\iisee{codomínio}{função, codomínio}%
\tdefined{função}[definição intuitiva]%
\tdefined{função}[domínio]%
\tdefined{função}[codomínio]%
\tdefined{função}[valor]%
Sejam $A,B$ conjuntos.
Chamamos $f$ uma \dterm{função de $A$ para $B$}, sse
para todo $x \in A$, o símbolo $f(x)$ é definido e $f(x)\in B$.
O $f(x)$ é o \dterm{valor} da $f$ no $x$.
O \dterm{domínio} da $f$ é o conjunto $A$,
e seu \dterm{codomínio} é o conjunto $B$.
Consideramos então que a função $f$ associa \emph{para todo} elemento $a \in A$,
\emph{exatamente um} elemento $f(a) \in B$.
%%}}}

%%{{{ df: function_notation 
\definition.
\label{function_notation}%
\sdefined {\holed f : \holed A \to \holed B} {$f$ é uma função de $A$ para $B$}%
\sdefined {\holed A \toarrow {\holed f} \holed B} {$f$ é uma função de $A$ para $B$}%
\sdefined {\dom {\holed f}} {o domínio da função $f$}%
\sdefined {\cod {\holed f}} {o codomínio da função $f$}%
\tdefined{ponto}[de conjunto]%
Escrevemos
$$
f : A \to B
\qqqqtext{e sinonimamente}
A \toarrow f B
$$
para dizer que \emph{$f$ é uma função de $A$ para $B$},
e escrevemos
$$
x \mapstoarrow f y
$$
para dizer que \emph{$f$ mapeia o $x$ para o $y$}.
Definimos também as operações $\dom$ e $\cod$
que retornam o domínio e o codomínio do seu argumento.
Resumindo:
$$
f : A \to B
\quad\defiff\quad
\text{$f$ é uma função}
\;\mland\;
\dom f = A
\;\mland\;
\cod f = B.
$$
As vezes o tipo da função aparece olhando para a direção oposta:
$f : B \from A$ em vez de $f : A \to B$.
Escrevemos também $f\app x$ em vez de $f(x)$,
e em certos casos (mais raros) até $x\app f$.
Podemos referir aos membros do domínio e do codomínio duma
função como \dterm{pontos} desses conjuntos.
%%}}}

%%{{{ df: endomapping 
\definition Endomapa.
\label{endomapping}%
\tdefined{endomapa}%
Uma função $f$ é um \dterm{endomapa} no $A$ sse $\dom f = \cod f = A$.
%%}}}

%%{{{ f : A -> B  and  A --f--> B  notations 
\note.
Escrevemos ``sejam $f,g : A \to B$'' e entendemos como:
``sejam funções $f$ e $g$ de $A$ para $B$'', e (abusando) se não temos já
declarados os conjuntos $A,B$, a mesma frase entendemos com um implicito
``sejam conjuntos $A,B$ e funções \dots''.
Do mesmo jeito, a frase
$$
\text{<<{Sejam $A \toarrow f B \toarrow g C$.}>>}
$$
pode se equivalente com a:
$$
\text{<<{Sejam conjuntos $A,B,C$, e funções $f:A\to B$ e $g:B\to C$.}>>}
$$
Espero que dá para apreciar a laconicidade dessa notação.
%%}}}

%%{{{ eg: succ and its black box 
\example.
A função $\namedfun{succ} : \nats\to\nats$
que retorna para cada natural $n$ seu sucessor $n+1$.
Dando por exemplo $2$ como entrada nela, observamos o valor
$\namedfun{succ}(2) = 3$:
$$
\tikzpicture
\tikzi blackboxfunsucc;
\endtikzpicture
$$
\endexample
%%}}}

%%{{{ function vs. application of function 
\note Função vs.~aplicação de função.
Em matemática muitas vezes falamos frases como as seguintes:
$$
\gather
\text{<<a função $\sin(x)$ é periódica>>}, \\
\text{<<a função $f(t)$ é monótona>>}, \\
\endgather
$$
etc.  Literalmente estamos falando algo errado!
As funções, nesse exemplo, são as $\sin$ e $f$, não as $\sin(x)$ e $f(t)$.
Denotamos com $\sin(x)$ o \emph{valor} da função $\sin$ no ponto $x$,
e com $f(t)$ o \emph{valor} da função $f$ no ponto $t$.
Claramente, esse ``erro'' é algo que não vai confundir nenhum matemático,
e com a mínima maturidade matemática não vamos encontrar problema nenhum
trabalhando assim.
Entendemos então que é apenas um ``modo de falar'' usado em certos casos.
Mas aqui nosso objetivo é estudar e \emph{fundamentar} bem a idéia e a ``alma''
dos vários tipos matemáticos, e não podemos nos permitir nenhum abuso desse tipo!
Essa distinção vai ficar ainda mais crucial, com a notação de $\lambda$-calculus
e com as funções de órdem superior.
%%}}}

%%{{{ The type of a function 
\note O típo duma função.
Seja $f : A \to B$.
Chamamos o ``$A \to B$'' o típo da $f$, e pronunciamos como
<<função de $A$ para $B$>>.
%%}}}

%%{{{ x: what_is_the_type_of_foo 
\exercise.
Aqui um programa escrito em C:
\sourcecode typefoo.c;
\endgraf\noindent
Qual é o típo desse $\code{x}$ no corpo da $\code{foo}$?
Qual o tipo da $\code{foo}$?
Cuidado: programadores de C (e C++, Java, etc.) tendem errar nessa última questão!

\hint
O típo de $\code{foo}$ não é $\code{int}$.
Se fosse $\code{int}$ mesmo, o $\code{foo}$ seria um $\code{int}$.

\solution
O tipo de $\code{x}$ é $\code{int}$.
O tipo de $\code{foo}$ é: ``função de $\code{int}$ para $\code{int}$''.
Programadores de $C$ muitas vezes erram nessa terminologia, dizendo que o típo de $\code{foo}$ é $\code{int}$.
Se fosse $\code{int}$ mesmo, o $\code{foo}$ seria um $\code{int}$.
O que eles querem dizer é que o \emph{return type} de $\code{foo}$ é $\code{int}$, e isso tá certo.
Mas a pergunta foi identificar o \emph{tipo} de $\code{foo}$.

\endexercise
%%}}}

%%{{{ df: function_space 
\definition.
\label{function_space}%
\tdefined{função}[espaço de]%
\sdefined {(\holed A \to \holed B)} {o conjunto das funções de $A$ para $B$}%
Sejam $A,B$ conjuntos.
O \dterm{espaço de funções} de $A$ para $B$ é o conjunto de todas as funções de
$A$ para $B$.  Denotamos-lo por $(A \to B)$ ou por $B^A$:
$$
(A \to B) \defeq B^A \defeq \setst f {f: A \to B}.
$$
%%}}}

%%{{{ Conditions: functionhood_conditions 
\note Condições.
\label{functionhood_conditions}%
\tdefined{função}[totalidade]%
\tdefined{função}[determinicidade]%
Na~\ref{function_pseudodefinition} aparece a frase
``o símbolo $f(x)$ é definido''.
Com isso entendemos que não existe ambigüidade, ou seja, para uma entrada $x$,
a $f$ não pode ter mais que uma saida.
E graças a outra frase, ``para todo $x\in A$'', sabemos que tem
\emph{exatamente uma} saida.  Esta saida é o que denotamos por $f(x)$.
\endgraf
Resumindo: para todo $x\in\dom f$,
\beginil
\item{(1)} existe pelo menos um $y\in\cod f$ tal que $x \mapstoarrow f y$ (\dterm{totalidade});
\item{(2)} existe no máximo  um $y\in\cod f$ tal que $x \mapstoarrow f y$ (\dterm{determinicidade}).
\endil
\noindent
Quando o (1) acontece dizemos que \emph{a $f$ é definida em todo o seu domínio}.
%%}}}

%%{{{ Arity and tuples 
\note Aridade e tuplas.
\ii{aridade}%
No jeito que ``definimos'' o que é uma função, ela só pode depender
em apenas um objeto, apenas uma entrada.
Isso parece bastante limitante, pois estamos já acostumados
com funções com aridades diferentes.%
\footnote{Lembra-se que \dterm{aridade} é a quantidade de
argumentos-entradas.}
Caso que uma função precisa mais que um argumento como entrada,
usamos a notação $f(x_1, \dotsc, x_n)$.
Identificamos isso com uma função que recebe ``apenas um'' objeto
como entrada: a $n$-tupla $\tup{x_1,\dotsc,x_n}$.
Então identificamos as notações
$$
\gather
f(x_1,\dotsc,x_n) = f( \tup{x_1,\dotsc,x_n} ) = f \tup{x_1,\dotsc,x_n}\\
f(x)              = f( \tup{x} )              = f \tup{x} = f \app x\\
f()               = f( \tup{}  )              = f \tup{}
\endgather
$$
onde na última linha as vezes identificamos com o próprio $f$ também
quando não existe possibilidade de confusão (mas vamos evitar isso aqui).
\endgraf
Similarmente, se queremos ``retornar'' mais que um objeto,
podemos ``empacotar'' todos eles numa tupla, e retornar apenas essa tupla,
satisfazendo assim a demanda de unicidade de função---cuidado pois isso
tem que ser refletido no codomínio da função!
%%}}}

%%{{{ Synonyms 
\note Sinônimos.
\tdefined{função!sinônimos}%
\iisee{mapeamento}{função}%
\iisee{mapa}{função}%
\iisee{map}{função}%
\iiseealso{operação}{função}%
\iiseealso{operador}{função}%
\iiseealso{procedimento}{função}%
Lembra que usamos várias palavras como sinônimos de ``conjunto''?
(Quais?)
Pois é, para funções a situação é parecida.
\emph{Dependendo do contexto e da ênfase},
as palavras seguintes podem ser usadas como
sinônimos de ``função'':
mapeamento,
mapa,
map,
operação,
operador,
etc.
%%}}}

%%{{{ Intension vs. extension 
\note Intensão vs{.}~extensão.
\label{intension_vs_extension_in_functions}%
Como nos conjuntos (\ref{Intension_vs_extension_in_sets}),
temos novamente a idéia de \dterm{intensão} e \dterm{extensão} de uma função.
Pensando uma função como uma caixa que dentro dela tem um \emph{programa},
a extensão dela não seria o que ela faz mesmo internalmente (isso seria sua
\emph{intensão}), mas o que ela \emph{consegue}.
Imaginando duas ``caixas pretas'' $f$ e $g$ onde podemos apenas observar
seus comportamentos usando os seus interfaces e nada mais, faz sentido
considerar iguais aquelas que não conseguimos demonstrar nenhum comportamento diferente.
Ou seja: qualquer entrada \emph{aceitável} para uma, deve ser \emph{aceitável}
para a outra também (pois, se não, isso já seria uma diferença observável);
e ainda mais, para a mesma entrada, as funções tem que atribuir o mesmo
valor---novamente: se não isso já seria um comportamento diferente e
observável.
%%}}}

%%{{{ Programs vs. functions 
\note Programas vs.~funções.
\label{programs_vs_functions}%
Considere as duas funções $\code{f}$ e $\code{g}$ implementadas no programa
seguinte em Python:
\sourcecode intext.py;
\endgraf\noindent
Suponha que queremos considerar ambas definidas nos inteiros.
A \emph{extensão} da $\code{f}$ é a mesma com a extensão da $\code{g}$.
Ou seja, como funções, temos $f = g$.
Suas \emph{intensões} são diferentes.
A primeira função, dado um número grande vai fazer bem mais operações até
finalmente retornar um valor.
Tente calcular as duas no interpretador de Python e também perceberás uma diferença
no tempo que cada uma precisa: compare os
$\code{f(1000000000)}$ e $\code{g(1000000000)}$.
Os \emph{programas} então são diferentes (pois num programa é a intensão que importa)
mas as funções são iguais.
Note que quando observamos caixas pretas, não podemos nem medir o tempo que
cada uma precisa para responder com seu valor, nem podemos tocar elas para ver
qual ficou mais quente, nem escutar para possíveis barulhos, etc.
Podemos apenas dar uma entrada e observar a saída e nada mais!
%%}}}

%%{{{ What about the codomain? (I) 
\note E o codomínio? (I).
\label{what_about_the_codomain_1}%
Em matemática clássica, e especialmente em teoria de
conjuntos~(\ref{Axiomatic_set_theory}) e análise,
em geral não consideramos que o codomínio duma função ``faz parte dela''.
Ou seja, a mesma função $\sin$, por exemplo, pode ser considerada como
$$
\xalignat3
\sin_1 &: \reals\to\reals     &
\sin_2 &: \reals\to[-1,1]     &
\sin_3 &: \reals\to(-\infty,2).
\endxalignat
$$
Para esse matemático então, \emph{o codomínio não é algo observável:}
como tu vai diferenciar entre as $\sin_1, \sin_2, \sin_3$ acima,
se teu único interface é dando objetos para elas, e observando seus valóres (saídas)?
Pois é, não tem como.
No outro lado, se alterar os domínios isso já é uma diferença demonstrável
(observável) com esse mesmo único interface.
%%}}}

%%{{{ x: how? 
\exercise.
Como?

\hint
O que significa que os domínios de duas funções são diferentes?

\solution
Se $f : A \to B$ e $g : C \to D$ são funções com $A\neq C$,
pela definição de igualdade de conjuntos, existe $x \in A\symdiff C$.
Para esse $x$, as funções vão comportar diferentemente.
Se $x \in A$ (e logo $x\notin C$), a $f$ vai aceitar o $x$
e vamos observar sua saida $f(x)$, mas a $g$ não vai aceitar
o $x$, e assim não vamos ver nenhuma saida;
Similarmente, se $x \in C$ (e logo $x\notin A$).

\endexercise
%%}}}

%%{{{ Recoverable or not? 
\note Recuperável ou não?.
\label{recoverable_or_not}%
Com esse ponto de vista, o domínio é um conjunto \emph{recuperável}
pela própria função $f$, pois podemos definir:
$$
\dom f
\defeq
\setstt x {$f(x)$ é definido}.
$$
Mas o codomínio não!
%%}}}

%%{{{ x: cod_wrongdef 
\exercise.
\label{cod_wrongdef}%
Qual o problema com essa suposta definição de codomínio de uma função $f$?:
$$
\cod f
\defeq
\setstt y {$f(x) = y$ para algum $x \in dom f$}.
$$

\hint
Aplique a $\cod$ nos $\sin_1,\sin_2,\sin_3$ do \ref{what_about_the_codomain_1}.

\solution
Aplicando essa definição de $\cod$ nas $\sin_1,\sin_2,\sin_3$ do \ref{what_about_the_codomain_1},
temos que
$$
\cod{\sin_1}
= \cod{\sin_2}
= \cod{\sin_3}
$$
mesmo que claramente não foi essa a nossa intenção.

\endexercise
%%}}}

\remark.
O conjunto definido no~\ref{cod_wrongdef} realmente é interessante e importante,
só que ele não é (necessariamente) o codomínio da função, mas o que chamamos de
range:

%%{{{ df: range 
\definition.
\tdefined{função}[range]%
\sdefined {\range {\holed f}} {o range da função $f$}%
Seja $f : A \to B$ função.
Seu \dterm{range} é conjunto
$$
\range f
\defeq
\setstt y {$f(x) = y$ para algum $x \in A$}.
$$
Observe que $\range f \subseteq B$.
%%}}}

%%{{{ x: what about these types for sin? 
\exercise.
Podemos considerar a função $\sin$ como uma função com os tipos seguintes?:
$$
\xalignat4
\sin_4 &: \rats \to \reals &
\sin_5 &: \reals\setminus\rats \to \reals\setminus\rats &
\sin_6 &: \rats \to \rats  &
\sin_7 &: \set{\pi} \to \set{0}
\endxalignat
$$

\solution
É fácil responder sobre as $\sin_4$ e $\sin_7$, pois realmente são
apenas restrições da função $\sin : \reals\to\reals$ (veja~\ref{fresto}).
Mas a situação com as $\sin_5$ e $\sin_6$ é bem mais complicada que isso!
Sobre a $\sin_5$, supondo que sabemos que $\pi \notin \rats$,
concluimos que o seu tipo está errado, pois $\sin(\pi) = 0 \notin \reals\setminus\rats$.
Note que para responder nisso precisamos saber a irracionalidade de $\pi$,
algo que não é trivial!
Mesmo sabendo disso, não é fácil responder sobre a $\sin_6$.
Seu tipo é realmente errado, pois
$$
\text{para todo $x \in \rats_{\neq0}$,  $\sin(x) \notin \rats$}
$$
mas a prova desse resultado é fora do escopo desse texto.
(Veja~\cite[Cor.~2.7]{nivenirrational} para mais detalhes.)
Ou seja, podemos considerar a $\sin$ com tipo
$$
\sin_8 : \rats_{\neq0} \to \reals\setminus\rats.
$$

\endexercise
%%}}}

%%{{{ remark: codomain is any superset of range 
\remark.
Seguindo o ponto de vista do~\refn{what_about_the_codomain_1},
tendo uma função $f : A \to B$,
podemos considerar ela como uma função com codomínio qualquer superconjunto de
$B$, sem mudar nada observável.
Em símbolos:
$$
f : A \to B  \mland  \range f \subseteq B'  \implies  f : A \to B'.
$$
Esse ponto de vista, identifica funções com gráficos iguais,
mas nem definimos ainda o que é um gráfico de função.
É o seguinte.
%%}}}

%%{{{ df: function_graph 
\definition.
\label{function_graph}%
\tdefined{função!gráfico}%
\sdefined{\graph{\holed f}} {o gráfico da função $\holed f$}%
Dado função $f : X\to Y$, o \dterm{gráfico da $f$}, é o conjunto
$$
\graph f \defeq \setst {\tup{x,f(x)}} {x \in X}.
$$
Observe que $\graph f \subseteq X\times Y$.
%%}}}

%%{{{ What about the codomain? (II) 
\note E o codomínio? (II).
\label{what_about_the_codomain_2}%
Em outras partes de matemática, especialmente em teoria das
categorias~(\ref{Category_theory}),
teoria dos típos~(\ref{Type_theory}),
e álgebra,
consideramos que o codomínio duma função faz parte dela sim!
Pensando em funções como black boxes então, com essa visão,
temos que imaginar que as caixas pretas tem dois rótulos
impressos: um na sua entrada com o domínio escrito nele,
e um na sua saida com o codomínio.
Assim, a diferença do condomínio vira uma coisa imediatamente
observável: é só olhar no rótulo da saida!
%%}}}

%%{{{ labeled black box for function 
\note Funções como black boxes com rótulos.
Com a ideia (II) de função visualizamos uma função
$f : A \to B$ assim:
$$
\tikzpicture
\tikzi blackboxfuncat;
\endtikzpicture
$$
%%}}}

%%{{{ Equality in functions 
\note Igualdade de funções.
Dependendo qual ponto de vista de função seguimos, a definição de igualdade
para o tipo de função vai ser diferente!
Mostramos primeiramente as definições corretas para o ponto de vista~(I)
e o ponto de vista~(II)
(explicados nos~\refn{what_about_the_codomain_1}~e~\refn{what_about_the_codomain_2}).
Depois, escrevendo num jeito diferente chegamos numa definição que vamos realmente usar,
e que é aplicável independente do ponto de visto.
Nesse texto vamos sempre deixar claro para cada função encontrada qual conjunto
consideramos como seu domínio e qual como seu codomínio.%
\footnote{Exceto numas partes onde esclarecemos qual a noção de função que
utilizamos.}
Assim, a escolha de ponto de vista de função não vai nos afetar.
%%}}}

%%{{{ df: f_eq_g_1 
\definition Igualdade (I).
\label{f_eq_g_1}%
Sejam $f,g$ funções.
Digamos que $f=g$ sse \emph{quaisquer duas} das afirmações seguintes são válidas:
\beginol
\li $\dom f = \dom g$;
\li para todo $x \in \dom f$, $f(x) = g(x)$;
\li para todo $x \in \dom g$, $f(x) = g(x)$.
\endol
\endgraf\noindent
Equivalentemente,
$$
f = g \defiff \graph f = \graph g.
$$
%%}}}

%%{{{ df: f_eq_g_2 
\definition Igualdade (II).
\label{f_eq_g_2}%
Sejam $f,g$ funções.
Digamos que $f=g$ sse 
\beginol
\li $\dom f = \dom g$;
\li $\cod f = \cod g$;
\li para todo $x \in \dom f$, $f(x) = g(x)$.
\endol
%%}}}

%%{{{ towards a flexible definition of equality 
\blah.
Aqui a definição ``flexível'':
%%}}}

%%{{{ df: f_eq_g 
\definition Igualdade.
\label{f_eq_g}%
Sejam $f,g : A\to B$ funções.
Definimos
$$
f=g
\defiff
\text{para todo $x \in A$, $f(x) = g(x)$.}
$$
%%}}}

\endsection
%%}}}

%%{{{ Internal and external diagrams 
\section Diagramas internos e externos.

%%{{{ Internal diagrams 
\note Diagramas internos.
\tdefined{diagrama}[interno]%
Em certos casos podemos representar toda a informação numa função
usando \dterm{diagramas internos}, ou seja, diagramas que mostram
o interno do domínio e codomínio duma função, e como ela comporta
nele.
%%}}}

%%{{{ eg: internal_diagram_example 
\example.
\label{internal_diagram_example}%
Aqui um diagrama interno de duas funções $A \toarrow f B \toarrow g C$:
$$
\tikzpicture
\tikzi internaldiagram;
\endtikzpicture
$$
Aqui o conjunto $A$ tem 2 membros---não importa quais são, ou seja,
os nomes deles---o $B$ tem 3, e o $C$ tem 2 também.
\endexample
%%}}}

%%{{{ Names of elements 
\note Nomes de elementos.
É muito comum desenhar esse tipo de diagramas para construir exemplos e
contraexemplos que involvem funções, e quando os \emph{quais são}
os membros não é importante desenhamos apenas um $\bullet$ para
representar os membros, com o entendimento que pontos distintos
representam membros distintos.
Note que \emph{se} quisermos definir formalmente um exemplo baseado num
desenho, nossa tarefa é trivial: é só escolher nomes para os $\bullet$
e pronto.
Por exemplo, dando esses nómes nos pontos
do~\ref{internal_diagram_example} chegamos no seguinte:
$$
\tikzpicture
\tikzi internaldiagramnames;
\endtikzpicture
$$
E agora para definir isso formalmente na escrita podemos apenas dizer:
Sejam os conjuntos
$$
A = \set{\mathrm a, \mathrm b} \qqqquad
B = \set{\mathrm c, \mathrm d, \mathrm e} \qqqquad
C = \set{\mathrm u, \mathrm v}
$$
e as funções $f : A\to B$ e $g : B\to C$ definidas pelas:
$$
\aligned
f(\mathrm a) &= e\\
f(\mathrm b) &= d
\endaligned
\qqqquad
\aligned
g(\mathrm c) &= u\\
g(\mathrm d) &= v\\
g(\mathrm e) &= v
\endaligned
$$
Observe que os $\mathrm a, \mathrm b, \mathrm c$, etc.~\emph{não são variáveis},
mas as próprias letras `a', `b', `c', etc.
Naturalmente escolhemos nomes bem conhecidos, como números, letras, etc.
%%}}}

%%{{{ remark: to what do those barred arrows correspond? 
\remark.
Então em que corresponde cada uma das setinhas barradas do diagrama interno?
Numa das \emph{equações} q definam a correspondente função,
ou seja, num par da forma $\tup{x, f(x)}$.
%%}}}

%%{{{ External diagrams 
\note Diagramas externos.
\tdefined{diagrama}[externo]%
Muitas vezes queremos olhar para a ``big picture'' e os detalhes
``internos'' da configuração não nos importam.
Pelo contrário, nos atrapalham: \emph{perdemos a floresta pelas arvores}.
Nesse caso usamos \dterm{diagramas externos}.
%%}}}

%%{{{ eg: external_of_previous_example 
\example.
\label{external_of_previous_example}%
O diagrama externo da configuração do~\ref{internal_diagram_example}
é o seguinte:
$$
A \tolongarrow f B \tolongarrow g C.
$$
\endexample
%%}}}

%%{{{ Diagrams of endomaps 
\note Diagramas de endomapas.
No caso especial que temos um endomapa $f:A\to A$,
podemos desenhar seu diagrama interno
sem usar duas cópias de $A$, mas apenas mostrando os mapeamentos assim
como o exemplo seguinte sugere.
%%}}}

%%{{{ eg: internal_diagram_of_endomap 
\example.
Considere o diagrama interno:
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi internaldiagramendo1;
\endtikzpicture
$$
Esse é o diagrama interno da função $f : A \to A$ definida pelas
$$
\xalignat8
f(1) &= 2; &
f(2) &= 1; &
f(3) &= 1; &
f(4) &= 4; &
f(5) &= 5; &
f(6) &= 8; &
f(7) &= 5; &
f(8) &= 5;
\endxalignat
$$
onde $A = \set {1,2,3,4,5,6,7,8}$.
\endexample
%%}}}

\endsection
%%}}}

%%{{{ How to define and how not to define functions 
\section Como definir e como não definir funções.

%%{{{ Q: what must we do to correctly define a function f : A -> B ? 
\question.
O que precisamos fazer para definir corretamente uma função?
%%}}}

%%{{{ A: We must make clear what its values are for all of its domain. 
\note Resposta.
Precisamos deixar claro qual é o seu domínio e o seu valor para cada ponto no
seu domínio.
Se consideramos que o codomínio da função faz parte dela também (veja conversa
no~\ref{Function_contept}), precisamos deixar claro seu codomínio também---aqui
sempre faremos isso.
%%}}}

%%{{{ Definition by expression 
\note Definição por expressão.
Uma das maneiras mais comuns para definir funções, é escrever algo do tipo:
\emph{Seja $f:A\to B$ a função definida pela \thole}
%%}}}

%%{{{ remark: what we define is f(x) not f 
\remark.
Literalmente, o que estamos definindo assim é o ``$f(x)$'' para todo $x \in A$,
e não o próprio $f$.  Mas, a $f$ sendo função, realmente é determinada para
seu comportamento (seus valóres) das todas as entradas possíveis do seu domínio,
então isso realmente defina a própria função $f$---graças a definição de igualdade
de funções.
%%}}}

%%{{{ eg: a polynomial function on reals 
\example.
Seja $f : \reals \to \reals$ definida pela
$$
f(x) = x^2 + 2x + 1, \qquad \text{para todo $x\in \reals$}.
$$
Em geral, cada polinómio de $n$ variáveis,
pode ser visto como uma função de aridade $n$.
\endexample
%%}}}

%%{{{ Definitive description 
\note Descrição definitiva.
\tdefined{descrição definitiva}%
Podemos definir uma função $f : A \to B$ dando uma \dterm{descrição definitiva}
do seu valor num ponto $x$ do seu domínio:
$$
f(x) = \text{aquele $b \in B$ que {\xlthole}}.
$$
Cuidado pois nesse caso precisamos verificar que realmente para cada $x\in A$,
existe exatamente um $b\in B$ que satisfaz a afirmação no {\xlthole}.%
%%}}}

%%{{{ Definitive descriptor 
\remark Descritor definitivo.
\tdefined{descritor definitivo}%
\sdefined {\descrsym} {descritor definitivo}%
Existe uma notação especial para a frase <<aquele $b$ que {\xlthole}>>:
o \dterm{descritor definitivo} $\descrsym$:
$$
\text{<<aquele $b$ que {\xlthole}>>} \quad\leadsto\quad \descr b {{\xlthole}}.
$$
Essa notação parece bastante com a $\lambda$-notação que encontramos logo
na~\ref{Lambda_notation}, mas é diferente pois na {\thole} aqui precisamos
algo que denota uma afirmação; na notação lambda algo que denota um objeto.
Aqui não vamos usar o descritor definitivo~$\descrsym$,
mas a $\lambda$-notação é importantíssima e ficaremos a usando o tempo todo.
Paciência até~\refn{Lambda_notation} então.
%%}}}

%%{{{ eg: mother_and_child_function_and_wannabe 
\example.
\label{mother_and_child_function_and_wannabe}%
Seja $\cal P$ o conjunto de todas as pessoas.
\emph{Queremos} definir as funções $m,c : \cal P \to \cal P$ pelas equações
$$
\align
m(p) &= \text{a mãe de $p$}\\
c(p) &= \text{a prole de $p$}
\endalign
$$
(onde ``mãe'' significa ``mãe biológica'').
Mas\dots
\endexample
%%}}}

%%{{{ x: mother_and_child_function_and_wannabe 
\exercise.
Ache o problema no~\ref{mother_and_child_function_and_wannabe} acima.

\hint
Lembe-se as condições no~\refn{functionhood_conditions}.

\endexercise
%%}}}

%%{{{ definition by cases (branching) 
\note Definição por casos (branching).
As vezes os valores $f(x)$ duma função $f$ não seguem o mesmo ``padrão'',
a mesma ``regra'' para todos os $x\in\dom f$.
%%}}}

%%{{{ eg: branching_example_1 
\example.
\label{branching_example_1}%
Seja $f : \reals \to \reals$ definida pela
$$
f(x)
=
\knuthcases{
x^2,     & se $x\in\rats$;\cr
0,       & se $x = \sqrt p$ para algum primo $p$;\cr
2x + 1,  & caso contrário.
}
$$
\endexample
%%}}}

%%{{{ beware: function_definition_by_cases_mistakes 
\beware.
\label{function_definition_by_cases_mistakes}%
Cada vez que definimos uma função por casos, precisamos verificar que:
\beginol
\li contamos para todos os casos possíveis da entrada;
\li não existe sobreposição inconsistente em nossos casos.
\endol
\noindent
Seguem uns exemplos que demonstram esses erros.
%%}}}

%%{{{ eg 
\example.
Definimos a função $f : \nats \to \nats$, pela
$$
f(n) = \knuthcases{
0, & se $n$ pode ser escrito como $3k$ para algum $k\in\nats$;\cr
k, & se $n$ pode ser escrito como $3k+1$ para algum $k\in\nats$.\cr
}
$$
Aqui o problema é que $f$ não foi definida para todo o seu domínio, pois
existem números (por exemplo o $2$) que não satisfazem nenhum dos casos da
definição da $f$.
\endexample
%%}}}

%%{{{ remark: use of otherwise 
\remark.
Para ter certeza que tomamos cuidado de todos os casos possíveis,
podemos descrer o último caso com um ``otherwise'' (ou ``caso contrário'').
Observe que as funções $f_1, f_2 : \nats \to \nats$ definidas pelas
$$
\align
f_1(n) &= \knuthcases{
0, & se $n$ pode ser escrito como $3k$ para algum $k\in\nats$;\cr
n, & se $n$ pode ser escrito como $3k+1$ para algum $k\in\nats$;\cr
2, & otherwise.\cr
}\\
f_2(n) &= \knuthcases{
0, & se $n$ pode ser escrito como $3k$ para algum $k\in\nats$;\cr
n, & otherwise.\cr
}\\
\endalign
$$
são realmente duas funções bem definidas e diferentes.
%%}}}

%%{{{ x: prove that they are different 
\exercise.
Prove que são diferentes!

\solution
Temos
$$
f_1(5) = 2 \neq 5 = f_2(5),
$$
logo $f_1 \neq f_2$.

\endexercise
%%}}}

%%{{{ eg: overlapping_inconsistent_cases 
\example.
\label{overlapping_inconsistent_cases}%
Definimos a função $g : \nats \to \nats$, pela
$$
g(n) = \knuthcases{
0,  & se $n$ é primo;\cr
1,  & se $n$ é par;\cr
12, & caso contrário.
}
$$
Aqui o problema é que não determinamos um único valor para cada membro do domínio da $g$.
Por exemplo o $2$, satisfaz os dois primeiros casos da definição acima.
Então $g(2) = 0$, pois $2$ é primo, e também $g(2) = 1$, pois $2$ é par!
Por isso essa $g$ é mal-definida, e não uma função.
\endexample
%%}}}

%%{{{ x: is g a well-defined function? 
\exercise.
A $h : \nats \to \nats$, definida pela
$$
h(n) = \knuthcases{
2n,  & se $n$ é primo;\cr
n+2, & se $n$ é par;\cr
12,  & caso contrário.
}
$$
é uma função bem-definida?

\hint
Qual é a sobreposição dos casos que aparecem na definição da $h$ e quais os
valóres da $h$ seguindo cada um deles?

\solution
A $h$ realmente é bem definida, mas isso não é imediatamente óbvio,
pois os dois primeiros casos na sua definição não são distintos,
e os valores que cada um escolhe para a $h$ são aparentemente diferentes.
Para provar que a $h$ é uma função bem definida 
precisamos ver quais são os membros do seu condomínio que satisfazem
mais que um caso (aqui os dois primeiros casos, pois o terceiro é o ``caso contrario'')
e verificar que o valor da $h$ para esses membros são os mesmos, independente
do caso escolhido.
O único número natural que é primo e par e o $2$.
Seguindo o primeiro caso temos
$$
h(2) = 2\ntimes 2 = 4,
$$
e seguindo o segundo caso temos
$$
h(2) = 2+2 = 4.
$$
Logo, a $h$ realmente é uma função bem definida.

\endexercise
%%}}}

%%{{{ remark: compatible cases (cases agree) 
\remark.
Quando dois casos diferentes duma definição de função atribuem os mesmos
valores para as mesmas entradas da sua sobreposição comum, dizemos que
são \emph{compatíveis}, ou que \emph{concordam}.
%%}}}

%%{{{ Else-if 
\note Else-if.  Programadores são bastante acostumados com o uso de
``else-if'', e isso é algo que podemos usar definindo funções por casos.
Alterando a definição da função do~\ref{overlapping_inconsistent_cases}
podemos realmente (bem) definir uma função $g : \nats \to \nats$ pela
$$
g(n) = \knuthcases{
0,  & se $n$ é primo;\cr
1,  & senão; se $n$ é par;\cr
12, & caso contrário.
}
$$
Assim, cada caso é necessariamente separado de todos os casos anteriores.
Em programação o múltiplo uso de ``else-if'', é chamado uma
\dterm{if-else-if ladder}.
%%}}}

%%{{{ defining_function_by_formula 
\note Por fórmula.
\label{defining_function_by_formula}%
Outro jeito para definir uma função $f : A \to B$, é
determinar completamente quando é que $f(x) = v$,
para todo $x\in A$ e $v \in B$:
$$
f(x) = v \defiff \tunderbrace {\phi(x,v)} {function-like}.
$$
Onde a fórmula (ou a afirmação) $\phi(x,v)$ deve ser \dterm{function-like}
no $A$, ou seja, $\phi$ é tal que para todo $x\in A$, exatamente um $v \in B$
satisfaz a $\phi(x,v)$.
\footnote{Pode olhar também na definição formal disso,~\refn{functionlike}.}
%%}}}

%%{{{ x: welldefined_functionlike
\exercise.
\label{welldefined_functionlike}%
As ``funções'' em baixo são bem definidas?
$$
\xalignat2
f &: \reals_{\geq0} \to \reals &
f(x) = y &\defiff y^2 = x \\
g &: \nats \to \nats &
g(x) = y &\defiff y^2 = x \\
h &: \reals \to \reals &
h(x) = y &\defiff \text{$y$ é o maior inteiro que satisfaz $y \leq x$} \\
u &: \ints^2 \to \ints &
u(x,y) = z &\defiff \text{$z$ é primo} \mland z\divides x+y; \\
v &: \ints^2 \to \ints &
v(x,y) = z &\defiff \text{$z$ é o menor primo tal que $z\divides x+y$}.
\endxalignat
$$
Justifique tuas refutações.

\solution
A $f$ não é bem definida: perdemos a unicidade; pois, por exemplo, como $1^2 = 1 = (-1)^2$, o $f(1)$ fica sem valor unicamente determinado.
\endgraf
A $g$ não é bem definida: perdemos a totalidade; pois para o $2\in\nats$
por exemplo, não existe nenhum $y\in\nats$ com $y^2 = 2$.
\endgraf
A $h$ realmente é bem definida, conhecida como ``floor''.
\endgraf
A $u$ não é bem definida: perdemos a unicidade; por exemplo o
$u(1,5)$ fica sem valor determinado, pois $2$ é primo e $2 \divides 6$ mas $3$ também é primo e $3\divides 6$.
\endgraf
A $v$ também não é bem definida: perdemos a totalidade; por exemplo o
$v(0,1)$ fica sem valor nenhum, pois nenhum primo divide o $0+1=1$.

\endexercise
%%}}}

%%{{{ defining_function_by_graph 
\note Por gráfico.
\label{defining_function_by_graph}%
Podemos definir uma função $f : A \to B$ se definir qual é o seu
gráfico $\graph f$.  Observe que do gráfico já podemos recuperar
o domínio mas o codomínio não (veja~\refn{recoverable_or_not}).
Então basta so deixar isso claro e pronto.
Claro que precisamos tomar cuidado: o gráfico tem que satisfazer
as condições de ser função: totalidade e
determinicidade~(\ref{functionhood_conditions}).
Olhando apenas para o gráfico, só a determinicidade pode ser
quebrada.  Mas se o domínio foi especificado separadamente,
precisamos verificar a totalidade também.
(Aqui vamos sempre deixar claro o domínio e o codomínio.)
Seguem uns exemplos.
%%}}}

%%{{{ eg: defining_function_by_graph_eg 
\example.
\label{defining_function_by_graph_eg}%
Sejam $A = \set{0,1,2,3}$ e $f : A \to \nats$ a função com gráfico
$$
\graph f = \set{ \tup{0,0}, \tup{1,1}, \tup{2,4}. \tup{3,2} }.
$$
Temos, por exemplo, $f(0) = 0$ e $f(2) = 4$.
\endexample
%%}}}

%%{{{ x: which_of_the_graphs_define_functions 
\exercise.
Quais dos gráficos abaixo definam funções com codomínio o $\nats$?
Quais os seus domínios recuperados por seus gráficos?
$$
\align
\graph f &= \set{ \tup{0,1}, \tup{2,4}, \tup{3,8}, \tup{1,2} } \\
\graph g &= \set{ \tup{0,12^{12}} } \\
\graph h &= \set{ \tup{0,1}, \tup{1,1}, \tup{0,1}, \tup{8,1}, \tup{3,2} } \\
\graph k &= \set{ \tup{\nats,0}, \tup{\ints,0}, \tup{\rats,0}, \tup{\reals,1} } \\
\graph r &= \emptyset \\
\graph s &= \set{ \tup{0,0}, \tup{1,1}, \tup{2,2^3}, \tup{3,3^{-1}} } \\
\graph t &= \set{ \tup{3,0}, \tup{2,0}, \tup{2,1}, \tup{2,7} } \\
\graph w &= \set{ \tup{0,0}, \tup{\tup{1,2},2}, \tup{\tup{12,12},2}, \tup{\tup{0,1,0,0},1} }
\endalign
$$

\solution
Temos:
$$
\xalignat2
f &: \set{ 0,1,2,3 } \to \nats &
r &: \emptyset \to \nats \\
g &: \set{ 0 } \to \nats &
s &: \text{não é (codomínio errado)} \\
h &: \set{ 0,1,3,8 } \to \nats &
t &: \text{não é (quebrou determinicidade)} \\
k &: \set{ \nats,\ints,\rats,\reals } \to \nats &
w &: \set{ 0, \tup{1,2}, \tup{12,12}, \tup{0,1,0,0} } \to \nats
\endxalignat
$$

\endexercise
%%}}}

\blah.
Ainda não encontramos a notação mais interessante para definir funções.
Vamos estudá-la logo; ela merece uma secção própria (\ref{Lambda_notation}).
Antes disso, vamos ver mais uma maneira de definir funções: com buracos!

\endsection
%%}}}

%%{{{ Holed expressions 
\section Expressões com buracos.

%%{{{ What is a holed expression? 
\note O que é uma expressão com buraco?.
\tdefined{buraco}%
Podemos criar uma função através duma expressão,
escolhendo um dos objetos que aparecem nela e o substituindo por um \dterm{buraco}.
Criamos assim \emph{aquela função} que recebendo um argumento,
retorna a expressão criada botando sua entrada no buraco da expressão.
Usamos $\bhole$, $\dhole$, e $\_$, para denotar esses buracos.
%%}}}

%%{{{ eg: holed_expression 
\example.
\label{holed_expression}%
Considere a expressão
$$
\align
\cos(1 + 5\cbrt2)^{2a} + \sin(5)&.
\intertext{Qual o típo dela?
Ela denota um número real, ou seja,}
\cos(1 + 5\cbrt2)^{2a} + \sin(5) &: \reals.
\intertext{Escolhemos um objeto nela e botamos um buraco no seu lugar:}
\cos(\bhole + 5\cbrt2)^{2a} + \sin(5)&.
\intertext{Assim criamos uma função.
Qual o típo dela?
Para decidir o domínio dela, olhamos para o típo do objeto
substituido por esse buraco.  Nesse caso, consideramos $1 : \reals$, então
temos}
\cos(\bhole + 5\cbrt2)^{2a} + \sin(5) &: \reals \to \reals
\intertext{
Uma outra opção seria escolher o $2$ no $5\cbrt2$, ou até o próprio $5\cbrt2$,
criando assim a função}
\cos(1 + \bhole)^{2a} + \sin(5) &: \reals \to \reals
\endalign
$$
do mesmo típo.
\endexample
%%}}}

%%{{{ more than one hole 
\blah.
Podemos botar mais que um buraco na mesma expressão,
assim criando funções de aridades maiores.
Seguimos a convenção que os seus argumentos são botados
nos buracos que aparecem na ordem de esquerda para direita,
e de cima pra baixo.
%%}}}

%%{{{ eg: holed_expression_many 
\example.
\label{holed_expression_many}%
Considere de novo a expressão
$$
\align
\cos(1 + 5\cbrt2)^{2a} + \sin(5) &: \reals,
\intertext{mas agora bote os buracos}
\cos(\bhole + 5\cbrt2)^{2\bhole} + \sin(\bhole)&.
\intertext{Qual o típo dessa função?
Cada um dos buracos está esperando receber um real,
ou seja:}
\cos(\bhole + 5\cbrt2)^{2\bhole} + \sin(\bhole)&:\reals^3\to\reals
\intertext{Uma outra opção seria criar a função}
\cos(1 + \bhole\cbrt\bhole)^{\bhole a} + \sin(\bhole) &: \reals^4 \to \reals,
\endalign
$$
etc.
\endexample
%%}}}

%%{{{ x: calculate_holes 
\exercise.
Calcule:
\beginol
\li $(2 + \bhole)(40)$;
\li $(\bhole + 2\bhole)(2,4)$;
\li $(\dhole \ntimes 2^{\dhole})(3,0)$;
\li $(\set{1,2,3} \union \dhole)(\set{2,8})$.
\endol

\solution
Calculamos:
$$
\align
(2 + \bhole)(40) &= 2 + 40 = 42 \\
(\bhole + 2\bhole)(2,4) &= 2 + 2^4 = 18 \\
(\dhole \ntimes 2^{\dhole})(3,0) &= 3 \ntimes 2^0 = 3 \\
(\set{1,2,3} \union \dhole)(\set{2,8}) &= \set{1,2,3} \union \set{2,8} = \set{1,2,3,8}
\endalign
$$

\endexercise
%%}}}

%%{{{ remark: fractions and the symbol of division 
\remark.
Da expressão
$$
\frac 1 2 : \rats
$$
podemos criar as funções
$$
\xalignat3
\frac {\bhole} 2 & : \ints \to \rats &
\frac 1 {\bhole} & : \ints_{\neq0} \to \rats &
\frac {\bhole} {\bhole} & : \ints\times\ints_{\neq0} \to \rats
\endxalignat
$$
Agora o símbolo $\div$ da operação binária de divisão que aparece nos calculadores
talvez faz mas sentido, né?
%%}}}

%%{{{ Limitations 
\note Limitações.
Para um uso simples e rápido as expressões com buracos oferecem uma
ferramenta muito útil.  Mas, temos umas limitações importantes:
\beginol
\li Não podemos ``ligar'' dois ou mais buracos para representar
a idéia que o mesmo argumento vai ser copiado em todos eles.
\li Não podemos escolher a órdem que os argumentos da função
criada vão preencher os buracos.
\endol
Finalmente vamos estudar a notação lambda e com ela vamos
superar essas limitações facilmente!
%%}}}

\endsection
%%}}}

%%{{{ The lambda notation 
\section A notação lambda.
\label{Lambda_notation}%

%%{{{ Useless namings 
\note Nomeamentos inúteis.
\label{useless_namings}%
Imagine que precisamos identificar uma certa função dum conjunto $A$ prum
conjunto $B$, e depois de muitos cálculos e usando várias outras funções
e objetos dados pelo nosso problema, concluimos com a frase:
\emph{<<\dots a função desejada é aquela função que recebendo como entrada
um número $x$, ela retorna o $2x+5$.>>}.
Vamos isolar esta subfrase:
$$
\text{aquela função que recebendo como entrada um número $x$, retorna o \thole$x$\thole}.
$$
O que ela denota?
Claramente uma função.
Mas qual é o \emph{nome} dessa função?
Pois é, ela não tem.
É uma função \emph{anônima}.
Isso talvez aprece estranho, mas acontece o tempo todo com outros típos
de objetos matemáticos, por exemplo com números.
Falamos
$$
\text{<<a área dum triângulo com báse $b$ e altura $h$ é $bh/2$>>}
$$
sem nenhuma obrigação de nomear essa área com um nome para a usar;
e ninguém reclama.
Se tivessimos essa obrigação deveriamos falar:
$$
\text{<<\dots seja $a = bh/2$.  A área do triângulo é $a$.>>}
$$
Claramente isso é inútil.
Introduzimos um novo nome apenas para o referir logo após e nunca mais.
Em nossa última frase ``a área do triângulo é $a$'', a informação
nem é mais visível.  O leitor vai ter que lembrar qual foi a definição desse $a$,
ou ir procurar achá-la.
Obviamente a abordagem anterior é melhor.
\endgraf
Para usar um exemplo de ``nomeamento inútil'' em programação, considere
as funções seguintes em Python, cada uma programada por um programador diferente:
\sourcecode uselessnaming.py;
\endgraf\noindent
Como funções são iguais, mas o programador que programou $\code{g}$,
fez algo estranho.
Decidiu nomear a expressão $\code{2 * x + 1}$ com o nome $\code{r}$,
e a única coisa que ele fez com esse $\code{r}$, foi returnar seu
valor.  Pra quê isso programador?
%%}}}

%%{{{ From words to lambda 
\note De palavras para lambda.
Voltamos na frase
$$
\text{``aquela função que recebendo como entrada um $x$,
retorna o \thole$x$\thole''}
$$
onde <<\thole$x$\thole>> é uma expressão que determina um único objeto e que,
possivelmente depende (refere) no $x$, como aconteceu por exemplo com o $2x+5$ acima.
Se essa frase realmente determina uma função, então podemos também
definir uma função \dterm{epônima}\ii{epônima}~(``com nome'') quando desejamos,
escrevendo:
$$
\gather
\text{Seja $f : A \to B$ tal que}\\
\text{$f \defeq \text{aquela função que recebendo\dots}$}.
\endgather
$$
Mas escrever todo isso toda vez que queremos ``construir'' uma função anônima
é muito chato.  Bem vindo $\lambda$ (lambda) da notação de
$\lambda$-calculus~(\ref{Lambda_calculus})!
Escrevemos apenas
$$
\lam x {2x+5}
$$
para a frase:
$$
\overbrace{\text{aquela função que recebendo como entrada um número}}^{\dsize\lambda}~~x~~\overbrace{\text{, retorna o}}^{\dsize.}~~2x+5.
$$
%%}}}

%%{{{ df: lambda_abstraction 
\definition.
\label{lambda_abstraction}%
\tdefined{$\lambda$-abstracção}%
\tdefined{$\lambda$-abstracção}[corpo]%
\sdefined {\lam {\holed x} {\thole}} {$\lambda$-abstracção}%
A expressão
$$
\lam x {\text{\thole$x$\thole}}
$$
é chamada \dterm{$\lambda$-abstracção} e \emph{denota uma função}:
$$
\text{``aquela função que recebendo como entrada um $x$,
retorna o \thole$x$\thole''}
$$
Supomos aqui que o domínio e codomínio são claros pelo contexto.
Chamamos a parte ``\thole$x$\thole'' o \dterm{corpo} da abstracção.
%%}}}

%%{{{ remark: lambda_is_a_binder & alpha_equiv_first_contact 
\remark.
\label{lambda_is_a_binder}%
\label{alpha_equiv_first_contact}%
O $\lambda$ é um \emph{ligador de variável}.
Todos os $x$ que aparecem livres no \thole$x$\thole
viram ligados com o $x$ do $\lambda x$.
Naturalmente consideramos funções que são diferentes apenas nos
nomes das variáveis ligadas como iguais.
Por exemplo:
$$
\lam x x = \lam y y.
$$
Compare com programação onde uma troca \emph{com cuidado} de variáveis
resulta em programas e procedimentos equivalêntes.
Precisamos tomar os mesmos cuidados aqui, mas deixamos esses
detalhes para o~\ref{Lambda_calculus}.
%%}}}

\blah.
Então:
o $\lambda$ nos permite criar funções anônimas numa maneira simples e útil.
E o que podemos fazer com uma expressão dessas?
Tudo que podemos fazer com uma função!

%%{{{ eg: applying an anonymous function to an argument 
\example.
Calculamos:
$$
\align
(\lam x {2x+5})(4) &= 2\ntimes 4 + 5 = 13 \\
(\lam x x)(2)      &= 2 \\
\endalign
$$
Em geral omitimos as parenteses no argumento, escrevendo:
$$
\plam x {2x+5} \lapp 4, \qquad
\plam x x \lapp 2, \qquad
\text{etc.},
$$
algo que acontece com funções epônimas também (veja~\ref{function_notation}).
\endexample
%%}}}

%%{{{ dot-till-end convention 
\note Convenção.
Para evitar uso excessivo de parenteses, acordamos que o corpo duma
$\lambda$-abstracção extende o maior possível, por exemplo:
$$
\plam x {x + y + z}
\qqtext{significa}
\plam x {\paren{x + y + z}}.
$$
%%}}}

%%{{{ x: calculate lambda reductions 
\exercise.
Calcule os seguintes:
\beginol
\li $\plam x x \lapp 5$;
\li $\plam y {42} \lapp 5$;
\li $\plam z x \lapp 5$;
\li $\plam x {x+1} \lapp 41$;
\li $\plam x {2 + \plam y {3y} \lapp 5} \lapp 3$;
\li $\plam x {2 + \plam y {3y} (x^2) } \lapp 3$;
\li $\plam x {2 + \plam y {xy} \lapp 4 } \lapp 3$.
\endol
\noindent
Não se preocupe se uns deles parecem errados ou bizarros,
nem se tu errar calculando uns deles.

\solution
Calculamos:
$$
\align
\plam x x \lapp 5 &= 5 \\
\plam y {42} \lapp 5 &= 42 \\
\plam z x \lapp 5 &= x \\
\plam x {x+1} \lapp 41 &= 41 + 1 = 42 \\
\plam x {2 + \plam y {3y} \lapp 5} \lapp 3 &= 2 + \plam y {3y} \lapp 5 = 2 + 3\ntimes 5 = 17 \\
\plam x {2 + \plam y {3y} (x^2) } \lapp 3 &= 2 + \plam y {3y} (3^2) = 2 + 3\ntimes 3^2 = 29 \\
\plam x {2 + \plam y {xy} \lapp 4 } \lapp 3 &= \plam x {2 + x\ntimes 4} \lapp 3 = 2 + 3 \ntimes 4 = 14.
\endalign
$$

\endexercise
%%}}}

%%{{{ x: eta_conversion_first_encounter 
\exercise.
\label{eta_conversion_first_encounter}%
Seja $f : A \to B$.
Qual nome tu daria para a função $\lam x {f\app x}$?
Lembre-se que graças as convenções notacionais essa expressão é a mesma com a
$\lamp x {f(x)}$.

\hint
Como a função $\lam x {f \app x}$ comporta?

\solution
$f$.

\endexercise
%%}}}

%%{{{ df: barred arrow 
\definition.
\label{mapsto}%
\tdefined{setinha barrada}%
\sdefined {(\holed x \mapsto \holed{\thole x \thole})} {função anônima}%
Uma notação diferente usada em matemática para criar funções anônimas
utiliza a \dterm{setinha barrada} $\mapsto$:
$$
\text{escrevemos}\qquad
(x \mapsto \thole)
\qqtext{como sinônimo de}
\lam x {\thole}.
$$
%%}}}

%%{{{ remark: we won't use mapsto, we'll use lambdas instead 
\remark.
Não vamos usar muito a notação $(x \mapsto \thole)$.
Pois a notação $\lam x {\thole}$ serve bem melhor para a maioria dos nossos usos.
%%}}}

\endsection
%%}}}

%%{{{ Empty (co)domains 
\section (Co)domínios vazios.

%%{{{ x: f_from_A_to_emptyset 
\exercise.
\label{f_from_A_to_emptyset}%
Seja $f : A \to \emptyset$.
O que podemos concluir sobre o $A$?
Quantas funções têm esse tipo?

\hint
O que significa ser função?

\solution
$A=\emptyset$, pois, caso contrario, pegando um $a\in A$,
chegamos na contradição $f(a) \in \emptyset$.
Quantas funções $f$ têm esse tipo?
Vamos resolver isso logo: veja~\ref{emptyfun} e~\ref{uniqueness_of_emptyfun}.

\endexercise
%%}}}

%%{{{ x: f_from_emptyset_to_A 
\exercise.
\label{f_from_emptyset_to_A}%
Seja $f : \emptyset \to A$.
O que podemos concluir sobre o $A$?
Quantas funções têm esse tipo?

\endexercise
%%}}}

%%{{{ df: emptyfun 
\definition Função vazia.
\label{emptyfun}%
\tdefined{função}[vazia]%
\iisee{vazia!função}{função, vazia}%
Uma função $f$ com $\dom f = \emptyset$ é chamada \dterm{função vazia}.
%%}}}

%%{{{ x: uniqueness_of_emptyfun 
\exercise.
\label{uniqueness_of_emptyfun}%
<<Uma>> ou <<a>>?

\solution
<<A>> mesmo!
Tome $f,g$ funções vazias.
Logo $f : \emptyset \to A$ e $g : \emptyset \to B$ para alguns conjuntos $A,B$.
Vacuamente temos que para todo $x\in \emptyset$, $f(x) = g(x)$.

\endexercise
%%}}}

\endsection

%%}}}

%%{{{ Composition 
\section Composição.

%%{{{ Composition with black boxes 
\note Composição com black boxes.
Suponha que temos uma configuração de conjuntos e funções assim:
$$
A \toarrow f B \toarrow g C.
$$
Note então que a saida da $f$ pode ser usada como entrada para
a $g$:
$$
\tikzpicture
\tikzi blackboxfuncomp1;
\endtikzpicture
$$
Podemos criar um novo black box, conectando os ``cabos'' assim:
$$
\tikzpicture
\tikzi blackboxfuncomp2;
\endtikzpicture
$$
Pintamos preta essa construção, botando os rótulos certos
de domínio e codomínio, e pronto:
$$
\tikzpicture
\tikzi blackboxfuncomp3;
\endtikzpicture
$$
Criamos assim a composição $g\of f$ das funções $f$ e $g$.
Formalmente, chegamos na definição seguinte.
%%}}}

%%{{{ df: fcompose 
\definition.
\label{fcompose}%
\tdefined{função}[composição]%
\iisee{composição!de funções}{função, composição}%
Sejam
$A \toarrow f B \toarrow g C$.
Definimos a função $g\of f : A\to C$ pela
$$
\paren{g\of f}(x) \defeq g\paren{f(x)}.
$$
Assim temos
$$
\xalignat2
\dom (g\of f) &= \dom f &
\cod (g\of f) &= \cod g.
\endxalignat
$$
Chamamos a $g\of f$ a \dterm{composição} da $g$ seguindo a $f$
(ou ``da $g$ com $f$'', ou ``$g$ de $f$'').
%%}}}

%%{{{ beware: gof_not_fog 
\beware.
\label{gof_not_fog}%
\label{digramatic_notation}%
Escrevemos $g\of f$ e não $f\of g$ para a composição na~\ref{fcompose}!
Então quando temos $A\toarrow f B\toarrow g C$, a composição é
$A \toarrow {g\of f} C$, que parece o oposto da ordem das setinhas.
Definimos a notação alternativa
$$
f;g \defeq g\of f,
$$
chamada \dterm{notação diagramática}\ii{composição}[diagramática]\iisee{diagramática}{composição}, pois concorda com as setinhas do diagrama:
$$
A \toarrow {f;g} C.
$$
Mas vamos principalmente usar a notação $g\of f$ mesmo.
%%}}}

%%{{{ x: when_is_fog_defined 
\exercise.
\label{when_is_fog_defined}%
Sejam $A \toarrow f B \toarrow g C$.
Qual função é a $f \of g$?

\solution
Nem é definida a $f \of g$ no caso geral!
Para ser definida, é necessário e suficiente ter
$A = C$.

\endexercise
%%}}}

%%{{{ defining functions as compositions 
\note Definindo funções como composições.
Como $\of$ é uma operação de funções, ganhamos então mais uma maneira
de definir funções.
Dadas compóveis funções $A \toarrow f B \toarrow g C$ podemos
definir uma função $h : A \to C$ apenas escrevendo:
$$
\text{<<Seja $h = g\of f$.>>}
$$
Claramente (e seguindo a discussão no~\refn{useless_namings})
não precisamos dar um nome para essa função.
Podemos apenas falar sobre a $g\of f$, exatamente no mesmo
jeito que falamos do número $2\ntimes 8$ sem precisar
dar um nome pra ele!
%%}}}

%%{{{ why_not_compose_more 
\note Por quê não compor mais?.
\label{why_not_compose_more}%
Sejam $f : A \to B$ e $g : B' \to C$, e suponha que $B \subsetneq B'$.
É tentador definir uma função de composição $g\of f : A \to C$ pela
$$
(g\of f)(x) = f\big(f(x)\big) \quad \text{para todo $x\in A$}.
$$
No final das contas, para qualquer $x\in A$ temos $f(x)\in B$
e como $B\subsetneq B'$, também temos $f(x) \in B'$.
Então $g(f(x))$ é definido!
Ou seja, por quê não relaxar pouco a restrição que temos na definição
da composição
$$
\text{de}
\quad
\cod f = \dom g
\quad
\text{para}
\quad
\cod f \subseteq \dom g
\ \ \text{?}
$$
Usando black boxes, temos as funções
$$
\tikzpicture
\tikzi blackboxfuncompsubset0;
\draw[-Latex]  (1.5,0)  -- (0.5,0);
\draw[-Latex]  (-0.5,0) -- (-1.5,0);
\node (x)   at (4.5,0)    {$x$};
\node (fx) at (0,0)       {$f(x)$};
\node (gfx) at (-4.8,0)   {$g(f(x))$};
\endtikzpicture
$$
e queremos ``conectar os cabos'' para criar um novo black box
$$
\tikzpicture
\tikzi blackboxfuncompsubset0;
\draw [rounded corners=0mm]
      (-3,1)--(-3,-1)--(3,-1)--(3,1)--cycle;
\draw[-Latex]  (1.5,0) -- (-1.5,0);
\node (x)    at (4.5,0)     {$x$};
\node (gfx)  at (-4.8,0)    {$g(f(x))$};
\draw [rounded corners=0.25mm, fill=gray!50]
      (-0.3,0.04)--(-0.3,-0.04)--(0.3,-0.04)--(0.3,0.04)--cycle;
\endtikzpicture
$$
pintar ele preto e considerar como a $g\of f$ de $A$ para $C$ mesmo:
$$
\tikzpicture
\tikzi blackboxfuncompthree;
\node (x)   at (4.5,0)    {$x$};
\node (gfx) at (-4.8,0)   {$g(f(x))$};
\node (gof) at (0,0)      {$g\of f$};
\node (A)   at (2.7,0.7)  {$A$};
\node (C)   at (-2.7,0.7) {$C$};
\endtikzpicture
$$
Qual o problema com isso?
<<Nenhum>>, uns matemáticos responderiam, e ficariam usando esse tipo
de composição ``mais geral''.
Mas para a gente aqui, vamos supor que para motivos que não
importam---talvez religiosos, ou um TOC mesmo---\emph{não podemos}
conectar esse cabo no meio quando os conjuntos são diferentes:
\quote{
\emph{<<Não comporás funções $f$ e $g$ se $\cod f \neq \dom g$!>>}
}
Essa suposta restrição, na verdade não nos restringe---pelo contrário:
nos ajuda criar composições ``limpas'' sem gambiarras como essa
``fita durex'' no cabo conectando o $B$ com o $B'$!
Trabalhe agora no exercício seguinte para demonstrar exatamente isso!
%%}}}

%%{{{ x: inclusions_for_compositions 
\exercise.
\label{inclusions_for_compositions}%
Mostre como construir a função criada no~\ref{why_not_compose_more}
como composição de black boxes que contenha as $f$ e $g$ mas
sem nenhuma conexão ``proibida''.

\hint
Tu vai precisar definir uma terceira função $i$, e usar
seu black box na tua construção.

\hint
O que falta é decidir o que botar nos ``?'' abaixo,
e definir formalmente a função que corresponde nesta caixa:
$$
\tikzpicture
\tikzi blackboxfuncompsubset0;
\draw [rounded corners=0mm]
      (-3,1)--(-3,-1)--(3,-1)--(3,1)--cycle;
\draw[-Latex]  (1.5,0)  -- (0.5,0);
\draw[-Latex]  (-0.5,0) -- (-1.5,0);
\node (x)    at (4.5,0)     {$x$};
\node (gfx)  at (-4.8,0)    {$g(f(x))$};
\draw [rounded corners=0mm, fill=gray!10]
      (-0.5,0.5)--(-0.5,-0.5)--(0.5,-0.5)--(0.5,0.5)--cycle;
\node (i)  at (0,0)      {$?$};
\node (iS) at (0.3,0.3)  {$?$};
\node (iT) at (-0.3,0.3) {$?$};
\endtikzpicture
$$

\solution
Definimos a função $i : B \to B'$ pela regra
$$
i(x) = x,   \quad\text{para todo $x\in B$}.
$$
Seu black box então, parece assim:
$$
\tikzpicture
\draw [rounded corners=0mm, fill=gray!10]
      (-0.5,0.5)--(-0.5,-0.5)--(0.5,-0.5)--(0.5,0.5)--cycle;
\node (i)  at (0,0)      {$i$};
\node (iS) at (0.3,0.3)  {$B$};
\node (iT) at (-0.3,0.3) {$B'$};
\draw[-Latex]  (1.5,0)  -- (0.5,0);
\draw[-Latex]  (-0.5,0) -- (-1.5,0);
\endtikzpicture
$$
e é exatamente o ``missing link'' para construir nosso black box:
$$
\tikzpicture
\tikzi blackboxfuncompsubset0;
\draw [rounded corners=0mm]
      (-3,1)--(-3,-1)--(3,-1)--(3,1)--cycle;
\draw[-Latex]  (1.5,0)  -- (0.5,0);
\draw[-Latex]  (-0.5,0) -- (-1.5,0);
\draw [rounded corners=0mm, fill=gray!10]
      (-0.5,0.5)--(-0.5,-0.5)--(0.5,-0.5)--(0.5,0.5)--cycle;
\node (i)  at (0,0)      {$i$};
\node (iS) at (0.3,0.3)  {$B$};
\node (iT) at (-0.3,0.3) {$B'$};
\endtikzpicture
$$
Construimos e usamos então a $g\of i\of f : A \to C$
em vez da ``gambiarrada'' e proibida $g\of f$.
Essa função $i$ é chamada a \dterm{inclusão do $A$ no $B$}
que definimos na~\ref{inclusion_function}.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Functions for free 
\section Funções de graça.

\blah.
Investigamos aqui umas primeiras funções garantidas para existir assim que
tivermos alguns outros objetos: um conjunto, uma função, etc.

%%{{{ df: identity_function 
\definition Identidade.
\label{identity_function}%
\tdefined{função}[identidade]%
\sdefined {\id_{\holed A}} {a identidade do $\holed A$}
\iisee{identidade}{função, identidade}%
Seja $A$ conjunto.
A função $\lam x x : A \to A$ é chamada
\dterm{identidade do $A$}.
Denotamos a identidade do conjunto $A$ por $\id_A : A \to A$ ou $1_A : A \to A$.
%%}}}

%%{{{ x: id_compose_practice
\exercise.
\label{id_compose_practice}%
Sejam $A,B$ conjuntos diferentes, e $f : A \to B$.
Para cada uma das igualdades em baixo,
decida se ela é válida ou não, justificando tua resposta.
$$
\xalignat4
(1)\quad f &= {f \compose \id_A}; &
(2)\quad f &= {f \compose \id_B}; &
(3)\quad f &= {\id_A \compose f}; &
(4)\quad f &= {\id_B \compose f}.
\endxalignat
$$

\solution
\noindent (1)
Válida: a composição é definida, e se $a\in A$ então:
$$
\alignat2
(f \compose \id_A)(a)
&= f(\id_A(a))        \qqby{def.~$\compose$}\\
&= f(a)               \qqby{def.~$\id_A$}
\endalignat
$$
\endgraf
\noindent (2) e (3): as composições não são definidas
\endgraf
\noindent (4) Similar com (1): a composição é definida e se $a \in A$ então:
$$
\alignat2
(\id_B \compose f)(a)
&= \mathrm{id}_B(f(a)) \qqby{def.~$\compose$}\\
&= f(a)                \qqby{def.~$\id_B$}
\endalignat
$$

\endexercise
%%}}}

%%{{{ df: inclusion_function 
\definition Inclusão.
\label{inclusion_function}%
\tdefined{função}[inclusão]%
\sdefined {\holed f : \holed A \incto \holed B} {a inclusão do $A$ no $B$}%
Sejam $A,B$ conjuntos com $A\subseteq B$.
A função $\lam x x : A \to B$ é chamada \dterm{inclusão do $A$ no $B$}.
Frequentemente usamos os nomes $i,\iota$ para denotar uma inclusão
e escrevemos
$$
i : A \incto B
$$
para enfatisar que é uma inclusão mesmo.
Note que seguindo o ponto de vista categorial (\refn{f_eq_g_2}),
se $A \subsetneq B$ então $i \neq \id_A$,
mas seguindo o ponto de vista conjuntista (\refn{f_eq_g_1}),
temos $i = \id_A$.
%%}}}

%%{{{ df: constant_function 
\definition Constante.
\label{constant_function}%
\tdefined{função}[constante]%
Seja $f : A\to B$.
Chamamos a função $f$ \dterm{constante} sse ela mapea todos os membros
do seu domínio para o mesmo objeto.
Formulamente,
$$
\text{$f : A \to B$ constante}
\defiff
\lforall {x, y \in A} {f(x) = f(y)}.
$$
Dados conjuntos $A,B$, e $b\in B$, definimos a função constante
$$
k^A_b : A \to B
\qtext{com}
k^A_b(x) = b.
$$
Quando o $A$ é implícito pelo contexto, escrevemos apenas $k_b$.
%%}}}

%%{{{ x: constant_function_different_def 
\exercise.
\label{constant_function_different_def}%
As vezes aparece como definição de função constante a seguinte:
\emph{A função $f : A \to B$ é constante sse existe $b\in B$ tal que
para todo $x \in A$, $f(x) = b$.}
Essa definição é equivalente com a~\ref{constant_function}?

\hint
$\emptyset$.

\solution
Não.
Por exemplo a função vazia $f : \emptyset\to\emptyset$ é constante com
a~\ref{constant_function}, mas não com a definição do exercício.

\endexercise
%}}}

%%{{{ prop: constant_function_definitions_almost_agree 
\proposition.
\label{constant_function_definitions_almost_agree}%
Sejam $A \toarrow f B$ com $A \neq \emptyset$.
Prove que:
$$
\text{$f$ constante}
\iff
\pexists {b\in B}
\lforall {x\in A}
{f(x) = b}.
$$
\proof.
\lrdir:
Seja $a\in A$ ($A\neq\emptyset$).
Vamos mostramos que tomando $b\asseq f(a)$ a proposição na direita é satisfeita.
Observe que o $f(a)\in B$ e satisfaz
$$
\lforall {x\in A} {f(x) = f(a)}
$$
pela definição de constante.
\endgraf
\rldir:
Seja $b_0\in B$ tal que para todo $x\in A$, $f(x) = b_0$.
Agora para todo $x,y \in A$ temos $f(x) = b_0 = f(y)$ pela hipótese,
ou seja, $f$ é constante.
\qed
%%}}}

%%{{{ x: constant_function_which_definition_is_stronger 
\exercise.
\label{constant_function_which_definition_is_stronger}%
No caso geral, alguma das direções
da~\ref{constant_function_definitions_almost_agree} é valida ainda?

\solution
Sim, a {\rldir}.
Observe \emph{bem} que na prova dessa direção não precisamos $A\neq\emptyset$.
E pelo~\ref{constant_function_different_def} já sabemos que a {\lrdir} não é
valida em geral.

\endexercise
%%}}}

%%{{{ x: gof_constant_does_not_imply 
\exercise.
\label{gof_constant_does_not_imply}%
Prove ou refute a afirmação seguinte:
\emph{se $(g\compose f)$ é constante, então pelo menos uma das $f,g$ também é}.

\hint
Tente achar contraexemplo desenhando diagramas internos.

\solution
Falso.
Um contraexemplo é o seguinte:
$$
\tikzpicture
\tikzi gofconstantdoesnotimply;
\endtikzpicture
$$

\endexercise
%%}}}

%%{{{ x: wrong_order_of_quantifiers 
\exercise.
\label{wrong_order_of_quantifiers}%
O que é errado na definição seguinte de função constante?
$$
\text{$f:A\to B$ constante}
\defiff
\pforall {a \in A}
\lexists {b \in B} {f(a) = b}.
$$
Se substituir o $\exists$ por $\unique$, o problema tá resolvido?
Sugira uma outra resolução simples.

\hint
Siga essa definição e tente achar alguam função que não vai ser chamada
constante.

\solution
A definição tem o problema que vai aceitar toda função como constante,
pois o que ela exige é satisfeito por toda função.
Substituindo o $\exists$ por $\unique$ nada muda nesse sentido,
pois toda função satisfaz essa afirmação mais forte
(determinicidade de função).
\endgraf
O problema é que os quantificadores estão na ordem errada!
Simplesmente trocando a ordem deles, chegamos numa
definição equivalente à do~\ref{constant_function_different_def}:
$$
\text{$f:A\to B$ constante}
\defiff
\pexists {b \in B}
\lforall {a \in A}
{f(a) = b}.
$$

\endexercise
%%}}}

%%{{{ df: characteristic_funcion 
\definition Característica.
\label{characteristic_function}%
\tdefined{função}[característica]%
\iisee{característica}{função, característica}%
\sdefined {\chr_{\holed A, \holed X}} {a função característica do $\holed A$ no $\holed X$}%
Sejam $A,X$ conjuntos com $A\subseteq X$.
A \dterm{função característica do $A$ no $X$} é a função
$\chr_{A,X} : X \to \set{0,1}$ definida pela
$$
\chr_{A,X}(x) =
\knuthcases{
1, &se $x\in A$\cr
0, &se $x\notin A$.
}
$$
Escrevemos apenas $\chr_A$ quando o conjunto $X$ é implícito pelo
contexto---e na práctica esse é quase sempre o caso!
%%}}}

%%{{{ warning: characteristic_function_inverted_values 
\warning.
\label{characteristic_function_inverted_values}%
O uso de $1$ para representar ``true'' e o $0$ para o ``false'' é aleatório.
De fato, dependendo de caso, as vezes definímos a função característica
com esses valores invertidos!  Isso é muito comum em teoria de recursão
(veja~\cite{kleeneIM} por exemplo), mas não só:
nos shells de Unix\ii{Unix}[shell], também o valor $0$ representa o ``true''
e cada valor positivo um ``false'' (com $1$ sendo o padrão deles).
\endgraf
\emph{A moral da história:}
sempre verifique a definição da função característica
usada---e se quiseres usar num texto teu, sempre bota sua definição junto!
Nesse texto, quando aparece a notação $\chr_A$ sem definição,
denota a função que definimos acima na~\ref{characteristic_function}.
%%}}}

%%{{{ remark: replacing_cases_by_characteristic_functions 
\remark.
\label{replacing_cases_by_characteristic_functions}%
Um dos usos comuns de funções características é definir funções num jeito mais
curto, aproveitando os fato que $0x = 0$ e $1x = x$ para todo $x\in\reals$.
Esse uso lembra das expressões $\namedfun{if-then-else}$ que usamos
\emph{evitando} um ``if branching'' em liguagens de programação.
%%}}}

%%{{{ eg: replacing_cases_by_characteristic_functions_example 
\example.
\label{replacing_cases_by_characteristic_functions_example}%
Considere a $f : \reals \to \reals$ definida pela
$$
f(x) = \knuthcases{
2\cbrt{x + \log_2 |x+1|} + x^2, & se $x \in \rats$ \cr
2\cbrt{x + \log_2 |x+1|} + e^x, & caso contrário.
}
$$
Usando as funções características de $\rats$ e $\reals\minus\rats$
podemos definir a $f$ com uma equação só, e ``sem repetição'':
$$
f(x) = 2\cbrt{x + \log_2 |x+1|} + x^2 \chr_{\rats}(x) + e^x\chr_{\reals\minus\rats}(x).
$$
Isso lembra um
$$
f(x) = 2\cbrt{x + \log_2 |x+1|} + (\mathbf{if}~x\in\rats~\mathbf{then}~x^2~\mathbf{else}~e^x)
$$
usado em linguagens de programação que suportam if-then-else \emph{expressions}.
\endexample
%%}}}

%%{{{ x: char_compose_char 
\exercise.
Sejam $A,X$ conjuntos com $A\subseteq X$.
Suponha que $\chr_{A,X}\of\chr_{A,X}$ é definida.
O que podes concluir sobre o $X$?
Podemos concluir que a $\chr_A\of\chr_A$ é constante ou a identidade?

\hint
O fato que uma composição é definida dá informação sobre um domínio
e um codomínio envolvido.

\solution
Temos $\chr_A : X \to \set{0,1}$.
Como a composição $\chr_A \of \chr_A$ é definida,
concluimos que $\cod(\chr_A) = \dom(\chr_A)$.
Ou seja, $X = \set{0,1}$.
\endgraf
O $A$ sendo um subconjunto de $\set{0,1}$ so tem 4 possibilidades:
$$
\xalignat4
A &= \emptyset; &
A &= \set{0};   &
A &= \set{1};   &
A &= \set{0,1} = X.
\endxalignat
$$
Calculamos em todos os casos:
$$
\align
A = \emptyset &\implies
\left\{\aligned
(\chr_A \of \chr_A)(0) &= \chr_A(\chr_A(0)) = 0 \\
(\chr_A \of \chr_A)(1) &= \chr_A(\chr_A(1)) = 0
\endaligned\right. \\
A = \set{0} &\implies
\left\{\aligned
(\chr_A \of \chr_A)(0) &= \chr_A(\chr_A(0)) = \chr_A(1) = 0 \\
(\chr_A \of \chr_A)(1) &= \chr_A(\chr_A(1)) = \chr_A(0) = 1
\endaligned\right. \\
A = \set{1} &\implies
\left\{\aligned
(\chr_A \of \chr_A)(0) &= \chr_A(\chr_A(0)) = \chr_A(0) = 0 \\
(\chr_A \of \chr_A)(1) &= \chr_A(\chr_A(1)) = \chr_A(1) = 1
\endaligned\right. \\
A = X &\implies
\left\{\aligned
(\chr_A \of \chr_A)(0) &= \chr_A(\chr_A(0)) = 1 \\
(\chr_A \of \chr_A)(1) &= \chr_A(\chr_A(1)) = 1\,.
\endaligned\right.
\endalign
$$
Sobre a $\chr_A\of\chr_A$ então concluimos que
se $A$ é um dos singletons $\set{0}$ ou $\set{1}$ então ela é a identidade.
Caso contrario, ela é uma constante:
se $A = \emptyset$, a constante $0$; se $A = X$, a constante $1$.

\endexercise
%%}}}

%%{{{ df: fresto 
\definition Restrição.
\label{fresto}%
\tdefined{função}[restrição]%
\sdefined {\holed f \resto \holed X} {a restrição de $f$ no $X$}%
Sejam $f : A \to B$ e $X \subseteq A$.
A \dterm{restrição da $f$ no $X$}, denotada por
$\resfun f X$ é a função de $X$ para $B$ definida pela
$$
(\resfun f X)(x) = f(x).
$$
Tambem é usada a notação $\resfunsub f X$.
%%}}}

\endsection
%%}}}

%%{{{ Partial application 
\section Aplicação parcial.

%%{{{ Partial application with black boxes 
\note Aplicação parcial com black boxes.
Suponha que temos uma função de aridade~$2$:
$$
f : (A\times B) \to C.
$$
Ou seja, nossa função ``para funcionar'', precisa receber
exatamente~2~argumentos: algum $a\in A$ e algum $b\in B$.
$$
\tikzpicture
\tikzi blackboxfunpartapp1;
\endtikzpicture
$$
para ``produzir'' o valor $f(a,b) \in C$.
Queremos utilizar essa função de aridade~$2$,
para criar duas outras, cada uma de aridade~$1$.
A idéia é a seguinte: vamos ``fixar'' uma das suas entradas
com um valor, e deixar a outra como entrada mesmo.
Imagine que fixamos um certo $b_0\in B$ no segundo ``cabo'' de entrada,
puxamos o outro cabo, e criamos uma nova caixa assim:
$$
\tikzpicture
\tikzi blackboxfunpartapp2;
\endtikzpicture
$$
E agora pintamos preta nossa caixa, escrevemos seus rótulos (seu típo),
e pronto, construimos uma nova função de aridade $1$:
$$
\tikzpicture
\tikzi blackboxfunpartapp3;
\endtikzpicture
$$
Observe que temos $f(\dhole,b_0):A \to C$.
Vamos agora ver a mesma ideia usando buracos, sem black boxes.
%%}}}

%%{{{ Partial application using holes 
\note Aplicação parcial usando buracos.
Considere uma função $f$ de aridade 3:
$$
A \times B \times C \tolongarrow f D.
$$
Lembre-se que
$$
f(\dhole, \dhole, \dhole) :
A \times B \times C \to D
$$
e ainda mais $f(\dhole, \dhole, \dhole)$ é a propria $f$!
Queremos preencher uns desses buracos, mas não todos.
E nada especial sobre esse $3$.
Em geral, dada uma função $f$ de aridade $n$,
podemos \emph{fixar} $k$ dos seus argumentos
com certos valores, botar buracos nos ouros,
e criar assim uma função de aridade $n-k$.
Uns exemplos vão esclarecer esse processo.
%%}}}

%%{{{ eg: partial_application_holes_eg 
\example.
Considere a função $f : \reals^3 \to \reals$, definida pela
$$
f(x,y,z) = x + y^2 + z^3.
$$
Temos então
$$
\align
f(\dhole,\dhole,\dhole) &: \reals^3 \to \reals.
\intertext{Com aplicação parcial, fixando uns dos seus argumentos,
criamos então as funções seguintes:}
f(2,\dhole,\dhole)      &: \reals^2 \to \reals \\
f(2,\dhole,\sin(2))     &: \reals   \to \reals \\
f(\dhole,\sqrt2,\cbrt2) &: \reals^2 \to \reals \\
f(\dhole,0,0)           &: \reals   \to \reals.
\endalign
$$
A última, por exemplo, é a $\id_\reals$; a penúltima é a $\lam x {x+4}$.
\endexample
%%}}}

%%{{{ eg: partial_application_holes_infix_eg 
\example.
Aplicando a função de adição $+ : \nats^2 \to \nats$
parcialmente fixando seu segundo argumento no número $1$,
criamos a função
$$
\align
(\bhole + 1) &: \nats \to \nats
\intertext{que é a função $\namedfun{succ}$ de sucessor;
e fixando seu primeiro argumento no $0$ criamos a}
(0 + \bhole) &: \nats \to \nats
\endalign
$$
que é a $\id_\nats$.
\endexample
%%}}}

\endsection
%%}}}

%%{{{ Composition_laws 
\section Leis de composição.
\label{Composition_laws} 

%%{{{ Composition as an operation 
\note Composição como operação.
No mesmo jeito que o produto $3\ntimes 2$ denota um número,
a composição $g\of f$ de certas funções $f$ e $g$ denota uma função.
A $\of$ então realmente é uma operação (binária) nas funções,
e agora vamos investigar as leis que ela satisfaz, fazendo uma
comparação com a multiplicação nos números, procurando similaridades
e diferêncas.  Note que já começamos com uma certa ambigüidade
com esse ``nos números'', pois as leis satisfeitas
pela~$\ntimes$~dependem em \emph{qual multiplicação} estamos considerando:
a multiplicação nos reais, por exemplo, satisfaz a uma certa lei de inversos
(viz.~«cada número diferente de zero tem um inverso multiplicativo»)
mas nos inteiros não.  Mais sobre isso depois.
%%}}}

%%{{{ Totality 
\note Totalidade.
Primeiramente observe uma grande diferença entre composição e multiplicação:
a multiplicação é uma operação \dterm{total}, ou seja, para todo número
$x, y$, seu produto $x\ntimes y$ é definido.
Mas como vimos na~\ref{fcompose}, para formar a composição $g\of f$
de duas funções $f$ e $g$ elas precisam satisfazer a condição
$\cod f = \dom g$.  Caso contrário, o $g\of f$ nem tem significado!
Continuamos investigando mais propriedades.
%%}}}

%%{{{ Intuition with tasks 
\note Intuição com tarefas.
Vamos agora imaginar funções como tarefas para ser feitas em algo,
e a composição como a ideia de ``seqüenciar as tarefas''.
Ou seja $g\of f$ seria a tarefa ``fazer a tarefa $f$ e depois a $g$''.
Com essa intuição, parecem óbvias as duas afirmações
\beginol
\li a composição é associativa;
\li a composição não é comutativa.
\endol
\noindent
Mas intuição nunca provou nada sozinha, então bora provar essas afirmações!
%%}}}

%%{{{ Associativity 
\note Associatividade.
Suponha que temos funções
$$
A \toarrow f B \toarrow g C \toarrow h D.
$$
Podemos entao formar as composições $g\of f$ e $h\of g$.
Temos então:
$$
A \toarrow {g\of f} C \toarrow h D
\qqquad
A \toarrow f B \toarrow {h\of g} D.
$$
Compondo as funções do primeiro diagrama criamos a função $h\of(g\of f)$,
e compondo aquelas do segundo criamos a $(h\of g)\of f$:
$$
A \tolongarrow {h\of (g\of f)} D
\qqquad
A \tolongarrow {(h\of g)\of f} D.
$$
Queremos saber se as duas funções são iguais.
Vamos pensar sobre isso usando black boxes.
$$
\gathered
\tikzpicture
\tikzi blackboxfuncompassoc1;
\endtikzpicture \\
\tikzpicture
\tikzi blackboxfuncompassoc2;
\endtikzpicture
\endgathered
$$
Primeiramente observe que os tipos delas são iguais.
Então basta verificar que concordam para todo ponto $x\in A$.
Pela definição de composição sabemos que ``internalmente''
elas funcionam assim:
$$
\gathered
\tikzpicture
\tikzi blackboxfuncompassoc3;
\endtikzpicture \\
\tikzpicture
\tikzi blackboxfuncompassoc4;
\endtikzpicture
\endgathered
$$
Agora pelas definições das $g\of f$ e $h\of g$,
o que precisamos comparar na verdade são as:
$$
\gathered
\tikzpicture
\tikzi blackboxfuncompassoc5;
\endtikzpicture \\
\tikzpicture
\tikzi blackboxfuncompassoc6;
\endtikzpicture
\endgathered
$$
Agora que tá tudo transparente parece óbvio que as duas funções são iguais,
e comportam como a seguinte:
$$
\tikzpicture
\tikzi blackboxfuncompassoc0;
\endtikzpicture
$$
Mas para provar que as duas construções resultam na mesma função,
vamos precisar calcular os <<$?$>> do desenho acima, e seguir
fielmente as definições.
%%}}}

%%{{{ thm: associativity_of_fcom 
\theorem.
\label{associativity_of_fcom}%
Sejam
$$
A \toarrow f B \toarrow g C \toarrow h D.
$$
Então
$$
h \of (g \of f) = (h \of g) \of f.
$$
\sketch.
Mostramos que as duas funções são iguais seguindo a definição
de igualdade~\refn{f_eq_g}:
mostrando que elas tem o mesmo domínio $A$,
e que comportam igualmente para o arbitrário $a \in A$.
Observe que seus codomínios também são iguais, satisfazendo
assim a definição de igualdade~\refn{f_eq_g_2} também.
Pegando cada lado da igualdade e aplicando a definição de $\of$
chegamos no mesmo valor.
\qes
\proof.
Primeiramente vamos verificar que as duas funções tem o mesmo domínio:
$$
\alignat2
\dom\paren{ h \of (g \of f) }
&= \dom (g \of f)               \qqby {def.~$h\of(g\of f)$} \\
&= \dom f                       \qqby {def.~$g\of f$}
\intertext{e do lado direito}
\dom\paren{ (h \of g) \of f }
&= \dom f.                      \qqby {def.~$(h\of g)\of f$}
\endalignat
$$
Similarmente elas tem os mesmos codomínios
(caso que seguimos a definição~\refn{f_eq_g_2})
$$
\alignat2
\cod\paren{ h \of (g \of f) }
&= \cod h                       \qqby {def.~$h\of(g\of f)$}
\intertext{e do lado direito}
\dom\paren{ (h \of g) \of f }
&= \cod (h \of g)               \qqby {def.~$(h\of g)\of f$} \\
&= \cod h.                      \qqby {def.~$h\of g$}
\endalignat
$$
Agora precisamos mostrar que as duas funções comportam no mesmo jeito
para todos os elementos no $A$.
Suponha $a\in A$ então, e calcule:
$$
\alignat2
\paren{h \of (g \of f)}(a)
&= h\paren{\paren{g \of f}(a)}  \qqby{def.~$h\of(g\of f)$}\\
&= h\paren{g \paren{f(a)}}      \qqby{def.~$g\of f$}
\intertext{e o lado direito:}
\paren{(h \of g) \of f}(a)
&= \paren{h \of g}\paren{f(a)}  \qqby{def.~$(h\of g)\of f$}\\
&= h\paren{g \paren{f(a)}}      \qqby{def.~$h\of g$}
\endalignat
$$
\qed
%%}}}

%%{{{ Commutativity
\note Comutatividade.
É fácil provar que a composição de funções \emph{não é comutativa}.
Faça isso agora no exercício seguinte!
%%}}}

%%{{{ x: non_commutativity_of_fcom 
\exercise.
\label{non_commutativity_of_fcom}%
Existem funções $f,g$ entre conjuntos $A,B$
tais que $f\of g$ e $g\of f$ são ambas definidas,
mas mesmo assim
$$
f\of g \neq g\of f.
$$
Mostre pelo menos dois exemplos diferentes:
um com $A\neq B$; outro com $A = B$.

\solution
{%
\def\flip{\namedfun{flip}}%
\def\zero{\namedfun{zero}}%
\def\one{\namedfun{one}}%
Para o primeiro exemplo, escolhe $A = \set{0}$ e $B=\set{0,1}$.
Agora sejam $f : A \to B$ e $g : B \to A$ definidas pelas
$$
\xalignat2
f(0) &= 0  &  g(x) = 0
\endxalignat
$$
Ambas as $g\of f$ e $f\of g$ são definidas mas são diferentes
pois nem domínios iguais elas tem:
$$
\dom (g\of f) = \dom g = B \neq A = \dom f = \dom (f\of g).
$$
\endgraf
Para o segundo exemplo, tome $A=B=\set{0,1}$
e defina as funções $\flip,\zero,\one:A \to A$ pelas:
$$
\xalignat3
\flip(0) &= 1  &  \zero(0) &= 0  &  \one(0) &= 1\\
\flip(1) &= 0  &  \zero(1) &= 0  &  \one(1) &= 1.
\endxalignat
$$
Calculando temos $\flip\of\zero = \one$ mas $\zero\of\flip = \zero$.
De fato, quaisquer duas dessas três funções servem como um exemplo nesse caso!
}

\endexercise
%%}}}

%%{{{ Identity 
\note Identidades.
Investigamos aqui se a operação de composição possui \emph{identidade}
mas primeiramente vamos lembrar o que isso significa.
%%}}}

%%{{{ Q: what_is_the_identity_of_composition 
\question.
\label{what_is_the_identity_of_composition}%
Chamamos o $1$ a \dterm{identidade} da operação $\ntimes$ nos reais, pois:
$$
1\ntimes x = x = x\ntimes 1, \qquad \text{para todo $x\in \reals$}
$$
Tentando achar uma similaridade entre funções e números num lado, e composição e multiplicação no outro,
qual seria nosso $1$ aqui?
Ou seja,
procuramos objeto \holed?\ tal que
$$
\holed? \of f = f = f \of \holed?
$$
para toda função $f$.
%%}}}
\spoiler.

%%{{{ df: idempotent_function 
\definition Idempotente.
\label{idempotent_function}%
\tdefined{função}[idempotente]%
\iisee{idempotente!função}{função idempotente}%
Seja $f : A \to A$ um endomapping.
Chamamos a $f$ \dterm{idempotente} sse
$$
f \of f = f.
$$
%%}}}

%%{{{ x: how_many_idempotents_on_AtoA_for_A_triset 
\exercise.
\label{how_many_idempotents_on_AtoA_for_A_triset}%
Seja $A$ conjunto com $\card A = 3$.
Quantas funções idempotentes podemos definir no $A$?

\hint
Use um diagrama interno para endomapas!

\hint
Observe que em geral, aparecem certos ``redemoinhos''
num diagrama interno de endomapa quando ela é idempotente.

\hint
Separe as funções idempotentes dependendo na quantidade
de ``redemoinhos'' que aparecem nos seus diagramas.

\solution
Vamos tentar definir uma $f$ idempotente e contar as escolhas que temos.
Observe que assim que mandamos um $x \mapsto y$, o $f(y)$ ``não tem mais
escolha'': precisa ser $f(y) = y$, pois $f$ deve ser idempotente.
Ou seja, $y$ vai ser um \dterm{ponto fixo} (ou \dterm{fixpoint}) da $f$
(mais sobre isso na~\refn{Fixpoints}).
A $f$ então deve ter pelo menos $1$ fixpoint, e no máximo $\card A = 3$.
Separamos então por casos, contamos as maneiras em cada caso e usamos
o Princípio da adição~(\refn{principle_of_addition}) para contar
quantidade total das maneiras.
Defina então
$$
F_i \defeq \setstt {f : A \to A} {$f$ tem exatamente $i$ fixpoints}.
$$
Queremos achar o $\card{F_1} + \card{F_2} + \card{F_3}$.
Calculamos separadamente.:
\endgraf
\proofpart{Quantas funções no $F_1$?}
Temos $3$ funções, uma para cada escolha de fixpoint, pois
assim que determinamos o único fixpoint, todos os outros membros
devem ser mapeados nele.
\endgraf
\proofpart{Quantas funções no $F_2$?}
Temos $\comb 3 2 = 3$ maneiras de escolher $2$ dos membros de $A$ para ser
os fixpoints da $f$.  Para cada uma dessas escolhas, temos $2$ opções para
o não-fixpoint (escolher em qual dos dois fixpoints vamos mandá-lo).
Pelo Princípio da multiplicação~(\refn{principle_of_multiplication}) então
temos $3\ntimes 2 = 6$ funções no $F_2$.
\endgraf
\proofpart{Quantas funções no $F_3$?}
Apenas uma: a identidade.
\endgraf
Finalmente podemos responder: existem $3 + 6 + 1 = 10$ funções idempotentes
num conjunto de cardinalidade $3$.

\endexercise
%%}}}

%%{{{ x: constant_implies_idempotent 
\exercise.
\label{constant_implies_idempotent}%
Seja $f : A \to A$.
Prove ou refute a implicação:
$$
\text{$f$ constante}
\implies
\text{$f$ idempotente}
$$

\hint
A implicação é válida.
Prove!

\solution
Vamos provar a implicação.
Suponha que $f : A\to A$ é constante.
Caso $A=\emptyset$ a $f$ é a função vazia e a $f\of f$ também.
Caso $A\neq\emptyset$, usamos a definição alternativa
da~\ref{constant_function_definitions_almost_agree}.
Seja $c\in A$ tal que para todo $x\in A$, $f(x) = c$\fact1.
Queremos mostrar que $f\of f = f$, ou seja, que para todo $a\in A$,
$$(f\of f)(a) = f(a)$$
(definição de igualdade de funções~\refn{f_eq_g}).
Calculamos no lado esquerdo:
$$
\alignat2
(f\of f)(a)
&= f\paren{f(a)}    \qqby{def.~$\fcom$}\\
&= f(c)             \qqby{pelo \byfact1, com $x \asseq a$}\\
&= c                \qqby{pelo \byfact1, com $x \asseq c$}
\intertext{e no lado direito:}
f(a)
&= c.               \qqby{pelo \byfact1, com $x \asseq a$}.
\intertext{Logo, $f \of f = f$ como desejamos.
\endgraf
Alternativamente, podemos nos livrar dum passo no calculo do lado esquerdo assim:
}
(f\of f)(a)
&= f\paren{f(a)}    \qqby{def.~$\fcom$}\\
&= c.               \qqby{pelo \byfact1, com $x \asseq f(a)$}
\endalignat
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Commutative diagrams 
\section Diagramas comutativos.

\blah.
Começamos com uma definição complicada; leia agora, mas veja logo os exemplos
seguintes.

%%{{{ pseudodf: commutative_diagram 
\pseudodefinition diagrama comutativo.
\label{commutative_diagram}%
\tdefined{diagrama}[comutativo]%
Digamos que um diagrama externo de funções \dterm{comuta} ou que é um
\dterm{diagrama comutativo} sse: para todo par de ``caminhos'' feitos
por seguindo setas, \emph{se pelo menos um dos dois caminhos tem tamanho
maior que $1$}, então os dois caminhos são iguais.
%%}}}

%%{{{ eg: triangle
\example.
O que significa que o diagrama seguinte comuta?
$$
\cdopt{sep=2cm}
A   \ar[r, "f"]\ar[dr, "h"'] \| B \ar[d, "g"] \\
                             \| C
\endcd
$$
Significa que $h = g\of f$.
\endexample
%%}}}

%%{{{ eg: square
\example.
O que significa que o diagrama seguinte comuta?
$$
\cdopt{sep=2cm}
A   \ar[r, "f"]\ar[d, "h"'] \| B \ar[d, "g"] \\
D   \ar[r, "k"]             \| C
\endcd
$$
Significa que $g\of f  = k\of h$
\endexample
%%}}}

%%{{{ eg: commutative_diagram_example_line 
\example.
\label{commutative_diagram_example_line}%
O que significa que o diagrama seguinte comuta?
$$
\cdopt{sep=2cm}
A   \ar[r, shift left, "g"]\ar[r, shift right, "h"'] \| B \ar[r, "f"]  \|  C
\endcd
$$
Significa que $f\of g  = f\of h$.
\endexample
%%}}}

%%{{{ beware: at least one path must have length greater than 1 
\beware.
Graças à parte enfatisada na~\ref{commutative_diagram}, \emph{não podemos}
concluir no~\ref{commutative_diagram_example_line} que $g = h$, pois mesmo que
existem esses dois caminhos de $A$ para $B$ (um seguindo a seta $g$, outro
seguindo a seta $h$), nenhum deles tem tamanho maior que 1.
%%}}}

%%{{{ eg: part of diagram commutes 
\example.
O que significa que o rectângulo no diagrama seguinte comuta?
$$
\cdopt{sep=2cm}
A   \ar[r, "f"]\ar[d, "k"'] \| B \ar[d, "g"]  \ar[dr, "i"] \\
D                           \| C \ar[l, "h"'] \ar[r, "j"] \| D 
\endcd
$$
Apenas que $h \of g \of f = k$.
Observe que isso não nos permite concluir nada especial sobre as
setas~$i$ e~$j$ do triângulo.  Se soubéssemos que o diagrama
comuta (e não apénas seu rectângulo), poderiamos concluir
que $i = j\of g$ também.
\endexample
%%}}}

\blah.
Afirmando a comutatividade de certos diagramas vira uma maneira curta de
afirmar proposições, como por exemplo essas duas leis que já encontramos
na~\refn{Composition_laws}.

%%{{{ eg: commutative_diagram_id_laws 
\example.
\label{commutative_diagram_id_laws}%
Como expressar as lei da identidade da~\refn{Composition_laws} usando
apenas a comutatividade dum diagrama?
Assim:
$$
\cdopt{sep=2cm}
A   \ar[dr, "f"']\ar[r, "\id_A"] \| A \ar[d, "f"]  \ar[dr, "f"]   \\
                                 \| B \ar[r, "\id_B"'] \| B
\endcd
$$
\endexample
%%}}}

%%{{{ x: commutative_diagram_associativity_law 
\exercise.
\label{commutative_diagram_associativity_law}%
Afirme a lei da associatividade da~\refn{Composition_laws}
usando a comutatividade dum diagrama.

\hint
Sejam $A\toarrow f B \toarrow g C \toarrow h D$.
Basta desenhar um diagrama cuja comutatividade quis dizer
$h \of (g \of f) = (h \of g) \of f$.

\solution
Sejam $A\toarrow f B \toarrow g C \toarrow h D$.
Então o diagrama seguinte comuta:
$$
\cdopt{sep=2cm}
A   \ar[r, "f"]\ar[rr, bend left=30,  "g\of f"] \|
B   \ar[r, "g"]\ar[rr, bend right=30, "h\of g"'] \|
C   \ar[r, "h"] \|
D
\endcd
$$
Outra maneira para desenhar o mesmo diagrama seria a seguinte:
$$
\cdopt{sep=2cm}
A   \ar[r, "f"]\ar[rd, "g\of f"'] \| B \ar[d, "g"]  \ar[dr, "h\of g"] \\
                                  \| C \ar[r, "h"']      \| D
\endcd
$$

\endexercise
%%}}}

%%{{{ x: commutative_diagram_copy_paste 
\exercise.
\label{commutative_diagram_copy_paste}%
Suponha que os quadrados no diagrama seguinte comutam:
$$
\cdopt{sep=2cm}
A   \ar[r, "f"] \ar[d, "i"] \| B \ar[r, "g"] \ar[d, "j"] \| C \ar[d, "k"] \\
P   \ar[r, "s"]             \| Q \ar[r, "t"]             \| R
\endcd
$$
Prove que o rectângulo grande também comuta.

\solution
Temos que os quadrados do
$$
\cdopt{sep=2cm}
A   \ar[r, "f"] \ar[d, "i"] \| B \ar[r, "g"] \ar[d, "j"] \| C \ar[d, "k"] \\
P   \ar[r, "s"]             \| Q \ar[r, "t"]             \| R
\endcd
$$
comutam.
Precisamos provar que o rectângulo também comuta, ou seja, que
$$
\alignat2
k \of g \of f &= t \of s \of i.
\intertext{Calculamos:}
k \of g \of f
&= (k \of g) \of f \qqby{assoc.~da~$\of$}\\
&= (t \of j) \of f \qqby{comut.~do quad.~direito}\\
&= t \of (j \of f) \qqby{assoc.~da~$\of$}\\
&= t \of (s \of i) \qqby{comut.~do quad.~esquerdo}\\
&= t \of s \of i.  \qqby{assoc.~da~$\of$}
\endalignat
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Recursive definitions 
\section Definições recursivas.

\blah.
Já encontramos várias definições recursivas.
Agora vamos analizar com que precisamos tomar cuidado para garantir
que nossas ``funções'' realmente são funções bem definidas.

%%{{{ Safe recursion 
\note Recursão segura.
Na maioria das vezes que definimos funções recursivamente
exite ``algo'' (muitas vezes esse ``algo'' é o próprio
argumento da função, mas não sempre) que com cada ``chamada recursiva''
da função fica menor e menor, até cair num valor que garanta
uma ``saida da recursão''.
(Essa descrição é bem vaga sim.)
%%}}}

%%{{{ eg: recursion_with_powers_of_two 
\example.
\label{recursion_with_powers_of_two}%
Seja $f : \nats\to\nats$ a função definida pela:
$$
f(x) =
\knuthcases{
\log_2(x), & se $x$ é uma potência de $2$;\cr
f(x+1), & se não.
}
$$
Aqui nas chamadas recursivas não é o próprio argumento que é
``cada vez menor''---pelo contrário: as chamadas recursivas
estão sendo cada vez com argumento maior!
Mesmo assim, a recursão ``sempre termina'', e a $f$ realmente
é bem definida.
Calculamos como exemplo uns valores:
$$
\align
f(0) &= f(1) = 0 \\
f(4) &= 2 \\
f(5) &= f(6) = f(7) = f(8) = 3 \\
f(1020) &= f(1021) = f(1022) = f(1023) = f(1024) = 10.
\endalign
$$
\endexample
%%}}}

%%{{{ x: find invariant 
\exercise.
Ache um ``algo'' que fica cada vez menor com cada chamada recursiva
da $f$ do~\ref{recursion_with_powers_of_two}.

\hint
Uma ``distância'' está sendo cada vez menor.  Qual?

\solution
Com cada chamada com entrada $x$, o número $b - x$ é cada vez menor,
onde
$$
b = \min \setst {2^n} {x \leq 2^n, \ n\in\nats}.
$$

\endexercise
%%}}}

%%{{{ Dangerous recursion 
\note Recursão perigosa.
Não é cada equação recursiva que realmente defina uma função!
Vamos ver agora uns exemplos que mostram exatamente isso.
%%}}}

%%{{{ eg: dangerous_recursion_f 
\example.
\label{dangerous_recursion_f}%
Seja $f : \nats\to\nats$ a função definida pela
$$
f(n) = f(n),
\quad\text{para todo $n\in\nats$}.
$$
É óbvio que isso não \emph{determina} uma função:
\emph{toda função $\nats\to\nats$ satisfaz essa equação},
então não podemos usá-la como definição!
\endexample
%%}}}

%%{{{ eg: dangerous_recursion_g 
\example.
\label{dangerous_recursion_g}%
Seja $g : \nats\to\nats$ a função definida pela
$$
g(n) = g(n)+1,
\quad\text{para todo $n\in\nats$}.
$$
Isso também não \emph{determina} uma função:
\emph{nenhuma função $\nats\to\nats$ satisfaz essa equação},
então não podemos usá-la como definição!
\endexample
%%}}}

%%{{{ eg: dangerous_recursion_h 
\example.
\label{dangerous_recursion_h}%
Seja $h : \nats\to\nats$ a função definida pela
$$
h(n) = h(n+1),
\quad\text{para todo $n\in\nats$}.
$$
Isso também não \emph{determina} uma função---mas por quê?
\endexample
%%}}}

%%{{{ x: what_is_the_problem_with_the_recursion_of_h 
\exercise.
\label{what_is_the_problem_with_the_recursion_of_h}%
A pergunta não foi rhetórica!

\endexercise
%%}}}

%%{{{ eg: collatz_recursive 
\example.
\label{collatz_recursive}%
Considere a função $f : \nats_{>0} \to \nats$ definida pela recursão
$$
\align
f(1) &= 1\\
f(n) &=
\knuthcases{
f(n/2),  &se $n$ é par\cr
f(3n+1), &se $n$ é ímpar.
}\quad\text{(para $n > 1$)}.
\endalign
$$
\endexample
%%}}}

%%{{{ x: calculate three values 
\exercise.
Calcule os valores $f(8), f(3), f(7)$ da $f$ acima.

\endexercise
%%}}}

%%{{{ x: why_recursive_collatz_does_not_define_a_function 
\exercise.
\label{why_recursive_collatz_does_not_define_a_function}%
Qual o problema com a definição da função $f$ do~\ref{collatz_recursive}?

\hint
Por quê termina a recursão para toda entrada?

\solution
Não sabemos se ela satisfaz a totalidade de função, ou seja,
se ela é realmente definida em todo o seu domínio.
Ate agora, ninguém sabe dizer!
Essa é exatamente a concjetura de \Collatz{}Collatz~(\ref{collatz_conjecture}).

\endexercise
%%}}}

%%{{{ mutual_recursion 
\note Recursão mutual.
\label{mutual_recursion}%
Podemos definir duas ou mais funções, cada uma chamando recursivamente
outras, tomando certos cuidados como sempre para garantir que realmente
todas as funções vão ser definidas mesmo para todas as entradas
aceitas pelos domínios delas.

%%{{{ eg: mutual_recursion_even_odd 
\example.
\label{mutual_recursion_even_odd}%
{%
\def\even{\namedfun{even}}%
\def\odd{\namedfun{odd}}%
Vamos definir as funções $\even,\odd:\nats\to\set{0,1}$ pelas
$$
\xalignat2
\even(0)   &= 1       & \odd(0)   &= 0 \\
\even(n+1) &= \odd(n) & \odd(n+1) &= \even(n)
\endxalignat
$$
Calculamos, por exemplo:
$$
\align
\even(3) &
= \odd(2)
= \even(1)
= \odd(0)
= 0 \\
odd(3) &
= \even(2)
= \odd(1)
= \even(0)
= 1
\endalign
$$
}
\endexample
%%}}}

%%}}}

\blah.
Deixamos esse assunto por enquanto (até o~\ref{Recursive_functions}),
assumindo que temos já um entendimento de como definições recursivas
funcionam.

\endsection
%%}}}

%%{{{ More constructions and operations on functions 
\section Mais construções e operações em funções.

%%{{{ df: function_iterations 
\definition iterações.
\label{function_iterations}%
\tdefined{função}[iteração]%
\sdefined {\holed f^\holed n} {a $n$-ésima iteração da $f$.}%
Seja $f : A \to A$.
Definimos as \dterm{iterações} de $f$ pela recursão
$$
\align
f^0     &= \id_A \\
f^{n+1} &= f\of f^n
\endalign
$$
%%}}}

%%{{{ eg: calculate_iterate_3_fx 
\example.
Seja $f : A \to A$.  Calculamos:
$$
\alignat2
f^3(x)
&= (f \of f^2)(x)                   \qqby{def.~$f^3$}\\
&= (f \of (f \of f^1))(x)           \qqby{def.~$f^2$}\\
&= (f \of (f \of (f \of f^0)))(x)   \qqby{def.~$f^1$}\\
&= (f \of (f \of (f \of \id_A)))(x) \qqby{def.~$f^0$}\\
&\dotseq (f \of f \of f)(x)         \qqby{ass.~$\of$; lei da~$\id_A$}\\
&\dotseq f (f (f (x)))              \qqby{def.~$\of$}
\endalignat
$$
Em geral omitimos parentênces quando a expressão involve apenas uma operação
associativa;
botamos aqui para enfatizar cada aplicação de definição nesse cálculo.
\endexample
%%}}}

%%{{{ beware: notation of functions with exponents 
\beware.
Em certos textos de matemática, aparece a notação $f^n(x)$ como
sinónimo de $(f(x))^n$.
Por exemplo:
$$
\text{quem escreveu\dots}
\quad
\sin^2 x + \cos^2 x
\quad
\aligned
&\text{\dots quis dizer\dots}\\
&\text{\dots mas aqui seria\dots}
\endaligned
\quad
\aligned
&(\sin x)^2   + (\cos x)^2    \\
&\sin(\sin x) + \cos(\cos x).
\endaligned
$$
%%}}}

%%{{{ df: fcross 
\definition cross.
\label{fcross}%
\tdefined{função}[cross]%
\tdefined{função}[produto]%
\sdefined {\holed f \times \holed g} {a função-produto e $f$ ``cross'' $g$}%
Sejam
$$
\gather
A \tolongarrow f B\\
C \tolongarrow g D
\endgather
$$
Chamamos \dterm{função-produto da $f$ ``cross'' $g$},
que denotamos por $f \cross g$,
a função
$$
A \times C \tolongarrow {f\cross g} B \times D
$$
definida pela
$$
(f \cross g)(x,y) = \tup{f(x), g(y)}.
$$
%%}}}

%%{{{ x: fcross_commutative_diagram 
\exercise.
\label{fcross_commutative_diagram}%
Bote nomes e direções onde faltam e prove que o diagrama comuta:
$$
\cdopt{sep=2cm}
A \ar[d, "f"']   \|  A\times C \ar[l, dash, ""]\ar[r, dash, ""]\ar[d, dotted, ""]   \| C \ar[d, "g"]  \\
B                \|  B\times D \ar[l, dash, ""]\ar[r, dash, ""]                     \| D
\endcd
$$

\endexercise
%%}}}

%%{{{ df: fpair 
\definition pair.
\label{fpair}%
\tdefined{função}[par]%
\sdefined {\holed f \times \holed g} {a função-produto e $f$ ``cross'' $g$}%
Sejam
$$
A \fromlongarrow f D \tolongarrow g B
$$
Chamamos \dterm{função-par da $f$ ``pair'' $g$},
que denotamos por $\tup{f,g}$,
a função
$$
D \tolongarrow {\tup{f,g}} A\times B
$$
definida pela
$$
\tup{f,g}(x) = \tup{f(x), g(x)}.
$$
%%}}}

%%{{{ x: fpair_commutative_diagram 
\exercise.
\label{fpair_commutative_diagram}%
Bote nomes e direções onde faltam e prove que o diagrama comuta:
$$
\cdopt{sep=2cm}
A \| A\times B \ar[l, dash, ""]\ar[r, dash, ""] \| B \\
  \| D\ar[u, dotted, ""]\ar[ul, "f"]\ar[ur, "g"']
\endcd
$$

\endexercise
%%}}}

%%{{{ df: pointwise_operation 
\definition pointwise.
\label{pointwise_operation}%
\tdefined{pointwise!operação}%
\iisee{função!pointwise operação}{pointwise, operação}%
Sejam $A,B$ conjuntos e $\ast$ uma operação binária no $B$.
Dadas funções $f,g : A \to B$, definimos a função
$f \ast g : A \to B$
pela
$$
(f \ast g)(x) = f(x) \ast g(x) , \qquad \text{para todo $x\in A$}.
$$
Chamamos a $(\dhole \ast \dhole)$ a \dterm{operação pointwise}
da $\ast$ no $(A \to B)$.
%%}}}

\endsection
%%}}}

%%{{{ Injections, Surjections, Bijections 
\section Injetoras, sobrejetoras, bijetoras.

%%{{{ noneg: not_injective 
\nonexample.
Nenhuma dessas funções é injetora:
$$
\xxalignat3
&
\tikzpicture
\tikzi not_injective0;
\draw[->] (0.5,2.0) -- (2.5,2.0) node[midway,below] {$f$};
\draw[|->] (a1) -- (b3);
\draw[|->] (a2) -- (b1);
\draw[|->] (a3) -- (b2);
\draw[|->,color=red] (a4) -- (b4);
\draw[|->,color=red] (a5) -- (b4);
\node[color=red] (a4) at (0,-.5)   {$\bullet$};
\node[color=red] (a5) at (0,-1)    {$\bullet$};
\endtikzpicture
&&
\tikzpicture
\tikzi not_injective0;
\draw[->] (0.5,2.0) -- (2.5,2.0) node[midway,below] {$g$};
\draw[|->,color=red] (a1) -- (b3);
\draw[|->]           (a2) -- (b3);
\draw[|->]           (a3) -- (b3);
\draw[|->,color=red] (a4) -- (b3);
\draw[|->]           (a5) -- (b3);
\node[color=red] (a1) at (0,1)     {$\bullet$};
\node[color=red] (a4) at (0,-.5)   {$\bullet$};
\endtikzpicture
&&
\tikzpicture
\tikzi not_injective0;
\draw[->] (0.5,2.0) -- (2.5,2.0) node[midway,below] {$h$};
\draw[|->,color=red] (a1) -- (b2);
\draw[|->,color=red] (a2) -- (b2);
\draw[|->] (a3) -- (b2);
\draw[|->] (a4) -- (b4);
\draw[|->] (a5) -- (b4);
\node[color=red] (a1) at (0,1)     {$\bullet$};
\node[color=red] (a2) at (0,.5)    {$\bullet$};
\endtikzpicture
\endxxalignat
$$
Em cada caso \emph{uma} razão é enfatisada com cor.
\endnonexample
%%}}}

%%{{{ noneg: not_surjective 
\nonexample.
E aqui nenhuma dessas funções é sobrejetora:
$$
\xxalignat3
&
\tikzpicture
\draw (0,2.0) node {$A$};
\draw (3,2.0) node {$B$};
\draw[->] (0.5,2.0) -- (2.5,2.0) node[midway,below] {$f$};
\draw (0,0) ellipse (-.85cm and 1.5cm);
\draw (3,0) ellipse (-.85cm and 1.5cm);
\node (a1) at (0,.666)    {$\bullet$};
\node (a2) at (0,0)       {$\bullet$};
\node (a3) at (0,-.666)   {$\bullet$};
\node (b1) at (3,1)       {$\bullet$};
\node (b2) at (3.2,.333)  {$\bullet$};
\node (b3) at (3.1,-.333) {$\bullet$};
\node (b4) at (2.8,-1)    {$\bullet$};
\draw[|->] (a1) -- (b1);
\draw[|->] (a2) -- (b2);
\draw[|->] (a3) -- (b3);
\node[color=red] (b4c) at (b4) {$\bullet$};
\endtikzpicture
&&
\tikzpicture
\draw (0,2.0) node {$A$};
\draw (3,2.0) node {$C$};
\draw[->] (0.5,2.0) -- (2.5,2.0) node[midway,below] {$g$};
\draw (0,0) ellipse (-.85cm and 1.5cm);
\draw (3,0) ellipse (-.85cm and 1.5cm);
\node (a1) at (0,.666)  {$\bullet$};
\node (a2) at (0,0)     {$\bullet$};
\node (a3) at (0,-.666) {$\bullet$};
\node (b1) at (3,1)     {$\bullet$};
\node (b2) at (2.9,.7)  {$\bullet$};
\node (b3) at (3.1,0.1) {$\bullet$};
\node (b4) at (2.8,-.5) {$\bullet$};
\node (b5) at (3,-1)    {$\bullet$};
\node (b6) at (3.2,-0.8){$\bullet$};
\draw[|->] (a1) -- (b2);
\draw[|->] (a2) -- (b2);
\draw[|->] (a3) -- (b5);
\node[color=red] (b4c) at (b4) {$\bullet$};
\endtikzpicture
&&
\tikzpicture
\draw (0,2.0) node {$\emptyset$};
\draw (3,2.0) node {$D$};
\draw[->] (0.5,2.0) -- (2.5,2.0) node[midway,below] {$h$};
\draw (0,0) ellipse (-.85cm and 1.5cm);
\draw (3,0) ellipse (-.85cm and 1.5cm);
\node (b1) at (3.0,.333)  {$\bullet$};
\node (b2) at (3.0,-.333) {$\bullet$};
\node[color=red] (b2c) at (b2) {$\bullet$};
\endtikzpicture
\endxxalignat
$$
\endnonexample
%%}}}

\question.
Como tu definirias os conceitos de função injetora e sobrejetora?
\spoiler.

%%{{{ df: jective_function 
\definition.
\label{jective_function}%
\tdefined{função}[injetora]%
\tdefined{função}[sobrejetora]%
\tdefined{função}[bijetora]%
\sdefined {\holed f : \holed A \injto \holed B} {$\holed f : \holed A\to \holed B$ é injetora}%
\sdefined {\holed f : \holed A \surto \holed B} {$\holed f : \holed A\to \holed B$ é sobrejetora}%
\sdefined {\holed f : \holed A \bijto \holed B} {$\holed f : \holed A\to \holed B$ é bijetora}%
Seja $f : A \to B$.
Chamamos a $f$ \dterm{injetora} (ou \dterm{injetiva}) sse
$$
\text{para todo $x,y \in A$, se $x\neq y$ então $f(x) \neq f(y)$}.
$$
Chamamos a $f$ \dterm{sobrejetora} (ou \dterm{sobrejetiva}) sse
$$
\text{para todo $b \in B$, existe $a\in A$ tal que $f(a) = b$}.
$$
Chamamos a $f$ \dterm{bijetora} (ou \dterm{bijetiva}, ou \dterm{correspondência}), sse
$f$ é injetora e sobrejetora.
Usamos as notações
$$
\align
f : A \injto B &\defiff \text{$f:A\to B$ é injetora}\\
f : A \surto B &\defiff \text{$f:A\to B$ é sobrejetora}\\
f : A \bijto B &\defiff \text{$f:A\to B$ é bijetora}
\endalign
$$
%%}}}

%%{{{ remark: contrapositive of injective 
\remark.
A seguinte afirmação equivalente de $f : A \injto B$ é muito útil:
$$
\text{para todo $x,y \in A$, se $f(x) = f(y)$ então $x = y$}.
$$
(É a sua contrapositiva.)
%%}}}

%%{{{ df: jection_spaces 
\definition.
\label{jection_spaces}%
\sdefined {(\holed A \injto \holed B)} {o conjunto de todas as injecções  de $\holed A$ para $\holed B$}%
\sdefined {(\holed A \surto \holed B)} {o conjunto de todas as surjecções de $\holed A$ para $\holed B$}%
\sdefined {(\holed A \bijto \holed B)} {o conjunto de todas as bijecções  de $\holed A$ para $\holed B$}%
Sejam $A,B$ conjuntos.  Definimos os conjuntos:
$$
\align
(A \injto B) &\defeq \setstt {f : A \to B} {$f$ injetora} \\
(A \surto B) &\defeq \setstt {f : A \to B} {$f$ sobrejetora} \\
(A \bijto B) &\defeq \setstt {f : A \to B} {$f$ bijetora}
\endalign
$$
%%}}}

%%{{{ x: cardinalities_of_jection_spaces 
\exercise.
Ache a cardinalidade dos conjuntos da~\ref{jection_spaces}
em termos das cardinalidades dos $A$ e $B$.

\endexercise
%%}}}

%%{{{ thm: injection_iff_mono 
\theorem.
\label{injection_iff_mono}%
Sejam $B \toarrow f C$.
A $f$ é injetora sse
$$
f\of g = f \of h \implies g = h
$$
para todas as $g,h$ tais que as composições em cima são definidas.
Digamos então que $f$ é \dterm{$\of$-cancelável pela esquerda}:
\sketch.
A direção {\lrdir} é o~\ref{injection_iff_mono_lrproof}.
Para a direção {\rldir}, tome $b,b'\in B$ tais que $f(b)=f(b')$.
Basta demonstrar que $b=b'$.
Tome $A\asseq\set{0}$ e defina $g,h$ no diagrama
$$
\cdopt{sep=2cm}
\set{0}   \ar[r, shift left, "g"]\ar[r, shift right, "h"'] \| B \ar[r, "f"]  \|  C
\endcd
$$
em tal maneira que o diagrama comuta (tem que definir mesmo as $g,h$).
Usamos agora a hipótese para concluir que $b=b'$.
\qes
\proof.
\lrdir: \ref{injection_iff_mono_lrproof}.
\endgraf
\rldir:
Suponha $b,b' \in B$ tais que $f(b) = f(b')$.
Basta mostrar que $b = b'$.
Temos então o diagrama interno seguinte:
$$
\tikzpicture
\tikzi mono_implies_inj0;
\endtikzpicture
$$
Seja $A = \set{0}$ e defina as $g,h$ no diagrama
$$
\cdopt{sep=2cm}
\set{0}   \ar[r, shift left, "g"]\ar[r, shift right, "h"'] \| B \ar[r, "f"]  \|  C
\endcd
$$
como as funções constantes definidas pelas 
$$
g(0) = b
\qqtext{e}
h(0) = b'.
$$
Então agora estamos com o diagrama interno assim:
$$
\tikzpicture
\tikzi mono_implies_inj1;
\endtikzpicture
$$
Observe que como
$$
\align
(f\of g)(0) &= f(g(0)) = f(b) \\
(f\of h)(0) &= f(h(0)) = f(b')
\endalign
$$
e $f(b) = f(b')$, temos
$f\of g = f\of h$ e agora usamos a hipótese para ganhar $g = h$.
Logo as $g,h$ concordam no $0$, ou seja, $b = b'$.
\qed
%%}}}

%%{{{ thm: surjection_iff_epic 
\theorem.
\label{surjection_iff_epic}%
Sejam $B \toarrow f C$.
A $f$ é sobrejetora sse
$$
g\of f = h\of f \implies g = h
$$
para todas as $g,h$ tais que as composições em cima são definidas.
Digamos então que $f$ é \dterm{$\of$-cancelável pela direita}:
\sketch.
A direção {\lrdir} é o~\ref{injection_iff_mono_lrproof}.
Para a direção {\rldir}, tomamos $c \in C$ e procuramos achar
$b\in B$ tal que $f(b) = c$.
Defina o $D$ (cuidado: aqui não ajuda tomar $D=\set{0}$)
e as $g,h$ no diagrama
$$
\cdopt{sep=2cm}
B  \ar[r, "f"] \|  C   \ar[r, shift left, "g"]\ar[r, shift right, "h"'] \| D
\endcd
$$
em tal maneira que $g\neq h$,
mas mesmo assim \emph{concordam em todo o $C$ exceto no ponto $c$}.
Usando a contrapositiva da hipótese ganhamos
$g\of f \neq h\of f$, mas isso só pode acontecer se a $f$ mandou pelo
menos um ponto do domínio dela para o $c$.
\qes
\proof.
\lrdir:
\ref{surjection_iff_epic_lrproof}.
\endgraf
\rldir:
Suponha $c\in C$.
Procuramos $b\in B$ tal que $f(b) = c$.
Começamos então com o diagrama interno seguinte:
$$
\tikzpicture
\tikzi epic_implies_surj0;
\endtikzpicture
$$
Seja $D=\set{0,1}$ e defina as funções $g,h:C\to D$ pelas
$$
g(y) = 0
\qqtext{e}
h(y) = \knuthcases{
1, &se $y = c$; \cr
0, &se $y \neq c$.
}
$$
Logo $g(c) \neq h(c)$, mas $g(y)=h(y)$ para todo $y\neq c$.
Agora estamos assim:
$$
\tikzpicture
\tikzi epic_implies_surj1;
\endtikzpicture
$$
Como $g\neq h$ então, pela hipótese concluimos que $g\of f \neq h\of f$, ou seja,
as $g\of f$ e $h\of f$ discordam em pelo menos um membro de $B$,
e seja $b$ um tal membro:
$$
(g\of f)(b) \neq (h\of f)(b).
$$
Logo
$$
g(f(b)) \neq h(f(b)),
$$
ou seja, $g$ e $h$ discordam no $f(b)$.
Mas $g$ e $h$ discordam apenas no $c$; ou seja,
$f(b) = c$ como desejamos.
\qed
%%}}}

%%{{{ x: injection_surjection_commutative_diagrams 
\exercise.
\label{injection_surjection_commutative_diagrams}%
Descreva as propriedades dos teoremas
\refn{injection_iff_mono}--\refn{surjection_iff_epic}
usando diagramas comutativos.

\solution
A função $f$ é injetora sse em todo diagrama comutativo da forma
$$
\cdopt{sep=2cm}
A   \ar[r, shift left, "g"]\ar[r, shift right, "h"'] \| B \ar[r, "f"]  \|  C
\endcd
$$
temos $g=h$.
\endgraf
A função $f$ é sobrejetora sse em todo diagrama comutativo da forma
$$
\cdopt{sep=2cm}
B  \ar[r, "f"] \|  C   \ar[r, shift left, "g"]\ar[r, shift right, "h"'] \| D
\endcd
$$
temos $g=h$.

\endexercise
%%}}}

%%{{{ x: injection_iff_mono_lrproof 
\exercise.
\label{injection_iff_mono_lrproof}%
Prove a direção {\lrdir} do~\ref{injection_iff_mono}.

\solution
Suponha então que $f\of g = f\of h$.
Vamos mostrar que $g = h$.
Seja $x \in A$.
Pela hipótese,
$$
(f\of g)(x) = (f\of h)(x)
$$
logo $f(g(x)) = f(h(x))$
e como $f$ injetora, chegamos no desejado $g(x) = h(x)$.

\endexercise
%%}}}

%%{{{ x: surjection_iff_epic_lrproof 
\exercise.
\label{surjection_iff_epic_lrproof}%
Prove a direção {\lrdir} do~\ref{surjection_iff_epic}.

\solution
Suponha que $g\of f = h\of f$.  Vamos mostrar que $g = h$.
Seja $c\in C$.
Logo existe $b\in B$ tal que $f(b) = c$.
Como
$$
(g\of f)(b) = (h\of f)(b)
$$
temos $g(f(b)) = h(f(b))$, ou seja, $g(c) = h(c)$.
Logo $g = h$.

\endexercise
%%}}}

%%{{{ x: fcom_respects_jections 
\exercise Composição respeita ``-jetividade''.
\label{fcom_respects_jections}%
Sejam $f : A\to B$ e $g : B \to C$.
Prove:
\item{(1)} Se $f$ e $g$ são injetoras, então $g\fcom f$ também é;
\item{(2)} Se $f$ e $g$ são sobrejetoras, então $g\fcom f$ também é;
\item{(3)} Se $f$ e $g$ são bijetoras, então $g\fcom f$ também é.

\endexercise
%%}}}

%%{{{ x: converse_to_gof_bij_conclusions 
\exercise.
Se $g\compose f$ é bijetora, o que podemos concluir sobre as $f,g$?  Justifique.

\endexercise
%%}}}

%%{{{ x: converse_to_gof_bij_conclusions 
\exercise.
Se $f$ é injetora e $g$ sobrejetora, a $g\compose f$ é necessariamente bijetora?

\solution
Não.
Aqui um contraexemplo:
$$
\tikzpicture
\draw (0,0) ellipse (-.75cm and 1.25cm);
\draw (3,0) ellipse (-.75cm and 1.25cm);
\draw (6,0) ellipse (-.75cm and 1.25cm);
\draw (0,-.5) node {$\bullet$};
\draw (3,.5)  node {$\bullet$};
\draw (3,-.5) node {$\bullet$};
\draw (6,.5)  node {$\bullet$};
\draw (6,-.5) node {$\bullet$};
\draw[|->] (0.2,-.5) -- (2.8,-.5);
\draw[|->] (3.2,-.5) -- (5.8,-.5);
\draw[|->] (3.2,.5) -- (5.8,.5);
\draw[->]  (0.5,1.5) -- (2.5,1.5);
\draw[->]  (3.5,1.5) -- (5.5,1.5);
\draw (0,1.5) node {$A$};
\draw (3,1.5) node {$B$};
\draw (6,1.5) node {$C$};
\draw (1.5,1.20) node {$f$};
\draw (4.5,1.20) node {$g$};
\endtikzpicture
$$

\endexercise
%%}}}

%%{{{ x: x_mapsto_singleton_x_properties 
\exercise.
\label{x_mapsto_singleton_x_properties}%
Sejam $A\neq\emptyset$ um conjunto e $f : A \to \pset A$ definida pela equação
$$
f(a) = \set a.
$$
Investigue:
(i) A $f$ é injetora?
(ii) A $f$ é sobrejetora?

\solution
\noindent
(i) Sim: se $x,y\in A$, então
$$
f(x) = f(y)
    \implies \set x = \set y
    \implies x = y.
$$
\endgraf
\noindent
(ii) Não: para todo $a\in A$ temos
$f(a) = \set a \neq \emptyset \in \pset A$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Inverses 
\section Inversas.

%%{{{ df: finverse 
\definition Função inversa.
\label{finverse}%
\tdefined{função}[inversa]%
\sdefined {\finv {\holed f}} {a função inversa da $f$}%
Seja função bijetora $f : A \bijto B$.
Definimos a função $\finv f : B \to A$ pela
$$
\finv f (y) \defeq \text{aquele $x\in A$ tal que $f(x) = y$}.
$$
Ou, \emph{equivalentemente}, pela
$$
\finv f (y) = x \defiff f(x) = y.
$$
Chamamos a $\finv f$ a \dterm{função inversa} da $f$.
%%}}}

%%{{{ x: finv_is_well_defined 
\exercise A inversa é definida bem.
\label{finv_is_well_defined}%
Prove que a função $\finv f$ foi definida bem.
O que precisas provar?

\solution
Pelo menos um tal $x\in A$ existe, pois a $f$ é sobrejetora.
E como $f$ é injetora, existe no máximo um.
Provamos assim a unicidade, algo que nos permite
\emph{definir a função} no jeito que definimos
na~\ref{finverse}.

\endexercise
%%}}}

%%{{{ x: finv_is_bij 
\exercise A inversa é bijetora.
\label{finv_is_bij}%
Prove que quando a função inversa $\finv f$ é definida, ela é bijetora.

\hint
O que exatamente garanta a injetoridade da $\finv f$, e o que a sua sobrejetoridade?

\hint
Considere:
$$
\align
\text{totalidade da $f$}      &\implies \text{$\finv f$ sobrejetora} \\
\text{determinicidade da $f$} &\implies \text{$\finv f$ injetora}.
\endalign
$$

\endexercise
%%}}}

%%{{{ x: finv_of_finv 
\exercise Inversa da inversa.
\label{finv_of_finv}%
Prove que se a função inversa $\finv f$ é definida,
então a sua inversa $\finvp{\finv f}$ também é
e temos $\finvp{\finv f} = f$.

\hint
Quando a função inversa é definida?

\hint
Aplique duas vezes a~\ref{finverse} de função inversa para provar
que as duas funções são iguais.

\solution
Pelo~\ref{finv_is_bij} temos que $\finv f$ é bijetora,
então sua inversa $\finvp{\finv f}$ é definida sim
(e pelo~\ref{finv_is_bij} de novo ela é bijetora também).
As $f$ e $\finvp{\finv f}$ têm domínios e codomínios iguais.
Basta verificar que concordam em todo o seu domínio.
Seja $x \in \dom f$ então.
Calculamos
$$
\alignat2
\finvp{\finv f}(x)    = f(x)
&\iff {\finv f}(f(x)) = x    \qqby{def.~$\finvp{\finv f}$} \\
&\iff f(x) = f(x)            \qqby{def.~$\finv f$}
\endalignat
$$
e a última igualdade é trivialmente válida,
e logo $\finvp{\finv f} = f$.

\endexercise
%%}}}

%%{{{ prop: finv_inverse_laws 
\proposition Leis da inversa.
\label{finv_inverse_laws}%
Para toda $f : A \bijto B$,
temos:
$$
\xxalignat4
\textrm{(L)} && \finv f \of f &= \id_A &
f \of \finv f &= \id_B. &&\textrm{(R)}
\endxxalignat
$$
\proof.
Como $\finv f : B \to A$, temos
$$
\xxalignat4
\textrm{\phantom{(L)}}&& \finv f \of f &: A \to A &
f \of \finv f &: B \to B. &&\textrm{\phantom{(R)}}
\endxxalignat
$$
Sejam $a\in A$ e $b\in B$.
Calculamos:
$$
\alignat2
(\finv f \of f) (a)
&= \finv f (f(a)) \\
&= \text{aquele $x\in A$ tal que $f(x) = f(a)$} \\
&= a                                \qqby{$f$ inj.}\\
&= \id_A(a). \\
\intertext{Agora tomando $y\in B$ calculamos a outra numa maneira diferente:}
(f \of \finv f) (b) = y
&\iff f(\finv f(b)) = y \\
&\iff \finv f (y) = \finv f(b) \\
&\iff y = b                         \qqby{$\finv f$ inj.} \\
&\iff \id_B(b) = y.
\endalignat
$$
\qed
%%}}}

%%{{{ x: finv_of_fcompose 
\exercise Inversa da composição.
\label{finv_of_fcompose}%
Sejam $
\cd
A \ar[r, tail, two heads, "f"] \| B \ar[r, tail, two heads, "g"] \| C
\endcd
$.
Descreva a $\finvp{g\of f}$ em termos das $\finv f$ e $\finv g$ e prove
tua afirmação.

\hint
Um erro comum é afirmar que $\finvp{g\of f} = \finv g \of \finv f$.
Pense em funções como ``processos'' e na $g\of f$ como o processo
<<faça $f$ e depois faça $g$>>.  Como exemplo, tome $f$ o <<bota
tua cueca>> e $g$ o <<boa teu shorts>>.
Logo $g\of f$ é o processo <<bora tua cueca e depois bota teu shorts>>.
Assim, qual processo seria o $\finv g \of \finv f$?
Se eu quero desfazer o $g\of f$ mesmo, o que preciso fazer?

\hint
$\finvp{g\of f} = \finv f \of \finv g$.

\hint
Para provar a $\finvp{g\of f} = \finv f \of \finv g$,
tome $x\in A$ e $z\in C$ e mostre a equivalência
$$
\finvp{g\of f}(x) = z
\iff
\paren{\finv f \of \finv g}(x) = z.
$$

\hint
Calcule cada lado separadamente:
$$
\alignat2
\finvp{g\of f}(x) = z
&\iff (g\of f)(z) = x  \qqby{def.~$\finvp{g\of f}$} \\
&\dotsiff \dots \\
\paren{\finv f \of \finv g}(x) = z
&\iff \finv f \funparen{\finv g (x)} = z  \qqby{def.~$\finv f \of \finv g$} \\
&\dotsiff \dots
\endalignat
$$

\hint
As vezes a direção em que a gente olha para uma igualdade faz diferença:
$\alpha = \beta \iff \beta = \alpha$ sim, mas nossos olhos conseguem
enxergar certas informações melhor na forma $\alpha = \beta$, e outras
na forma $\beta = \alpha$!

\solution
Vamos provar que
$$
\finvp{g\of f} = \finv f \of \finv g.
$$
Tome $x \in A$ e $z \in C$.  Basta provar que
$$
\finvp{g\of f}(x) = z
\iff
\paren{\finv f \of \finv g}(x) = z.
$$
pois isso quis dizer que as duas funções concordam em todo o seu domínio.
Calculamos:
$$
\alignat2
\finvp{g\of f}(x) = z
&\iff (g\of f)(z) = x                     \qqby{def.~$\finvp{g\of f}$} \\
&\iff g(f(z)) = x                         \qqby{def.~$g\of f$} \\
&\iff \finv g (x) = f(z)                  \qqby{def.~$\finv g$} \\
&\iff \finv f \funparen{\finv g (x)} = z  \qqby{def.~$\finv f$} \\
&\iff \paren{\finv f \of \finv g}(x) = z. \qqby{def.~$\finv f \of \finv g$}
\endalignat
$$

\endexercise
%%}}}

%%{{{ thm: finv_is_unique 
\theorem Unicidade da função inversa.
\label{finv_is_unique}%
Seja $f : A \bijto B$.
Se uma $f' : B \to A$ satisfaz pelo menos uma das duas leis da
inversa~(\ref{finv_inverse_laws}), então $f' = \finv f$.
\proof.
Caso que $f'$ satisfaz a (L):
$$
\alignat2
f'
&= f' \of \id_B            \qqby{lei da $\id_B$} \\
&= f' \of (f \of \finv f)  \qqby{(R) da $\finv f$} \\
&= (f' \of f) \of \finv f  \qqby{assoc.} \\
&= \id_A \of \finv f       \qqby{(L) da $f'$} \\
&= \finv f.                \qqby{lei da $\id_A$}
\intertext{E caso que $f'$ satisfaz a (R):}
f'
&= \id_A \of f'            \qqby{lei da $\id_A$} \\
&= (\finv f \of f) \of f'  \qqby{(L) da $\finv f$} \\
&= \finv f \of (f \of f')  \qqby{assoc.} \\
&= \finv f \of \id_B       \qqby{(R) da $f'$} \\
&= \finv f.                \qqby{lei da $\id_B$} \\
\endalignat
$$
\qed
%%}}}

%%{{{ cor: finv_of_id 
\corollary Inversa da identidade.
Para todo conjunto $A$, $\finv {\id_A} = \id_A$.
%%}}}

%%{{{ df: retractions_sections
\definition Retracções, secções.
\label{retractions_sections}%
\label{retraction}%
\tdefined{função}[retracção]%
\tdefined{função}[secção]%
\tdefined{função}[inversa-esquerda]%
\tdefined{função}[inversa-direita]%
Seja $f : A \to B$.
Se $r : B \to A$ satisfaz a
$$
r \of f = \id_A
$$
então chamamo-la uma \dterm{retracção} ou uma
\dterm{inversa-esquerda} da $f$.
Se $s : B \to A$ satisfaz a
$$
f \of s = \id_B
$$
então chamamo-la uma \dterm{secção} ou uma
\dterm{inversa-direita} da $f$.
%%}}}

\blah.
Ganhamos imediatamente dois corolários fáceis dos teoremas
\refn{injection_iff_mono}--\refn{surjection_iff_epic}.

%%{{{ cor: retraction_implies_injection 
\corollary.
\label{retraction_implies_injection}%
Se $f : A \to B$ tem retracção, então $f$ é injetora.
\proof.
Seja $r$ uma retracção da $f$.
Temos
$$
f \of g = f \of h
\implies r \of f \of g = r \of f \of h
\implies \id_A \of g = id_A \of h
\implies g = h
$$
e logo $f$ é injetora pelo~\ref{injection_iff_mono}.
\qed
%%}}}

%%{{{ cor: section_implies_surjection 
\corollary.
\label{section_implies_surjection}%
Se $f : A \to B$ tem secção, então $f$ é sobrejetora.
\proof.
Seja $s$ uma secção da $f$.
Temos
$$
g \of f = h \of f
\implies g \of f \of s = h \of f \of s
\implies g \of \id_B = h \of \id_B
\implies g = h
$$
e logo $f$ é sobrejetora pelo~\ref{surjection_iff_epic}.
\qed
%%}}}

%%{{{ x: retraction_implies_injection_elementary_proof 
\exercise.
\label{retraction_implies_injection_elementary_proof}%
Prove o~\ref{retraction_implies_injection} elementariamente (sem o~\refn{injection_iff_mono}).

\solution
Suponha que $f : A \to B$ e que $r : B \to A$ é uma retracção da $f$.
Tome $x, x' \in A$ tais que $f(x) = f(x')$.
Logo $r(f(x)) = r(f(x'))$.
Logo $(r\of f)(x) = (r\of f)(x')$.
Como $r$ é retracção, temos $\id_A(x) = \id_A(x')$, ou seja, $x = x'$ e $f$ é injetora.

\endexercise
%%}}}

%%{{{ x: section_implies_surjection_elementary_proof 
\exercise.
\label{section_implies_surjection_elementary_proof}%
Prove o~\ref{section_implies_surjection} elementariamente (sem o~\refn{surjection_iff_epic}).

\solution
Suponha que $f : A \to B$ e que $s : B \to A$ é uma secção da $f$.
Tome $b \in B$.
Logo $s(b) \in A$, e como $s$ secção, temos $f(s(b)) = b$, ou seja
a $f$ é sobrejetora pois mapeia $s(b) \mapstoarrow f b$.

\endexercise
%%}}}

%%{{{ x: retraction_and_section_implies_inverse 
\exercise.
Seja $f : A \to B$ tal que $r,s : A \from B$ são retracção
e secção da $f$ respectivamente.
Podemos concluir a afirmação seguinte?:
$$
\text{$f$ é bijetora}
\qquad\mland\qquad
\text{$r = s = \finv f$}.
$$
Se sim, prove; se não, refute.

\hint
Primeiramente observe:
$$
\left.\aligned
\text{$f$ tem retracção} &\implies   \text{$f$ é injetora} \\
\text{$f$ tem secção}    &\implies   \text{$f$ é sobrejetora}
\endaligned\right\}
\implies \text{$f$ bijetora}.
$$

\solution
Como $f$ tem retracção, ela é injetora;
e como ela tem secção, ela é sobrejetora;
logo $f$ é bijetora e a $\finv f$ é definida.
Aplicamos então o~\ref{finv_is_unique} com $f'\asseq r$ e com $f'\asseq s$
ganhamos:
$$
r = \finv f = s.
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Images, preimages 
\section Imagens, preimagens.
\label{Images_preimages}%

%%{{{ Two important subsets 
\note Dois subconjuntos importantes.
Sejam $A,B$ conjuntos e $f:A \to B$.
$$
\tikzpicture[scale=0.75,node distance=0mm]
\tikzi imgpreimgbase;
\endtikzpicture
$$
Vamos associar, com qualquer subconjunto $X$ de $A$, um certo subconjunto de $B$, que vamos o chamar a \emph{imagem} de $X$ através da $f$.
Similarmente, com qualquer subconjunto $Y$ de $B$, vamos associar um certo subconjunto de $A$, que vamos o chamar a \emph{preimagem} de $Y$ através da $f$.
Bem informalmente, parece que estamos ``elevando'' a função $f$ do nível ``membros'' para para o nível ``subconjuntos''.
Vamos ver como.
%%}}}

%%{{{ eg: sketches of image and preimage 
\example.
Nas figuras seguintes mostramos com azul o subconjunto com que começamos,
e com vermelho o subconjunto que associamos com ele.
Considere o $X\subseteq A$ como aparece no desenho em baixo,
e veja qual é o subconjunto $\img f X$ de $B$ que vamos associar com o $X$:
$$
\gathered
\tikzpicture[scale=0.75,node distance=0mm]
\draw [fill=blue!25] (0,-.5) ellipse (0.9cm and 1.6cm);
\tikzi imgpreimgbase;
\node [color=blue] (subset-X) at (-0.7,-2.1) {$X$};
\endtikzpicture
\endgathered
\quad
\leadsto
\quad
\gathered
\tikzpicture[scale=0.75,node distance=0mm]
\draw [fill=blue!25] (0,-.5) ellipse (0.9cm and 1.6cm);
\draw [fill=red!25] (4.9,-0.45) ellipse (0.7cm and 2cm);
\tikzi imgpreimgbase;
\node [color=blue] (subset-X) at (-0.7,-2.1) {$X$};
\node [color=red] (subset-fX) at (5.9,-2.05) {$\img f X$};
\endtikzpicture
\endgathered
$$
Na direção oposta, comece por exemplo com esse $Y\subseteq B$
e observe qual é o subconjunto $\pre f Y$ de $A$ que queremos associar com o $Y$:
$$
\gathered
\tikzpicture[scale=0.75,node distance=0mm]
\draw [fill=blue!25] (4.9,1.45) ellipse (1.1cm and 1.2cm);
\tikzi imgpreimgbase;
\node [color=blue] (subset-Y) at (5.95,0.4) {$Y$};
\endtikzpicture
\endgathered
\quad
\leadsto
\quad
\gathered
\tikzpicture[scale=0.75,node distance=0mm]
\draw [fill=blue!25] (4.9,1.45) ellipse (1.1cm and 1.2cm);
\draw [fill=red!25]  (0,1.0) ellipse (0.8cm and 2.0cm);
\tikzi imgpreimgbase;
\node [color=blue] (subset-Y)     at (5.95,0.4)  {$Y$};
\node [color=red]  (subset-fpreY) at (-0.9,-1.1) {$\pre f Y$};
\endtikzpicture
\endgathered
$$
\endexample
%%}}}

%%{{{ remark: just a function from A to B is enough 
\remark.
Observe que na discussão acima não supusemos \emph{nada mais} além da
existência de uma função $f$ dum conjunto $A$ para um conjunto $B$.
%%}}}

\question.
Como podemos definir formalmente os conjuntos indicados nos desenhos acima?
\spoiler.

%%{{{ df: img_and_pre 
\definition.
\label{img_and_pre}%
\tdefined{função!imagem}%
\tdefined{função!preimagem}%
\sdefined {\img {\holed f} {\holed X}} {a imagem de $X$ através da $f$}%
\sdefined {\pre {\holed f} {\holed Y}} {a preimagem de $Y$ através da $f$}%
Seja $f : A \to B$, e sejam subconjuntos $X\subseteq A$ e $Y\subseteq B$.
Definimos:
$$
\align
\img f X &\defeq \setst {f(x)} {x \in X}\\
\pre f Y &\defeq \setst {a \in A} {f(a) \in Y}.
\endalign
$$
Lembrando a notação set-builder~(\ref{set_builder}), temos as definições:
$$
\align
y \in \img f X &\defiff \lexists{x\in X} {f(x) = y} \\
x \in \pre f Y &\defiff f(x) \in Y.
\endalign
$$
%%}}}

%%{{{ x: type_of_img_f_hole_and_pre_f_hole  
\exercise.
\label{type_of_img_f_hole_and_pre_f_hole}%
Quais os típos das $\img f {\dhole}$ e $\pre f {\dhole}$?

\solution
$$
\align
\img f {\dhole} &: \pset X \to \pset Y \\
\pre f {\dhole} &: \pset Y \to \pset X
\endalign
$$

\endexercise
%%}}}

%%{{{ x: img_and_pre_of_emptyset 
\exercise.
\label{img_and_pre_of_emptyset}%
Seja $f : X \to Y$.
Verifique:
$$
\img f \emptyset = \emptyset
\qqtext{e}
\pre f \emptyset = \emptyset.
$$

\solution
As duas afirmações seguem diretamente pelas definições:
$$
\align
\img f \emptyset &= \setst {f(x)}   {x \in \emptyset}    = \emptyset \\
\pre f \emptyset &= \setst {x\in X} {f(x) \in \emptyset} = \emptyset.
\endalign
$$

\endexercise
%%}}}

%%{{{ remark: range and surjection with f[-] notation 
\remark.
Se $f : A \to B$ então, temos que:
\beginol
\li $\range f = \img f A$;
\li $\img f A = B \iff \text{$f$ é sobrejetora}$.
\endol
\noindent
As duas afirmações são conseqüências imediatas das definições envolvidas.
%%}}}

%%{{{ x: erroneous_definition_of_pre 
\exercise.
\label{erroneous_definition_of_pre}%
Podemos definir a preimagem de $Y$ através de $f$ assim?:
$$
\pre f Y \defeq \setst {\finv f (y)} {y \in Y}
$$

\solution
Não!
O símbolo $\finv f (y)$ nem é definido no caso geral:
o definimos \emph{apenas para funções bijetoras}.

\endexercise
%%}}}

%%{{{ x: when_erroneous_definition_of_pre_is_valid 
\exercise.
\label{when_erroneous_definition_of_pre_is_valid}%
Sejam $f: A \bijto B$, e $Y \subseteq B$.
Mostre que
$$
\pre f Y = \setst {\finv f (y)} {y \in Y}.
$$

\hint
É um igualdade de conjuntos, então mostre cada uma das~{\lrdirset}
e~{\rldirset} separadamente.

\solution
Caso $\pre f Y = \emptyset$, necessariamente $Y=\emptyset$ também
(pois $f$ é sobrejetora) e logo
$$
\setst {\finv f (y)} {y \in Y}=\emptyset
$$
também.
Caso contrário, mostramos as duas direções separadamente:
\endgraf
{\lrdirset}:
Seja $x\in \pre f Y$ e logo
seja $y_x\in Y$ tal que $f(x) = y_x$ (pela def.~$\pre f Y$).
Logo $x = \finv f (y_x)$ pela definição da função inversa (\refn{finverse}),
ou seja $x \in \setst {\finv f (y)} {y \in Y}$.
\endgraf
{\rldirset}:
É só seguir os passos da {\lrdirset} em reverso.

\endexercise
%%}}}

%%{{{ x: pre_notation_problem 
\exercise.
\label{pre_notation_problem}%
Qual o problema com a~\ref{img_and_pre}?

\hint
Quando $f$ \emph{não} é bijetora, nenhum.

\hint
Se $f$ é bijetora, o símbolo $\pre f Y$ pode ter duas interpretações diferentes.

\solution
Se $f$ é bijetora, o símbolo $\pre f Y$ pode ter duas interpretações diferentes:
$$
\pre f Y \askeq
\knuthcases{
\pre {\alert{(f)}} {\alertb Y}
&= a preimagem de $\alertb Y$ através da função $\alert{f}$\cr
& \cr
\img {\alert{(\finv f)}} {\alertb Y}
&= a imagem de $\alertb Y$ através da função $\alert{\finv f}$
}
$$
onde usamos cores e parenteses para enfatisar o ``parsing'' diferente
de cada interpretação.
Observe que a segunda alternativa não é possível quando $f$ não é bijetora,
pois a função $\finv f$ nem é definida nesse caso!

\endexercise
%%}}}

%%{{{ x: correctness_of_pre_notation 
\exercise.
\label{correctness_of_pre_notation}
Depois de resolver o~\ref{pre_notation_problem}, justifique a corretude
da~\ref{img_and_pre}:
explique o que precisas provar, e prove!

\hint
Precisamos provar que no caso que $f:A\bijto B$ as duas interpretações do
símbolo $\pre f Y$ \emph{denotam o mesmo objeto}.

\hint
Temporariamente mude tua notação para ajudar teus olhos distinguir entre as duas interpretações melhor.
Use, por exemplo, $f_{-1}$ para denotar a função inversa da $f$, ou, alternativamente, bota parenteses
$(f^{-1})$ para enfatisar que estás denotando a função inversa da $f$.

\endexercise
%%}}}

%%{{{ x: composition_with_inverse_subsets 
\exercise.
\label{composition_with_inverse_subsets}%
Sejam conjuntos $X$ e $Y$, $f : X\to Y$, e $A\subseteq X$ e $B\subseteq Y$.
Prove as afirmações:
$$
\align
A &\subseteq \pre f {\img f A}\\
B &\supseteq \img f {\pre f B}.
\endalign
$$

\solution
Vamos provar as duas afirmações.
\endgraf\indent
\proofpart{Prova de $A \subseteq \pre f {\img f A}$.}
Suponha $a\in A$.
Logo $f(a) \in \img f A$ pela definição da função-imagem,
e logo $a \in \pre f {\img f A}$ pela definição da função-preimagem.
\endgraf\indent
\proofpart{Prova de $B \supseteq \img f {\pre f B}$.}
Suponha $y_0 \in \img f {\pre f B}$.
Logo tome $x_0 \in \pre f B$ tal que $y_0 = f(x_0)$\fact1.
Pela definição da função-preimagem $f(x_0) \in B$,
e agora pela~\byfact1~temos $y_0 \in B$.

\endexercise
%%}}}

%%{{{ x: composition_with_inverse 
\exercise.
\label{composition_with_inverse}%
Sejam conjuntos $X$ e $Y$, $f : X\to Y$, e $A\subseteq X$ e $B\subseteq Y$.
Considere as afirmações:
$$
\align
A &\askeq \pre f {\img f A}\\
B &\askeq \img f {\pre f B}.
\endalign
$$
Para cada uma delas: se podemos a concluir, prove;
e caso contrário, mostre um contraexemplo.

\hint
Nenhuma é válida em geral.
Procure contraexemplos.

\hint
O enunciado do~\ref{jection_iff_composition_with_inverse}
pode te ajudar pensar em contraexemplos.

\solution
Mostramos dois contraexemplos, um para cada afirmação.
$$
\tikzpicture
\draw (0,0) ellipse (1cm and 15mm);
\draw (3,0) ellipse (1cm and 12mm);
\draw (0,0.666) ellipse (5mm and 5mm);
\draw (-0.6,0.1) node {$A$};
\draw (0,0.666)  node {$1\,\bullet$};
\draw (0,-0.666) node {$2\,\bullet$};
\draw (3,0)  node {$\bullet\,3$};
\draw[|->] (0.3,0.6) -- (2.7,0.1);
\draw[|->] (0.3,-0.6) -- (2.7,-0.1);
\draw (0,2.0) node {$X$};
\draw (3,2.0) node {$Y$};
\draw (1.5,1.70) node {$f$};
\draw[->]  (0.5,2.0) -- (2.5,2.0);
\endtikzpicture
\qqqquad
\tikzpicture
\draw (0,0) ellipse (1cm and 12mm);
\draw (3,0) ellipse (1cm and 15mm);
\draw (3,0) ellipse (8mm and 10mm);
\draw (2.4,0.1) node {$B$};
\draw (3,0.666)  node {$\bullet\,2$};
\draw (3,-0.666) node {$\bullet\,3$};
\draw (0,0)  node {$1\,\bullet$};
\draw[|->] (0.35,0.05) -- (2.7,0.6);
\draw (0,2.0) node {$X$};
\draw (3,2.0) node {$Y$};
\draw (1.5,1.70) node {$f$};
\draw[->]  (0.5,2.0) -- (2.5,2.0);
\endtikzpicture
$$
No primeiro contraexemplo temos:
$A=\set{1}$;
$\img f A = \set {3}$; e
$\pre f {\set 3} = \set {1,2}$.
Logo
$$
A = \set{ 1 } \neq \set {1, 2} = \pre f {\img f A}.
$$
No segundo contraexemplo temos:
$B = \set{2,3}$;
$\pre f B = \set {1}$; e
$\img f {\set 1} = \set {2}$.
Logo
$$
B = \set{ 2,3 } \neq \set {2} = \img f {\pre f B}.
$$

\endexercise
%%}}}

\question.
O que muda no~\ref{composition_with_inverse} se $f$ é injetora?  Se é sobrejetora?
\spoiler.

%%{{{ jection_iff_composition_with_inverse 
\proposition.
\label{jection_iff_composition_with_inverse}%
Seja $f : X \to Y$.
$$
\align
\text{$f$ injetora}    &\iff \text{para todo $A \subseteq X$, $A = \pre f {\img f A}$}  \tag{1}\\
\text{$f$ sobrejetora} &\iff \text{para todo $B \subseteq Y$, $B = \img f {\pre f B}$}. \tag{2}
\endalign
$$
\proof.
As idas tu provarás (agora!) no~\refn{jection_implies_composition_with_inverse}.
As voltas é o~\ref{jection_iff_composition_with_inverse_proof}.
\qed
%%}}}

%%{{{ x: jection_implies_composition_with_inverse 
\exercise.
\label{jection_implies_composition_with_inverse}%
Prove as idas da~\ref{jection_iff_composition_with_inverse}.

\solution
Temos duas implicações para provar.
\endgraf
\proofpart{Ida da (i).}
Suponha que $f$ é injetora, e seja $A\subseteq X$.
Ja temos a
$$
A \subseteq \pre f {\img f A}
$$
pelo~\ref{composition_with_inverse_subsets}, então basta mostrar
$$
\pre f {\img f A} \subseteq A.
$$
Tome então $x_0 \in \pre f {\img f A}$.
Logo $f(x_0) \in \img f A$.
Logo $f(a) = f(x_0)$ para algum $a \in A$ (pela definição da função-imagem).
Mas $f$ é injetora, então $a = x_0$ e logo $x_0\in A$.
\endgraf
\proofpart{Ida da (ii).}
Suponha que $f$ é sobrejetora, e seja $Y\subseteq B$.
Ja temos a
$$
\img f {\pre f B} \subseteq B
$$
pelo~\ref{composition_with_inverse_subsets}, então basta mostrar
$$
B \subseteq \img f {\pre f B}
$$
Tome então $b \in B$.
Agora seja $x_b \in X$ tal que $f(x_b) = b$ (pois $f$ é sobrejetora).
Então $x_b \in \pre f B$.
Logo $f(x_b) \in \img f {\pre f B}$.
Logo $b \in \img f {\pre f B}$.

\endexercise
%%}}}

%%{{{ x: operations_respected_by_img 
\exercise.
\label{operations_respected_by_img}%
Sejam $f : X \to Y$, $A,B\subseteq X$.
Mostre que:
$$
\align
\img f {A\union B} &=       \img f A \union \img f B\\
\img f {A\inter B} &\askeq  \img f A \inter \img f B\\
\img f {A\minus B} &\askeq  \img f A \minus \img f B
\endalign
$$
onde nas $\askeq$ prove que a igualdade em geral não é válida,
mas uma das~\lrdirset~e~\rldirset, é.

\hint
Ataque cada direção ({\lrdirset} e {\rldirset}) da primeira separadamente.
Das duas $\askeq$, são válidas as inclusões:
$$
\align
\img f {A\inter B} &\subseteq \img f A \inter \img f B\\
\img f {A\minus B} &\supseteq \img f A \minus \img f B
\endalign
$$
Prove; e mostre contraexemplos que demonstram que as reversas
inclusões não são válidas em geral.

\solution
Vamos primeiramente provar a
$\img f {A\union B} = \img f A \union \img f B$.
\proofpart{\lrdirset}:
Tome $y \in \img f {A\union B}$.
Logo seja $x \in A\union B$ tal que $f(x) = y$.
\case{Caso $x \in A$,} temos $f(x)\in \img f A$
e logo $f(x)$ pertence na união $\img f A \union \img f B$.
\case{Caso $x \in B$,} concluímos similarmente
que $f(x) \in \img f B \subseteq \img f A \union \img f B$.
\endgraf
\proofpart{\rldirset}:
Tome $y \in \img f A \union \img f B$.
\case{Caso $y \in \img f A$,} seja $a\in A$ tal que $f(a)=y$.
Mas $a \in A\union B$, logo $y\in \img f {A\union B}$.
\case{O caso $y \in \img f B$} é similar.
\endgraf
Vamos provar a
$\img f {A\inter B} \subseteq \img f A \inter \img f B$ agora.
Tome $y \in \img f {A\inter B}$ e
seja $d \in A\inter B$ tal que $f(d) = y$.
Mas $d \in A$ e $d \in B$, ou seja $y \in \img f A$ e $y \in \img f B$,
e logo $y \in \img f A \inter \img f B$.
\endgraf
Vamos provar a
$\img f {A\minus B} \supseteq \img f A \minus \img f B$ agora.
Tome $y \in \img f A \minus \img f B$ então, ou seja
$y \in \img f A$ e $y \notin \img f B$.
Traduzindo:
$$
\lexists {a\in A} {f(a) = y}
\qquad\mland\qquad
\lforall {b\in B} {f(b) \neq y}.
$$
Usando a primeira afirmação abaixo tome $a\in A$ tal que $f(a) = y$,
e observe que graças à segunda, $a \notin B$.
Logo $a \in A\minus B$, e chegamos no desejado
$y \in \img f {A\minus B}$.
\endgraf
Finalmente, usamos apenas um contraexemplo para refutar simultaneamente
as duas inclusões que são inválidas no caso geral:
$$
\tikzpicture
\draw (0,0) ellipse (1cm and 15mm);
\draw (3,0) ellipse (1cm and 12mm);
\draw (0,.666) ellipse (5mm and 5mm);
\draw (0,-.666) ellipse (5mm and 5mm);
\draw (-0.6,0.25)  node {$A$};
\draw (-0.6,-0.25) node {$B$};
\draw (0,0.666)  node {$1\,\bullet$};
\draw (0,-0.666) node {$2\,\bullet$};
\draw (3,0)  node {$\bullet\,3$};
\draw[|->] (0.3,0.6) -- (2.7,0.1);
\draw[|->] (0.3,-0.6) -- (2.7,-0.1);
\node (X) at (0,2.0) {$X$};
\node (Y) at (3,2.0) {$Y$};
\draw[->]  (0.5,2.0) -- (2.5,2.0) node[midway, below] {$f$};
\endtikzpicture
$$
Calculamos para verificar:
$$
\aligned
\img f {A \inter B}
&= \img f \emptyset
= \emptyset \\
\img f A \inter \img f B
&= \set{3} \inter \set{3}
= \set{3}
\endaligned
\qquad
\aligned
\img f {A \minus B}
&= \img f A
= \set {3}\\
\img f A \minus \img f B
&= \set {3} \minus \set {3}
= \emptyset.
\endaligned
$$
Um contraexemplo mais pictorial, seria considerar uma função $f$
que mapeia pontos do plano $\reals^2$
para pontos da reta $\reals$, mandando cada
entrada $\tup{x,y}$ para sua ``sombra'' $x$.
Já conhecemos essa função: é a primeira projecção: $f = \pi_0$.
Observe que a $\img {\pi_0} {\dhole}$ manda cada subconjunto de $\reals^2$
para sua ``sombra'':
$$
\tikzpicture
\draw [rounded corners=8mm, fill=gray!10] (1,3)--(1,5)--(4,5)--(4,3)--cycle;
\node at (2.5,4) {$A$};
\draw [rounded corners=0mm, fill=black]   (1,-0.1)--(1,0.1)--(4,0.1)--(4,-0.1)--cycle;
\node at (2.5,-0.4) {$\img {\pi_0} A$};
\draw[-]  (-1,0) -- (6,0);
\draw[|->] (2,2.6) -- (2,0.5);
\endtikzpicture
$$
Para achar o contraexemplo agora, basta só escolher dois subconjuntos de
$\reals^2$ como esses:
$$
\tikzpicture
\draw [rounded corners=8mm, fill=gray!10] (1,3)--(1,5)--(4,5)--(4,3)--cycle;
\node at (2.5,4) {$A$};
\draw [rounded corners=3mm, fill=gray!10] (1,1)--(1,2)--(4,2)--(4,1)--cycle;
\node at (2.5,1.5) {$B$};
\draw [rounded corners=0mm, fill=black]   (1,-0.1)--(1,0.1)--(4,0.1)--(4,-0.1)--cycle;
\node at (2.5,-0.4) {$\img {\pi_0} A = \img {\pi_0} B$};
\draw[-]  (-1,0) -- (6,0);
\endtikzpicture
$$
Verifique que isso é um contraexemplo que refuta as duas igualdades
que queremos refutar.

\endexercise
%%}}}

%%{{{ x: operations_respected_by_img_of_inj 
\exercise.
\label{operations_respected_by_img_of_inj}%
Sejam $f : X \injto Y$ injetora, e $A,B\subseteq X$.
Mostre que:
$$
\align
\img f {A\inter B} &= \img f A \inter \img f B\\
\img f {A\minus B} &= \img f A \minus \img f B.
\endalign
$$

\hint
Já provou metade de cada igualdade no~\ref{operations_respected_by_img}
até sem a hipótese que $f$ é injetora.
Basta então provar as duas inclusões:
$$
\align
\img f {A\inter B} &\supseteq \img f A \inter \img f B\\
\img f {A\minus B} &\subseteq \img f A \minus \img f B.
\endalign
$$

\solution
Já provamos metade de cada igualdade no~\ref{operations_respected_by_img}
para qualquer função, então para nossa injetora $f$ também.
Basta então provar as duas inclusões:
$$
\align
\img f {A\inter B} &\supseteq \img f A \inter \img f B\\
\img f {A\minus B} &\subseteq \img f A \minus \img f B.
\endalign
$$
\proofpart{Prova de $\img f {A\inter B} \supseteq \img f A \inter \img f B$}:
Suponha $y \in \img f A \inter \img f B$.
Logo $y \in \img f A$ e $y \in \img f B$.
Tome então $a\in A$ tal que $f(a) = y$ e $b \in B$ tal que $f(b) = y$.
Juntando as duas igualdades temos $f(a) = f(b)$.
Mas $f$ é injetora, e logo $a = b$.
Ou seja, $a \in A\inter B$, e chegamos no desejado
$y \in \img f {A \inter B}$.
\endgraf\noindent
\proofpart{Prova de $\img f {A\minus B} \subseteq \img f A \minus \img f B$}:
Suponha $y \in \img f {A\minus B}$.
Tome então $a_0 \in A\minus B$ tal que $f(a_0) = y$.
Logo $a_0 \in A$ e $a_0 \notin B$.
Já sabemos então que $y \in \img f A$.
Agora usamos a injetividade da $f$ para provar que $y \notin \img f B$.
Se $y$ fosse um membro de $\img f B$, existiria $b\in B$ com $f(b) = y$.
Mas já temos o único ($f$ injetora) membro do domínio $X$ que $f$ mapeia no $y$,
o $a_0$, e sabemos que $a_0 \notin B$!
Logo $y \notin \img f B$ e chegamos no $y\in \img f A \minus \img f B$.

\endexercise
%%}}}

\blah.
A preimagem comporta bem melhor que a imagem: ela respeita
todas essas operações mesmo quando $f$ não é injetora,
algo que tu provarás agora.

%%{{{ x: operations_respected_by_pre 
\exercise.
\label{operations_respected_by_pre}%
Sejam $f : X \to Y$, $A,B\subseteq Y$.
Mostre que:
$$
\align
\pre f {A\union B} &= \pre f A \union \pre f B\\
\pre f {A\inter B} &= \pre f A \inter \pre f B\\
\pre f {A\minus B} &= \pre f A \minus \pre f B
\endalign
$$

\endexercise
%%}}}

\blah.
Essas propriedades generalizam naturalmente para uniões e intersecções
de seqüências e famílias de conjuntos;
veja por exemplo o~\ref{big_operations_respected_by_img_and_pre}.

\endsection
%%}}}

%%{{{ Higher-order functions 
\section Funções de ordem superior.

%%{{{ Holes again 
\note Buracos de novo.
Já encontramos a idéia de \emph{abstrair} certas partes de uma expressão,
botando \emph{buracos}, criando assim funções de várias aridades.
Além de buracos, trabalhamos com \emph{$\lambda$-abstracção} que nos
permitiu dar nomes para esses buracos, ligar (identificar) certos buracos, etc.
Considere novamente uma expressão como a
$$
\cos(1 + 5\cbrt2)^{2a} + \sin(5)
$$
onde $\cos : \reals\to\reals$, $\sin : \reals\to\reals$, e $a\in \reals$.
Botando uns buracos, criamos, por exemplo as funções:
$$
\alignat2
f_1&=\cos(1 + 5\cbrt2)^{\bhole a} + \sin(5)            &&\eqtype \reals   \to \reals\\
f_2&=\cos(\bhole + 5\cbrt{\bhole})^{2a} + \sin(\bhole) &&\eqtype \reals^3 \to \reals\\
f_3&=\cos(\bhole + \bhole\cbrt2)^{2\bhole} + \sin(5)   &&\eqtype \reals^3 \to \reals\\
f_4&=\cos(\bhole + \bhole)^{\bhole} + \sin(5)          &&\eqtype \reals^3 \to \reals\\
f_5&=\bhole + \sin(\bhole)                                &&\eqtype \reals^2 \to \reals\\
f_6&=\lam x {\cos(1 + 5\cbrt2)^{2x} + \sin(5)}         &&\eqtype \reals   \to \reals\\
f_7&=\lam {x,y} {\cos(1 + y\cbrt x)^{2a} + \sin(y)}    &&\eqtype \reals^2 \to \reals.
\endalignat
$$
%%}}}

%%{{{ x: verify_abstractions_of_expression 
\exercise.
\label{verify_abstractions_of_expression}%
Para quais entradas cada uma dessas funções retorna o valor da expressão inicial?

\hint
Respeite as aridades!

\solution
Temos
$$
\align
f_1&(2)\\
f_2&(1,2,5)\\
f_3&(1,5,a)\\
f_4&(1,5,2a)\\
f_5&(\cos(1 + 5\cbrt2)^{2a}, 5)\\
f_6&(a)\\
f_7&(2, 5).
\endalign
$$

\endexercise
%%}}}

%%{{{ Higher-order holes 
\note Buracos de ordem superior.
Em todos os exemplos acima, botamos os buracos para substituir
apenas termos cujos valores seriam números (reais).
Expressões tanto como as $2$, $1$, $5$, e $a$,
quanto como as $5\cbrt2$, $2a$, e $cos(1 + 5\cbrt2)^{2a}$,
denotam, no final das contas, números reais.
Que tal botar um buraco assim:
$$
\cos(1 + 5\cbrt2)^{2a} + \bhole(5)
$$
O que substituimos aqui?  O próprio $\sin$!  Por quê não?
E o que tipo de objetos podemos botar nesse buraco?
Um real, não serve: a expressão
$$
\cos(1 + 5\cbrt2)^{2a} + 7(5)
$$
não faz sentido: ela é \dterm{mal-tipada}.
O $7$ não pode receber um argumento como se fosse uma função, pois não é.
Que tipo de coisa então caiba nesse buraco?
Funções!
E não funções quaisquer, mas precisam ter um tipo compatível,
com a aridade certa, etc.
Esses buracos são \emph{de ordem superior}.
E com buracos de ordem superior, vêm funções de ordem superior.
%%}}}

%%{{{ pseudodf: higher_order_function 
\pseudodefinition.
\label{higher_order_function}%
\tdefined{função}[de ordem superior]%
Dizemos que uma função $f : A \to B$ é de \dterm{ordem superior}
se ela recebe ou retorna funções.
%%}}}

%%{{{ x: type_higher_order_holed_expressions 
\exercise.
\label{type_higher_order_holed_expressions}%
Escreva os tipos das funções seguintes:
$$
\align
F_1 &= \cos(1 + 5\cbrt2)^{2a} + \bhole(5)\\
F_2 &= \bhole(1 + 5\cbrt2)^{2a} + \sin(5)\\
F_3 &= \bhole(1 + 5\cbrt2)^{2a} + \bhole(5)\\
F_4 &= \cos(\bhole(1,5\cbrt2)^{2a} + \sin(5)\\
F_5 &= \cos(\bhole(1,5\cbrt2)^{2a} + \bhole(\bhole)\\
F_6 &= \lam {r,t,u} {\cos(1 + r(u,\cbrt2))^{r(t,a)} + \sin(u)}
\endalign
$$

\solution
Temos
$$
\alignat2
F_1 &= \cos(1 + 5\cbrt2)^{2a} + \bhole(5)                          &&\eqtype (\reals\to\reals) \to \reals\\
F_2 &= \bhole(1 + 5\cbrt2)^{2a} + \sin(5)                          &&\eqtype (\reals\to\reals) \to \reals\\
F_3 &= \bhole(1 + 5\cbrt2)^{2a} + \bhole(5)                           &&\eqtype \paren{(\reals\to\reals)\times(\reals\to\reals)} \to \reals\\
F_4 &= \cos(\bhole(1,5\cbrt2)^{2a} + \sin(5)                    &&\eqtype (\reals^2\to\reals)\to\reals\\
F_5 &= \cos(\bhole(1,5\cbrt2)^{2a} + \bhole(\bhole)                &&\eqtype \paren{(\reals^2\to\reals)\times(\reals\to\reals)\times\reals}\to\reals\\
F_6 &= \lam {r,t,u} {\cos(1 + r(u,\cbrt2))^{r(t,a)} + \sin(u)}  &&\eqtype \paren{(\reals^2\to\reals)\times\reals\times\reals}\to\reals
\endalignat
$$

\endexercise
%%}}}

%%{{{ Returning functions 
\note Retornando funções.
Até agora encontramos exemplos onde funções recebem como argumentos outras funções,
mas aindo não conhecemos alguma função que \emph{retorna função}.
Ou sera que conhecemos?
Seguem uns exemplos de operadores de ordem superior que você talves já
encontrou e até usou na tua vida.
%%}}}

%%{{{ Defining higher-order functions 
\note Definindo funções de ordem superior.
Considere a função $F : \reals \to (\reals \to \reals)$ definda pela
$$
F(w) = \text{aquela função $f : \reals \to \reals$ que quando recebe um $x$, retorna $w + x$}.
$$
%%}}}

%%{{{ Q: what type of thing is F(25)? 
\question.
Que tipo de coisa é o $F(25)$?
%%}}}
\spoiler.

%%{{{ Answer 
\note.
Antes de responder nessa pergunta, vamos responder numa outra, ainda mais específica:
o que \emph{é} o $F(25)$?
Ou seja:
$$
F(25) = \dots?\dots
$$
Não precisamos pensar nada profundo!
Vamos apenas \emph{copiar fielmente} sua definição (no lado depois do ``$=$''), substituindo cada ocorrência de $w$, por $25$:
$$
F(25) = \text{aquela função $f : \reals \to \reals$ que quando recebe um $x\in\reals$, retorna o número $25 + x$}.
$$
Ou seja,
$$
F(25) : \reals\to\reals.
$$
Sendo função, podemos a chamar com um argumento do certo tipo, por exemplo como o $3\in\reals$, e a evaluar:
$$
\paren{F(25)}(3) = 28.
$$
%%}}}

%%{{{ x: where_did_28_come_from 
\exercise.
\label{where_did_28_come_from}%
De onde chegou esse $28$?

\solution
Seguindo a definição da $F(25)$ ela é a função que recebendo um valor (agora tá recebendo o $3$), retorna a soma de $25$ e esse valor:
$25 + 3 = 28$.

\endexercise
%%}}}

%%{{{ With lambdas 
\note Com lambdas.
\ii{função!anônima}%
Observe que na definição de $F(w)$, apareceu a frase ``aquela função $f$\dots''.
Assim baptizamos temporariamente essa função com um nome (``$f$'') à toa:
apenas para referir a ela e a retornar.
Usando a $\lambda$-notação, essa definição fica mais direta, mais elegante,
e (logo) mais legível:
$$
F(w) = \lam x {w + x} \quad \eqtype \reals \to \reals
$$
Observe que no lado direito aparece uma função anônima.
%%}}}

%%{{{ x: find_expressions_with_given_types 
\exercise.
Escreva $\lambda$-expressões que podem ser consideradas como funções com os
tipos seguintes:
$$
\align
F_1&: \reals \to \reals \\
F_2&: \reals \to (\reals \to \reals) \\
F_3&: (\reals \to \reals) \to \reals \\
F_4&: (\reals \to \reals) \to (\reals \to \reals) \\
F_5&: (\reals^2 \to \reals) \to \reals \\
F_6&: (\reals^2 \to \reals) \to (\reals \to (\reals \to \reals)).
\endalign
$$

\endexercise
%%}}}

%%{{{ x: find_expressions_with_given_types_abstract 
\exercise.
Escreva $\lambda$-expressões que podem ser consideradas como funções com os
tipos seguintes, onde $A,B,C$ são conjuntos sobre quais tu não pode assumir
absolutamente nada mais!
Para cada um dos típos, tente escrever as mais $\lambda$-expressões realmente
diferentes que tu consegues.
Cuidado: para uns deles não é possível achar nenhuma!
$$
\align
&: A \to A \\
&: (A \times B) \to A \\
&: (A \times B) \to B \\
&: (A \times B) \to (B \times A) \\
&: A \to B \\
&: A \to (B \to A) \\
&: A \to (B \to B) \\
&: (A \to A) \to A \\
&: (A \to (B \to C) \to ((A\times B)\to C)) \\
&: ((A\times B)\to C) \to (A \to (B \to C))
\endalign
$$

\endexercise
%%}}}

\blah.
Funções de ordem superior não é algo tão desconhecido como talvez aparece.
O leitor já está acostumado com os operadores nos exemplos seguintes:

%%{{{ eg: higher_order_example_composition 
\example Composição.
\label{higher_order_example_composition}%
Sejam conjuntos $A,B,C$.
O operador da composição $\of$ (que decoramos com $_{A,B,C}$ aqui para especificar o domínio e codomínio dele) é o seguinte:
$$
\dhole\of_{A,B,C}\dhole : \bigparen{(B\to C) \times (A\to B)} \to (A\to C).
$$
Observe que ela é um operador de ordem superior, pois seus (dois) argumentos
são funcões, e tambem pois sua saida também é uma função.
\endexample
%%}}}

%%{{{ eg: higher_order_example_apply 
\example Apply.
Suponha $f : A \to B$ e seja $a \in A$.
Quando escrevemos $f\app a$ (ou $f(a)$), estamos denotando a aplicação da $f$ no $a$.
Essa aplicação é uma operação de ordem superior também.
O símbolo da aplicação é invisível, ou seja, a aplicação é denotada pela juxtaposição da função e do seu argumento.
Em vez de escrever algo do tipo
$$
\namedfun{apply}(f, a)
$$
escrevemos simplesmente $f\app a$ ou $f(a)$.
Como fizemos na composição, decoramos essa operação com $_{A,B}$
para estudar o domínio e codomínio de cada caso.
Então dados conjuntos $A,B$ temos
$$
\namedfun{apply}_{A,B} : \bigparen{(A \to B) \times A} \to B
$$
que é claramente uma operação de ordem superior.
\endexample
%%}}}

%%{{{ eg: higher_order_example_derivation 
\example Derivação.
\label{higher_order_example_derivation}%
Considere o operador da derivação
$$
D(\dhole) : C^\infty \to C^\infty
$$
onde $C^\infty$ é o conjunto de todas as funções infinitamente deriváveis.
Por exemplo, se $f(x) = x^3 + 5x$, temos
$$
D(f) = g
$$
onde $g(x) = 3x^2 + 5$.
Cuidado, não escrevemos aqui $D(f) = 3x^2 + 5$, mas podemos escrever
$$
D(f) = \lam x {3x^2 + 5}
$$
sim.
\endexample
%%}}}

%%{{{ eg: higher_order_example_integration 
\example Integração.
\label{higher_order_example_integration}%
De novo uns exemplos de calculus: a integração definitiva e indefinitiva.
Sejam $a,b\in\reals$ com $a<b$ e seja
$$
R[a,b] \defeq \setstt {f : [a,b] \to \reals} {$f$ é \Riemann{}Riemann-integrável}.
$$
Observe que $R[a,b]$ é um conjunto de funções.
Definimos o operador
$$
\lam f {\lam x {\int_a^{x} f}} : R[a,b] \to ([a,b] \to \reals)
$$
cujo argumento é uma função---e ainda mais,
sua saida também é uma função---e logo ele é um operador de ordem superior
também.
Para a integração indefinita, seja
$$
R \defeq \setstt {f : \reals\to\reals} {$f$ é Riemann-integrável}
$$
e defina um operador
$$
\int\dhole : R \to \pset{(\reals\to\reals)}
$$
tal que
$$
\int f = \setst {F : \reals\to\reals} {D(F) = f}.
$$
Observe que a notação comum em análise é diferente: usamos por exemplo
$\int_a^x f(t)\, dt$, e o $\int f$ é visto como uma antiderivada
(que depende numa constante $C$) e não como o conjunto de todas
essas antiderivadas como definimos aqui.
\endexample
%%}}}

\endsection
%%}}}

%%{{{ Currying 

\section Currificação.

\note Ha-ha! Minha linguagem é melhor que a tua.
Imagine que um amigo definiu uma função $f : \ints^2\to\ints$
trabalhando numa linguagem de programação que não permite
definições de funções de ordem superior.
Queremos escrever um programa equivalente ao programa do nosso amigo
numa outra linguagem que permite sim definir funções de ordem superior
mas não funções de aridade maior que $1$.
Mesmo assim nossas funções podem \emph{chamar} a função $f$ do nosso amigo nos seus corpos.

\question.
Como fazer isso?
\spoiler.

%%{{{ Currying in Python 
\note Currificação em Python.
\label{currying_in_python}%
Aqui uma resposta, escrita em Python.
%%}}}

\sourcecode currying.py;

\TODO Explicar o que acontece.

%%{{{ x: uncurry_exercise 
\exercise Uncurry.
Resolva o problema converso:
começando com a função ``currificada'' de ordem superior $F$,
defina sua versão ``decurrificada'' $f$ (de aridade 2).

\solution
Dados a $F : \ints\to(\ints\to\ints)$,
é só definir a $f : \ints^2\to\ints$ pela $f(x,y) = F(x)(y)$.
Note que a expressão ``$F(x)(y)$'' quis dizer ``$\bigparen{F(x)}(y)$'' mesmo.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Partial functions 
\section Funções parciais.
\label{Partial_functions}%

\blah.
A restrição que uma função $f : A \to B$ precisa ser \emph{totalmente} definida no $A$,
não nos permite considerer naturalmente situações onde um certo programa, por exemplo,
retorna valores para certas entradas aceitáveis, e para as outras não: talvez
ele fica num \emph{loop infinito}; ou ele faz a máquina explodir; ou simplesmente
não termina com uma saida---não importa o porquê.
Definimos então o conceito de \emph{função parcial}, que é exatamente isso:
funções que para certas entradas aceitáveis delas, possivelmente \dterm{divergem}.

%%{{{ df: partial_function 
\definition.
\label{partial_function}%
\tdefined{função}[parcial]%
\sdefined {\holed f : \holed A \parto \holed B} {$f$ é uma função parcial de $A$ para $B$}%
\sdefined {(\holed A \parto \holed B)} {o conjunto das funções parciais de $A$ para $B$}%
Sejam $A,B$ conjuntos.
Chamamos a $f$ uma \dterm{função parcial} de $A$ para $B$ sse:
$$
\text{para todo $x\in A$, se $f(x)$ é definido então $f(x) \in B$.}
$$
Nesse caso, chamamos \dterm{domínio} o conjunto
$$
\dom f \defeq \setstt {x \in A} {$f(x)$ é definido}
$$
e \dterm{codomínio} o $B$ mesmo.
Escrevemos $f : A \parto B$ para ``$f$ é uma função parcial de $A$ para $B$''.
Naturalmente denotamos o conjunto de todas as funções parciais de $A$ para $B$ por
$$
(A \parto B) \defeq \setst f {f : A \parto B}.
$$
%%}}}

%%{{{ remark: total vs partial: default 
\remark.
Com essas definições cada função total é uma função parcial.
Escrevemos esse ``total'' quando queremos enfatizar, mas normalmente
``função'' sem o adjetivo ``parcial'' significa ``função total''.
Claramente, quando trabalhamos principalmente com funções parciais,
seguimos a convenção oposta.
%%}}}

%%{{{ remark: partial function conditions 
\remark Condições.
Encontramos então aqui o que acontece se apagar a primeira das
condições~\refn{functionhood_conditions}:
\beginil
\item{}\strikeout{(1)~totalidade};
\item{}(2)~determinicidade.
\endil
e ficar só com a (2).
No~\ref{Relations} vamos estudar também o caso onde apagamos ambas as condições.
%%}}}

\endsection
%%}}}

%%{{{ Fixpoints 
\section Fixpoints.
\label{Fixpoints}%

%%{{{ df: fixpoint 
\definition Fixpoint.
\label{fixpoint}%
\tdefined{fixpoint}%
\iisee{função!fixpoint}{fixpoint}%
Seja $f : A \to A$ um endomapa num conjunto $A$.
Chamamos \dterm{fixpoint} da $f$ qualquer $x\in A$ tal que
$f(x) = x$.
%%}}}

%%{{{ x: fix_f_properties 
\exercise.
\label{fix_f_properties}%
Seja $f : A \to A$,
e seja $F$ o conjunto de todos os fixpoints da $f$.
$$
F = \setstt {x \in A} {$x$ é um fixpoint da $f$}
$$
Quais das igualdades seguintes podemos concluir?:
$$
\xalignat2
\img f F &= F &
\pre f F &= F
\endxalignat
$$
Prove aquelas que sim; mostre um contraexemplo daquelas que não,
mas verifique se alguma das duas inclusões
{\lrdirset} ou {\rldirset} é válida.
O que muda se $f$ é injetora?

\solution
Sempre temos $\img f F = F$ e $\pre f F \supseteq F$.
Se $f$ é injetora, ganhamos a $\pre f F \subseteq F$ também.
\endgraf
\proofpart{Prova de $\img f F \subseteq F$.}
Seja $y\in\img f F$.
Logo tome $p\in F$ tal que $f(p) = y$\fact1 (pela definição da função-imagem).
Logo $p$ é um fixpoint da $f$, ou seja, $f(p) = p$\fact2.
Juntando as {\byfact1} e~{\byfact2}, ganhamos $p = y$, ou seja $y$ é um fixpoint da $f$, e logo $y\in F$.
\endgraf
\proofpart{Prova de $\img f F \supseteq F$.}
Seja $p \in F$.
Logo $f(p) \in \img f F$ (pela definição da função-imagem).
Mas $p$ é um fixpoint da $f$ (pois $p\in F$), ou seja $f(p) = p$.
Logo $p \in \img f F$.
\endgraf
\proofpart{Prova de $\pre f F \supseteq F$.}
Seja $p \in F$, ou seja $p$ é um fixpoint da $f$.
Logo $f(p) = p \in F$, e logo $p \in \pre f F$.
\endgraf
\proofpart{Contraexemplo para $\pre f F \subseteq F$.}
Tome $A = \set{0,1}$ e defina $f$ pela $f(x) = 0$.
Nesse caso temos $F = \set{0}$, mas $\pre f F = \set{0,1}$.
\endgraf
\proofpart{Prova da $\pre f F \subseteq F$ quando $f$ injetora.}
Seja $a\in \pre f F$.
Logo $f(a)$ é um fixpoint da $f$.
Ou seja, $f(f(a)) = f(a)$
Agora, como $f$ é injetora, temos $f(a) = a$, ou seja,
$a$ é um fixpoint também e logo $a\in F$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ how_many_idempotents_on_AtoA_for_A_finite 
\problem.
\label{how_many_idempotents_on_AtoA_for_A_finite}%
Generalize o~\ref{how_many_idempotents_on_AtoA_for_A_triset} para
um arbitrário conjunto finito $A$.

\hint
Seja $n = \card A$.

\endproblem
%%}}}

%%{{{ constant_function_why_did_we_omit_unique
\problem.
\label{constant_function_why_did_we_omit_unique}%
Na definição do~\ref{constant_function_different_def}
não escrevemos ``existe único'', mas apenas ``existe''.
O que mudaria com esse ``único''?
Prove tua afirmação.

\hint
Lembra se que a definição é apenas aplicável numa \emph{função}.
Mas cuidado com os casos especiais que invólvem o $\emptyset$.

\solution
\emph{Quase} nada!
Parece ser redundante, pois a definição é aplicavel numa \emph{função}
e graças à determinicidade sabemos que se existe, tem que ser
único---mas!
Vamos tentar provar para achar algo interessante.
\endgraf
Suponha que temos $b,b'\in B$ que satisfazem a condição, ou seja,
temos:
$$
\align
\text{para todo $x \in A$,}& f(x) = b \\
\text{para todo $x \in A$,}& f(x) = b'
\endalign
$$
Logo se $x\in A$, temos
$$
b = f(x) = b',
$$
ou seja, unicidade mesmo desse $b$,
dado qualquer $x\in A$.
Mas isso é, supondo que $A\neq\emptyset$.
O que acontece se $A=\emptyset$ e $B\neq\emptyset$?
Botando esse ``único'' na definição, uma função
$$
\emptyset\toarrow f B
$$
vai ser constante sse $B$ é um singleton.
Sem o ``único'', ela vai ser constante sse $B\neq\emptyset$.

\endproblem
%}}}

%%{{{ type_of_restriction_op_with_hole 
\problem.
\label{type_of_restriction_op_with_hole}%
Sejam $f : A\to B$ e $X\subseteq A$.
Ache o tipo dos:
$$
\align
f\resto X       &\eqtype ?\\
f\resto \dhole  &\eqtype ?\\
(\dhole\resto X)\resto(A \to B)
                &\eqtype ?
\endalign
$$

\solution
Temos
$$
\align
f\resto X       &\eqtype X \to B\\
f\resto \dhole  &\eqtype \pset A \to \Unionl_{X\in\pset A}(X\to B)\\
(\dhole\resto X)\resto (A \to B)
                &\eqtype \paren{(A \to B) \to (X \to B)}
\endalign
$$

\endproblem
%%}}}

%%{{{ first_contact_with_initial_and_terminal_objects 
\problem Objetos iniciais e terminais.
\label{first_contact_with_initial_and_terminal_objects}%
(1) Quais conjuntos $S$ (se algum) têm a propriedade seguinte?:
$$
\text{para todo conjunto $A$, existe única função $f:S \to A$.}
$$
(2) Quais conjuntos $T$ (se algum) têm a propriedade seguinte?:
$$
\text{para todo conjunto $A$, existe única função $f:A \to T$.}
$$

\solution
(1) Apenas o conjunto vazio:
a única função que existe de $\emptyset$ para $A$,
é a função vazia.
Se $S \neq \emptyset$ tome $s\in S$ e considere
o conjunto $A = \set{0,1}$.
Já temos duas funções diferentes $f,g : S \to A$:
basta apenas diferenciar elas no $s$.
Tome por exemplo $f = \lam x 0$ e $g = \lam x 1$.
Como $f(s) = 0 \neq 1 = g(s)$, temos $f\neq g$.
(2) Todos os singletons.
Se $T = \emptyset$, tome $A\neq\emptyset$ e observe
que não existe nenhuma função $f : A \to T$.
E se $\card T > 1$, tome $u,v\in T$ com $u\neq v$
e considere o $A = \set 0$.
Já temos duas funções $f,g : A \set T$:
a $f = \lam x u$ e a $g = \lam x v$.
Elas são realmente distintas,
pois $f(0) = u \neq v = g(0)$, e logo $f\neq g$.

\endproblem
%%}}}

%%{{{ epimono_factorization 
\problem.
\label{epimono_factorization}%
Sejam $A \toarrow f B$.
Então existem: injecção $m$, surjecção $e$, e conjunto $C$
tais que o diagrama seguinte comuta:
$$
\cdopt{sep=1cm}
A   \ar[rr, "f"]\ar[dr, twoheadrightarrow, "e"']\|  \| B \\
                                                \| C \ar[ur, rightarrowtail, "m"']
\endcd
$$

\endproblem
%%}}}

%%{{{ jection_iff_composition_with_inverse_proof
\problem.
\label{jection_iff_composition_with_inverse_proof}%
Prove a~\ref{jection_iff_composition_with_inverse}.

\solution
Já provou as idas no~\refn{jection_implies_composition_with_inverse}.
Vamos provar as voltas.
\endgraf
\proofpart{Volta da (1).}
Suponha a hipótese:
$$
\text{para todo $A \subseteq X$, $A = \pre f {\img f A}$}.
$$
Para mostrar que $f$ é injetora, suponha que $x,x'\in X$ tais que $f(x) = f(x')$.
Basta verificar que $x = x'$.
Considere o conjunto $A = \set{x}$.
Observe que $A \subseteq X$, e logo pela hipótese temos
$$
A = \pre f {\img f A}.\tag{A}
$$
Temos $f(x) \in \img f A$ pela definição da função-imagem.
Como $f(x') = f(x)$ temos também $f(x') \in \img f A$.
Logo
$$
x, x' \in \pre f {\img f A} \eqlabel A A = \set{x}.
$$
Como $x, x' \in \set{x}$, logo $x = x'$.
\endgraf
\proofpart{Volta da (2).}
Suponha a hipótese:
$$
\text{para todo $B \subseteq Y$, $B = \img f {\pre f B}$}.
$$
Tome $y_0\in Y$.
Para mostrar que $f$ é sobrejetora
basta mostrar que $\pre f {\set{y_0}} \neq \emptyset$.
Considere o
$$
B = \set{y_0} \subseteq Y
$$
e logo pela hipótese temos
$$
B = \img f {\pre f B}.\tag{B}
$$
Ou seja, $\pre f B \neq \emptyset$
(caso contrário teriamos
$$
B
\eqlabel B \img f {\pre f B}
= \img f {\emptyset}
= \emptyset
$$
que é absurdo pois $B = \set{y_0}$).
Isso mostra que $f$ é sobrejetora.

\endproblem
%%}}}

%%{{{ big_intersection_respected_by_img_wrong_proof 
\problem.
\label{big_intersection_respected_by_img_wrong_proof}%
Um aluno ``provou'' que se $f : A \to B$ e $\sequence A n$ é uma
seqüência de subconjuntos de $A$, então
$$
\img f {\Interl_{n=0}^\infty A_n} = \Interl_{n=0}^\infty \img f {A_n}.
$$
Sua ``prova'' foi a seguinte:
\quote{\noindent
<<Calculamos:
$$
\alignat2
b \in \img f {\Interl_{n=0}^\infty A_n}
&\ifflabel1 \lexists {a \in \Interl_{n=0}^\infty A_n} {f(a) = b}            \qqby{def.~$\img f {\dhole}$}\\
&\ifflabel2 \exists a \paren{a \in \Interl_{n=0}^\infty A_n \land f(a) = b} \qqby{lógica}\\
&\ifflabel3 \exists a \paren{\forall n \paren{a \in A_n} \land f(a) = b}    \qqby{def.~$\Interl_{n=0}^\infty$}\\
&\ifflabel4 \exists a \paren{\forall n \paren{a \in A_n \land f(a) = b}}    \qqby{lógica}\\
&\ifflabel5 \exists a \forall n \paren{a \in A_n \land f(a) = b}            \qqby{lógica}\\
&\ifflabel6 \forall n \exists a \paren{a \in A_n \land f(a) = b}            \qqby{lógica}\\
&\ifflabel7 \forall n \lexists {a \in A_n} {f(a) = b}                       \qqby{lógica}\\
&\ifflabel8 \forall n \paren{b \in \img f {A_n}}                            \qqby{def.~$\img f {\dhole}$}\\
&\ifflabel9 b \in \Interl_{n=0}^\infty {\img f {A_n}}                       \qqby{def.~$\Interl_{n=0}^\infty$}
\endalignat
$$
Logo temos
$\img f {\Interl_{n=0}^\infty A_n} = \Interl_{n=0}^\infty \img f {A_n}$
pela definição de igualdade de conjuntos.>>
}
Ache os seus erros.

\hint
O problema está na $\ifflabel6$.
Uma da suas direções não é válida.

\solution
O problema é com a direção {\rldir} da $\ifflabel6$:
$$
\alignat2
\cdots\iff  \exists a \forall n \paren{a \in A_n \land f(a) = b}
&\ifflabel6 \forall n \exists a \paren{a \in A_n \land f(a) = b} \qqby{lógica}
\endalignat
$$
Saber que
\emph{existe $a$ tal que para todo $n$ algo $P(a,n)$ acontece}
é uma afirmação bem mais forte do que saber que
\emph{para todo $n$ existe algum $a$ tal que $P(a,n)$ acontece}.
Na primeira temos pelo menos um $a$ que serve para todo $n$,
mas na segunda pode ser que para cada $n$, o $a$ ``que serve''
é diferente.  Para enfatisar essa dependência podemos escrever:
\emph{para todo $n$ existe algum $a_n$ tal que $P(a_n, n)$}.
É por isso que a ida é válida mas a vólta, em geral, não é.
Compare com o~\ref{wrong_order_of_quantifiers}.

\endproblem
%%}}}

%%{{{ big_operations_respected_by_img_and_pre 
\problem.
\label{big_operations_respected_by_img_and_pre}%
{%
\def\I{{\cal I}}%
\def\J{{\cal J}}%
Sejam $f : A \to B$, e duas famílias indexadas de conjuntos:
$\famil A i \I$ feita por subconjuntos de $A$, e
$\famil B j \J$ feita por subconjuntos de $B$.
Ou seja, par todo $i\in \I$, e todo $j \in \J$,
temos $A_i \subseteq A$ e $B_j \subseteq B$.
Mostre que:
$$
\align
\img f {\Unionl_{i \in \I} A_i} &=      \Unionl_{i \in \I} \img f {A_i} \tag1\\
\img f {\Interl_{i \in \I} A_i} &\askeq \Interl_{i \in \I} \img f {A_i} \tag2\\
\pre f {\Unionl_{j \in \J} B_j} &=      \Unionl_{j \in \J} \pre f {B_j} \tag3\\
\pre f {\Interl_{j \in \J} B_j} &=      \Interl_{j \in \J} \pre f {B_j} \tag4
\endalign
$$
onde na $\askeq$ prove que a igualdade em geral não é válida,
mas uma das~{\lrdirset}~e~{\rldirset} é.
Prove-a, e, supondo que $f$ é injetora, prove a outra também.
}

\solution
{%
\def\I{{\cal I}}%
\def\J{{\cal J}}%
\proofpart{(1)}:
Provamos cada direção separadamente.
{\lrdirset}:
Seja $b \in \img f {\Union_{i\in\I} A_i}$.
Seja $a\in\Union_{i\in\I} A_i$ tal que $f(a) = b$\fact1 (pela definição de função-imagem).
Agora tome $i\in\I$ tal que $a\in A_i$\fact2.
Agora pelas~\byfact1,\byfact2~temos que $b\in\img f {A_i}$.
Ou seja, $b \in \Union_{i\in\I} \img f {A_i}$.
{\rldirset}:
Seja $b \in \Union_{i\in\I} \img f {A_i}$.
Seja $i\in\I$ tal que $b\in \img f {A_i}$.
Tome $a\in A_i$ tal que $f(a) = b$\fact1.
Como $a\in A_i$, logo $a\in\Union_{i\in\I} A_i$ e agora pela~\byfact1
ganhamos $b \in \img f {\Union_{i\in\I} A_i}$.
\endgraf
\proofpart{(2)}:
Provamos primeiro a {\lrdirset} que é verdade para toda $f$,
e mostramos que se $f$ é injetora, a {\rldirset} também é válida.
{\lrdirset}:
Seja $b \in \img f {\Inter_{i\in\I} A_i}$.
Logo tome $a \in \Inter_{i\in\I} A_i$\fact1 tal que $f(a) = b$\fact2.
Agora, como $a$ pertence em todos os $A_i$'s e $f(a) = b$,
então para cada $i\in\I$, $b\in\img f {A_i}$.
Ou seja, $b$ pertence em todos os $\img f {A_i}$'s.
Chegamos então no desejado $b\in\Inter_{i\in\I} \img f {A_i}$.
\endgraf
{\rldirset}:
Para essa direção vamos supor que $f$ é injetora.
Tome $b\in\Inter_{i\in\I} \img f {A_i}$, ou seja $b$
pertence em todos os $\img f {A_i}$'s.
Ou seja, para cada um dos $A_i$'s, existe $a_i\in A_i$
tal que $f(a_i) = b$.
Mas a $f$ é injetora, então todos esses $a_i$'s são iguais;
seja $a$ então esse membro comum dos $A_i$'s.
Temos então que:
$a \in \Inter_{i\in\I} {A_i}$ e $f(a) = b$.
Ou seja, $b \in \img f {\Inter_{i\in\I} A_i}$.
\endgraf
\proofpart{(3)}:
Calculamos:
$$
\alignat2
a \in \pre f {\Unionl_{j\in\J} B_j}
&\iff f(a) \in \Unionl_{j\in\J} B_j         \qqby {def.~$\pre f {\Unionl_{j\in\J} B_j}$}\\
&\iff \lexists {j\in\J} {f(a) \in B_j}      \qqby {def.~$\Unionl_{j\in\J} B_j$}\\
&\iff \lexists {j\in\J} {a \in \pre f {B_j}}\qqby {def.~$\pre f {B_j}$}\\
&\iff a \in \Unionl_{j\in\J} {\pre f {B_j}}.\qqby {def.~$\Unionl_{j\in\J} {\pre f {B_j}}$}
\endalignat
$$
Ou seja, $\pre f {\Unionl_{j \in \J} B_j} = \Unionl_{j \in \J} \pre f {B_j}$.
\endgraf
\proofpart{(4)}:
{\lrdirset}:
Seja $a \in \pre f {\Inter_{i\in\J}^\infty B_j}$.
Logo $f(a) \in {\Inter_{i\in\J}^\infty B_j}$,
ou seja, para todo $i\in\J$, $f(a) \in B_j$.
Logo $a \in \pre f {B_j}$ para todo $i\in\J$, ou seja,
$a \in {\Inter_{i\in\J}^\infty \pre f {B_j}}$.
{\rldirset}.
Similar: é só seguir os passos da {\lrdirset} em reverso.
}

\endproblem
%%}}}

%%{{{ injto_surfrom_powerset 
\problem.
\label{injto_surfrom_powerset}%
Seja conjunto $A\neq\emptyset$.
Defina funções $f,g$ com os tipos seguintes:
$$
\align
f &: A \injto \pset A \\
g &: \pset A \surto A.
\endalign
$$
Prove que:
(i) a $f$ é injetora;
(ii) a $f$ não é sobrejetora;
(iii) a $g$ é sobrejetora;
(iv) a $g$ não é sobrejetora.

\hint
Cuidado: sobre o $A$ não podes supor nada mais que $A\neq\emptyset$.

\hint
A parte do problema sobre a $f : A \injto \pset A$ foi resolvida
no~\ref{x_mapsto_singleton_x_properties}.
Falta a parte sobre a $g : \pset \surto A$.

\hint
É para a parte do problema sobre a $g : \pset A \surto A$
que precisas o $A\neq\emptyset$.

\hint
Seja $a_0 \in A$.  Defina a $g : \pset A \to A$ pela
$$
g(X) = \knuthcases{
\dots?\dots, & $\dots?\dots$ \cr
\dots?\dots, & caso contrário.
}
$$
Novamente: cuidado para não supor nada mais que $A\neq\emptyset$
sobre o $A$.  Por exemplo: não sabemos se $A$ tem \emph{mais}
que um elemento (sabemos apenas que tem \emph{pelo menos} um);
não sabemos se os membros dele são ordenados; etc.
Se a gente soubesse que os membros de $A$ são \emph{bem ordenados}
a gente poderia definir o primeiro caso acima pela
$$
g(X) = \knuthcases{
\min X, & se $X \neq \emptyset$ \cr
\dots?\dots, & caso contrário.
}
$$
mas sem a informação que o $A$ é bem ordenado a $g$ não seria
bem definida.
Por enquanto: um conjunto é chamado \dterm{bem ordenado} sse todo
$\emptyset\subsetneq X \subseteq A$ possui elemento mínimo.
No~\ref{Wellorderings_and_transfinite_induction}
estudamos conjuntos bem ordenados e suas propriedades.

\hint
Seja $a_0 \in A$.  Defina a $g : \pset A \to A$ pela
$$
g(X) = \knuthcases{
x,   & se $X$ é o singleton $\set{x}$ \cr
a_0, & caso contrário.
}
$$
Falta provar que ela é sobrejetora e que não é injetora.

\solution
A parte do problema sobre a $f : A \injto \pset A$ foi resolvida
no~\ref{x_mapsto_singleton_x_properties}, onde definimos a
$f : A \to \pset A$ pela $f(x) = \set{x}$ e provamos as (i)--(ii).
\endgraf
Fixe $a_0 \in A$ ($A\neq\emptyset$) e defina a $g : \pset A \to A$ pela
$$
g(X) = \knuthcases{
x,   & se $X$ é o singleton $\set{x}$\cr
a_0, & caso contrário.
}
$$
\endgraf
(iii) \proofpart{A $g$ é sobrejetora.}
Seja $y \in A$.  Observe que $g(\set{y}) = y$.
Como $\set{y}\in\pset A$, temos que $g$ é sobrejetora.
\endgraf
(iv) \proofpart{A $g$ não é injetora.}
Observe que $\emptyset, \set{a_0} \in \pset A$ e que $\emptyset \neq \set{a_0}$,
mas mesmo assim $g(\emptyset) = a_0 = g(\set{a_0})$.
Logo, $g$ não é injetora.

\endproblem
%%}}}

%%{{{ double_or_reverse_string_inj_or_surj 
\problem.
\label{double_or_reverse_string_inj_or_surj}%
Seja~$S$ o conjunto de todos os strings \emph{não vazios}
dum alfabeto $\Sigma$, com $\card{\Sigma} \geq 2$.
Considere a função
$f : S \times \set{0,1} \to S$ definida pela:
$$
f(w,i) =
\knuthcases{
ww, &se $i = 0$\cr
w', &se $i = 1$
}
$$
onde $w'$ é o string reverso de $w$,
e onde denotamos a concatenação de strings por juxtaposição.
(1) A $f$ é injetora?
(2) A $f$ é sobrejetora?

\hint
Quais são o domínio e o codomínio da $f$?

\solution
(i) Não, $f$ não é injetora.
Tome uma letra do alfabeto $a\in\Sigma$ e observe que
$$
f(a, 0) = aa = f(aa,1).
$$
Como $(a,0) \neq (aa,1)$, a $f$ não é injetora.
\endgraf
(ii)
Sim, $f$ é sobrejetora.
Tome um aletorio string $w\in S$, e seja $w'$ o string reverso de $w$.
Temos
$$
f(w',1) = (w')' = w.
$$

\endproblem
%%}}}

%%{{{ projection_inj_or_surj 
\problem.
\label{projection_inj_or_surj}%
Sejam $A\neq\emptyset$ conjunto, $n\in\nats_{>0}$, e $I=\set{ i\in\nats \st i < n}$.
Considere a função $\pi : I \times A^n \to A$ definida por
$$
\pi(i, \alpha)
= \pi_i(\alpha)
\qquad\Bigparen{
= \text{o $i$-ésimo elemento da tupla $\alpha$}
}
$$
onde consideramos o primeiro membro duma tupla seu ``$0$-ésimo'' membro, etc.
Investigue a injetoridade e a sobrejetoridade da $\pi$.

\hint
Calcule uns valóres primeiro.  Por exemplo,
$$
\xalignat3
\pi (2, \tup{2,3,5,7}) &= 5 &
\pi (0, \tup{2})       &= 2 &
\pi (3, \tup{2,0,0,1}) &= 1
\endxalignat
$$

\solution
A injetoridade da $\pi$ depende no $n$:
\endgraf
\case{Caso $n>1$}, não é:
pois tomando $a\in A$,
$$
\pi(0,\tup{a,\dotsc,a}) = a = \pi(1,\tup{a,\dotsc,a}).
$$
\endgraf
\case{Caso $n=1$}, é:
tomando $w, w' \in I\times A^n$ com $w\neq w'$, temos
que $w = \tup{ 0, \tup{a} }$ e $w' = \tup{ 0, \tup{a'} }$
para alguns $a,a'\in A$.
Agora como $w\neq w'$ concluimos que $a\neq a'$ e logo
$\pi(0,w) \neq \pi(0,w')$, ou seja, $\pi$ é injetora
nesse caso.
\endgraf\noindent
A $\pi$ é sobrejetora sim:
pois para qualquer $a\in A$, $\pi(0,\tup{a,\dotsc,a}) = a$.

\endproblem
%%}}}

%%{{{ funion 
\problem União de funções.
Sejam $f : A \to B$ e $g : C \to D$.
Queremos definir a $f\union g : A\union C \to B\union D$,
consultando as $f$ e $g$, numa maneira parecida com aquela da
definição de $f\cross g$ (\refn{fcross}).
Uma definição razoável deve fazer o diagrama seguinte comutar:
$$
\cdopt{column sep=2cm,row sep=1cm}
A \ar[d, hook] \ar[r, "f"]   \| B \ar[d, hook] \\
A\union C \ar[r, dashed, "f\union g"] \| B\union D \\
C \ar[u, hook] \ar[r, "g"']  \| D \ar[u, hook]
\endcd
$$
Explique quais são as condições necessárias para definir
a $f\union g$, e defina-la.

\solution
Chame as $f$ e $g$ \dterm{compatíveis} sse:
$$
\text{para todo $x\in\dom f \inter \dom g$, $f(x) = g(x)$}.
$$
Agora dadas \emph{compatíveis} $f : A \to B$ e $g : C \to D$, definimos a
$f \union g : A\union C \to B\union D$ pela
$$
(f\union g)(x) =
\knuthcases{
f(x), & se $x \in A$\cr
g(x), & se $x \in C$.
}
$$
Equivalentemente, podemos definir a $f\union g$ definindo seu gráfico:
$$
\graph (f\union g) \defeq \graph f \union \graph g.
$$
Observe que com nas duas maneiras precisamos a condição de
compatibilidade para a $f\union g$ ser bem definida.

\endproblem
%%}}}

%%{{{ implement_nondeterministic_functions 
\problem Funções não-deterministas.
\label{implement_nondeterministic_functions}%
\tdefined{função}[não-determinista]%
Na~\ref{Partial_functions} definimos um conceito mais geral de ``função'':
as \emph{funções parciais}, onde apagamos a primeira das
condições~\refn{functionhood_conditions}:
\beginil
\item{}\strikeout{(1)~totalidade};
\item{}(2)~determinicidade.
\endil
Neste problema, pense numa maneira de usar funções (mesmo), para
representar \dterm{funções não-deterministas}, ou seja, ``funções''
que não respeitam necessariamente a determinicidade; apenas a totalidade:
\beginil
\item{}(1)~totalidade;
\item{}\strikeout{(2)~determinicidade}.
\endil
Precisas então \dterm{implementar} o conceito de função não-determinista
usando conceitos (tipos) que encontramos até agora: conjuntos, tuplas,
seqüências, famílias indexadas, e funções.
Para implementar um conceito não basta apenas definir o que são os
objetos desse tipo em termos de já conhecidos.
Precisamos implementar tambem o interface desejado, em termos de operações e
relações que já temos em nossa disposição.
Nesse caso:
\endgraf
Como definarias a composição $g \ast f$ de duas funções não-deterministas?
Use a notação $f : A \ndeto B$ para <<$f$ é uma função não-determinista
de $A$ para $B$>>.
Que mais tu poderias fazer para tua implementação ser uma implementação boa?

\solution
Podemos representar a $f : A \ndeto B$ pela função
$\bar f : A \to \pset B\setminus\set{\emptyset}$ definida pela
$$
\bar f(x) = \setst {y\in B} {x\mapstoarrow f y}.
$$
Sejam~$f : A \ndeto B$ e~$g : B \ndeto C$ funções não-deterministas.
Logo temos $\bar f : A \to \pset B\setminus\set{\emptyset}$
e          $\bar g : B \to \pset C\setminus\set{\emptyset}$.
Definimos sua composição
$g\ast f : A \ndeto C$ pela
$$
(\overline{g\ast f})(x) = \Union \img {\bar g} {\bar f (x)}.
$$
O que mais seria legal definir e mostrar para nossa implementação?
Bem, seria bom definir pelo menos a identidade não-determinista
$id_A : A \ndeto A$, e investigar se as leis que provamos sobre
o caso de funções que conectam composição e identidades estão válidas
para nossas funções não-deterministas também.

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

O \cite[Cap.~5]{velleman} defina e trata funções
como casos especiais de relações (veja~\ref{Relations}),
algo que não fazemos nesse texto.
Muitos livros seguem essa abordagem, então o leitor é conselhado
tomar o cuidado necessário enquanto estudando esses assuntos.

Um livro excelente para auto-estudo é o~\cite[Par.~I~\&~II]{babylawvere}.
\emph{Não pule seus exercícios e problemas!}

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Relations 
\chapter Relações.
\label{Relations}%

%%{{{ intro
\chapintro
Nesse capítulo estudamos então mais um \emph{tipo} importante para matemática:
a \emph{relação}.
Se pensamos em funções como construtores (ou ``apontadores'') de objetos,
então as relações são \emph{construtores de afirmações}.
Podemos pensar que uma relação é como um \emph{verbo}, ou um \emph{predicado}
duma afirmação.
Como no~\ref{Functions}, nosso objetivo é entender \emph{o que são}
as coisas desse tipo (relações) e não como as definir formalmente como
objetos matemáticos---sobre isso, paciência até o~\ref{Axiomatic_set_theory}.
%%}}}

%%{{{ Concept, notation, equality 
\section Conceito, notação, igualdade.

%%{{{ eg 
\example.
Nos numeros reais, estamos bem acostumados com as relações de ordem
($\leq$, $\geq$, $<$, $>$).
Nos inteiros já estudamos bastante a relação binária de ``divide''
($\dhole\divides\dhole$) e a relação ternária de ``congruência modular''
($\dhole \cong \dhole \pmod \dhole$).
\endexample
%%}}}

%%{{{ eg 
\example.
No conjunto $\cal P$ de pessoas, conhecemos várias relações também.
Por exemplo
$$
\align
\namedpred{Mother}(x,y)     &\defiff \text{$x$ é a mãe de $y$}\\
\namedpred{Parents}(x,y,z)  &\defiff \text{$x$ e $y$ são os pais de $z$}\\
\namedpred{Love}(x,y)       &\defiff \text{$x$ ama $y$}
\endalign
$$
\endexample
%%}}}

\blah.
Relações podem ``relacionar'' tipos diferentes.

%%{{{ eg 
\example.
Considere as relações seguintes, cujos argumentos não têm o mesmo típo.
$$
\align
\namedpred{Born}(x,w)       &\defiff \text{$x$ nasceu no ano $w$} \\
\namedpred{Author}(x,k)     &\defiff \text{$x$ escreveu o livro $k$} \\
\namedpred{Read}(x,k)       &\defiff \text{$x$ leu o livro $k$}
\endalign
$$
O primeiro argumento da primeira relação é uma pessoa
mas o segundo é um ano; e as relações $\namedpred{Author}$
e $\namedpred{Read}$ são ambas entre pessoas e livros.
\endexample
%%}}}

%%{{{ eg 
\example.
Para cada tipo, sua igualdade $=$ é uma relação, de aridade $2$.
Nos números naturais por exemplo, se $n,m\in\nats$, $n = m$ é uma afirmação:
$$
\align
n = m &\pseudodefiff \text{os $n$ e $m$ denotam o mesmo número natural}.
\intertext{Similarmente nos conjuntos: se $A,B$ são conjuntos, $A = B$ é a afimação seguinte:}
A = B &\pseudodefiff \text{os $A$ e $B$ denotam o mesmo conjunto}.
\endalign
$$
Etc., etc.
Observe que podemos fazer uma \ii{aplicação!parcial}\emph{aplicação parcial},
nas relações como fazemos nas funções.
Fixando um objeto de nosso tipo, por exemplo o natural $0\in\nats$
em qualquer um dos dois lados da igualdade (vamos fixar na direita nesse exemplo),
chegamos numa relação de aridade $1$:
$$
\bhole = 0
$$
onde aplicando a relação para qualquer $x\in\nats$ chegamos na afirmação
$$
x = 0.
$$
\endexample
%%}}}

%%{{{ the type of a relation 
\note O ``tipo'' de uma relação.
Com cada relação associamos o seu \dterm{tipo} (pedimos emprestada aqui
a terminologia usada em funções) que é apenas a informação de tipo
para cada uma das suas entradas.
%%}}}

%%{{{ funlike_notation_for_relations 
\note Notação funcionista.
\label{funlike_notation_for_relations}%
Relações de aridade $2$ são as mais comuns, e usamos certa notação
e terminologia especialmente só para elas.
Nesse caso, podemos ver o conceito de relação como uma generalização de função,
onde nos livramos das duas condições do~\refn{functionhood_conditions}.
Por isso, quando temos uma relação no $A\times B$
usamos a frase <<relação \emph{de} $A$ \emph{para} $B$>>.
Vamos criar uma notação parecida com aquala das funções para dizer que $R$
é uma relação do conjunto $A$ para o conjunto $B$.
Escrevemos, equivalentemente:
$$
R : A \relto B
\qqqquad
R : B \relfrom A
\qqqquad
A \reltoarrow R B
\qqqquad
B \relfromarrow R A.
$$
Todo isso quis dizer apenas que $R$ é uma relação binária entre $A$ e $B$.
Também, em vez de escrever $R(x,y)$, escrevemos as vezes
o $R$ com notação \emph{infixa}: $x \rel R y$.
%%}}}

%%{{{ beware: this notatios is not standard 
\beware.
A notação definida no~\refn{funlike_notation_for_relations}
\emph{não} é padrão.
%%}}}

%%{{{ setlike_notation_for_relations 
\note Notação conjuntista.
\label{setlike_notation_for_relations}%
Vestindo nosso chapel de conjuntista, abusamos a notação conjuntista e escrevemos
tambem $\tupp{x,y} \in R$ para dizer que $R(x,y)$.
E para afirmar que $R$ é uma relação ``de tipo'' $A\times B$, escrevemos
até $R \subseteq A\times B$.
É importante entender bem neste momento que essas são apenas
\emph{notações}.  Uma relação $R$ \emph{não é} um conjunto, então nada pertence nela,
e similarmente ela não é subconjunto de ninguém!
Mesmo assim escrevemos coisas como
$\namedpred{Author} \subseteq \cal P \times \cal B$
e
$\namedpred{Parents} \subseteq \cal P^3$
\emph{entendendo} como: ``a $\namedpred{Author}$ é uma relação binária
entre $\cal P$ e $\cal B$'' e ``a $\namedpred{Parents}$ é uma relação
ternária entre membros de $\cal P$''.
Mais uma vez: relações \emph{não são} conjuntos.
%%}}}

%%{{{ x: repeat_after_me_relations_are_not_sets 
\exercise.
\label{repeat_after_me_relations_are_not_sets}%
Repita!

\hint
Relações \emph{não são}\dots

\solution
Relações \emph{não são} conjuntos!

\endexercise
%%}}}

%%{{{ Black boxes 
\note Black boxes.
\label{blackbox_rel}%
\tdefined{black box}[de relação]%
\iisee{relação!como black box}{black box}%
Visualizamos uma relação $R$ de aridade $n$ como um black box com $n$ entradas
e uma lâmpada que pisca ou não, dependendo de se os objetos-entradas
$x_1,\dotsc,x_n$ são relacionados pela $R$.
Nesse caso dizemos que os $x_1,\dotsc,x_n$ \dterm{satisfazem} a $R$.
%%}}}

\blah.
Cada vez que introduzimos um tipo novo, precisamos definir quando dois objetos
desse tipo são iguais.  Vamos fazer isso agora.  Novamente, vamos optar para
identificar relações cujos comportamentos são indistinguíveis usando apenas
os seus interfaces.

%%{{{ df: R_eq_S_bin_on_single_set_case 
\definition Igualdade.
\label{R_eq_S_bin_on_single_set_case}%
Sejam $R,S$ relações binárias num conjunto $A$.
Definimos
$$
R=S
\defiff
\text {para todos $x,y \in A$, temos:\ \ $x \rel R y \iff x \rel S y$}.
$$
%%}}}

\blah.
Principalmente vamos trabalhar com relações binárias definidas num conjunto só,
então a definição de igualdade~\refn{R_eq_S_bin_on_single_set_case} que
acabamos de ver nos serve bem.  No~\ref{R_eq_S_bin_on_different_sets_case}
e no~\ref{R_eq_S} tu vai extender essa definição para os casos mais gerais.

%%{{{ x: R_eq_S_bin_on_different_sets_case 
\exercise Igualdade.
\label{R_eq_S_bin_on_different_sets_case}%
Como tu extenderia a~\ref{R_eq_S_bin_on_single_set_case} para o caso onde as
$R,S$ não são relações num conjunto só?
Ou seja, tendo relações binárias~$R,S$, a~$R$ de~$A$ para~$B$, e a~$S$ de~$C$
para~$D$, como tu definirias a igualdade~$R=S$ nesse caso?

\solution
Digamos que $R=S$ sse para todo $x\in A\union C$, e todo $y \in B\union D$, temos $x \rel R y \iff x \rel S y$.

\endexercise
%%}}}

%%{{{ Intension vs. Extension 
\note Intensão vs{.}~extensão.
Com nossa experiência com \emph{intensão} e \emph{extensão} de
conjuntos~(\refn{Intension_vs_extension_in_sets}) e de
funções~(\refn{intension_vs_extension_in_functions}
e~\refn{programs_vs_functions}), não precisamos esclarecer
muita coisa sobre relações, pois a idéia continua a mesma.
%%}}}

%%{{{ eg: R(n) vs T(n) intensionally and extensionally 
\example.
Considere as relações no $\nats$:
$$
\align
R(n) &\defiff \Prime(n) \mland \Even(n) \\
T(n) &\defiff n = 2.
\endalign
$$
As \emph{intensões} das relações $R$ e $T$ são diferentes,
mas a \emph{extensão} é comum:
$$
\lforall {n\in\nats} {R(n) \iff T(n)}.
$$
\endexample
%%}}}

\blah.
Para capturar a extensão duma relação, definimos o seu gráfico,
na mesma forma que definimos no caso de funções~(\ref{function_graph}).

%%{{{ df: relation_graph 
\definition.
\label{relation_graph}%
\label{truth_set}%
\tdefined{relação!gráfico}%
\tdefined{truth set}%
\iisee{gráfico}{relação, gráfico}%
\iisee{gráfico}{função, gráfico}%
\sdefined{\graph{\holed R}} {o gráfico da relação $\holed R$}%
Dado relação $R$ de $A$ para $B$, o \dterm{gráfico da $R$}
é o conjunto
$$
\graph R \defeq \setst {(x,y)} {x \rel R y},
$$
também conhecido como \dterm{truth set} da $R$.
%%}}}

%%{{{ remark: graph R = graph T and setlike notation 
\remark.
Agora temos uma maneira formal para afirmar que $R$ e $T$ tem
a mesma extensão: $\graph R = \graph T$.
E agora a notação conjuntista do~\refn{setlike_notation_for_relations}
vira literalmente correta se substituir as relações por seus gráficos.
%%}}}

\endsection
%%}}}

%%{{{ Defining relations 
\section Definindo relações.

%%{{{ with holes 
\note Com buracos.
Começando com uma expressão que denota um \emph{objeto}
e botando $n$ buracos em certas subexpressões dela, criamos
uma \emph{função} de aridade $n$.
Se fizer a mesma coisa numa expressão que denota uma \emph{afirmação},
então criamos uma \emph{relação} de aridade $n$.
%%}}}

%%{{{ eg: john_loves_mary_holes 
\example.
Considere a frase \trel{João ama Maria}.
Criamos assim as relações:
$$
\align
L &\defeq \mtrel{{\thole} ama {\thole}} \\
J &\defeq \mtrel{João ama {\thole}} \\
M &\defeq \mtrel{{\thole} ama Maria}.
\endalign
$$
A primeira é uma relação no $\cal P \times \cal P$ e as outras duas no $\cal P$.
Usando variáveis em vez de buracos, escrevemos:
$$
\align
L(x,y) &\defiff \mtrel{$x$ ama $y$} \\
J(x)   &\defiff \mtrel{João ama $x$} \\
M(x)   &\defiff \mtrel{$x$ ama Maria}.
\endalign
$$
\endexample
%%}}}

%%{{{ other ways of defining relations 
\note Outras maneiras de definir relações.
Em vez de explicar todas as maneiras seguintes em detalhe,
eu acho que um exemplo é suficiente para cada caso, pois
todas essas maneiras são já bem conhecidas graças à nossa
experiência com funções no~\ref{Functions}.
%%}}}

%%{{{ eg: with formulas 
\example Com fórmulas.
Considere os conjuntos $\cal P$ de todas as pessoas
e $\cal B$ de todos os livros.
Sejam as relações
$P\subseteq \ints$,
$R\subseteq \ints \times \ints$,
$Q\subseteq \cal P \times \cal B$, e
$M\subseteq \ints^3$,
definidas pelas fórmulas:
$$
\align
P(n)     &\defiff \lforall {x,y\in\ints} {xy = n \limplies \paren{|x| = 1 \lor |y| = 1}} \\
R(n,m)   &\defiff \lnot\lexists {k \in \ints} {\Prime(k) \land 2^n < k < 3^m}; \\
Q(p,b)   &\defiff \lexists {b' \in \cal B} {b \neq b' \land \namedpred{Read}(p,b') \land \lexists {a \in \cal P} {\namedpred{Author}(a,b) \land \namedpred{Author}(a,b')}} \\
C(a,b,m) &\defiff \lexists {k \in \ints} {mk = a-b}
\endalign
$$
Tente expressar cada uma delas em lingua natural.
\endexample
%%}}}

%%{{{ eg: relations_with_text_example 
\example Com texto.
\label{relations_with_text_example}%
Sejam as relações $\namedpred{Coauthors}$ (binária, entre pessoas)
e $\namedpred{SameCard}$ (unária, nos conjuntos), definidas pelas:
$$
\align
\namedpred{Coauthors}(x,y) &\defiff \text{$x$ e $y$ já escreveram algum livro juntos}; \\
\namedpred{SameCard}(x)    &\defiff \text{todos os membros de $x$ são conjuntos com a mesma cardinalidade}.
\endalign
$$
Por exempo: $\namedpred{Coauthors}(\textrm{Birkhoff}, \textrm{Mac Lane})$
e $\namedpred{SameCard}(\set{ \set{0,1}, \set{\nats,\set{42}}, \set{\emptyset, \set{\emptyset}}})$.
\endexample
%%}}}

%%{{{ beware: definitive text 
\beware.
Como sempre, tomamos cuidado quando definimos coisas com texto:
tem que ser uma afirmação definitiva, sem ambigüidades, etc.
%%}}}

%%{{{ x: do_nats_ints_rats_reals_have_the_same_cardinality 
\exercise.
\label{do_nats_ints_rats_reals_have_the_same_cardinality}%
Com a definição de $\namedpred{SameCard}$ do~\ref{relations_with_text_example},
$\namedpred{SameCard}(\set{\nats,\ints,\rats,\reals})$?
Responda com ``sim'' ou ``não'', com uma curtíssima explicação (sem prova).

\hint
Lembre a~\ref{naive_cardinality}.

\solution
Infelizmente não podemos ainda responder nessa pergunta:
sua resposta é um dos assuntos principais do~\ref{Cantors_paradise}.
Paciência!
Se tu respondeste ``sim, pois todos são conjuntos infinitos'',
fizeste bem, pois é uma resposta aceitável \emph{neste momento}.
Só que\dots~não é uma resposta correta!
Aliás, seguindo a~\ref{naive_cardinality} é uma resposta correta sim,
porém vamos ter que redefinir o conceito de cardinalidade logo.

\endexercise
%%}}}

%%{{{ eg: partial_application_in_relations_example 
\example Aplicação parcial.
\label{partial_application_in_relations_example}%
Sejam as relações $\namedpred{EqPar}$ (binária entre inteiros),
$B$ (unária em pessoas), e $N$ (unária em inteiros), definidas pelas:
$$
\align
\namedpred{EqPar} &\defeq \dhole \cong \dhole \pmod 2 \\
B                 &\defeq \namedpred{Coauthors}(\textrm{Birkhoff}, \dhole) \\
N                 &\defeq \dhole < 0.
\endalign
$$
Assim temos por exemplo:
$\namedpred{EqPar}(3,11)$ mas $\lnot\namedpred{EqPar}(3,4)$;
$B(\textrm{Mac~Lane})$ mas $\lnot B(\textrm{Thanos})$;
$N(-23)$ mas $\lnot N(0)$.
\endexample
%%}}}

\endsection
%%}}}

%%{{{ Internal diagrams 
\section Diagramas internos.

%%{{{ Relation as a generalization of function 
\note Relação como uma generalização de função.
Um jeito de olhar para uma relação é como uma ``função'' sem as restrições
de totalidade e de determinicidade que encontramos no~\refn{functionhood_conditions}.
Então: lembra dos conjuntos $A,B$ que encontramos na~\ref{Images_preimages}?
Aqui são duas relações $R,Q$ de $A$ para $B$, determinadas por seus
diagramas internos:
$$
\xxalignat2
&
\tikzpicture[node distance=0mm,scale=0.8]
\tikzi imgpreimgpointsetsbase;
\draw[-{Latex[length=6pt,open]}]  (0.5,4.5) -- (4.5,4.5);
\node (arrow-R) at (2.5,4) {$R$};
\draw[->] (elem-b) -- (elem-1);
\draw[->] (elem-b) -- (elem-2);
\draw[->] (elem-c) -- (elem-2);
\draw[->] (elem-e) -- (elem-5);
\draw[->] (elem-e) -- (elem-6);
\draw[->] (elem-e) -- (elem-5);
\draw[->] (elem-e) -- (elem-2);
\endtikzpicture
&&
\tikzpicture[node distance=0mm,scale=0.8]
\tikzi imgpreimgpointsetsbase;
\draw[-{Latex[length=6pt,open]}]  (0.5,4.5) -- (4.5,4.5);
\node (arrow-Q) at (2.5,4) {$Q$};
\draw[->] (elem-a) -- (elem-1);
\draw[->] (elem-b) -- (elem-1);
\draw[->] (elem-c) -- (elem-1);
\draw[->] (elem-d) -- (elem-3);
\draw[->] (elem-d) -- (elem-4);
\draw[->] (elem-d) -- (elem-5);
\draw[->] (elem-d) -- (elem-6);
\draw[->] (elem-f) -- (elem-6);
\endtikzpicture
\endxxalignat
$$
%%}}}

\blah.
A situação sobre relações binárias definidas num conjunto $A$
é mais divertida.

%%{{{ Relation as a directed graph 
\note Relação como grafo direcionado.
Seja $A$ um conjunto e $R$ uma relação binária nele.
Podemos representar a $R$ como um \emph{grafo direcionado},
onde, para todos $x,y\in A$, desenhamos uma setinha
$x\longrightarrow y$ sse $x \rel R y$.
%%}}}

%%{{{ eg: first_internal_diagrams_for_rel 
\example.
\label{first_internal_diagrams_for_rel}%
Seja $A = \set{1, 2, 3, 4, 5, 6, 7, 8}$.
Desenhamos os diagramas de três relações binárias no $A$:
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi internaldiagramrel0;
\draw[->] (elem-1) to [bend left=20]  (elem-2);
\draw[->] (elem-2) to [bend left=20]  (elem-1);
\draw[->] (elem-8) to                 (elem-6);
\draw[->] (elem-5) to                 (elem-7);
\draw[->] (elem-5) to                 (elem-8);
\node (elem-4h) at (-1.5 ,-1.3 ) {};
\draw[->] (elem-4h) arc (10:290:0.25);
\node (elem-5h) at ( 0.1 , 0.7 ) {};
\draw[->] (elem-5h) arc (10:290:0.25);
\draw (0,-3.0) node {$R$};
\endtikzpicture
\quad
\tikzpicture[>=stealth, scale=0.84]
\tikzi internaldiagramrel0;
\draw[->] (elem-1) to                 (elem-2);
\draw[->] (elem-8) to                 (elem-6);
\draw[->] (elem-7) to                 (elem-5);
\draw[->] (elem-5) to                 (elem-8);
\draw[->] (elem-6) to                 (elem-5);
\draw (0,-3.0) node {$S$};
\endtikzpicture
\quad
\tikzpicture[>=stealth, scale=0.84]
\tikzi internaldiagramrel0;
\draw[->] (elem-1) to [bend left=20]  (elem-2);
\draw[->] (elem-2) to [bend left=20]  (elem-1);
\draw[->] (elem-5) to [bend left=20]  (elem-8);
\draw[->] (elem-8) to [bend left=20]  (elem-5);
\draw[->] (elem-3) to [bend left=20]  (elem-4);
\draw[->] (elem-4) to [bend left=20]  (elem-3);
\draw[->] (elem-7) to [bend left=10]  (elem-6);
\draw[->] (elem-6) to [bend left=10]  (elem-7);
\node (elem-5h) at ( 0.1 , 0.7 ) {};
\draw[->] (elem-5h) arc (10:290:0.25);
\draw (0,-3.0) node {$Q$};
\endtikzpicture
$$
Os gráficos delas então são os
$$
\align
\graph R &= \set{ (1,2), (2,1), (4,4), (5,5), (5,7), (5,8), (8,6) } \\
\graph S &= \set{ (1,2), (5,8), (6,5), (7,5), (8,6) } \\
\graph Q &= \set{ (1,2), (2,1), (3,4), (4,3), (5,5), (5,8), (6,7), (7,6), (8,5) }.
\endalign
$$
Mais uma vez, aviso que é comum identificar uma relação $R$ com seu gráfico
$\graph R$, escrevendo por exemplo $R = \set { (1,2), (2,1), \dotsc }$.
Já fez o~\ref{repeat_after_me_relations_are_not_sets}, né?
\endexample
%%}}}

%%{{{ x: empty_and_true_relation 
\exercise.
\label{empty_and_true_relation}%
No mesmo conjunto $A = \set{1,2,3,4,5,6,7,8}$, como parecem os diagramas
das relações $F,T$ com gráficos $\graph F = \emptyset$ e $\graph T = A^2$?

\solution
O diagrama da $F$ parece assim:
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi internaldiagramrel0;
\draw (0,-3.0) node {$F$};
\endtikzpicture
$$
E o diagrama da $T$ parece uma bagunça.

\endexercise
%%}}}

%%{{{ x: we_cannot_draw_two_parallel_arrows_on_a_rel_diagram 
\exercise.
\label{we_cannot_draw_two_parallel_arrows_on_a_rel_diagram}%
Para quais relações podemos ter \emph{duas} setinhas do objeto $x$
para o objeto $y$?

\solution
Para nenhuma!
Exatamente como um conjunto não tem noção de \emph{quantas vezes}
um certo objeto pertence nele, uma relação também não tem noção
de \emph{quantas vezes} um certo objeto relaciona com um certo outro.

\endexercise
%%}}}

%%{{{ remark: conventions_for_internal_diagrams_of_rel 
\remark Convenções para diagramas internos.
\label{conventions_for_internal_diagrams_of_rel}%
Quando queremos desenhar o diagrama duma relação que
sabemos que tem uma certa propriedade, podemos preguiçar
e não desenhar todas as suas setas.
\crtabcase{Reflexiva:}
não precisamos botar nenhuma das setinhas-redemoinhos,
pois graças à reflexividade são todas implicitas.
\crtabcase{Simétrica:}
não precisamos botar cabeças nas setas, pois para
cada seta já é garantida a sua seta-oposta, então
botamos apenas uma linha entre dois objetos e já
entendemos que existem as setas das duas direções
entre si.
\crtabcase{Transitiva:}
não precisamos desenhar setas entre objetos se já
existe um caminho entre eles usando outras setas
já desenhadas.
%%}}}

\endsection
%%}}}

%%{{{ Constructions and operations on relations 
\section Construções e operações em relações.

\blah.
Todas as relações que consideramos nessa secção serão binárias.

%%{{{ df: ropposite 
\definition.
\label{ropposite}%
\tdefined{relação}[oposta]%
\iisee{relação!dual}{oposta}%
\iisee{relação!inversa}{oposta}%
\sdefined {\rop {\holed R}} {a relação oposta da $R$}%
\sdefined {\rinv {\holed R}} {a relação oposta da $R$ (notação alternativa)}%
\tdefined{relação}[dual]%
Seja $R$ uma relação de $A$ para $B$.
Definimos a sua \dterm{relação oposta} $\rop R$ de $B$ para $A$ pela:
$$
x \rop R y \defiff y \rel R x.
$$
Também é conhecida como \dterm{relação inversa} ou \dterm{relação dual}.
A notação mais comum para essa relação é a $\rinv R$.
%%}}}

%%{{{ cor: rop_is_an_involution 
\corollary.
\label{rop_is_an_involution}%
A operação $\rop{\dhole}$ é uma \emph{involução}:
para toda relação binária $R$, $\rop {\rop R} = R$.
%%}}}

%%{{{ eg: opposite_relations_of_common_orders 
\example.
Nos $\reals$, a relação oposta $\rop<$ da $<$ é a $>$,
e a $\rop\leq$ é a $\geq$.
\endexample
%%}}}

%%{{{ Composition 
\note Composição.
Dadas relações compatíveis, podemos formar sua composição
$R\rcom S$ numa forma natural.  Vamos ver uns exemplos
antes de chegar na definição formal.
%%}}}

%%{{{ eg: persons_books_words 
\example.
\label{persons_books_words}%
\DefPred{Author}%
\DefPred{Read}%
\DefPred{Contains}%
Sejam os conjuntos $\cal P$ de pessoas, $\cal B$ de livros, e $\cal W$ de palavras.
Considere as relações:
$$
\align
\Author(x,y)    &\defiff \text{$x$ é um escritor do livro $y$}\\
\Read(x,y)      &\defiff \text{$x$ leu o livro $y$}\\
\Contains(x,y)  &\defiff \text{a palavra $y$ aparece no livro $x$}
\endalign
$$
Observe que $\Author$ e $\Read$ são relações de $\cal P$ para $\cal B$,
e $\Contains$ de $\cal B$ para $\cal W$.
O que seria a relação $\Author\rcom\Read$, o que a $\Author\rcom\Contains$,
e o que a $\Read\rcom\Contains$?
Antes de defini-las, vamos primeiramente pensar se faz sentido compor essas
relações.
Como a $\Author$ é uma relação de $\cal P$ para $\cal B$,
e a $\Read$ de $\cal P$ para $\cal B$ também,
podemos realmente as combinar:
Similarmente, a $\Author$ é compatível com a $\Contains$.
são compatíveis (gráças ao $\cal B$ ``no meio'').
No outro lado, não faz podemos compor a $\Author$ com a $\Read$!
Bem, então $\Author\rcom\Contains$ e $\Read\rcom\Contains$ são ambas
relações de $\cal P$ para $\cal W$.
Mas quais?
Lembre que para definir uma relação, precisamos determinar
completamente quando dois arbitrários $x,y$ são relacionados pela
relação.
Precisamos então completar as:
$$
\align
x \relp{\Author\rcom\Contains} y &\defiff \text{\dots?\dots}\\
x \relp{\Read\rcom\Contains}   y &\defiff \text{\dots?\dots}
\endalign
$$
mas como?
\spoiler.
Bem, botamos:
$$
\align
x \relp{\Author\rcom\Contains} y &\defiff \text{a pessoa $x$ escreveu algum livro que contem a palavra $y$}\\
x \relp{\Read\rcom\Contains}   y &\defiff \text{a pessoa $x$ leu algum livro que contem a palavra $y$}
\endalign
$$
\endexample
%%}}}

%%{{{ x: comparison_of_statements_about_reading_books 
\exercise.
\DefPred{Author}%
\DefPred{Read}%
\label{comparison_of_statements_about_reading_books}%
A relação $R$ de $\cal P$ para $\cal W$ definida pela
$$
R(x,y) \defiff \text{a pessoa $x$ leu a palavra $y$ num livro}
$$
é a mesma relação com a $\Author\rcom\Read$?
Em outras palavras:
$$
R \askeq \Author\rcom\Read
$$

\hint
As afirmações:
$$
\gather
\text{a pessoa $x$ leu a palavra $y$ num livro}\\
\text{a pessoa $x$ leu um livro onde a palavra $y$ aparece}
\endgather
$$
estão afirmando a mesma coisa?

\endexercise
%%}}}

\blah.
Segue mais um exemplo, essa vez usando apenas um conjunto---e
logo todas as relações são gratuitamente compatíveis para composição.

%%{{{ x: grandparents_grandchildren_siblings_and_couples_with_children 
\exercise.
\label{grandparents_grandchildren_siblings_and_couples_with_children}%
\DefPred{Parent}%
\DefPred{Child}%
Seja $\cal P$ o conjunto de todas as pessoas, e considere as relações
$$
\align
\Parent(x,y) &\defiff \text{$x$ é a mãe ou o pai de $y$}\\
\Child(x,y)  &\defiff \text{$x$ é filho ou filha de $y$}.
\endalign
$$
Como tu definirias diretamente as relações seguintes?:
$$
\Parent\rcom\Parent
\qqquad
\Child\rcom\Child
\qqquad
\Parent\rcom\Child
\qqquad
\Child\rcom\Parent
$$

\solution
{%
\DefPred{Parent}%
\DefPred{Child}%
Temos:
$$
\align
x \relp{\Parent\rcom\Parent} y &\defiff \text{$x$ é um avô ou uma avó de $y$}\\
x \relp{\Child\rcom\Child}   y &\defiff \text{$x$ é um neto ou uma neta de $y$}\\
x \relp{\Parent\rcom\Child}  y &\defiff \text{$x$ e $y$ tem um filho ou uma filha juntos}\\
x \relp{\Child\rcom\Parent}  y &\defiff \text{$x$ e $y$ são irmã(o)s ou a mesma pessoa}
\endalign
$$
}

\endexercise
%%}}}

%%{{{ Q: How can we define composition of relations? 
\question.
Como podemos definir a composição de relações?
%%}}}
\spoiler.

%%{{{ df: rcompose 
\definition.
\label{rcompose}%
\tdefined{relação}[composição]%
\iisee{composição!de relações}{relação, composição}%
Sejam conjuntos $A,B,C$ e as relações~$R$ de~$A$ para~$B$
e~$S$ de~$B$ para~$C$.
Definimos a relação~$R\rcom S$ de~$A$ para~$C$ pela
$$
a\rel{(R \rcom S)}c
\defiff
\text{existe $y \in B$ tal que $a \rel R y$ \& $y \rel S c$}.
$$
Chamamos a $R \rcom S$ a \dterm{composição} da $R$ \emph{com} a $S$.
%%}}}

%%{{{ beware: RoS_not_SoR 
\beware.
\label{RoS_not_SoR}%
Não existe um consensus para a ordem de escrever esses $R,S$
na~\ref{rcompose}.  Tome cuidado então enquanto lendo a notação
$R \rcom S$, pois nosso $R \rcom S$ pode ser escrito como $S \rcom R$
por outros autores, e vice versa.
Quando a composição é denotada por $;$ a ordem concorda com nossa:
$$
a\rel{(R ; S)}c
\defiff
\text{existe $y \in B$ tal que $a \rel R y$ \& $y \rel S c$}.
$$
Veja também a~\ref{gof_not_fog}.
%%}}}

%%{{{ prop: associativity_of_rcom 
\property.
\label{associativity_of_rcom}%
Sejam as relações binárias:
$R$ de $A$ para $B$;
$S$ de $B$ para $C$; e
$T$ de $C$ para $D$.
Então
$$
(R\rcom S)\rcom T = R \rcom (S\rcom T),
$$
e logo podemos escrever apenas $R\rcom S\rcom T$.
\sketch.
Supomos $a \in A$ e $d\in D$, e mostramos a equivalência
$$
a \rel{((R\rcom S)\rcom T)} d
\iff
a \rel{(R\rcom (S\rcom T))} d.
$$
aplicando a definição de $\rcom$ e leis da lógica.
\qes
\proof.
Suponha $a\in A$ e $d\in D$.  Temos:
$$
\alignat 2
a \rel{((R\rcom S)\rcom T)} d
&\iff \lexists {c\in C} { a \rel{(R\rcom S)} c \;\land\; c \rel{T} d } \qqby{def.~de $\rcom$} \\
&\iff \lexists {c\in C} { \lexists {b\in B} {x \rel{R} b \;\land\; b \rel{R} c } \;\land\; c \rel{T} d } \qqby{def.~de $\rcom$} \\
&\iff \lexists {c\in C} { \lexists {b\in B} { \paren{ a \rel{R} b \;\land\; b \rel{R} c } \;\land\; c \rel{T} d } } \qqby{lógica} \\
&\iff \lexists {b\in B} { \lexists {c\in C} { \paren { a \rel{R} b \;\land\; b \rel{R} c } \;\land\; c \rel{T} d } } \qqby{lógica} \\
&\iff \lexists {b\in B} { \lexists {c\in C} { a \rel{R} b \;\land\; \paren{ b \rel{R} c \;\land\; c \rel{T} d } } } \qqby{lógica} \\
&\iff \lexists {b\in B} { a \rel{R} b \;\land\; \lexists {c\in C} {  b \rel{R} c \;\land\; c \rel{T} d } } \qqby{lógica} \\
&\iff \lexists {b\in B} { a \rel{R} b \;\land\; { b \rel{(R\rcom T)} d } } \qqby{def.~de $\rcom$} \\
&\iff a \rel{(R\rcom(S\rcom T))} d \qqby{def.~de $\rcom$}.
\endalignat
$$
\qed
%%}}}

%%{{{ x: associativity_of_rcom_nat_lang 
\exercise.
\label{associativity_of_rcom_nat_lang}%
Escreva uma prova em linguagem natural da~\ref{associativity_of_rcom}.

\solution
\lrdir:
Suponha $a \in A$ e $d \in D$ tais que
$a \rel{((R\rcom S)\rcom T)} d$.
Logo, para algum $c\in C$, temos $a \rel{(R\rcom S)} c$\fact1\ e
$c \rel{T} d$\fact2,
e usando a \byfact1\ ganhamos um $b\in B$ tal que $a \rel{R} b$\fact3
e $b \rel{S} c$\fact4.
Juntando as \byfact4~e~\byfact2 temos $b \rel{(S \rcom T)} d$, e agora
junto com a \byfact3~chegamos em
$a \rel{((R\rcom S)\rcom T)} d$.
\endgraf
A direção \rldir\ é similar.

\endexercise
%%}}}

%%{{{ x: only_if_incest 
\exercise.
\label{only_if_incest}%
\DefPred{Parent}%
\DefPred{Child}%
Prove ou refute:
$$
\Child\rcom\Parent
\askeq
\Parent\rcom\Child.
$$

\hint
{%
\DefPred{Parent}%
\DefPred{Child}%
$\Child\rcom\Parent\neq\Parent\rcom\Child$.
Agora refute!
}

\solution
{%
\DefPred{Parent}%
\DefPred{Child}%
Temos $\Child\rcom\Parent\neq\Parent\rcom\Child$:
\endgraf
Tome $x,y\in \cal P$ dois irmãos que não têm filhos (juntos).
Logo
$$
x \relp{\Parent\rcom\Child} y
\qqtext{mas não}
x \relp{\Child\rcom\Parent} y.
$$
Demonstramos assim que as duas relações são diferentes.
}

\endexercise
%%}}}

%%{{{ x: id_of_rcom 
\exercise.
\label{id_of_rcom}%
Considere a $\rcom$ como uma operação nas relações binárias num conjunto $A$.
Ela tem \dterm{identidade}?  Ou seja, existe alguma relação binária $E$ no $A$,
tal que
$$
\text{para toda relação $R$ no $A$,}\quad
E \rcom R = R = R \rcom E\,?
$$
Se sim, defina essa relação $E$ e prove que realmente é.
Se não, prove que não existe.

\hint
Sem pensar, dois candidatos prováveis para considerar seriam a igualdade e
a relação trivial $\True$ satisfeita por todos os pares de elementos de $A$:
$$
\text{ou}
\knuthcases{
x \rel E y \defiff \True\cr
x \rel E y \defiff x = y
}
$$

\solution
Existe sim: a $E$ é a igualdade $=$.
Vamos mostrar que para todos $a,b \in A$
$$
a \rel R b \iff a \rel{(E \rcom R)} b.
$$
Tratamos cada direção separadamente.
\endgraf
\lrdir.
Suponha que $a \rel R b$.
Precisamos mostrar que
existe $w\in A$ tal que $a \rel E w$ e $w \rel R b$.
Tome $w \asseq a$.  Realmente temos $a \rel E a$ (pois $E$ é a igualdade),
e $a \rel R b$ que é nossa hipótese.
\endgraf
\rldir.
Suponha que $a \rel {(E \rcom R)} b$.
Logo, existe $w\in A$ tal que $a \rel E w$\fact1 e $w \rel R b$\fact2.
Mas, como $E$ é a igualdade, o único $w$ que satisfaz a~\reffact1 é o proprio~$a$.
Ou seja, $w = a$.
Substituindo na~\byfact2, ganhamos o desejado $a \rel R b$.
\endgraf
A outra equivalência,
$$
a \rel R b \iff a \rel{(R \rcom E)} b,
$$
é similar.

\endexercise
%%}}}

\blah.
Tendo uma operação binária (composição) e sua identidade (\ref{id_of_rcom})
podemos já definir as suas potências.

%%{{{ x: R_exp_n 
\exercise Potências.
\label{R_exp_n}%
Define formalmente as ``potências'' $R^n$ duma dada relação binária $R$
num conjunto, informalmente definida por:
$$
x \relp{R^n} y \pseudodefiff
x \rel{\Big(\tunderbrace{R \rcom\dotsb\rcom R}{$n$ vezes}\Big)} y,
$$
valida \emph{para todo $n\in\nats$}.

\hint
Questão: o que precisa achar para tua definição servir para o caso $n=0$ também?

\hint
Resposta: precisa achar o elemento neutro da operação $\rcompose$.
Já fez o~\ref{id_of_rcom}, né?

\solution
Definimos:
$$
\align
x\mathrel{\paren{R^{0}}}y   &\defiff x=y\\
x\mathrel{\paren{R^{n+1}}}y &\defiff x\mathrel{\paren{R\rcompose {R^n}}}y
\endalign
$$
Ou, direitamente, em estilo ``point-free'':
$$
\align
R^0     &\defeq \Eq\\
R^{n+1} &\defeq R^n \rcom R,
\endalign
$$
onde escrevemos $\Eq$ para a relação de igualdade $=$.

\endexercise
%%}}}

%%{{{ x: operation_with_opposite_does_not_yield_identity 
\exercise.
\label{operation_with_opposite_does_not_yield_identity}%
Prove ou refute:
\emph{para toda relação binária $R$ num conjunto $A$,
$R \rcom \rop R = \Eq = \rop R \rcom R$}.

\hint
\ref{grandparents_grandchildren_siblings_and_couples_with_children}.

\hint
\ref{only_if_incest}

\hint
{%
\DefPred{Parent}%
\DefPred{Child}%
Temos $\Parent = \rop \Child$ (e logo $\Child = \rop \Parent$ também).
}

\solution
{%
\DefPred{Parent}%
\DefPred{Child}%
Não, como o contraexemplo do~\ref{only_if_incest} mostra, pois
$$
{\Parent} = {\rop \Child} \qquad\mland\qquad {\Child} = {\rop \Parent}.
$$
}

\endexercise
%%}}}

%%{{{ x: describe_coauthors_in_terms_of_author 
\exercise.
Descreva a $\namedpred{Coauthors}$ do \ref{relations_with_text_example}
em termos da $\namedpred{Author}$.

\solution
Considerando que um escritor é coescritor com ele mesmo,
$$
\namedpred{Coauthors} = \namedpred{Author}\rcom\rop{\namedpred{Author}}.
$$

\endexercise
%%}}}

%%{{{ beware: rinv_is_not_inverse 
\beware A inversa não é inversa.
\label{rinv_is_not_inverse}%
Depois dos exercícios~\refn{operation_with_opposite_does_not_yield_identity}
e~\refn{describe_coauthors_in_terms_of_author}, deve ser claro porque eu
preferi chamar a $\rop R$ a relação \emph{oposta} da $R$, e usar essa notação
em vez de $\rinv R$ e o nome \emph{inversa}.
(Que também usamos pois são os mais comuns!)
Se usar a notação $\rinv R$, cuidado para não confudir pensando que
$R \rcom \rinv R = \namedpred{Eq} = \rinv R \rcom R$, pois em geral isso
não é verdade.
Ou seja: a relação ``inversa'' $\rinv R$, \emph{não é a $\rcom$-inversa} da $R$!
%%}}}

%%{{{ x: rop_of_rcompose 
\exercise.
\label{rop_of_rcompose}%
Sejam $R,S$ relações binárias tais que a $R\rcom S$ é definida.
Descreva a $\ropp{R\rcom S}$ em termos das $\rop R$ e $\rop S$
e prove tua afirmação.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Properties of relations 
\section Propriedades de relações.

Aqui aumentamos nossa terminologia, identificando certas propriedades
interessantes que uma relação binária $R$ no $X$ pode ter.

%%{{{ Reflection 
\note Reflexão.
\label{reflexion_terminology}
\tdefined{relação!reflexiva}
\tdefined{relação!irreflexiva}
Olhamos como cada elemento do $X$ relaciona com ele mesmo.
Dois casos notáveis aparecem:
(i) pode ser que para todo $x$ temos $x\rel R x$;
(ii) pode ser que para nenhum $x$ temos $x\rel R x$.
No primeiro caso, chamamos $R$ \dterm{reflexiva}; no segundo, \dterm{irreflexiva}.
Observe que ``irreflexiva'' não significa ``não reflexiva'', etc:
$$
\alignat 2
\text{$R$ é reflexiva}      &\iff \phantom\lnot\forall x R(x,x)        &&\iff \lnot\exists x \lnot R(x,x)\\
\text{$R$ não é reflexiva}  &\iff \lnot\forall x R(x,x)                &&\iff \phantom\lnot\exists x \lnot R(x,x)\\
\text{$R$ é irreflexiva}    &\iff \phantom\lnot\forall x \lnot R(x,x)  &&\iff \lnot\exists x R(x,x)\\
\text{$R$ não é irreflexiva}&\iff \lnot\forall x \lnot R(x,x)          &&\iff \phantom\lnot\exists x R(x,x)
\endalignat
$$
onde os quantificadores quantificam sobre o $X$.
%%}}}

%%{{{ eg 
\example.
As relações $=$, $\leq$, $\geq$, nos números e $=$, $\subseteq$, $\supseteq$ nos conjuntos são todas reflexivas.
Também reflexivas são as relações
\trel{\thole\ nasceu no mesmo pais que \thole},
\trel{\thole\ tem o mesmo primeiro nome com \thole}, etc.,
definidas entre pessoas.
Típicos exemplos de irreflexivas são as $\neq$, $<$, $>$, $\subsetneq$, $\supsetneq$,
\trel{\thole\ é mais baixo que \thole},
\trel{\thole\ e \thole\ nunca estiveram em distância de 2 metros entre si},
etc.
\endexample
%%}}}

%%{{{ Symmetry 
\note Simetria.
\label{symmetry_terminology}
\tdefined{relação!simétrica}
\tdefined{relação!assimétrica}
\tdefined{relação!antissimétrica}
Agora examinamos a relação $R$ com respeito à ordem dos seus argumentos.
Novamente, certos casos notáveis aparecem:
(i) $R$ pode comportar sempre no mesmo jeito independente da ordem dos seus argumentos; nesse caso a chamamos \dterm{simétrica}.
(ii) O $R$-relacionamento dum objeto $x$ com outro $y$ pode garantir que o $y$ não esta $R$-relacionado com o $x$; a chamamos \dterm{asimmétrica}.
(iii) O único caso onde a $R$ relaciona os mesmos argumentos com as duas possíveis órdens, é quando os dois argumentos são iguais; chamamos a $R$ \dterm{antisimmétrica}.
%%}}}

%%{{{ eg 
\example.
Simétricas: $=$, $\neq$, composicionalidade de funções, \trel{\thole\ e \thole\ são irmãos}, \trel{\thole\ e \thole\ são cidades do mesmo país}, etc.
\endgraf\noindent
Asimétricas: $<$, $\subsetneq$, $>$, $\supsetneq$, \trel{\thole\ deve dinheiro para \thole}, \trel{\thole\ está andando no lado esquerdo de \thole}, \trel{\thole\ é a mãe de \thole}, etc.
\endgraf\noindent
Antissimétricas: $\leq$, $\subseteq$, $\geq$, $\supseteq$, $=$, \trel{a palavra \thole\ aparece, mas não depois da palavra \thole\ no dicionário}, etc.
\endexample
%%}}}

%%{{{ x: not_symmetric_notequiv_asymmetric 
\exercise.
\label{not_symmetric_notequiv_asymmetric}%
Verifique que ``não simétrica'' não significa nem ``assimétrica''
nem ``antissimétrica'', escrevendo todas as fórmulas envolvidas e suas negações,
como no~\refn{reflexion_terminology}.

\endexercise
%%}}}

%%{{{ x: check_reflexion_and_symmetry 
\exercise.
\label{check_reflexion_and_symmetry}%
Decida a ``reflexão'' e a ``simetria'' das relações seguintes:
$$
\align
R(A, B) &\letiff \text{os conjuntos $A$ e $B$ são disjuntos}\\
S(A, B) &\letiff |A\setminus B| > 1\\
T(A, B) &\letiff A\symdiff B \neq \emptyset.
\endalign
$$

\endexercise
%%}}}

%%{{{ x: asymmetric_implies_irreflexive 
\exercise.
\label{asymmetric_implies_irreflexive}%
Mostre que:
$$
\text{$R$ assimétrica} \implies \text{$R$ irreflexiva}.
$$

\hint
Contrapositivo.

\solution
Mostramos o contrapositivo.
Suponha que $R$ não é irreflexiva.
Então existe $s$ com $R(s,s)$,
e logo é impossível que a $R$ seja assimétrica,
pois achamos $x$ e $y$ ($x,y\asseq s$) que satisfazem ambas
$R(x,y)$ e $R(y,x)$.

\endexercise
%%}}}

%%{{{ x: asymetric_implies_antisymmetric 
\exercise.
\label{asymetric_implies_antisymmetric}%
Uma das duas direções abaixo é válida:
$$
\text{$R$ assimétrica} \askiff \text{$R$ antissimétrica}.
$$
Prove-a, e mostre que a oposta não é.

\hint
Como uma relação assimétrica poderia não ser antissimétrica?
(O que significa ``não ser antissimétrica''?)

\hint
Procure contraexemplo nos exemplos típicos de relação antissimétrica.

\solution
Para provar a \lrdir, observe que $R$ não é antissimétrica
sse existem $x$ e $y$ tais que:
$$
\underbrace{R(x,y)
\land
R(y,x)}_{\text{impossível por assimetria}}
{}\land\ \ 
{x\neq y}.
$$
Para refutar a \rldir, considere o contraexemplo da antissimétrica $\leq$
no $\nats$, que não é assimétrica, pois é reflexiva.

\endexercise
%%}}}

\note Totalidade.

\TODO Total.

\TODO Tricotomia.

\note Transições.

\TODO Transitividade.

\TODO Circular

\TODO Left-euclidean

\TODO Right-euclidean

\TODO Explicar os nomes ``euclidean''.

%%{{{ Glossary: relations_glossary 
\note Glossário.
\label{relations_glossary}%
Resumimos aqui as propriedades que encontramos.
Seja $X$ conjunto e $R$ uma relação binária nele.
Definimos as seguintes propriedades:
$$
\alignat 2
&x \rel R x                                         &\qqqquad&\textrm{(reflexiva)}\\
&x \not\rel R x                                     &\qqqquad&\textrm{(irreflexiva)}\\
&x \rel R y  \implies  y \rel R x                   &\qqqquad&\textrm{(simétrica)}\\
&x \rel R y  \implies  y \not\rel R x               &\qqqquad&\textrm{(assimétrica)}\\
&x \rel R y  \mland y \rel R x \implies x = y       &\qqqquad&\textrm{(antissimétrica)}\\
&x \rel R y  \mland  y \rel R z \implies x \rel R z &\qqqquad&\textrm{(transitiva)}\\
&x \rel R y  \mland  y \rel R z \implies z \rel R x &\qqqquad&\textrm{(circular)}\\
&x \rel R y  \mland  x \rel R z \implies y \rel R z &\qqqquad&\textrm{(right-euclidean)}\\
&x \rel R z  \mland  y \rel R z \implies x \rel R y &\qqqquad&\textrm{(left-euclidean)}\\
&x \rel R y  \mlor   y \rel R x                     &\qqqquad&\textrm{(total)}\\
\text{exatamente uma das:}\quad
&x \rel R y\, ; \ \  y \rel R x\, ; \ \  x = y      &\qqqquad&\textrm{(tricotômica)}\\
\endalignat
$$
%%}}}

%%{{{ x: investigate_rel_properties_of_three_diags 
\exercise.
\label{investigate_rel_properties_of_three_diags}%
Para cada uma das relações $R,S,Q,F,T$ do~\refn{first_internal_diagrams_for_rel}
e do~\ref{empty_and_true_relation} decida se ela têm ou não, cada uma das
propriedades do glossário no~\refn{relations_glossary}.

\hint
Cuidado: nas propriedades que acabam ser implicações, as variáveis que aparecem
nas suas premissas não denotam obrigatoriamente objetos distintos!

\endexercise
%%}}}

%%{{{ prop: wrong_property_of_sym_and_trans_implies_refl 
\proposition.
\label{wrong_property_of_sym_and_trans_implies_refl}
Seja $X\neq\emptyset$ e $\sim$ uma relação no $X$.
Se $\sim$ é simétrica e transitiva, então ela é reflexiva.
\wrongproof.
Como ela é simétrica, de $x\sim y$ concluimos que $y\sim x$ também.
E agora usando a transitividade, de $x\sim y$ e $y\sim x$, concluimos a $x\sim x$,
que mostra que $\sim$ é reflexiva também.
\mistaqed
%%}}}

%%{{{ x: find the error and prove that the proposition is false 
\exercise.
Ache o erro na prova acima e \emph{prove} que a proposição é falsa!

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Equivalence relations and partitions 
\section Relações de equivalência e partições.
\label{Equivalence_relations_and_partitions}%

%%{{{ Equivalence 
\note Equivalência.
Considere um conjunto $A$, onde queremos ``identificar'' certos elementos deles,
talvez porque ligamos apenas sobre uma propriedade, e queremos ignorar os
detalhes irrelevantes que nos obrigariam distinguir uns deles.
Por exemplo, se $A$ é um conjunto de pessoas, podemos focar apenas na
``nacionalidade''.  Esquecendo todos os outros detalhes então, vamos
considerar todos os copatriotas como se fossem ``iguais'':
o termo certo é \dterm{equivalentes}.
Outra propriedade poderia ter sido o ano que cada pessoa nasceu,
ou o primeiro nome, ou até quem é a mãe de cada pessoa.
Queremos identificar as propriedades que uma relação desse tipo tem que ter:
\item{(i)} Reflexividade: não importa qual foi o critério que escolhemos
para ``equivaler'' os objetos, cada objeto com certeza vai ``concordar''
com ele mesmo nesse critério.
\item{(ii)} Simetría: pela natureza da nossa intuição é claro que
para decidir se dois elementos serão equivalentes ou não, não precisamos
os considerar numa certa ordem.
\item{(iii)} Transitividade:
Se $a$ e $b$ viram equivalentes, e $b$ e $c$ também, isso quis dizer
que não podemos distinguir entre $a$ e $b$, nem entre $b$ e $c$;
segue que $a$ e $c$ também serão equivalentes.
\endgraf
\noindent Chegamos assim na definição seguinte:
%%}}}

%%{{{ df: equivalence_relation 
\definition.
\label{equivalence_relation}
\tdefined{relação!de equivalência}
Seja $A$ conjunto e $\sim$ uma relação binária no $A$.
Chamamos $\sim$ uma \dterm{relação de equivalência} sse ela é
reflexiva, simétrica, e transitiva.
%%}}}

%%{{{ eg: eq_is_an_eqrel 
\example.
\label{eq_is_an_eqrel}%
A $=$ é uma relação de equivalência.
\endexample
%%}}}

%%{{{ x: congruence_mod_m_is_an_eqrel_again 
\exercise.
\label{congruence_mod_m_is_an_eqrel_again}%
Seja $m\in\nats$.
Prove que a relação binária nos inteiros definida pela
$$
a \cong_m b \defiff a \cong b \pmod m
$$
é uma relação de equivalência.

\solution
Esqueceu o~\ref{congruence_mod_m_is_an_eqrel}?

\endexercise
%%}}}

%%{{{ eg: equivalent_relations_on_euclidean_plane 
\example.
\label{equivalent_relations_on_euclidean_plane}
No $\reals^2$ considere as relações:
$$
\align
\tup{x,y} \sim_1 \tup{x',y'}
&\iff x = x'\\
\tup{x,y} \sim_2 \tup{x',y'}
&\iff y = y'\\
\tup{x,y} \sim_{\textrm N} \tup{x',y'}
&\iff \norm{ \tup{x,y} } = \norm{ \tup{x',y'} }
\endalign
$$
Facilmente todas são relações de equivalência.
\endexample
%%}}}

%%{{{ eg: equivalent_relations_on_euclidean_space 
\example.
\label{equivalent_relations_on_euclidean_space}
No $\reals^3$ considere as relações:
$$
\align
\tup{x,y,z} \sim_3 \tup{x',y',z'}
&\iff z = z'\\
\tup{x,y,z} \sim_{1,2} \tup{x',y',z'}
&\iff x = x' \mland y = y' \\
\tup{x,y,z} \sim_{\textrm N} \tup{x',y',z'}
&\iff \norm{ \tup{x,y,z} } = \norm{ \tup{x',y',z'} }
\endalign
$$
Facilmente todas são relações de equivalência.
\endexample
%%}}}

%%{{{ x: cannot replace and with or 
\exercise.
Mudamos o ``e'' para ``ou'' na segunda relação
do~\ref{equivalent_relations_on_euclidean_space}:
$$
\tup{x,y,z} \sim \tup{x',y',z'} \iff x = x' \mlor y = y'
$$
A $\sim$ é uma relação de equivalência?

\hint
Ache um contraexemplo que refuta sua transitividade.

\solution
Não, pois não é transitiva.
Tome os
$\tup{0,0,0}$,
$\tup{0,1,0}$, e
$\tup{2,1,0}$.
Observe que
$$
\tup{0,0,0}
\sim
\tup{0,1,0}
\mland
\tup{0,1,0}
\sim
\tup{2,1,0}
$$
mas $\tup{0,1,0} \not\sim \tup{2,1,0}$.

\endexercise
%%}}}

%%{{{ x: how_many_equivalent_relations_on_3 
\exercise.
\label{how_many_equivalent_relations_on_3}%
Seja $A$ conjunto com $\card A = 3$.
Quantas relações de equivalência podemos definir no $A$?

\hint
Deixe para responder junto com o~\ref{how_many_partitions_on_3}.

\solution
Encontramos a resposta dessa pergunta no~\ref{how_many_partitions_on_3}.

\endexercise
%%}}}

%%{{{ x: equivalent_properties_to_eqrel 
\exercise.
\label{equivalent_properties_to_eqrel}%
Seja $R$ uma relação binária num conjunto $A$.
O.s.s.e.:
\item{(i)}   $R$ é uma relação de equivalência;
\item{(ii)}  $R$ é reflexiva e circular;
\item{(iii)} $R$ é reflexiva e left-euclideana;
\item{(iv)}  $R$ é reflexiva e right-euclideana.

\endexercise
%%}}}

%%{{{ Partition 
\note Partição.
Voltamos de novo para nosso conjunto $A$, mas essa vez sem uma predeterminada
propriedade para focar.  Essa vez vamos dividir os elementos do $A$ em
\dterm{classes}, tais que cada membro do $A$ pertencerá em
\emph{exatamente uma delas}, e cada uma delas terá pelo menos um membro do $A$.
E nem vamos justificar essa separação, explicando o como ou o porquê.
Esse tipo de colecção de classes vamos definir agora.
%%}}}

%%{{{ df: partition 
\definition.
\label{partition}%
\tdefined{partição}%
Seja $A$ conjunto e $\scr A \subseteq \pset A$ uma família de subconjuntos de $A$.
$\scr A$ é uma \dterm{partição} de $A$, sse:
\item{(i)} $\Union \scr A = A$;
\item{(ii)} os membros de $\scr A$ são disjuntos dois a dois;
\item{(iii)} $\emptyset \notin \scr A$.
\endgraf\noindent
Chamamos de \dterm{classes} os membros da $\scr A$.
%%}}}

%%{{{ x: partitions_of_seven 
\exercise.
\label{partitions_of_seven}
Seja $A=\set{0,1,2,3,4,5,6}$.
Quais das colecções seguintes são partições do $A$?:
$$
\alignat 2
\scr A_1 &= \big\{ \set{0,1,3}, \set 2, \set{4,5}, \set 6 \big\}                &\quad\scr A_5 &= \big\{ \set{0,1,2}, \set{2,3,4}, \set{4,5,6} \big\} \\
\scr A_2 &= \big\{ \set{0,1,2,3}, \emptyset, \set{4,5,6} \big\}                 &\scr A_6 &= \big\{ \set{1,2}, \set{0,3}, \set 5, \set 6 \big\}  \\
\scr A_3 &= \big\{ \set{0,1,2,3,4,5,6} \big\}                                   &\scr A_7 &= \big\{ \set{0,1,2}, \set 3, \set{4,5,6,7} \big\}    \\
\scr A_4 &= \big\{ \set 0, \set 1, \set 2, \set 3, \set 4, \set 5, \set 6 \big\}&\scr A_8 &= \big\{ \set 0, \set{1,2}, \set{6,5,4,3} \big\}        
\endalignat
$$

\endexercise
%%}}}

%%{{{ x: union_scr_A_subset_already_known 
\exercise.
\label{union_scr_A_subset_already_known}%
Podemos trocar o~(i) da~\ref{partition} por
$$
\text{(i$'$)}\quad\Union \scr A \supseteq A \ ?
$$

\hint
Será que já sabemos a outra ``direção'' da igualdade?

\solution
Sim!
Pois como $\scr A$ é uma família de subconjuntos de $A$,
já sabemos que $\Union \scr A \subseteq A$.
Logo, afirmar $\Union \scr A = A$ ou afirmar $\Union \scr A \supseteq A$
nesse caso é a mesma coisa.
Escolhemos o (i) pois fica mais natural (e porque se retirar a hipótese
que $\scr A \subseteq \pset A$, o (i) vira necessário).

\endexercise
%%}}}

%%{{{ x: pairwise_necessary_for_partition 
\exercise.
\label{pairwise_necessary_for_partition}%
Podemos trocar o~(ii) da~\ref{partition} por
$$
\text{(ii$'$)}\quad\Inter \scr A = \emptyset\  ?
$$

\hint
Não: nossa definição vai permitir mais colecções ser chamadas ``partição'' do que deveriam.

\hint
Uma das colecções não-partições do~\ref{partitions_of_seven} vai
acabar sendo partição.

\solution
A $\scr A_5\subseteq\powerset A$ do~\ref{partitions_of_seven} satisfaz as
$$
\Union \scr A_5 = A,
\qqqquad
\Inter \scr A_5 = \emptyset,
$$
mas não é uma partição: o $2\in A$ por exemplo, pertenceria em duas classes
diferentes, algo contra da nossa idéia de ``partição''.

\endexercise
%%}}}

%%{{{ Two sides of the same coin 
\note Dois lados da mesma moeda.
Os dois conceitos de ``relação de equivalência'' e ``partição'',
parecem diferentes mas realmente são apenas duas formas diferentes de
expressar a mesma idéia.
Cada relação de equivalência determina uma partição;
e vice-versa: cada partição determina uma relação de equivalência.
Bora provar isso.
%%}}}

%%{{{ x: wrong_partition_of_eqrel_def 
\exercise Cuidado!.
\label{wrong_partition_of_eqrel_def}%
Tentando resolver esse problema, começando com uma relação de equivalência $R$,
um aluno tentou definir a partição $\scr A_{R}$ assim:
$$
\align
C \in \scr A_{R}
\defiff
&C \subseteq A\\
&\mland  C \neq \emptyset\\
&\mland  \lforall {c,d \in C} {c \rel R d}.
\endalign
$$
Qual o erro na definição do aluno?
O que faltou escreverer para virar uma definição correta?

\hint
Considere o conjunto $A$ com a relação de equivalência $R$ como no diagrama
interno seguinte:%
\footnote{Lembra-se que como já declaramos a~$R$ de ser uma relação de
equivalência, não precisamos botar todas as setinhas, apenas as necessárias
para ``gerar'' a~$R$.
Veja~\ref{conventions_for_internal_diagrams_of_rel}.}
$$
\tikzpicture
\tikzi eqrel2partitionbase;
\draw (elem-1) -- (elem-2) -- (elem-3) -- (elem-4);
\draw (elem-5) -- (elem-6);
\endtikzpicture
$$
Seguindo fielmente sua definição, qual é o conjunto $\scr A_{R}$?

\hint
\emph{Não} é o conjunto dos seguintes subconjuntos de $A$:
$$
\tikzpicture
\tikzi eqrel2partitionbase;
\tikzi eqrel2partitiondesired;
\endtikzpicture
$$
Ache um $C\subseteq A$ tal que $C \in \scr A_{R}$ mas \emph{não deveria}.

\hint
A definição do aluno garanta que todos os elementos numa classe realmente
relacionam entre si através da $R$;
mas não garanta que cada classe $C$ é feita por \emph{todos} os elementos
de~$A$ que relacionam com os membros da $C$ mesmo.
Por exemplo, ela \emph{corretamente exclue} conjuntos como $\set{2,5}$;
mas ela \emph{incorretamente inclue} conjuntos como o $\set{2,3}$.
$$
\tikzpicture
\draw [rounded corners=3mm, fill=blue!20] (-1.6,0.4)--(-1.6,1.4)--(-0.3,1.4)--(-0.3,0.4)--cycle;
\tikzi eqrel2partitiondesired;
\tikzi eqrel2partitionbase;
\endtikzpicture
\qqqquad
\tikzpicture
\draw [rounded corners=2mm, fill=red!20] (-1.5,1.4)--(-1.5,-1.0)--(-0.9,-1.0)--(-0.9,1.4)--cycle;
\tikzi eqrel2partitiondesired;
\tikzi eqrel2partitionbase;
\endtikzpicture
$$

\solution
Seguindo as dicas, faltou escrever a ultima linha:
$$
\align
C \in \scr A_{R}
\defiff
&C \subseteq A\\
&\mland  C \neq \emptyset\\
&\mland  \lforall {c,d \in C} {c \rel R d}\\
&\mland  \pforall {a \in A} \lforall {c \in C} {a \rel R c \implies a \in C}.
\endalign
$$

\endexercise
%%}}}

%%{{{ x: from_eqrel_to_partition 
\exercise.
\label{from_eqrel_to_partition}%
Escreva claramente como definir uma partição dum conjunto $A$,
dada uma relação de equivalência $\sim$ no $A$.
Prove que realmente é uma partição
(a partição \dterm{induzida} pela $\sim$).

\endexercise
%%}}}

%%{{{ x: from_partition_to_eqrel 
\exercise.
\label{from_partition_to_eqrel}%
Escreva claramente como definir uma relação de equivalência num conjunto $A$,
dada uma partição $\scr A$ do $A$.
Prove que realmente é uma relação de equivalência
(a relação de equivalência \dterm{induzida} pela $\scr A$).

\endexercise
%%}}}

%%{{{ x: why_all_of_partition_properties_are_needed 
\exercise.
\label{why_all_of_partition_properties_are_needed}%
Explique onde precisou cada uma das condições (i)--(iii) da~\ref{partition}
na tua resolução do~\ref{from_partition_to_eqrel}.

\endexercise
%%}}}

%%{{{ x: how_many_partitions_on_3 
\exercise.
\label{how_many_partitions_on_3}%
Seja $A$ conjunto finito com $\card A = 3$.
Quantas partições de $A$ existem?

\endexercise
%%}}}

%%{{{ df: equivalent_class and quoset 
\definition.
\label{equivalent_class}%
\label{quoset}%
\tdefined{classe de equivalência}%
\tdefined{conjunto}[quociente]%
\sdefined {\eqclass {\holed a} {\holed R}} {classe de equivalência do $\holed a$ através da $\holed R$}%
\sdefined {\eqclassimp {\holed a}} {classe de equivalência do $\holed a$ (relação implícita pelo contexto)}%
\sdefined {\quoset {\holed A} {\holed R}} {conjunto quociente do $\holed A$ por $\holed R$}%
\iisee{quociente!conjunto}{conjunto quociente}%
Seja $A$ um conjunto e $\sim$ uma relação de equivalência no $A$.
Para cada $a\in A$, definimos a \dterm{classe de equivalência do} $a$
como o conjunto
$$
\eqclass a {\sim} \defeq \set {x\in A \st x\sim a},
$$
e quando a relação de equivalência é implicita pelo contexto
denotamos apenas por $\eqclassimp a$.
Definimos também o \dterm{conjunto quociente} de $A$ por $\sim$:
$$
\quoset A {\sim} \defeq \set {\eqclass a {\sim} \st a \in A }.
$$
%%}}}

%%{{{ eg: some_eqclasses_geometrically_and_algebrically 
\example.
\label{some_eqclasses_geometrically_and_algebrically}%
Vamos descrever geometricamente as classes de equivalência das
relações do~\ref{equivalent_relations_on_euclidean_plane} no $R^2$,
ou seja, determinar os conjuntos quocientes correspondentes.
Lembramos as relações:
$$
\align
\tup{x,y} \sim_1 \tup{x',y'}
&\iff x = x'\\
\tup{x,y} \sim_2 \tup{x',y'}
&\iff y = y'\\
\tup{x,y} \sim_{\textrm N} \tup{x',y'}
&\iff \norm{ \tup{x,y} } = \norm{ \tup{x',y'} }
\endalign
$$
Em cada classe de equivalência da $\sim_1$ então, estão todos os
pares que concordam na sua primeira coordenada.  Ou seja,
cada classe é uma retas vertical, e o conjunto quociente é
colecção de todas essas linhas.  Olhando ainda mais de longe,
podemos ``identificar'' cada reta com seu representante canônico
que fica no eixo-$x$, ou seja, podemos dizer que
$$
\quoset {\reals^2} {\sim_1} \pseudoeq \reals.
$$
A situação é similar para a $\sim_2$, so que essa vez são todas
as retas horizontais, mas olhando novamente de longe,
identificamos cada reta com seu representante canônico
que agora fica no eixo-$y$, ou seja, novamente temos
$$
\quoset {\reals^2} {\sim_2} \pseudoeq \reals.
$$
Sobe a $\sim_{\textrm N}$, a classes do seu
conjunto quociente são todos os cíclos com centro a origem $(0,0)$,
incluindo o ``ciclo-trivial'' com raio $0$, que acaba sendo apenas
o ponto $(0,0)$ mesmo.
Essa vez, identificando cada cíclo com seu raio, chegamos na
$$
\quoset {\reals^2} {\sim_{\textrm N}} \pseudoeq \reals_{\geq 0}.
$$
Por enquanto, entendemos todas essas $\pseudoeq$ apenas como
um ``modo de falar''.
Cuidado pois nenhuma delas é uma verdadeira $=$!
Os dois lados dessas ``igualdades'' são conjuntos cujos membros
nem são objetos do mesmo tipo!
No lado esquerdo pertencem \emph{conjuntos de pares de números reais},
no lado direito pertencem \emph{números reais}.
\endexample
%%}}}

%%{{{ x: more_eqclasses_geometrically_and_algebrically 
\exercise.
\label{more_eqclasses_geometrically_and_algebrically}%
Descreva geometricamente e algebricamente os conjuntos quocientes
das relações de equivalência
do~\ref{equivalent_relations_on_euclidean_space}.

\hint
Entendeu o~\ref{some_eqclasses_geometrically_and_algebrically}?

\solution

\endexercise
%%}}}

%%{{{ x: guaranteed_eqrels 
\exercise.
\label{guaranteed_eqrels}%
Seja $A$ um conjunto qualquer.
Quais relações de equivalência podes já definir nele, sem saber
absolutamente nada sobre seus elementos?

\solution
A identidade $=$, a trivial $\True$, e a vazia $\False$.

\endexercise
%%}}}

%%{{{ x: equivalent_statements_to_x_equiv_y 
\exercise.
Sejam $\sim$ uma relação de equivalência num conjunto $X$, e $a,b\in X$.
Mostre que as afirmações seguintes são equivalentes:
\item{(i)} $a\sim b$
\item{(ii)} $\eqclassimp a = \eqclassimp b$
\item{(iii)} $\eqclassimp a \inter \eqclassimp b \neq \emptyset$.

\solution
Vamos provar primeiro a ``(i)\bidir(iii)''.
\endgraf
\lrdir.
Suponha que $a \sim b$.
Precisamos achar um elemento que pertence nos dois conjuntos
$\eqclassimp a$ e $\eqclassimp b$.
Tome o proprio $a$.
Temos $a\in \eqclassimp a$ pois $a \sim a$ (pela reflexividade da $\sim$).
Tambem temos $a \in \eqclassimp b$, pois $a \sim b$ (hipótese).
Logo $a \in \eqclassimp a \inter \eqclassimp b\neq\emptyset$.
\endgraf
\rldir.
Suponha que $\eqclassimp a\inter\eqclassimp b \neq \emptyset$
e tome $w \in \eqclassimp a\inter\eqclassimp b$.
Logo $w \in \eqclassimp a$ e $w \in \eqclassimp b$,
ou seja $w \sim a$ e $w \sim b$ pela definição de classe de equivalência.
Pela simetría da $\sim$ temos $a \sim w$.
Agora como $a\sim w$ e $w \sim b$, pela transitividade da $\sim$ ganhamos
o desejado $a \sim b$.
\endgraf
Agora vamos provar a ``(i)\bidir(ii)''.
\endgraf
\lrdir.
Suponha que $a \sim b$.
Tome $x\in \eqclassimp a$.
Logo $x \sim a$.
Mas $a \sim b$ e logo pela transitividade da $\sim$ temos $x \sim b$,
e logo $x \in \eqclassimp b$.
\rldir.
Suponha que $\eqclassimp a = \eqclassimp b$.
Pela reflexividade da $\sim$, sabemos que $a\in\eqclassimp a$.
Logo $a\in\eqclassimp b$, e logo $a\sim b$ pela definição de $\eqclassimp b$.

\endexercise
%%}}}

%%{{{ x: quoset_of_congruence_mod_m 
\exercise.
\label{quoset_of_congruence_mod_m}%
Seja $m\in\nats$.
Já provou no~\ref{congruence_mod_m_is_an_eqrel} que a relação de
congruência módulo $m$ é uma relação de equivalência.
Então: qual é o seu conjunto quociente?
Também: seguindo a idéia do~\ref{some_eqclasses_geometrically_and_algebrically},
com que tu ``identificaria'' o $\quoset \ints {\cong_m}$?

\endexercise
%%}}}

%%{{{ df: kernel_coimage 
\definition.
\label{kernel_coimage}
\tdefined{kernel}
\tdefined{coimagem}
\sdefined {\ker {\holed f}} {kernel da \holed f}
\sdefined {\coim {\holed f}} {coimagem da \holed f}
Seja $f : X \to Y$ e defina a relação binária $\frel f$ no $X$ pela
$$
x_1 \frel f x_2 \defiff f(x_1)=f(x_2).
$$
Chamamos a $\frel f$ o \dterm{kernel} da $f$, e seu conjunto quociente
a \dterm{coimagem} da $f$.
Usamos também os símbolos $\ker f$ e $\coim f$ respectivamente.
%%}}}

%%{{{ x: frel_is_an_eqrel 
\exercise.
\label{frel_is_an_eqrel}%
Com os dados da~\ref{kernel_coimage}
mostre que $\frel f$ é uma relação de equivalência e descreva os elementos da coimagem.
O que podemos dizer se $f$ é injetora?  Se ela é sobrejetora?

\endexercise
%%}}}

%%{{{ x: immediate applications 
\exercise.
Mostre que todas as relações dos
exemplos~\refn{equivalent_relations_on_euclidean_plane}
e~\refn{equivalent_relations_on_euclidean_space}
são casos especiais do~\ref{frel_is_an_eqrel}
(e logo são relações de equivalência ``gratuitamente'').

\hint
Para cada uma delas, precisa definir completamente a
$f : A \to B$ (esclarecendo também quais são os $A,B$).

\endexercise
%%}}}

%%{{{ x: distance_like_not_transitive 
\exercise.
\label{distance_like_not_transitive}%
Seja real $\epsilon\in(0,1)$, e defina a relação $\approx_\epsilon$:
$$
x \approx_\epsilon y \defiff (x-y)^2 < \epsilon.
$$
A $\approx_\epsilon$ é uma relação de equivalência?

\hint
Primeiramente resolve o mesmo problema mas para a relação:
$$
x \sim_\epsilon y \defiff |x-y| < \epsilon
$$
onde $\epsilon > 0$.

\hint
Reflexividade e simetria das $\sim_\epsilon$ e $\approx_\epsilon$ são imediatas.
Sobre a transitividade, um desenho na linha real ajudaria.

\hint
Como contraexemplo, tome os reais $0$, $\epsilon/2$, e $\epsilon$ e
observe que $0 \sim_\epsilon \epsilon/2$ e $\epsilon/2 \sim_\epsilon \epsilon$
mas mesmo assim não temos $0\sim_\epsilon \epsilon$.

\hint
Como podes usar a não-transitividade da $\sim_\epsilon$
para deduzir a não-transitividade da $\approx_\epsilon$?

\hint
Para todo $\alpha\in\reals_{\geq 0}$ temos:
$$
\cdots
\iff
\sqrt{\alpha}\in(0,1)
\iff
\alpha\in(0,1)
\iff
\alpha^2\in(0,1)
\iff
\cdots
$$

\solution
Não é.  Uma resolução já foi rescunhada nas dicas.
Para um contraexemplo direto, pode tomar os reais
$0$, $\sqrt \epsilon / 2$, e $\sqrt \epsilon$.
Observe que $0 \approx_\epsilon \sqrt \epsilon / 2$
e $\sqrt \epsilon / 2 \approx_\epsilon \sqrt \epsilon$
mas não temos $0 \approx_\epsilon \sqrt \epsilon$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Order relations 
\section Relações de ordem.

%%{{{ df: order_relation 
\definition Ordem.
\label{order_relation}%
Seja $R$ uma relação binária num conjunto $A$.
Chamamos a $R$ \dterm{ordem parcial} sse ela é reflexiva, transitiva, e antissimétrica.
Se ela também é total, chamamos-la \dterm{ordem total}.
%%}}}

%%{{{ beware: total-partial default, relations vs functions 
\beware.
Quando usamos apenas o termo \emph{ordem}, entendemos como \emph{ordem parcial}.
Observe que esta convenção é a oposta que seguimos nas funções, onde um pleno
\emph{função} quis dizer \emph{função total}.
%%}}}

\TODO Examples.

%%{{{ divides_is_not_an_order_on_ints 
\exercise.
\label{divides_is_not_an_order_on_ints}%
A relação $\divides$ nos inteiros é uma relação de ordem?

\hint
O que podemos concluir se $a\divides b$ e $b\divides a$?

\endexercise
%%}}}

%%{{{ df: preorder_relation 
\definition Preordem.
\label{preorder_relation}%
\tdefined{preordem}%
\iisee{quasiordem}{preordem}%
Uma relação binária $R$ num conjunto $A$ é chamada \dterm{preordem} (ou \dterm{quasiordem}) sse ela é reflexiva e transitiva.
%%}}}

\blah.
No~\ref{why_called_preorder} tu vai justificar o nome ``preordem'',
mostrando que cada preordem $R$ fornece uma ordem $R'$.

\TODO Ordens estritas.

\TODO De fraca para estrita, ida e volta.

\endsection
%%}}}

%%{{{ Closures 
\section Fechos.

\blah.
Antes de definir formalmente o conceito importante de fechos,
começamos com uns exemplos ilustrativos para os três fechos mais comuns:
reflexivo, simétrico, transitivo.
A idéia é sempre a mesma, e vamos descreve-la como um algoritmo.

%%{{{ The idea 
\note A idéia.
Começamos com uma relação $R$, e fixamos uma propriedade
desejada (por exemplo, a transitividade).
Vamos construir uma nova relação $\bar R$, que chamamos o \dterm{fecho}
da $R$ pela propriedade escolhida.
Pense na $R$ como o seu diagrama interno, com suas setinhas.
Primeiramente nós nos perguntamos:
<<a relação já tem essa propriedade?>>
Caso que sim, não precisamos fazer nada, a relação que temos é
o fecho $\bar R$ que queriamos construir.
Caso que não, quis dizer que tem setinhas que
\emph{deveriam estar} no diagrama, mas não estão.
(Essas setinhas são as testemunhas que refutam a nossa propriedade.)
Adicionamo-las na nossa relação.
E agora voltamos a perguntar a mesma pergunta,
e continuar no mesmo jeito, até finalmente chegar numa
relação $\bar R$ que realmente satisfaz a propriedade escolhida.
Essa relação $\bar R$ é o fecho da $R$ pelessa propriedade.
%%}}}

%%{{{ eg: reflexive_closure_example 
\example Fecho reflexivo.
\label{reflexive_closure_example}%
Seja $R$ a relação no $A$ com o diagrama seguinte:
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\endtikzpicture
$$
Qual é o fecho reflexivo dela?
Bem, primeiramente nós nos perguntamos:
será que a relação já é reflexiva?
Ela não é.
Identificamos então as setinhas-testemunhas desse fato:
são as $(1,1)$, $(3,3)$, $(7,7)$, e $(8,8)$.
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\node[color=blue] (elem-1b) at (elem-1) {$1$};
\node[color=blue] (elem-3b) at (elem-3) {$3$};
\node[color=blue] (elem-7b) at (elem-7) {$7$};
\node[color=blue] (elem-8b) at (elem-8) {$8$};
\draw[->, color=red, ultra thick, dotted] ([shift={(0,0.2)}]elem-3) arc (10:290:0.25);
\draw[->, color=red, ultra thick, dotted] ([shift={(0,0.2)}]elem-7) arc (10:290:0.25);
\draw[->, color=red, ultra thick, dotted] ([shift={(0,-.2)}]elem-1) arc (-170:120:0.25);
\draw[->, color=red, ultra thick, dotted] ([shift={(-.2,0)}]elem-8) arc (80:350:0.25);
\endtikzpicture
$$
Adicionamo-la na relação e chegamos em:
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\draw[->] ([shift={(0,0.2)}]elem-3) arc (10:290:0.25);
\draw[->] ([shift={(0,0.2)}]elem-7) arc (10:290:0.25);
\draw[->] ([shift={(0,-.2)}]elem-1) arc (-170:120:0.25);
\draw[->] ([shift={(-.2,0)}]elem-8) arc (80:350:0.25);
\endtikzpicture
$$
\dots e perguntamos a mesma pergunta:
será que ela é reflexiva?
Agora é sim!
Essa relação então é o \emph{fecho reflexivo} da $R$.
\endexample
%%}}}

%%{{{ eg: symmetric_closure_example 
\example Fecho simétrico.
\label{symmetric_closure_example}%
Vamos calcular o agora o fecho simétrico da mesma relação $R$
do~\ref{reflexive_closure_example}:
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\endtikzpicture
$$
Será que ela já é simétrica?
Ela não é por causa das três setinhas seguintes,
onde para cada uma mostro em azul a setinha-razão que obriga
a setinha-faltante (em vermelho) ser adicionada:
$$
\xxalignat3
&
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\draw[->, color=blue, ultra thick        ] (elem-8) to                 (elem-6);
\draw[->, color=red , ultra thick, dotted] (elem-6) to [bend left=30]  (elem-8);
\endtikzpicture
&&
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\draw[->, color=blue, ultra thick        ] (elem-6) to                 (elem-7);
\draw[->, color=red , ultra thick, dotted] (elem-7) to [bend left=15]  (elem-6);
\endtikzpicture
&&
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\draw[->, color=blue, ultra thick        ] (elem-5) to                 (elem-8);
\draw[->, color=red , ultra thick, dotted] (elem-8) to [bend right=30] (elem-5);
\endtikzpicture
\endxxalignat
$$
Então adicionamos todas essas setinhas necessárias:
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\draw[->            ] (elem-8) to                 (elem-6);
\draw[->            ] (elem-6) to                 (elem-7);
\draw[->            ] (elem-5) to                 (elem-8);
\draw[->            ] (elem-6) to [bend left=30]  (elem-8);
\draw[->            ] (elem-7) to [bend left=15]  (elem-6);
\draw[->            ] (elem-8) to [bend right=30] (elem-5);
\endtikzpicture
$$
Agora perguntamos novamente: a relação é simétrica?
Ela é sim, então paramos aqui.
A relação criada é o \emph{fecho simétrico} da $R$.
\endexample
%%}}}

%%{{{ eg: transitive_closure_example 
\example Fecho transitivo.
\label{transitive_closure_example}%
Para ser original, seja $R$ a mesma relação dos
exemplos~\refn{reflexive_closure_example}--\refn{symmetric_closure_example}:
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\endtikzpicture
$$
Essa vez vamos calcular o fecho transitivo dela, então começamos com a pergunta:
será que a relação já é transitiva?
Não é!
Então precisamos achar todas as setinhas que deveriam estar nela e não estão
e adicioná-las:
$$
\xxalignat3
&
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\draw[->, color=blue, ultra thick        ] (elem-5) to (elem-8);
\draw[->, color=blue, ultra thick        ] (elem-8) to (elem-6);
\draw[->, color=red , ultra thick, dotted] (elem-5) to (elem-6);
\endtikzpicture
&&
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\draw[->, color=blue, ultra thick        ] (elem-8) to (elem-6);
\draw[->, color=blue, ultra thick        ] (elem-6) to (elem-7);
\draw[->, color=red , ultra thick, dotted] (elem-8) to (elem-7);
\endtikzpicture
&&
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosures0;
\draw[->, color=blue, ultra thick        ] (elem-1) to [bend left=20] (elem-2);
\draw[->, color=blue, ultra thick        ] (elem-2) to [bend left=20] (elem-1);
\draw[->, color=red , ultra thick, dotted] ([shift={(0,-.2)}]elem-1) arc (-170:120:0.25);
\endtikzpicture
\endxxalignat
$$
Adicionando todas essas setas necessárias, chegamos na relação:
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosurest1;
\endtikzpicture
$$
E perguntamos: ela é transitiva?
\emph{Ainda não!}
Pois, as novas setinhas que adicionamos criaram novos caminhos que
obrigam mais uma setinha estar na relação (dois caminhos diferentes
explicam a adição dessa mesma setinha nesse caso):
$$
\xalignat2
&
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosurest1;
\draw[->, color=blue, ultra thick        ] (elem-5) to (elem-6);
\draw[->, color=blue, ultra thick        ] (elem-6) to (elem-7);
\draw[->, color=red , ultra thick, dotted] (elem-5) to (elem-7);
\endtikzpicture
&&
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosurest1;
\draw[->, color=blue, ultra thick        ] (elem-5) to (elem-8);
\draw[->, color=blue, ultra thick        ] (elem-8) to (elem-7);
\draw[->, color=red , ultra thick, dotted] (elem-5) to (elem-7);
\endtikzpicture
\endxalignat
$$
Adicionamos então a setinha $(5,7)$:
$$
\tikzpicture[>=stealth, scale=0.84]
\tikzi reldiagclosurest1;
\draw[->] (elem-5) to (elem-7);
\endtikzpicture
$$
Ela é transitiva agora?  Sim, finalmente!
Então esse é o \emph{fecho transitivo} da $R$.
\endexample
%%}}}

%%{{{ pseudodf: fecho_pseudodefinition 
\pseudodefinition.
\label{closure_pseudodefinition}%
\tdefined{fecho!de relação}%
Seja $R$ uma relação binária num conjunto $A$,
e fixe uma propriedade \emph{razoável}
daquelas que aparecem no~glossário~\refn{relations_glossary}.
Definimos o fecho da $R$ pela propriedade para ser a relação que criamos se
\emph{adicionar} numa maneira \emph{justa} todas as setinhas \emph{necessárias}
no diagrama da $R$ até ela virar uma relação com a propriedade
desejada.
%%}}}

%%{{{ remark: we may add but never remove 
\remark Podemos botar mas não retirar.
Note então que o fecho $\bar R$ de uma relação $R$ tem todas
as setinhas que $R$ tem, e possivelmente mais ainda.
Ou seja, temos
$$
\graph R \subseteq \graph \bar R
$$
para qualquer fecho escolhido.
%%}}}

\blah.
Na~\ref{closure_pseudodefinition} enfatisei as palavras ``razoável'',
``justa'' e ``necessárias''.
Vamos ver o que cada uma delas quis dizer mesmo.

%%{{{ Necessary arrows 
\note Setinhas necessárias.
``Adicionar apenas as setinhas \emph{necessárias}'' quis dizer que
a falta de cada uma dessas setinhas é uma razão que nossa relação não
satisfaz a propriedade escolhida.
Caso contrário não vamos adiciona-la, \emph{mesmo se sua adição não afeta nada}.
%%}}}

%%{{{ Fair way 
\note Maneira justa.
``Adicionar setinhas numa maneira \emph{justa}'' quis dizer que em
nenhum ponto vamos ter que escolher entre duas ou mais setinhas-testemunhas
\emph{tais que a adição de apenas uma} seria suficiente para satisfazer
a propriedade.
Imagine que nesse caso, nossa escolha não seria justa para a setinha
não-escolhida (ou para a setinha escolhida, dependendo o ponto de vista).
Formar o fecho duma relação deve ser uma operação, e sendo isso deve
ser determinista.
Imagina entao que temos uma propriedade estranha, dizendo que:
$$
x \rel R x \mland y \rel R y \implies x \rel R y.
$$
(Nem adianta tentar achar um nome razoável para essa propriedade.)
Agora, a relação $R$ no $\nats$ com $\graph R = \set{ (0,0), (1,1) }$
claramente não satisfaz essa propriedade.
Tentando formar o fecho através dessa propriedade, já na primeira etapa,
temos duas ``setinhas-testemunhas'' que podemos escolher para adicionar:
a $(0,1)$ e a $(1,0)$.  Graças à restrição de ``necessárias'', não podemos
adicionar ambas, pois assim que adicionar uma, a propriedade já é satisfeita.
No outro lado, não podemos escolher uma das duas numa maneira justa:
as duas servem igualmente bem.
\emph{Para esse tipo de propriedade então não podemos definir um fecho.}
Espero que isso explica também o que eu quis dizer com a palavra ``razoável''.
O~\ref{unreasonable_properties_for_closures_of_relations} esclarecerá
isso ainda mais.
%%}}}

%%{{{ x: unreasonable_properties_for_closures_of_relations 
\exercise.
\label{unreasonable_properties_for_closures_of_relations}%
Por quê não falamos de fecho total, irreflexivo, e asimétrico?

\hint
Seja justo.

\solution
Fechando através da totalidade a gente deveria tomar umas decisões
injustas.
Fechando através da irreflexividade a gente deveria retirar setinhas
quando fechando podemos apenas adicionar.
Fechando através da asimetria, a gente deveria retirar setinhas
também e inclusive isso seria numa maneira injusta:
dadas setinhas $(0,1)$ e $(1,0)$ qual das duas tu vai escolher para retirar?

\endexercise
%%}}}

%%{{{ Q: How would you define the reflexive and symmetric closures of R? 
\question.
Como tu definarias formalmente o fecho reflexivo e o fecho simétrico duma relação $R$?
%%}}}
\spoiler.

%%{{{ df: rclosure 
\definition Fecho reflexivo.
\label{rclosure}%
\tdefined{fecho!reflexivo}%
\sdefined {\rclosure {\holed R}} {o fecho reflexivo da \holed R}%
\sdefined {\rclo {\holed R}} {o fecho reflexivo da \holed R}%
Seja $R$ relação num conjunto $A$.
Definimos a relação $\rclosure R$ pela
$$
x \rclosure R y \defiff x \rel R y \mlor x = y
$$
Chamamos a $\rclosure R$ o \dterm{fecho reflexivo} da $R$.
Também usamos a notação $\rel {R^=}$.
%%}}}

%%{{{ x: wrong_sclosure_definition 
\exercise.
Alguém definiu o fecho simétrico assim:
\quote{Seja $R$ relação binária num conjunto $A$.
Seu fecho simétrico é a relação $\sclosure R$ definida pela
$$
x \sclosure R y \pseudodefiff x \rel R y \mland y \rel R y.
$$
}
Ache o erro na definição e mostre que a definição realmente é errada.
Tente corrigir o erro.

\hint
Aplique fielmente essa definição na relação do~\ref{symmetric_closure_example}.

\hint
Essa definição pode acabar apagando setas!

\solution
Tome a relação $R$ nos $\nats$ com gráfico $\set{(0,1)}$.
Aplicando essa suposta definição da $\sclosure R$ então temos:
$$
x \sclosure R y \iff x \rel R y \mland y \rel R x \iff \False
$$
ou seja, a $x \sclosure R y$ acaba sendo a relação vazia.
Assim acabamos apagando setinhas, algo contra do nosso conceito de fecho!

\endexercise
%%}}}

%%{{{ df: sclosure 
\definition Fecho simétrico.
\label{sclosure}%
\tdefined{fecho!simétrico}%
\sdefined {\sclosure {\holed R}} {o fecho simétrico da \holed R}%
\sdefined {\sclo {\holed R}} {o fecho simétrico da \holed R}%
Seja $R$ relação num conjunto $A$.
Definimos a relação $\sclosure R$ pela
$$
x \sclosure R y \defiff x \rel R y \mlor y \rel R y.
$$
Chamamos a $\sclosure R$ o \dterm{fecho simétrico} da $R$.
Também usamos a notação $\rel {R^\leftrightarrow}$.
%%}}}

%%{{{ x: wrong_tclosure_definition 
\exercise.
Alguém definiu o fecho transitivo assim.
\emph{Seja $R$ relação binária num conjunto $A$.
Seu fecho transitivo é a relação $\tclosure R$ definida pela}
$$
x \tclosure R y \pseudodefiff \text{existe $w\in A$ tal que $x \rel R w \mland w \rel R y$}.
$$
Mas isso não é o fecho transitivo da $R$.  O que é mesmo?

\solution
A relação definida é a $R^2$, ou seja, a $R \rcom R$.

\endexercise
%%}}}

%%{{{ Q: How would you define the transitive closures of R? 
\question.
Como tu definarias formalmente o fecho transitivo duma relação $R$?
%%}}}
\spoiler.

%%{{{ df: tclosure and rtclosure 
\definition Fecho transitivo.
\label{tclosure}%
\label{rtclosure}%
\tdefined{fecho!transitivo}%
\tdefined{fecho!reflexivo-transitivo}%
\sdefined {\tclosure {\holed R}} {o fecho transitivo da \holed R}%
\sdefined {\tclo {\holed R}} {o fecho transitivo da \holed R}%
\sdefined {\rtclosure {\holed R}} {o fecho reflexivo-transitivo da \holed R}%
\sdefined {\rtclo {\holed R}} {o fecho reflexivo-transitivo da \holed R}%
Seja $R$ relação num conjunto $A$.
Definimos as relações $\tclosure R$ e $\rtclosure R$ pelas
$$
\xalignat2
x \tclosure R y &\defiff x \rel {R^n} y \ \ \text{para algum $n\in\nats_{>0}$}.
&&\text{(\dterm{fecho transitivo} da $R$)}\\
x \rtclosure R y &\defiff x \rel {R^n} y \ \ \text{para algum $n\in\nats$}
&&\text{(\dterm{fecho reflexivo-transitivo} da $R$)}\\
\endxalignat
$$
Chamamos a $\tclosure R$ o \dterm{fecho transitivo} da $R$,
e a $\rtclosure R$ o \dterm{fecho reflexivo-transitivo} da $R$.
Também usamos as notações $\tclo R$ para o $\tclosure R$
e $\rtclo R$ para o $\rtclosure R$.
%%}}}

%%{{{ x: order_of_closures_matters 
\exercise.
\label{order_of_closures_matters}%
Seja $R$ relação num conjunto $A$.
Podemos concluir alguma das afirmações seguintes?:
\beginil
\item{(i)}  $t(r(R)) \askeq r(t(R))$
\item{(ii)} $t(s(R)) \askeq s(t(R)$
\endil
\noindent
Aqui $r, s, t$ são os fechos reflexivo, simétrico, transitivo respectivamente.

\hint
Use diagramas internos.

\hint
Tente achar um contraexemplo para o (ii).
Qual a dificuldade de achar contraexemplo para o (i)?

\endexercise
%%}}}

\blah.
Deixamos as definições de outros fechos para os problemas.

%%{{{ x: isPred 
\exercise.
\label{isPred}
Considere a relação $\to$ no $\nats$, definida pela:
$$
x\to y \defiff x + 1 = y.
$$
Descreva as relações seguintes:
\item{$\transcl{\to}$}: seu fecho transitivo;
\item{$\rtranscl{\to}$}: seu fecho reflexivo-transitivo;
\item{$\rtranscl{\leftrightarrow}$}: seu fecho reflexivo-transitivo-simétrico.
\endgraf\noindent
Descreva o conjunto quociente $\quoset{\nats}{\rtranscl{\leftrightarrow}}$.

\endexercise
%%}}}

%%{{{ x: isPred_in_reals 
\exercise.
\label{isPred_in_reals}%
Considere a relação $\to$ definida pela mesma equação como
no~\ref{isPred}, mas essa vez no conjunto $\reals$.
Descreva os mesmos fechos e o
$\quoset{\reals}{\rtranscl{\leftrightarrow}}$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Recursive definitions 
\section Relações recursivas.

\blah.
Aqui são exemplos familiares para definir recursivamente relações.

%%{{{ eg: even_and_odd_rels_recursion 
\example.
No $\nats$ definimos:
$$
\xalignat2
\Even(0).      &                       &\lnot\Odd(0).&\\
\Even(n+1)     &\defiff \lnot \Even(n) &\Odd(n+1)&\defiff \lnot \Odd(n)
\intertext{Ou, alternativamente, usando duas bases:}
\Even(0).      &                       &\lnot\Odd(0).&\\
\lnot\Even(1). &                       &\phantom\lnot\Odd(1).&\\
\Even(n+2)     &\defiff \Even(n)       &\Odd(n+2)&\defiff \Odd(n)
\endxalignat
$$
\endexample
%%}}}

%%{{{ eg: even_and_odd_rels_mutual_recursion 
\example Recursão mutual.
$$
\xalignat2
\Even(0).  &                  &\lnot\Odd(0).&\\
\Even(n+1) &\defiff \Odd(n)   &\Odd(n+1)&\defiff \Even(n)
\endxalignat
$$
\endexample
%%}}}

\blah.
Num paradigma de programação, na \emph{programação lógica},
programamos definindo relações nesse jeito.
Deixamos então esse assunto para o~\ref{Logic_programming}.

\endsection
%%}}}

%%{{{ Implementing functions as relations and vice-versa 
\section Implementando funções como relações e vice versa.

\blah.
Já encontramos a ideia de \emph{implementação} de algum
conceito matemático no~\ref{Functions}
(veja novamente o~\ref{implement_nondeterministic_functions}).

\endsection
%%}}}

%%{{{ Higher-order relations 
\section Relações de ordem superior.

\blah.
Talvez você já se perguntou o que acontece se numa frase como a
$$
\mtrel{João ama Maria}
$$
em vez de substrituir os objetos ``João'' e ``Maria'' com buracos,
substituir o próprio verbo ``amar'':
$$
\mtrel{João {\thole} Maria}.
$$
Chegamos assim no conceito de relações de ordem superior.
Não vale a pena investigar (ainda) esse conceito pois necessita
mais umas ferramentas (e pouco mais maduridade).
Voltamos depois de estudar programação lógica (\ref{Logic_programming})
e lógicas de ordem superior (\ref{Mathematical_logic}).

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ prob 
\problem.
Define no $\ints\times(\ints\setminus\set0)$ a relação
$$
\tup{a,b} \approx \tup{c,d}
\defiff
ad = bc
$$
Mostre que $\approx$ é uma relação de equivalência
e descreva suas classes de equivalência.

\endproblem
%%}}}

%%{{{ prob 
\problem.
Define no $\rats$ a relação
$$
r \sim s \defiff r-s\in\ints.
$$
Prove que $\sim$ é uma relação de equivalência e descreva as classes do $\quoset {\rats} {\sim}$.

\endproblem
%%}}}

%%{{{ prob 
\problem.
Define no $\reals$ a relação
$$
x \sim y \defiff x-y\in\rats.
$$
Prove que $\sim$ é uma relação de equivalência e descreva as classes do $\quoset {\reals} {\sim}$.

\endproblem
%%}}}

%%{{{ prob 
\problem.
Define no $(\nats\to\nats)$ as relações seguintes:
$$
\align
f \rel{\buildrel{{}_{\exists\forall}} \over =} g &\defiff (\exists n\in\nats) (\forall x \geq n) [ f(x) = g(x) ]\\
f \rel{\buildrel{{}_{\forall\exists}} \over =} g &\defiff (\forall n\in\nats) (\exists x \geq n) [ f(x) = g(x) ]
\endalign
$$
Para cada uma das relações acima, decida se ela é relação de equivalência (prove ou refute).
Se é, descreva seu conjunto quociente.

\endproblem
%%}}}

%%{{{ prob 
\problem.
Define no $(\reals\to\reals)$ as relações seguintes:
$$
\align
f \rel{\buildrel{{}_{\exists\forall}} \over \leq} g &\defiff (\exists n\in\nats) (\forall x \geq n) [ f(x) \leq g(x) ]\\
f \rel{\buildrel{{}_{\forall\exists}} \over \leq} g &\defiff (\forall n\in\nats) (\exists x \geq n) [ f(x) \leq g(x) ]
\endalign
$$
Para cada uma das relações acima, decida se ela tem ou não cada uma das propriedades de uma ordem total.

\endproblem
%%}}}

%%{{{ prob: simz_sime_simo_simi 
\problem.
\label{simz_sime_simo_simi}%
\def\simz{\rel{\stackrel{{}_{\mathrm z}}=}}%
\def\sime{\rel{\stackrel{{}_{\mathrm e}}=}}%
\def\simo{\rel{\stackrel{{}_{\mathrm o}}=}}%
\def\simi{\rel{\stackrel{\infty}=}}%
Defina as relações seguintes no $(\nats\to\nats)$ assim:
$$
\align
f\simz g&\defiff f(0)    = g(0)\\
f\sime g&\defiff f(2n)   = g(2n)  \ \text{para todo $n\in\nats$}\\
f\simo g&\defiff f(2k+1) = g(2k+1)\ \text{para todo $k\in\nats$}\\
f\simi g&\defiff f(n)    = g(n)   \ \text{para uma infinidade de $n\in\nats$.}
\endalign
$$
\beginil
\item{(i)}
Para cada uma da $\simz,\sime,\simo,\simi$, decida se é uma relação de
equivalência ou não.
\item{(ii)}
Prove ou refute a afirmação seguinte:
\emph{a relação $(\sime\rcom\simo)$ é a relação trivial $\mathsf{True}$.}
\endil

\hint
{%
\def\simi{\rel{\stackrel{\infty}=}}%
Ache um contraexemplo para a $\simi$.  As outras, são.
}

\solution
{%
\def\simz{\rel{\stackrel{{}_{\mathrm z}}=}}%
\def\sime{\rel{\stackrel{{}_{\mathrm e}}=}}%
\def\simo{\rel{\stackrel{{}_{\mathrm o}}=}}%
\def\simi{\rel{\stackrel{\infty}=}}%
(i)
A $\simi$ não é.  Considere o seguinte contraexemplo.
Sejam as $\alpha, \beta, \gamma : \nats\to\nats$ (como seqüências):
$$
\align
\alpha &= \tup{0,1,0,1,0,1,\dotsc}\\
\beta  &= \tup{0,2,0,2,0,2,\dotsc}\\
\gamma &= \tup{1,2,1,2,1,2,\dotsc}
\endalign
$$
Trivialmente, $\alpha\simi\beta$ e $\beta\simi\gamma$ mas $\alpha\not\simi\gamma$.
\endgraf\noindent
(ii)
Correto.
Sejam $f, g \in (\nats\to\nats)$.
Vamos mostrar que $f(\sime\rcom\simo)g$.
Pela definição da $\rcom$ temos:
$$
f \rel{(\sime\rcom\simo)} g
\iff \text{existe $h \in (\nats\to\nats)$ tal que $f \sime h$ e $h\simo g$}.
$$
A função $h : \nats\to\nats$ definida pela
$$
h(n) = \knuthcases{
f(n), &se $n$ par\cr
g(n), &se $n$ ímpar
}
$$
satisfaz as $f \sime h\simo g$ pela sua construção.
Logo, $f \rel{(\sime\rcom\simo)} g$.
}

\endproblem
%%}}}

\ignore{
%%{{{ prob: simh_simv 
\problem.
\def\simh{\sim_{\mathrm h}}
\def\simv{\sim_{\mathrm v}}
Defina as relações $\simh$ e $\simv$ no $(\ints\to\ints)$:
$$
\align
f \simh g &\iffdef (\exists u\in\ints)(\forall x \in\ints)[f(x) = g(x+u) ]\\
f \simv g &\iffdef (\exists v\in\ints)(\forall x \in\ints)[f(x) = g(x)+v ]
\endalign
$$
\endproblem
%%}}}
}

%%{{{ R_eq_S 
\problem Igualdade.
\label{R_eq_S}%
Defina a igualdade para o caso mais geral onde as relações $R$ e $S$ são relações de aridade qualquer,
em conjuntos quaisquer.

\endproblem
%%}}}

%%{{{ why_called_preorder 
\problem Por que preordem?.
\label{why_called_preorder}%
Justifique o nome ``preordem'': mostre como começando com uma preordem
$R$ num conjunto $A$, podemos construir uma relação $R'$ consultando a $R$.
Pode provar essa afirmação em vários jeitos, mas o objetivo é achar
a ordem $R'$ mais natural e a mais \emph{justa}, seguindo a preordem $R$.

\hint
A ordem $R'$ não vai ser uma ordem no $A$, pois não podemos
decidir como ``resolver conflitos'' do tipo $R(a,b)$ e $R(b,a)$.
Não podemos arbitrariamente escolher um dos $a,b$ como ``menor'',
botando assim por exemplo $R'(a,b)$ e $\lnot R'(b,a)$.
Isso não seria justo!
Então, em qual conjunto $A'$ faz sentido definir nossa ordem $R'$?

\endproblem
%%}}}

%%{{{ prob: how_many_partitions 
\problem Números Bell.
\label{how_many_partitions}
Seja $A$ conjunto finito.
Quantas partições de $A$ existem?

\hint
Conte ``manualmente'' os casos com $\card A = 0, 1, 2, 3$.

\hint
(Os números que tu achou na dica anterior devem ser: $1$, $1$, $2$, e $5$, respectivamente.)
Chame $B_n$ o número de partições dum conjunto finito com $n$ elementos.
Use recursão para definir o $B_n$.

\hint
Já temos umas bases desde a dica anterior:
$$
\align
B_0 &= 1\\
B_1 &= 1\\
B_2 &= 2\\
B_3 &= 5
\intertext{Para a equação recursiva,}
B_{n+1} &= \dots
\endalign
$$
lembra-se que podes considerar conhecidos \emph{todos} os números
$B_k$ para $k \leq n$.

\hint
Sejam $a_0,\dots,a_n$ os $n+1$ elementos de $A$
e considere uma partição arbitrária $\scr A$ dele.
Sendo partição, existe exatamente um conjunto-classe $A_0$ no $\scr A$
tal que $a_0\in A_0$.
Influenciados por a notação de classes de equivalência, denotamos
o $A_0$ por $\eqclassimp {a_0}$.
Tirando esse conjunto da partição $\scr A$ chegamos no
$$
\scr A \setminus \set {\eqclassimp {a_0}}
$$
que é (certo?) uma partição do conjunto
$$
\Union\paren{\scr A \setminus \set {\eqclassimp {a_0}}}.
$$
Seja $k$ o número de elementos desse conjunto.
Quais são os possíveis valores desse $k$?

\hint
Vamos melhorar nossa notação para nos ajudar raciocinar.
O conjunto 
$$
\Union\paren{\scr A \setminus \set {\eqclassimp {a_0}}}.
$$
da dica anterior, depende de quê?
Como a gente fixou uma enumeração dos elementos do $A$,
ele depende apenas na partição $\scr A$.
Introduzimos então a notação
$$
R_{\scr A} \asseq
\Union\paren{\scr A \setminus \set {\eqclassimp {a_0}}}.
$$
E denotamos o $k$ da dica anterior com
$k_{\scr A} \asseq \card {R_{\scr A}}$.
O $k_{\scr A}$ da dica anterior pode ter qualquer um dos valores
$k_{\scr A}=0,\dotsc,n$.
E agora?

\hint
Agora separe todas as partições $\scr A$ de $A$ em grupos dependendo
no valor de $k_{\scr A}$, ache o tamanho de cada grupo separadamente,
e use o princípio da adição para achar a resposta final.

\hint
Todas as partições do $A$ são separadas assim em:
\beginul
\li as partições $\scr A$ de $A$ tais que $k_{\scr A} = 0$.
\li as partições $\scr A$ de $A$ tais que $k_{\scr A} = 1$.
\li \dots
\li as partições $\scr A$ de $A$ tais que $k_{\scr A} = n$.
\endul
Seja
$N_i$
o número das partições $\scr A$ de $A$ tais que $k_{\scr A} = i$.
Graças ao princípio da adição, procura-se o somatório $\sum_{i=0}^n N_i$.
Ache o valor do arbitrário $N_i$.

\hint
De quantas maneiras pode acontecer que o
$$
R_{\scr A} = \Union\paren{\scr A \setminus \set {\eqclassimp {a_0}}}
$$
tem $i$ elementos?

\hint
Sabemos que o $a_0$ não pode ser um deles,
então precisamos escolher $i$ elementos dos $n$ seguintes: $a_1, \dotsc, a_n$.
Ou seja, de $\comb n i$ maneiras.
Cada escolha $A_i$ corresponde numa colecção de partições:
$$
\Big\{
\eqclassimp {a_0}\ 
,
\underbrace{\quad\dots\quad}_{\hbox{partição do $A_i$}}
\Big\}
$$

\hint
Sabemos a quantidade de partições de qualquer conjunto de tamanho $i$
com $i\leq n$: são $B_i$.

\solution
Seguindo todas as dicas, basta definir:
$$
\align
B_0 &= 1\\
B_{n+1}
&= \sum_{i=0}^n N_i
= \sum_{i=0}^n \comb n i B_i
\endalign
$$
\tdefined{Bell numbers}
Essa seqüência de números é conhecida como números~\Bell[números]{}Bell.

\endproblem
%%}}}

%%{{{ prob: same_limits_eqrel 
\problem.
\label{same_limits_eqrel}%
No $(\nats\to\reals)$ defina a relação
$$
a\sim b
\defiff
\lim\nolimits_n a_n = \lim\nolimits_n b_n
\mlor
\text{nenhum dos dois limites é definido.}
$$
descreva o $\quoset {(\nats\to\reals)} {\sim}$.

\endproblem
%%}}}

%%{{{ prob 
\problem.
Sejam conjunto $A$ com $\card A=1$, e $n\in\nats$ com $n\geq 2$.
No $A^n$ defina:
$$
a \sim b
\defiff
\card{ \set{ i\in\finord n \st a_i = b_i } } \geq n/2,
$$
onde
$a \eqass \tup{ a_0, \dotsc, a_{n-1}}$
e
$b \eqass \tup{ b_0, \dotsc, b_{n-1}}$.
A $\sim$ é uma relação de equivalência?

\solution
Não é.
Sejam $s,t,u\in A$ distintos dois a dois.
Tome
$$
\align
a &\leteq \tup{ s,s,\dots,s,t,t,\dotsc,t }\\
b &\leteq \tup{ s,s,\dots,s,u,u,\dotsc,u }\\
c &\leteq \tup{ t,t,\dots,t,u,u,\dotsc,u }
\endalign
$$
como contraexemplo, pois temos
$a \sim b$ e $b \sim c$ mas $a\not\sim c$.

\endproblem
%%}}}

%%{{{ prob: cyclic_and_euclidean_closures 
\problem Fecho cíclico, fechos euclideanos.
\label{cyclic_and_euclidean_closures}%
\tdefined{fecho!cíclico}%
\tdefined{fecho!left-euclideano}%
\tdefined{fecho!right-euclideano}%
\sdefined {\cclo {\holed R}} {o fecho cíclico da \holed R}%
\sdefined {\reclo {\holed R}} {o fecho right-euclideano da \holed R}%
\sdefined {\leclo {\holed R}} {o fecho left-euclideano da \holed R}%
Seja $R$ uma relação num conjunto $A$.
Defina seus fechos: cíclico~($\cclo R$), left-euclideano~($\leclo R$), right-euclideano~($\reclo R$).

\endproblem
%%}}}

%%{{{ prob: smiles_and_frowns 
\problem.
\label{smiles_and_frowns}%
\def\Smile{\rel{\ddot\smile}}%
\def\Frown{\rel{\ddot\frown}}% 
No conjunto $\reals$ defina as relações:
$$
\align
x \smile y
    &\defiff x \leq y
             \mland
             \lnot \lexists {n \in \ints} {x \leq n \leq y} \\
x \frown y
    &\defiff x \leq y
             \mland
             \lnot \lexists {n \in \ints} {x < n < y}
\endalign
$$
Sejam $\Smile$ o fecho reflexivo-simétrico da $\smile$,
e $\Frown$ o fecho simétrico da $\frown$.
\endgraf
(i) Prove que $\Smile$ é uma relação de equivalência;
(ii) Prove ou refute a afirmação: \emph{$\Frown$ é uma relação de equivalência}.

\hint
{%
\def\Smile{\rel{\ddot\smile}}%
\def\Frown{\rel{\ddot\frown}}%
Sobre a (i):
defina uma partição $\scr C$ de $\reals$ tal que $\scr C = \quoset \reals {\Smile}$;
pois isso já mostraria que $\Smile$ é uma relação de equivalência.
Sobre a (ii): a afirmação é falsa; refute!
}

\hint
{%
\def\Smile{\rel{\ddot\smile}}%
\def\Frown{\rel{\ddot\frown}}%
Sobre a (i):
Defina a partição de $\reals$
$$
\scr C \defeq
\munderbrace {\set{ (n,n+1) \st n\in\ints}} {\dsize \cal I}
\union
\munderbrace {\set{ \set{n} \st n \in\ints}} {\dsize \cal S}.
$$
Basta provar que $\scr C = \quoset \reals {\Smile}$.
\endgraf\noindent
Sobre a (ii): mostre com um contraexemplo que $\Frown$ não é transitiva.
}

\solution
{%
\def\Smile{\rel{\ddot\smile}}%
\def\Frown{\rel{\ddot\frown}}%
(i)
Defina a partição de $\reals$
$$
\scr C \defeq
\munderbrace {\set{ (n,n+1) \st n\in\ints}} {\dsize \cal I}
\union
\munderbrace {\set{ \set{n} \st n \in\ints}} {\dsize \cal S}.
$$
Basta provar que
$
    \scr C = \quoset \reals {\Smile}
$,
ou seja:
$$
    x\Smile y \iff \lexists {C\in \scr C} {x\in C \mland y\in C}.
$$
{\rldir}.
Trivial nos dois casos $C\in\cal I$ e $C\in\cal S$.
\endgraf\noindent
{\lrdir}.
Pela hipótese, $x=y$ ou $x\smile y$ ou $y\smile x$.
Separamos então em casos:
\endgraf\noindent
\case{Caso $x=y$:}
Caso $x\in\ints$ tome $C=\set x\in\cal S$.
Caso $x\notin\ints$ tome $C=(\floor x, \floor x + 1)\in\cal I$.
\endgraf\noindent
\case{Caso $x\smile y$:}
Nesse caso $[x,y] \inter \ints = \emptyset$.
Facilmente, $\floor x < x \leq y < \floor x + 1$.
Tome novamente $C=(\floor x, \floor x + 1)\in\cal I$.
\endgraf\noindent
\case{Caso $y\smile x$:}
Similar.
\endgraf
(ii) Não é, pois não é transitiva.
Observe que $0 \Frown 1$, pois não existe inteiro no $(0,1)$,
e similarmente $1 \Frown 2$.
Mas $0 \not\Frown 2$, pois $1$ é inteiro e $1\in(0,2)$.
}

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

O \cite[Cap.~4]{velleman} defina e trata relações
diretamente como conjuntos, algo que não fazemos nesse texto.
De novo: muitos livros seguem essa abordagem, então o leitor é conselhado
tomar o cuidado necessário enquanto estudando esses assuntos.
Nos vamos ver relações como conjuntos apenas no~\ref{Axiomatic_set_theory}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Logic programming 
\chapter Programação lógica.
\label{Logic_programming}%

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{lpbook},
\cite{artofprolog},
\cite{holpbook}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Structured sets 
\chapter Conjuntos estruturados.
\label{Structured_sets}%

%%{{{ Concept, notation, equality 
\section Conceito, notação, igualdade.
Já encontramos a idéia de estrutura (interna) dum
conjunto~(foi no~\ref{blackbox_set}).

\TODO Elaborar.

\note Abuso notacional.
\label{notational_abuse_stuctured_sets}
Suponha $\ssetfont A = \sset A {\dotsc}$ é algum conjunto estruturado.
Tecnicamente falando, escrever ``$a\in \ssetfont A$'' seria errado.
Mesmo assim escrevemos sim $a\in \ssetfont A$ em vez de $a\in A$,
similarmente falamos sobre ``os elementos de~$\ssetfont A$''
quando na verdade estamos se referendo aos elementos de~$A$,
etc.
Em geral, quando aparece um conjunto estruturado~$\ssetfont A$ num contexto
onde deveria aparecer algum conjunto, identificamos o~$\ssetfont A$
com seu carrier set~$A$.
As vezes usamos até o mesmo símbolo na sua definição, escrevendo
$A = \sset A {\dotsc}$.

\endsection
%%}}}

%%{{{ Structured sets with constants 
\section Conjuntos estruturados com constantes.

\endsection
%%}}}

%%{{{ Structured sets with operations 
\section Conjuntos estruturados com operações.

%%{{{ df: closed_associative_identity_inverse 
\definition.
\label{closed_associative_identity_inverse}%
Sejam conjunto $A$,
uma operação binária $\ast$ no $A$,
e um $g \in A$.
Dizemos que:
$$
\align
\text{$A$ é $\ast$-fechado}                     &\defiff \lforall {a,b \in A}   {a \ast b \in A}\\
\text{$\ast$ é associativa}                     &\defiff \lforall {a,b,c \in A} {(a \ast b) \ast c = a \ast (b \ast c)}\\
\text{$\ast$ é comutativa}                      &\defiff \lforall {a,b \in A}   {a \ast b = b \ast a}\\
\text{$u$ é uma identidade esquerda da $\ast$}  &\defiff \lforall {a \in A}     {u \ast a = a}\\
\text{$u$ é uma identidade direita da $\ast$}   &\defiff \lforall {a \in A}     {a \ast u = a}\\
\text{$u$ é uma identidade do $\ast$}           &\defiff \lforall {a \in A}     {u \ast a = a = a \ast u}\\
\text{$y$ é um $\ast$-inverso esquerdo de $g$}  &\defiff \text{$y \ast g = e$, \ onde $e$ é uma identidade da $\ast$}\\
\text{$y$ é um $\ast$-inverso direito de $g$}   &\defiff \text{$g \ast y = e$, \ onde $e$ é uma identidade da $\ast$}\\
\text{$y$ é um $\ast$-inverso de $g$}           &\defiff \text{$y \ast g = e = g \ast y$, \ onde $e$ é uma identidade da $\ast$}
\endalign
$$
onde não escrevemos os ``$\ast$-'' quando são implícitos pelo contexto.
%%}}}

\endsection
%%}}}

%%{{{ Structured sets with relations 
\section Conjuntos estruturados com relações.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Teoria dos grupos 
\chapter Teoria dos grupos.
\label{Group_theory}%

%%{{{ History 
\history.

\TODO \Galois{}Galois, \Abel{}Abel.

\endhistory
%%}}}

%%{{{ Algebraic structures 
\section Estruturas algébricas.

\endsection
%%}}}

%%{{{ Permutations 
\section Permutações.

%%{{{ Introduce S_3 
\note.
\ii{permutação}%
Vamos começar considerando o conjunto $S_n$ de todas as permutações
dum conjunto com $n$ elementos.  Tomamos o $\set{1,2,\dotsc,n}$ como
nosso conjunto mas sua escolha é inessencial.
Logo, temos por exemplo
$$
S_3 \defeq (\set{1,2,3}\bijto\set{1,2,3}).
$$
Quantos elementos o $S_3$ tem?
Lembramos%
\footnote{Se não lembramos, veja a~\ref{total_permutations} e a~\refn{Permutations_and_combinations} em geral.  Depois disso, lembramos!}
que são
$$
\card{S_3} = \totperm 3 = 3! = 3\ntimes 2\ntimes 1 = 6.
$$
Nosso primeiro objetivo é achar todos esses $6$ membros de $S_3$.
\endgraf
Primeiramente, a identidade $\idof {\set{1,2,3}} \in S_3$ pois é bijetora.
Para continuar, introduzimos aqui uma notação bem práctica para
trabalhar com permutações:
%%}}}

%%{{{ Notation 
\note Notação.
\label{notation_with_cycles}%
Denotamos a bijecção $f \in S_n$ assim:
$$
f = \permf{
1    & 2    & \dotsb & n\\
f(1) & f(2) & \dotsb & f(n)
}
$$
Por exemplo, a identidade de $S_3$,
e a permutação $\phi$ que troca apenas o primeiro com o segundo elemento
são denotadas assim:
$$
\xalignat2
\id
&= \permf{
1 & 2 & 3\\
1 & 2 & 3
}
&
\phi
&\asseq \permf{
1 & 2 & 3\\
2 & 1 & 3
}
\endxalignat
$$
Considere agora uma permutação do $S_8$ e uma do $S_{12}$ por exemplo as
$$
\align
\permf{
1 & 2 & 3 & 4 & 5 & 6 & 7 & 8\\
2 & 3 & 1 & 4 & 6 & 5 & 7 & 8
}
\quad&\text{e}\quad
\permf{
1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12\\
2 & 3 & 1 & 4 & 5 & 10 & 6 & 11 & 9 & 12 & 8 & 7
}.
\intertext{Podemos as quebrar em ``ciclos'' escrevendo}
\permc{1 & 2 & 3}
\permc{5 & 6}
\quad&\text{e}\quad
\permc{1 & 2 & 3}
\permc{6 & 10 & 12 & 7}
\permc{8 & 11}
\endalign
$$
respectivamente.
Entendemos o ciclo $\permc{1 & 2 & 3}$ como
$1 \mapsto 2 \mapsto 3 \mapsto 1$.
%%}}}

%%{{{ x: verify cycle notation 
\exercise.
Verifique que as duas permutações que escrevemos usando ciclos
realmente correspondem nas permutações anteriores.

\endexercise
%%}}}

%%{{{ beware: beware_notation_with_cycles 
\beware.
\label{beware_notation_with_cycles}
Para usar a notação com ciclos para denotar os membros de algum
$S_n$, precisamos esclarecer o $n$---algo que não é necessário
com a notação completa, onde esta informação é dedutível pela
sua forma.  Por exemplo as duas permutações
$$
\underbrace{
\permf{
1 & 2 & 3 & 4 & 5\\
2 & 1 & 3 & 5 & 4
}}_{\permc{1 & 2}\permc{4 & 5}}
\qtext{e}
\underbrace{
\permf{
1 & 2 & 3 & 4 & 5 & 6 & 7\\
2 & 1 & 3 & 5 & 4 & 6 & 7
}}_{\permc{1 & 2}\permc{4 & 5}}
$$
compartilham a mesma forma usando a notação com ciclos!
Olhando para as formas acima, sabemos que a primeira
é uma permutação do $S_5$, e a segunda do $S_7$.
\endgraf
Mais um defeito dessa notação é que não temos como denotar
a identidade numa forma consistente: podemos concordar
denotá-la pelo $\permc {1}$ ou $\permc{}$, mas na práctica
optamos para o $\id$ mesmo.
%%}}}

%%{{{ The members of S_3 
\note Os membros de $S_3$.
Já achamos $2$ dos $6$ elementos de $S_3$:
$$
\xalignat2
\id
&=\permf{
1 & 2 & 3\\
1 & 2 & 3
}
&
\phi
&\leteq\permf{
1 & 2 & 3\\
2 & 1 & 3
}
=\permc{1 & 2}
\endxalignat
$$
Sabendo
que a composição de bijecções é bijecção (\ref{fcom_respects_jections}),
tentamos a
$$
\phi^2 = \phi\com\phi
=\permf{
1 & 2 & 3\\
2 & 1 & 3
}\com\permf{
1 & 2 & 3\\
2 & 1 & 3
}
=\permf{
1 & 2 & 3\\
1 & 2 & 3
}
=\id
$$
e voltamos para a própria $\id$!
Uma outra permutação no $S_3$ é a
$$
\psi\leteq\permf{
1 & 2 & 3\\
2 & 3 & 1
}
=\permc{1 & 2 & 3}.
$$
Vamos agora ver quais diferentes permutações ganhamos combinando essas:
$$
\align
\psi^2
= \psi\com\psi
&=\permf{
1 & 2 & 3\\
2 & 3 & 1
}\com\permf{
1 & 2 & 3\\
2 & 3 & 1
}
=\permf{
1 & 2 & 3\\
3 & 1 & 2
}
=\permc{1 & 3 & 2}
\\
\phi\com\psi
&=\permf{
1 & 2 & 3\\
2 & 1 & 3
}\com\permf{
1 & 2 & 3\\
2 & 3 & 1
}
=\permf{
1 & 2 & 3\\
1 & 3 & 2
}
=\permc{2 & 3}\\
\psi\com\phi
&=\permf{
1 & 2 & 3\\
2 & 3 & 1
}\com\permf{
1 & 2 & 3\\
2 & 1 & 3
}
=\permf{
1 & 2 & 3\\
3 & 2 & 1
}
=\permc{1 & 3}
\endalign
$$
E achamos $6$ membros distintos do $S_3$.%
\footnote{Por que são distintos?
Veja~\ref{why_phipsi_neq_psiphi} por exemplo.}
Mas $\card{S_3} = 6$, e logo achamos \emph{todos} os membros de
$S_3 = \set{\id, \phi, \psi, \psi^2, \phi\com\psi,\psi\com\phi}$:
$$
\xalignat3
\id  &= \permc {1}         &\psi         &= \permc {1 & 2 & 3}  & \phi\com\psi &= \permc {2 & 3}\\
\phi &= \permc {1 & 2}     &\psi^2       &= \permc {1 & 3 & 2}  & \psi\com\phi &= \permc {1 & 3}.
\endxalignat
$$
%%}}}

%%{{{ remark: is_it_needed_to_compute_last_value_of_perm 
\remark.
\label{is_it_needed_to_compute_last_value_of_perm}%
Preciso mesmo calcular os últimos números das permutações?
Vamos voltar no momento que estamos calculando o $\phi\fcom\psi$.
Já temos calculado as imagens de $1$ e $2$:
$$
\align
1 &\mapstoarrow {\psi} 2 \mapstoarrow {\phi} 1\\
2 &\mapstoarrow {\psi} 3 \mapstoarrow {\phi} 3
\endalign
$$
Estamos então aqui:
$$
\phi\fcom\psi
=\permf{
1 & 2 & 3\\
1 & 3 & 
}
$$
Agora podemos continuar no mesmo jeito, para calcular a imagem de $3$:
$$
3 \mapstoarrow {\psi} 1 \mapstoarrow {\phi} 2
$$
e assim chegar no
$$
\phi\fcom\psi
=\permf{
1 & 2 & 3\\
1 & 3 & 2
}
$$
Mas, $\phi\fcom\psi$ é uma bijecção (pois $\phi,\psi$ são,
e~\ref{fcom_respects_jections}), e logo podemos concluir neste momento que
$(\phi\fcom\psi)(3) = 2$.
Mesmo assim, sendo humanos, faz sentido achar esse último valor
\emph{com as duas maneiras}.
Assim, caso que elas chegam em resultados diferentes, teriamos um aviso sobre
um erro nos nossos cálculos anteriores!
%%}}}

%%{{{ x: calculate psi 
\exercise.
Calcule a $\psi\com\psi^2$ e justifique que ela é igual à $\psi^2\com\psi$.

\solution
Calculamos:
$$
\align
1 &\mapstoarrow {\psi^2} 3 \mapstoarrow \psi 1\\
2 &\mapstoarrow {\psi^2} 1 \mapstoarrow \psi 2\\
3 &\mapstoarrow {\psi^2} 2 \mapstoarrow \psi 3
\endalign
$$
ou seja, $\psi\com\psi^2 = \id$.
A igualdade é imediata pela associatividade da $\fcom$.
(E ambas são iguais à $\psi^3$.)

\endexercise
%%}}}

%%{{{ x: calculate phi psi^2 and psi^2 phi 
\exercise.
Calcule as $\phi\com\psi^2$ e $\psi^2\com\phi$.

\endexercise
%%}}}

%%{{{ note: abstracting_the_notion_of_group 
\note Abstraindo.
\label{abstracting_the_notion_of_group}%
Temos um conjunto cujos elementos podemos ``combinar'' através duma operação binária.
As seguintes propriedades são satisfeitas nesse caso:
\beginil
\item{(G0)}
O conjunto é fechado sobre a operação.%
\footnote{Aplicando a operação em quaisquer membros do nosso conjunto,
o resultado pertence no conjunto.}
\item{(G1)}
A operação é associatíva.
\item{(G2)}
A operação tem identidade no conjunto.
\item{(G3)}
Cada elemento do conjunto possui inverso no conjunto.
\endil
\endgraf
Conjuntos onde é definida uma operação que satisfaz essas propriedades
aparecem com freqüência, e vamos ver que são suficientes para construir
uma teoria rica baseada neles.
%%}}}

\endsection
%%}}}

%%{{{ What is a group? 
\section O que é um grupo?.

\blah.
Seguindo a abstracção do~\refn{abstracting_the_notion_of_group}, chegamos numa
primeira definição:

%%{{{ df: group_def_wordy 
\definition.
\label{group_def_wordy}%
\tdefined{grupo}%
Um conjunto $G$ com uma operação binária $\ast$ é um \dterm{grupo}
sse:
o $G$ é $\ast$-\emph{fechado};
a $\ast$ é \emph{associativa};
a $\ast$ tem \emph{identidade} no $G$;
cada elemento de $G$ possui $\ast$-\emph{inverso}.
%%}}}

\blah.
Lembrando a~\ref{closed_associative_identity_inverse}, tentamos esclarecer pouco essa definição:

%%{{{ pseudodf: group (0) 
\pseudodefinition Grupo (0).
\label{group_def_classic}%
\tdefined{grupo}%
Um conjunto $G$ com uma operação binária $\ast$ no $G$ é um \dterm{grupo} sse
as leis seguintes
$$
\gather
a,b \in G \implies a\ast b \in G                                             \tag{G0} \\
a\ast(b\ast c) = (a\ast b)\ast c                                             \tag{G1} \\
\text{existe $e\in G$ tal que para todo $a\in G$, $e\ast a = a = a\ast e$}   \tag{G2} \\
\text{para todo $a\in G$, existe $y\in G$, tal que $y\ast a = e = a \ast y$} \tag{G3}
\endgather
$$
são satisfeitas.
\mistake
%%}}}

%%{{{ Laws vs. axioms 
\note Leis vs.~axiomas.
\label{laws_vs_axioms}%
\tdefined{lei}%
\tdefined{leis de grupo}%
\ii{axioma!vs.~lei}%
As (G0)--(G3) são conhecidas como as \dterm{leis de grupos},
ou os \dterm{axiomas de grupos}.
Vamos evitar usar a palavra \emph{axioma} com esse sentido,
optando para a palavra \emph{lei} mesmo, pois chamamos
``axioma'' algo que aceitamos como verdade em noso univérso
(mais sobre isso no~\ref{Axiomatic_set_theory}), mas nesse
caso não estamos afirmanos a vericidade das (G0)--(G3).
Faz apenas parte do que significa ``ser grupo''.
Se um conjunto estruturado satisfaz todas as leis,
bem, ele ganha o direito de ser chamado um ``grupo''.
Se não, beleza, ele não é um grupo.
%%}}}

%%{{{ Notational abuse 
\note Abuso notacional.
Lembra-se o abuso notacional que introduzímos
no~\refn{notational_abuse_stuctured_sets}:
usamos $a,b\in\ssetfont G$, $G=\sset G {\bullet}$, etc.
%%}}}

%%{{{ Multiplicative and additive groups 
\note Grupos multiplicativos e aditivos.
\tdefined{grupo}[aditivo]%
\tdefined{grupo}[multiplicativo]%
Dependendo da situação, podemos adoptar um ``jeito multiplicativo''
para a notação dum grupo, ou um ``jeito additivo''---ou ficar
realmente com um jeito neutro.
Num \dterm{grupo multiplicativo} usamos $\cdot$ para denotar a operação do grupo,
aproveitamos a convenção de omitir o símbolo totalmente, usando apenas
juxtaposição: $a(bc)$ significa $a\cdot(b\cdot c)$ por exemplo.
A identidade parecerá com $e$ ou $1$, e $a^{-1}$ será o inverso de~$a$.
Num \dterm{grupo aditivo} usamos $+$ para denotar a operação do grupo,
a identidade parecerá com $e$ ou $0$; e $-a$ será o inverso de~$a$.
Naturalmente usamos $\ast$, $\bullet$, etc.~para denotar operação
de grupo, $e$ para sua identidade, e $a^{-1}$ para denotar o inverso de~$a$.
É importante entender que os termos ``grupo multiplicativo'' e ``grupo aditivo''
usados assim não carregam nenhum significado matemático mesmo: apenas mostram
uma preferência notacional.
Mas quando um conjunto já tem adição e/ou multiplicação definida
(como por exemplo os inteiros), então usamos frases como
``o grupo aditivo dos inteiros'' para referir no $\sset \ints +$.
%%}}}

\blah.
Para entender melhor as quatro leis de grupo, as escrevemos novamente, essa vez
sem deixar nenhum quantificador como implicito, e começando com um
\emph{conjunto estruturado} com uma operação binária:

%%{{{ pseudodf: group (1) 
\pseudodefinition Grupo (1).
\label{group_def_struct_1}%
Um conjunto estruturado $\ssetfont G = \sset G {\ast}$ é um \dterm{grupo} sse
$$
\alignat2
\pforall {a,b\in G}                 &\bracket{a\ast b \in G}                   &\tag{G0} \\
\pforall {a,b,c\in G}               &\bracket{a\ast(b\ast c) = (a\ast b)\ast c}&\tag{G1} \\
\pexists {e\in G} \pforall {a \in G}&\bracket{e\ast a = a = a\ast e}           &\tag{G2} \\
\pforall {a\in G} \pexists {y\in G} &\bracket{y\ast a = e = a \ast y}          &\tag{G3} 
\endalignat
$$
Chamamos o elemento garantido pela~(G2) a \dterm{identidade} do grupo,
chamamos o~$y$ da~(G3) o \dterm{inverso} de~$a$.
\mistake
%%}}}

%%{{{ x: check_group_def_classic_and_group_def_struct_1 
\exercise.
Tá tudo certo com as definições~\refn{group_def_classic}
e~\refn{group_def_struct_1}?

\hint
Quem é esse $e$ que aparece no (G3)?

\hint
Como assim \emph{o} inverso?

\endexercise
%%}}}

%%{{{ Galois, Abel, Cayley.
\note Galois, Abel, Cayley.
Como vimos, na mesma época o \Galois{}Galois e o \Abel{}Abel chegaram na
idéia abstrata de grupo.  Galois mesmo escolheu a palavra ``group'' para
esse conceito.
A definição ``moderna'' de grupo como conjunto com operação que satisfaz
as leis~(G0)--(G3) é de~\Cayley{}Cayley.
Como Abel focou em grupos cuja operação é comutativa, chamamos esse tipo
de grupos abelianos:
%%}}}

%%{{{ df: abelian group 
\definition Grupo abeliano.
\label{abelian_group}%
\tdefined{grupo!abeliano}%
Um grupo $\sset G {\ast}$ é \dterm{abeliano}
(também: \dterm{comutativo})
sse sua operação $\ast$ é comutativa:
$$
\alignat2
\pforall {a,b\in G}    &\bracket{a\ast b = b\ast a}.                   &\tag{GA}
\endalignat
$$
%%}}}

%%{{{ note: groups_and_abelian_groups_schematically 
\note.
\label{groups_and_abelian_groups_schematically}%
Esquematicamente:
$$
\left.
\aligned
&\left.
\aligned
\text{(G0)}&\\
\text{(G1)}&\\
\text{(G2)}&\\
\text{(G3)}&\\
\endaligned
\ \ 
\right\}
\text{grupo}\\
&\ \text{(G4)}
\endaligned
\ \ 
\right\}
\text{grupo abeliano}
$$
%%}}}

%%{{{ eg: S3_is_a_non_abelian_group 
\example.
\label{S3_is_a_non_abelian_group}%
Verifique que $S_3$ é um grupo.
Ele é abeliano?

\solution
Precisamos verificar as leis de grupo.
\endgraf\noindent
{(G0).}
Para provar que $S_3$ é fechado pela $\fcom$, precisamos verificar
que para todo $a,b\in S_3$, $a \fcom b \in S_3$.
Pela definição do $S_3$, isso segue pelo~\ref{fcom_respects_jections}~(3).
\endgraf\noindent
{(G1).}
Ja provamos a associatividade da $\fcom$ na~\ref{associativity_of_fcom}.
\endgraf\noindent
{(G2).}
Facilmente verificamos que a $\idof {\set{1,2,3}}$ é a identidade do
$\sset {S_3} {\fcom}$, pela sua definição.
\endgraf\noindent
{(G3).}
Cada bijecção tem uma função-inversa, que satisfaz as equações dessa lei
pela definição de função-inversa.
(Veja~\ref{finverse} e~\ref{finv_is_bij}.)
\endgraf\noindent
{(G4).}
Basta mostrar pelo menos um contraexemplo, ou seja, duas permutações
$a,b$ do $S_3$ tais que $a\fcom b \neq b\fcom a$.
Agora preciso saber o que significa igualdade entre \emph{funções}
(\ref{f_eq_g}).
Escolho os $\phi,\psi$.
Já calculamos as $\phi\fcom\psi$ e $\psi\fcom\phi$ e são diferentes.
\endgraf
Logo, $S_3$ é um grupo não abeliano.
\endexample
%%}}}

%%{{{ x: why_phipsi_neq_psiphi 
\exercise.
\label{why_phipsi_neq_psiphi}%
E por que $\phi\fcom\psi \neq \psi\fcom\phi$?

\solution
Pois elas discordam em pelo menos um valor: tome o $1$.
Agora
$$
(\phi\fcom\psi)(1)
= \phi(\psi(1))
= \phi(2)
= 1
\neq
3
= \psi(2)
= \psi(\phi(1))
= (\psi\fcom\phi)(1).
$$
Logo $\phi\fcom\psi \neq \psi\fcom\phi$.

\endexercise
%%}}}

%%{{{ And why 1 neq 3? 
\note E por que $1\neq 3$?.
Na resolução do~\ref{why_phipsi_neq_psiphi} nosso argumento reduziu
o que queriamos provar à afirmação $1 \neq 3$.
\emph{E por que $1 \neq 3$?}
Bem, precisamos saber o que significa igualdade no $\nats$!
Mas podemos já considerar o $1 \neq 3$ como um fato conhecido sobre os números
naturais.  Depois, no~\ref{Axiomatic_set_theory}, vamos \emph{fundamentar}
o~$\nats$ na teoria de conjuntos, e logo vamos ter como realmente provar essa
afirmação para nosso $\nats$, por exemplo.
%%}}}

%%{{{ x: find_all_inverses_on_S3 
\exercise.
\label{find_all_inverses_on_S3}%
Ache o inverso de cada elemento de $S_3$.%
\footnote{Se tu já fez isso para resolver o~\ref{S3_is_a_non_abelian_group},
não foi necessário.  Por quê?  Veja a resolução do~\refn{S3_is_a_non_abelian_group} mesmo.}

\endexercise
%%}}}

%%{{{ df: group (2) 
\definition Grupo (2).
\label{group_def_struct_2}%
\tdefined{grupo}%
Um conjunto estruturado $\ssetfont G = \sset G {e, \ast}$ é um grupo sse
$$
\alignat2
\pforall {a,b\in G}                 &\bracket{a\ast b \in G}                   &\tag{G0} \\
\pforall {a,b,c\in G}               &\bracket{a\ast(b\ast c) = (a\ast b)\ast c}&\tag{G1} \\
\pforall {a \in G}                  &\bracket{e\ast a = a = a\ast e}           &\tag{G2} \\
\pforall {a\in G} \pexists {y\in G} &\bracket{y\ast a = e = a \ast y}          &\tag{G3}
\endalignat
$$
%%}}}

%%{{{ x: check_group_def_struct_2 
\exercise.
Tá tudo certo com a~\ref{group_def_struct_2}?

\solution
Sim!
Pois, veja~\ref{a_vs_the_identity_of_a_group}.

\endexercise
%%}}}

%%{{{ remark: a_vs_the_identity_of_a_group 
\remark.
\label{a_vs_the_identity_of_a_group}%
O $e$ que aparece na~(G3) não é ``\emph{a} identidade do $\cal G$''.
É sim \emph{a} constante que aparece na estrutura do $\sset G {e,\ast}$,
que---graças à~(G2)---é \emph{uma} identidade do $\cal G$.
No~\ref{uniqueness_of_identity_in_group} vamos provar que cada grupo tem identidade única,
e apartir dessa prova, vamos ganhar o direito de usar o artigo definido ``a''.
%%}}}

%%{{{ x: group (4) 
\exercise Grupo (4).
Defina \dterm{grupo} como um conjunto estruturado
$\sset G {e, {}^{-1}, \ast}$.
Comece escrevendo as aridades da assinatura.

\solution
Um conjunto estruturado $\ssetfont G = \sset G {e, {}^{\prime}, \ast}$ é um \dterm{grupo} sse
$$
\alignat2
\pforall {a,b\in G}    &\bracket{a\ast b \in G}                    &\tag{G0} \\
\pforall {a,b,c\in G}  &\bracket{a\ast(b\ast c) = (a\ast b)\ast c} &\tag{G1} \\
\pforall {a \in G}     &\bracket{e\ast a = a = a\ast e}            &\tag{G2} \\
\pforall {a\in G}      &\bracket{a^{-1}\ast a = e = a \ast a^{-1}} &\tag{G3} 
\endalignat
$$

\endexercise
%%}}}

%%{{{ df: order of group 
\definition Ordem de grupo.
\label{order_of_group}%
\tdefined{ordem!de grupo}%
\sdefined {\gord {\holed G}} {a ordem do grupo $\holed G$}%
O número de elementos de um grupo $G$ é sua \dterm{ordem}.
Denotamos a ordem de $G$ com:
$\gord G$, $\tord G$, ou até $\bord G$ quando não existe ambigüidade.
Se o carrier set do grupo é infinito, escrevemos
$\gord G = \infty$.
%%}}}

%%{{{ x: group_of_any_finite_order 
\exercise.
\label{group_of_any_finite_order}
Ja conhecemos um grupo finito bem, o $S_3$, com $\gord {S_3} = 6$.
No~\ref{Sn_is_a_group} provarás que para todo $n\in\nats$, o $S_n$ é um grupo.
Seja $m\in\nats$.  Tem como achar um grupo com ordem $m$?
Observe que como sabemos que $\gord {S_n} = n!$, podemos já achar um grupo com ordem $m$ para qualqeur $m$ que fosse um fatorial.
Por exemplo, se $m=120$ já temos o grupo $S_5$, pois $\gord {S_5} = 5! = 120$.
Mas para um $m$ arbitrário, existe grupo com ordem $m$?

\hint
\ref{Congruences}.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Examples and nonexamples 
\section Exemplos e nãœxemplos.

%%{{{ eg: with numbers 
\example Com números.
Todos os seguintes conjuntos estruturados são grupos:
\beginol
\li$\sset A {0, +}$, onde $A \asseq \ints, \rats, \reals, \complex$;
\li$\sset B {1, \ntimes}$, onde $B \asseq \rats_{\neq0}, \reals_{\neq0}$;
\li$\sset C {1, \ntimes}$, onde $C \asseq \set{1,-1}, \set{1,i,-1,-i} \subseteq\complex$.
\endol
\endexample
%%}}}

%%{{{ noneg: with numbers 
\nonexample Com números.
E \emph{nenhum} dos seguintes é um grupo:
$\sset \nats {0, +}$;
$\sset {\ints_{\neq 0}} {1, \ntimes}$;
$\sset \reals {1, +}$.
\endnonexample
%%}}}

%%{{{ x: why? 
\exercise.
Por quê?

\endexercise
%%}}}

%%{{{ noneg: strings_with_concat_is_not_a_group 
\nonexample Strings.
\label{strings_with_concat_is_not_a_group}%
Sejam $\Sigma\neq\emptyset$ um alfabeto finíto,
e $S$ o conjunto de todos os strings finitos formados por símbolos do $\Sigma$.
O $\sset S +$ onde $+$ é a \emph{concatenação} de strings \emph{não} é um grupo.
\endnonexample
%%}}}

%%{{{ x: verify_all_group_laws_for_strings 
\exercise.
Para cada uma das leis~(G0)--(G4), decida se é
satisfeita pelo $\sset S +$ do~\ref{strings_with_concat_is_not_a_group}.
Se é, prove; se não é, refute!

\endexercise
%%}}}

%%{{{ x: shared_carrierset_group_notgroup 
\exercise.
\label{shared_carrierset_group_notgroup}%
Sejam $B = \setst {2^m} {m \in \ints}$ e $B_0 = B \union \set{0}$.
Considere os conjuntos estruturados
$$
\xalignat4
&\sset B {+}
&&\sset B {\ntimes}
&&\sset {B_0} {+}
&&\sset {B_0} {\ntimes}.
\endxalignat
$$
Para cada um deles decida se satisfaz cada uma das leis (G0)--(G4).

\endexercise
%%}}}

%%{{{ x: more number-based groups 
\exercise.
Mostre mais grupos formados de números dos
$\nats$, $\ints$, $\rats$, $\reals$, $\complex$,
e uma operação não-padrão da sua escolha.

\endexercise
%%}}}

%%{{{ eg: matrix_group_examples 
\example Matrizes.
\label{matrix_group_examples}%
Considere os conjuntos seguintes:
$$
\align
A &= \setst{ \matrixp{a & b\\c & d}\in\reals^{2\times2}} {a,b,c,d \in \reals }\\
M &= \setst{ \matrixp{a & b\\c & d}\in\reals^{2\times2}} {ad - bc \neq 0 }.
\endalign
$$
\TODOthis{Terminar o exemplo e mostrar mais.}
\endexample
%%}}}

%%{{{ eg: modular_arithmetic_group_eg
\example Aritmética modular.
\label{modular_arithmetic_group_eg}%
O $\finord n \defeq \set{0,\dotsc,n-1}$ com a operação $+_n$ da adição
módulo $n$.
Qual é o inverso de um elemento $a$ nesse caso?
É o $n-a$, pois $a +_n (n-a) = 0 = (n-a) +_n a$.
\endexample
%%}}}

%%{{{ df: symmetric_group 
\definition.
\label{symmetric_group}%
\tdefined {grupo}[simétrico]%
\sdefined {S_{\holed n}} {O grupo simétrico $S_{\holed n}$}%
Usamos $S_n$ para denotar o conjunto de todas as permutações
dum conjunto de tamanho $n\in\nats$.
Para definir mesmo o $S_n$ escolhemos o conjunto canônico:
$$
S_n \pseudodefeq (\set{1,\dotsc,n}\bijto\set{1,\dotsc,n}).
$$
Para qualquer $n\in\nats$, chamamos o $\sset {S_n} {\fcom}$
o \dterm{grupo simétrico} de tamanho $n$.
%%}}}

%%{{{ x: Sn_is_a_group 
\exercise.
\label{Sn_is_a_group}%
Justifique a~\ref{symmetric_group}: prove que o grupo simétrico $S_n$
realmente é um grupo.
Ele é abeliano?

\endexercise
%%}}}

%%{{{ x: pset_with_setops_group 
\exercise Conjuntos.
\label{pset_with_setops_group}%
Seja $A$ conjunto.
Com quais das operações $\union$, $\inter$, $\symdiff$, e $\setminus$,
o $\pset A$ é um grupo?

\endexercise
%%}}}

%%{{{ x: real_functions_pointwise_plus_group 
\exercise Funções reais: adição pointwise.
\label{real_functions_pointwise_plus_group}%
O $(\reals \to \reals)$ com operação a pointwise $+$, é um grupo?%
\footnote{Qual operação é a pointwise $+$?  Veja a~\ref{pointwise_operation}.}
Ele é abeliano?

\endexercise
%%}}}

%%{{{ x: real_functions_pointwise_times_nongroup 
\exercise Funções reais: multiplicação pointwise.
\label{real_functions_pointwise_times_nongroup}%
O $(\reals \to \reals) \setminus \set{ \lam x 0 }$ com operação a
pointwise~$\ntimes$, é um grupo?
Ele é abeliano?

\endexercise
%%}}}

\blah.
Chegam os exemplos por enquanto.
Vamos começar ver a \emph{teoria} de grupos, investigando propriedades que
todos os grupos necessariamente têm.
Ou seja, procuramos as \emph{conseqüências das leis} (G0)--(G3).

\endsection
%%}}}

%%{{{ First consequences 
\section Primeiras conseqüências.

%%{{{ lm: uniqueness_of_identity_in_group 
\lemma Unicidade da identidade.
\label{uniqueness_of_identity_in_group}%
\ii{unicidade!da identidade}%
Em todo grupo $G$ existe único elemento $e$ que satisfaz a (G2).
\sketch.
Seja $G$ grupo.
Sabemos que existe pelo menos uma identidade no $G$ pela (G2),
então precisamos mostrar que existe no máximo uma (unicidade).
Vamos supor que $e_1, e_2$ são identidades do $G$, e usando
as leis~(G0)--(G2) mostrar que $e_1 = e_2$.
\qes
\proof.
Seja $G$ grupo.
Sabemos que $G$ tem pelo menos uma identidade graças à (G2),
então o que precisamos mostrar é sua unicidade mesmo.
Suponha que $e_1,e_2\in G$ tais que $e_1,e_2$ são identidades do $G$;
em outras palavras:
$$
\align
\text{para todo $a\in G$},\quad & e_1\ast a \eqlabel L a \eqlabel R a\ast e_1   \tag{1}\\
\text{para todo $b\in G$},\quad & e_2\ast b \eqlabel L b \eqlabel R b\ast e_2.  \tag{2}
\endalign
$$
Agora exatamente a mesma prova pode ser escrita em dois caminho meio
diferentes:
\endgraf
\proofstyle{Caminho 1:}
Temos
$$
\alignat2
e_1
&= e_1 \ast e_2  \qqby{pela (2R), com $b\asseq e_1$}\\
&= e_2           \qqby{pela (1L), com $a\asseq e_2$}
\endalignat
$$
e provamos o que queremos: $e_1 = e_2$, ou seja,
em cada grupo existe única identidade.
\endgraf
\proofstyle{Caminho 2.}
Temos
$$
\alignat2
e_1 \ast e_2 &= e_1  \qqby{pois $e_2$ é uma identidade (2R)}\\
e_1 \ast e_2 &= e_2  \qqby{pois $e_1$ é uma identidade (1L)}
\endalignat
$$
e concluimos o desejado $e_1 = e_2$.
\qed
%%}}}

\blah.
Uma prova errada desse lema aparece
no~\ref{bust_proof_of_uniqueness_of_identity_in_group},
onde peço identificar seus erros.

%%{{{ Q: What have we just won? 
\question.
O que acabamos de ganhar?
%%}}}

%%{{{ A: The right to use the definite article 
\blah Resposta.
Ganhamos o direito de usar o artigo definido: para cada grupo~$\cal G$ falar
\emph{da}~identidade do~$\cal G$, em vez \emph{duma}~identidade do~$\cal G$.
Observe que dado algum $a\in \cal G$ ainda não podemos falar sobre
\emph{o}~inverso de~$a$, mas apenas sobre \emph{um}~inverso de~$a$,
pois por enquanto a~(G3) garanta que pelo menos um inverso existe.
Vamos resolver isso agora.
%%}}}

%%{{{ beware: bound_variables_in_proof_of_uniqueness_of_identity_in_group 
\beware.
\label{bound_variables_in_proof_of_uniqueness_of_identity_in_group}%
\ii{variável!ligada}%
Os $a$ e $b$ que aparecem nas~(1)--(2) na prova do~\ref{uniqueness_of_identity_in_group}
são \emph{variaveis ligadas} aos correspondentes <<para todo $\holed{\dots} \in G$>>
e logo, ``nascem'' com essa frase e ``morrem'' no fim da mesma linha!%
\footnote{Veja~\ref{Bound_and_free_variables} também.}
Daí, não faz sentido afirmar logo após das~(1)--(2) algo do tipo $e = a \ast e$, pois o $a$ não foi declarado!
Podemos escrever as duas afirmações sem usar o nome $a$:
\emph{para cada elemento do $G$, operando com o~$e_1$ ao qualquer lado (direito ou esquerdo), o resultado é o proprio elemento}.
E para enfatisar ainda mais a independência do~$a$ que aparece na~(1) com o~$b$ que aparece na~(2) escolhemos variáveis diferentes.
Mas isso é \emph{desnecessário}, em geral vamos reusar variáveis ligadas quando não gera confusão---e aqui não geraria nenhuma.
%%}}}

%%{{{ x: rewrite_proof_with_same_bound_var 
\exercise.
\label{rewrite_proof_of_uniqueness_of_identity_in_group_with_same_bound_var}%
O que muda na prova do~\ref{uniqueness_of_identity_in_group} se usar a mesma
variável ligada nas afirmações~(1) e~(2)?

\solution
É apenas escrever
$$
\align
\text{para todo $a\in G$},\quad & e_1\ast a \eqlabel L a \eqlabel R a\ast e_1 \tag{1}\\
\text{para todo $a\in G$},\quad & e_2\ast a \eqlabel L a \eqlabel R a\ast e_2 \tag{2}
\endalign
$$
e depois
$$
\alignat2
e_1
&= e_1 \ast e_2     \qqby{pela (2R), com $a\asseq e_1$}\\
&= e_2              \qqby{pela (1L), com $a\asseq e_2$}.
\endalignat
$$
Observe que os $a$ que aparecem nas instanciações $a \asseq \dots$ são completemante independentes.
Ou seja, nada muda mesmo!

\endexercise
%%}}}

%%{{{ lm: uniqueness_of_inverses_in_group 
\lemma Unicidade dos inversos.
\label{uniqueness_of_inverses_in_group}%
\ii{unicidade!dos inversos}%
Em todo grupo $G$, cada $a\in G$ tem
exatamente um inverso $\ginv a$ que satisfaz a (G3).
\sketch.
Supondo que existe um certo $a \in G$ que possui inversos
$a_1,a_2\in G$, mostramos que necessariamente $a_1 = a_2$.
Ganhamos isso como corolário do~\ref{cancellation_laws_in_group}.
(Como?)
\qes
\proof.
Seja $\sset G {e, \ast}$ grupo, e suponha que existem $a,a_1,a_2\in G$
tais que $a_1,a_2$ são inversos de $a$, ou seja,
$$
\alignat2
a_1 \ast a &\eqlabel L e \eqlabel R a \ast a_1  \qqby{$a_1$ é um inverso de $a$} \tag{1}\\
a_2 \ast a &\eqlabel L e \eqlabel R a \ast a_2. \qqby{$a_2$ é um inverso de $a$} \tag{2}
\endalignat
$$
Vamos mostrar que $a_1 = a_2$.
Temos:
$$
\alignat2
a_1 \ast a &= a_2 \ast a \qqby {pelas (1L), (2L)}\\
a_1        &= a_2        \qqby {pelo~\refn{cancellation_laws_in_group}~(GCR)}
\endalignat
$$
e \emph{ficamos devendo} provar a (GCR) do~\ref{cancellation_laws_in_group}.
\qed
%%}}}

%%{{{ beware: Dependencies 
\beware Dependências.
Até realmente provar as leis de cancelação~(\refn{cancellation_laws_in_group}) não temos
a unicidade dos inversos~(\refn{uniqueness_of_inverses_in_group}).
Dado um elemento $a$ dum grupo $G$ não podemos aind falar \emph{do}
inverso do $a$, nem usar a notação $\ginv a$ (seria mal-definida), etc.
Crucialmente, não podemos usar nada disso em nossa prova do~\refn{cancellation_laws_in_group};
caso contrario criamos uma loope de dependências.
``Forward dependencies'' são perigosos exatamente por causa disso, e nos evitamos mesmo.%
\footnote{Aqui escolhi essa abordagem para enfatisar a importância de ficar
alertos para identificar chances de afirmar e provar lêmata separadamente,
usando-los em nossa prova e para provar outros teoremas depois a vontade.
Fazemos isso exatamente no mesmo jeito que um bom programador bom,
percebe padrões nas suas funções e separa certas partes para outras funções
chamando-las na sua função e nos seus programs próximos a vontade.}
%%}}}

%%{{{ lm: cancellation_laws_in_group 
\lemma Leis de cancelação.
\label{cancellation_laws_in_group}%
Seja $G$ grupo.
Então as leis de cancelação pela esquerda e pela direita
$$
\alignat2
\pforall {a,x,y\in G}  &\bracket{a\ast x = a\ast y \implies x=y}  &\tag{GCL} \\
\pforall {a,x,y\in G}  &\bracket{x\ast a = y\ast a \implies x=y}  &\tag{GCR} \\
\endalignat
$$
são válidas em $G$.
\sketch.
Sejam $a,x,y\in G$ tais que
$$
a \ast x = a \ast y.   \tag{1}
$$
Queremos provar $x=y$.
Tome a~(1) então, e usando umas das leis de grupo---comece com a~(G3)---chegue no desejado $x=y$, provando assim a~(GCL).
A~(GCR) é similar.
\qes
\proof.
Sejam $a,x,y\in G$ tais que
$$
a \ast x = a \ast y.   \tag{1}
$$
Pela (G2) o $a$ possui inverso no $G$;
daí, seja $a_0$ \emph{um} inverso de $a$, ou seja,
$$
a_0 \ast a \eqlabel L e  \eqlabel R a \ast a_0.  \tag{2}
$$
Agora temos:
$$
\alignat2
a_0 \ast (a \ast x) &= a_0 \ast (a \ast y)  \qqby{pela (1)}\\
(a_0 \ast a) \ast x &= (a_0 \ast a) \ast y  \qqby{pela (G1): $\ast$ é associativa}\\
e \ast x            &= e \ast y             \qqby{pela (2L)}\\
x                   &= y                    \qqby{pela definição do $a_0$ como um inverso de $a$}
\endalignat
$$
Provamos assim a~(GCL).
A~(GCR) é completamente simétrica (e vamos precisar a~(2R) em vez da~(2L)).
\qed
%%}}}

%%{{{ x: converses_of_cancellation_laws 
\exercise.
\label{converses_of_cancellation_laws}%
Os conversos das leis de cancelação~(GCL)~\&~(GCR) são válidos?

\hint
Sim; mas por quê?

\hint
Não precisamos nem saber que $G$ é um grupo nem nada sobre $\ast$, etc.

\solution
Se $x=y$ isso quis dizer que podemos substituir a vontade em cada
\emph{expressão} que envolve $x$ e $y$, uns $x$'s por $y$'s, e vice versa.
Nesse caso, começa com o
$$
a \ast x
$$
e troca a única instância de $x$ nessa expressão por $y$, e já chegamos no
$$
a \ast y
$$
ou seja, $a \ast x = a \ast y$.

\endexercise
%%}}}

%%{{{ refute the arbitrary cancellation law 
\exercise.
Refuta: para todo grupo $\sset G {e, \ast}$ e $a,x,y\in G$
$$
a\ast x = y\ast a \implies x=y
$$

\endexercise
%%}}}

%%{{{ ginv_is_a_function 
\note Inverso.
\label{ginv_is_a_function}%
Provando finalmente a unicidade dos inversos
(\refn{uniqueness_of_inverses_in_group}) ganhamos em cada grupo $G$ uma
\emph{função} (unária) de inverso
$$
\ginvt : G \to G.
$$
Sua \emph{totalidade} era já garantida pela~(G3);
e agora acabamos de ganhar sua \emph{determinicidade} com
o~\ref{uniqueness_of_inverses_in_group}.
Ou seja: \emph{função!}
Podemos finalmente definir uma notação para denotar o inverso de qualquer $a\in G$.
Bora!
%%}}}

%%{{{ df: ginv 
\definition.
\label{ginv}%
\sdefined {\ginv {\holed a}} {o inverso de $\holed a$ num grupo}
Seja $\sset G \ast$ grupo.  Para qualquer $a\in G$, definimos o
$$
\ginv a \defeq \text{o único inverso de $a$ no $G$}.
$$
%%}}}

\blah.
Tendo ganhado unicidade da identidade e dos inversos,
vamos responder agora em duas perguntas.

%%{{{ Q1: When is y the inv(a)? 
\question 1.
Num grupo $G$, dado $a\in G$,
o que precisamos mostrar para provar que um certo $y\in G$ é o inverso de $a$?
%%}}}

%%{{{ wrong answer 
\note Resposta errada.
Basta mostrar que $a \ast y = e$
(ou, alternativamente, que $y \ast a = e$)
pois, \emph{graças à unicidade dos inversos},
apenas um membro do grupo pode satisfazer essa equação,
e logo necessariamente $y = \ginv a$.
%%}}}

%%{{{ Q2: When is u the identity? 
\question 2.
Num grupo $G$, o que precisamos mostrar para provar que um certo $u\in G$ é a identidade do grupo?
%%}}}

%%{{{ wrong answer 
\note Resposta errada.
Basta achar um $a\in G$ tal que $a \ast u = a$
(ou, alternativamente, tal que $u \ast a = a$),
pois, \emph{graças à unicidade da identidade},
apenas um membro do grupo pode satisfazer essa equação,
e logo necessariamente $u = e$.
%%}}}

%%{{{ Where's the mistake? 
\note Cadê o erro?.
O \emph{raciocínio} nas duas respostas é errado numa maneira parecida:
\endgraf
Na (1), pode ser que $y$ satisfaz a $a\ast y = e$ sem $y$ ser o inverso do $a$.
\emph{E isso não violaria a unicidade do inverso $\ginv a$},
pois pela definição de \emph{inverso do $a$}, ambas equações $a \ast y = e = y \ast a$
precisam ser satisfeitas, e talvez $y \ast a \neq e$.
\endgraf
Na (2), pode ser que $u$ satisfaz $a \ast u = a$ para algum membro $a \in G$ sem $u$ ser a identidade do grupo.
\emph{E isso não violaria a unicidade da identidade $e$},
pois pela definição de \emph{identidade do $G$}, o $u$ precisa satisfazer ambas as $a \ast u = e = u \ast e$ e mesmo se satisfaria ambas isso não seria sufiziente: ele tem que as satisfazer não apenas \emph{para algum} $a\in G$ que deu certo, mas \emph{para todo} $a\in G$!
Ou seja: o fato que achamos \emph{algum} $a \in G$ tal que $a \ast u = a (= u \ast a)$
não quis dizer que esse $u$ merece ser chamado \emph{a identidade do $G$} ainda,
pois talvez tem membros $c \in G$ tais que $c \ast u \neq c$ ou $u \ast c \neq c$.
%%}}}

%%{{{ warning: wrong_reasoning_nimplies_wrong_claim_group_eg 
\warning.
\label{wrong_reasoning_nimplies_wrong_claim_group_eg}%
Os raciocínios acima sendo errados não quis dizer que as afirmações também são!
Na verdade, nos dois casos podemos realmente ganhar o que queremos:
identidades e inversos \emph{mais baratos}, sem pagar todo o preço das definições.
Ambos resultados seguem como corolários diretos do~\ref{solution_of_group_equations}
que vamos provar daqui a pouco.
%%}}}

\blah.
Por enquanto, vamos continuar pesquisando o que mais podemos concluir assim
que tivermos um grupo~$G$, e voltaremos logo nessas duas questões.

%%{{{ Q: Can we conclude something about these? 
\question.
Se $a,b$ são membros de algum grupo $\sset G {e,\ast}$, podemos concluir algo sobre os\dots:?
$$
\align
\ginvp{e}           &\askeq \dots?\\
\ginvp{\ginv a}     &\askeq \dots?\\
\ginvp{a \ast b}    &\askeq \dots?
\endalign
$$
%%}}}
\spoiler.

%%{{{ prop: inverse_of_identity_in_group 
\property.
\label{inverse_of_identity_in_group}
Em todo grupo $G$, $\ginv e = e$.
\proof.
Precisamos mostrar que $e$ é o inverso de $e$, ou seja,
que ele satisfaz $ee = e$, algo imediato pela definição da identidade $e$.
\qed
%%}}}

%%{{{ lm: inverse_of_inverse_in_group 
\lemma Inverso de inverso.
\label{inverse_of_inverse_in_group}%
Em todo grupo $G$, $\ginvp {\ginv a} = a$ para todo $a\in G$.
\sketch.
Usamos as definições dos inversos involvidos para ganhar duas equações.
Com elas, chegamos na afirmação desejada.
\qes
\proof.
Temos
$$
\alignat2
\ginvp{\ginv a} \ast \ginv a &= e   \qqby{def.~$\ginvp{\ginv a}$}\\
a               \ast \ginv a &= e.  \qqby{def.~$\ginv a$}
\intertext{Logo}
\ginvp{\ginv a} \ast \ginv a &= a \ast \ginv a
\endalignat
$$
e cancelando agora pela direita (GCR), chegamos na desejada
$\ginvp{\ginv a} = a$.
\qed
%%}}}

%%{{{ x: cd 
\exercise.
Desenha um diagrama cuja comutatividade é a lei que tu acabou de provar.

\solution
$$
\cdopt{sep=2cm}
A   \ar[r, "\ginvt"]\ar[dr, "\id"'] \| A \ar[d, "\ginvt"] \\
                                    \| A
\endcd
$$

\endexercise
%%}}}

%%{{{ remark: where did the inversion come from 
\remark.
É comum adivinhar erroneamente que em geral
$\ginvp{a \ast b} = \ginv a \ast \ginv b$.
O erro é feito pois, acostumados com um certo grupo \emph{bem especial} como o
$\sset {\reals_{\neq0}} {\ntimes}$ onde essa lei realmente é valida,
generalizamos para o caso geral de grupos, sem perceber algo estranho e
esquisito que acontece nessa equação.  Repensanso em nosso exemplo-guia de
grupos, o~$S_3$, o que significa~$a \ast b$?
<<Faça a~$b$, depois a~$a$.>>
E o que signfica $\ginvp{a \ast b}$ então?
<<Desfaça a~$\paren{a \ast b}$.>>
E se aplicar uma transformação~$b$, e depois mais uma~$a$, qual seria o jeito
para desfazer tudo isso e voltar na configuração inicial?
<<Desfaça a~$a$, e depois desfaça a $b$.>>
Ou seja,~$\ginv b \ast \ginv a$.
Isso é bem natural sim: para desfazer uma seqüência de ações, começamos
desfazenso a última, depois a penúltima, etc., até finalmente desfazer
a primeira.
Sendo o inverso então, faz sentido que a ordem é a inversa também!
E nos reais, por quê não foi a inversa?
Foi sim!
É apenas que o~$\sset {\reals_{\neq0}} {\ntimes}$ é um grupo abeliano;
em outras palavras a ``ordem que acontecem os membros'' não importa.
Mas tudo isso é apenas uma \emph{intuição correta} para adivinhar essa lei.
Precisamos a provar.
%%}}}

%%{{{ lm: inverse_of_product_in_group 
\lemma Inverso de produto.
\label{inverse_of_product_in_group}%
Em todo grupo $G$, $\ginvp{a\ast b} = \ginv b \ast \ginv a$
para todo $a,b\in G$.
\sketch.
Queremos mostrar que $\ginv b \ast \ginv a$ é o inverso do $a \ast b$.
Mas o que <<ser o inverso do $a \ast b$>> significa?
Precisamos verificar que o $\ginv b \ast \ginv a$ satisfaz a definição:
$$
\paren{\ginv b \ast \ginv a} \ast \paren{a \ast b} = e = \paren{a \ast b} \ast \paren{\ginv b \ast \ginv a}.
$$
Agora só basta fazer esse cálculo mesmo.
\qes
\proof.
Calculamos
$$
\alignat2
\paren{\ginv b \ast \ginv a} \ast \paren{a \ast b}
&= \paren{\paren{\ginv b \ast \ginv a} \ast a} \ast b   \qqby{assoc.}\\
&= \paren{\ginv b \ast \paren{\ginv a \ast a}} \ast b   \qqby{assoc.}\\
&= \paren{\ginv b \ast e} \ast b                        \qqby{def.~$\ginv a$}\\
&= \paren{\ginv b} \ast b                               \qqby{def.~$e$}\\
&= e                                                    \qqby{def.~$\ginv b$}
\endalignat
$$
A $\paren{a \ast b} \ast \paren{\ginv b \ast \ginv a} = e$ é similar.
\qed
%%}}}

%%{{{ x: cd 
\exercise.
Desenha um diagrama cuja comutatividade é a lei que tu acabou de provar.

\hint
Podes começar com os conjuntos seguintes:
$$
\cdopt{column sep=1cm, row sep=2cm}
            \| G\times G \|           \| \| \| G \\
G\times G   \|           \| G\times G \| \| \|   \\
            \| G\times G \|           \| \| \| G
\endcd
$$
Só basta botar as setas (e seus nómes).

\hint
Já botei as setas pra ti.
Basta botas os nomes.
$$
\cdopt{column sep=6mm, row sep=2cm}
                        \| |[alias=N]| G\times G \|                      \| \| \| |[alias=NE]| G \\
|[alias=W]| G\times G   \|                       \||[alias=E]| G\times G \| \| \|                \\
                        \| |[alias=S]| G\times G \|                      \| \| \| |[alias=SE]| G
\ar[from=N,to=W]
\ar[from=N,to=E]
\ar[from=W,to=S]
\ar[from=E,to=S]
\ar[from=N,to=NE]
\ar[from=NE,to=SE]
\ar[from=S,to=SE]
\endcd
$$

\solution
Uma tal diagrama é o seguinte:
$$
\cdopt{column sep=6mm, row sep=2cm}
                        \| |[alias=N]| G\times G \|                      \| \| \| |[alias=NE]| G \\
|[alias=W]| G\times G   \|                       \||[alias=E]| G\times G \| \| \|                \\
                        \| |[alias=S]| G\times G \|                      \| \| \| |[alias=SE]| G
\ar[from=N,to=W,"\swap"']
\ar[from=N,to=E,"\ginvt\times\ginvt"]
\ar[from=W,to=S,"\ginvt\times\ginvt"']
\ar[from=E,to=S,"\swap"]
\ar[from=N,to=NE,"\ast"]
\ar[from=NE,to=SE,"\ginvt"]
\ar[from=S,to=SE,"\ast"]
\endcd
$$
onde $\swap(x,y) = \tup{y,x}$.

\endexercise
%%}}}

%%{{{ criterion: Cancellation-based group definition 
\criterion Definição de grupo com cancelação.
\label{cancellation_based_group_def}%
Seja $\ssetfont G = \sset G \ast$ um conjunto \emph{finito} estruturado
que satisfaz:
$$
\align
\pforall {a,b\in G}    &\bracket{a\ast b \in G}                    \tag{G0} \\
\pforall {a,b,c\in G}  &\bracket{a\ast(b\ast c) = (a\ast b)\ast c} \tag{G1} \\
\pforall {a,x,y\in G}  &\bracket{a\ast x = a\ast y \implies x=y}   \tag{GCL}\\
\pforall {a,x,y\in G}  &\bracket{x\ast a = y\ast a \implies x=y}   \tag{GCR}
\endalign
$$
Então $\ssetfont G$ é um grupo.
%%}}}

%%{{{ x: we_need_both_cancellation_laws_to_have_a_group 
\exercise.
\label{we_need_both_cancellation_laws_to_have_a_group}
Podemos apagar um dos (GCL), (GCR) das hipoteses do~\ref{cancellation_based_group_def}?

\endexercise
%%}}}

%%{{{ x: cancellation_based_group_def_only_valid_for_finite_G 
\exercise.
Mostre que não podemos apagar o ``finito'' das nossas hipoteses.

\hint
Não.  Procure contraexemplo!

\endexercise
%%}}}

%%{{{ lm: solution_of_group_equations 
\lemma Resolução de equações.
\label{solution_of_group_equations}%
Seja $G$ grupo.
Para quaisquer $a,b,x,y\in G$,
cada uma das equações abaixo tem resolução única para $x$ e $y$:
$$
\xalignat2
a\ast x &= b
&
y\ast a &= b
\endxalignat
$$
\sketch.
Aplicando o inverso de $a$ em cada equação pelo lado certo,
achamos que as soluções necessariamente são
$x = \ginv a \ast b$ e $y = b \ast \ginv a$.
\qes
\proof.
Aplicando $(a^{-1}\ast)$ nos dois lados da primeira
e $(\ast a^{-1})$ nos dois lados da segunda temos:
$$
\xalignat2
  a\ast x = b &\impliesbecause{$\ginv a\ast$} \ginv a\ast \paren{a\ast x} = a^{-1} \ast b 
& y\ast a = b &\impliesbecause{$\ast\ginv a$} \paren{x\ast a}\ast \ginv a = b \ast \ginv a
\\
&\implies\paren{\ginv a\ast a}\ast x = \ginv a \ast b
&&\implies y\ast \paren{a\ast \ginv a} = b \ast \ginv a
\\
&\implies e \ast x = \ginv a \ast b
&&\implies y\ast e = b \ast \ginv a
\\
&\implies x = \ginv a \ast b
&&\implies y = b \ast \ginv a
\endxalignat
$$
\qed
%%}}}

%%{{{ remark: ab_eq_c_each_determined_by_other_two 
\remark.
\label{ab_eq_c_each_determined_by_other_two}%
Isso quis dizer que dada uma equação $a \ast b = c$,
cada um dos $a,b,c$ é determinado pelos outros dois!
Assim, podemos \emph{definir} por exemplo o objeto $x$
como \emph{a única solução da} $a\ast x = b$, etc.
%%}}}

%%{{{ cor: cheaper_ginv 
\corollary Inverso mais barato.
\label{cheaper_ginv}%
Seja $G$ grupo e $a,y \in G$
tais que $a\ast y = e$ ou $y \ast a = e$.
Logo $y = \ginv a$.
%%}}}

%%{{{ cor: cheaper_gid 
\corollary Identidade mais barata.
\label{cheaper_gid}%
Seja $G$ grupo $u\in G$.
Se para algum $a\in G$, $au = a$ ou $ua = a$, então $u$ é a identidade do grupo:
$u = e$.
%%}}}

%%{{{ x: abelian_iff_inv_of_prod_sameorder 
\exercise.
\label{abelian_iff_inv_of_prod_sameorder}%
Prove a equivalência:
$$
\text{$G$ abeliano} \iff \text{para todo $a,b\in G$, $\ginvp{ab} = \ginv a \ginv b$}.
$$

\solution
\lrdir.
Calculamos:
$$
\alignat2
\ginvp{ab}
&= \ginv b \ginv a      \qqby{pelo~\ref{inverse_of_product_in_group}}\\
&= \ginv a \ginv b.     \qqby{$G$ abeliano}
\endalignat
$$
\endgraf
\rldir.
Calculamos:
$$
\alignat2
ab
&= \ginvp{\ginvp{ab}}               \qqby{pelo~\ref{inverse_of_inverse_in_group}}\\
&= \ginvp{\ginv b \ginv a}          \qqby{pelo~\ref{inverse_of_product_in_group}}\\
&= \ginvp{\ginv b} \ginvp{\ginv a}  \qqby{pela hipótese}\\
&= b a.                             \qqby{pelo~\ref{inverse_of_inverse_in_group}~($\times2$)}
\endalignat
$$

\endexercise
%%}}}

%%{{{ x: onesided_group_def 
\exercise Unilateral definição de grupo.
\label{onesided_group_def}%
Seja $\ssetfont G = \sset G {e, \ast}$ um conjunto estruturado que satisfaz:
$$
\align
\pforall {a,b\in G}                        &\bracket{a\ast b \in G}                    \tag{G0}  \\
\pforall {a,b,c\in G}                      &\bracket{a\ast(b\ast c) = (a\ast b)\ast c} \tag{G1}  \\
\pforall {a \in G}                         &\bracket{a\ast e = a}                      \tag{G2R} \\
\pforall {a\in G} \pexists {y\in G}   &\bracket{a \ast y = e}                     \tag{G3R} \\
\intertext{Mostre que $\ssetfont G$ é um grupo.
Comece verificando que mesmo se conseguir provar as}
\pforall {a \in G}                         &\bracket{e\ast a = a}                      \tag{G2L} \\
\pforall {a\in G} \pexists {a'\in G}  &\bracket{a' \ast a = e}                    \tag{G3L} 
\endalign
$$
isso não nos permite deduzir trivialmente as (G2) e (G3)!  Explique o por quê.

\hint
Para evitar as chances de ``roubar'' sem querer, use uma notação adaptada às novas leis:
chame $e_r$ a identidade-direita grantida pela (G2R);
$a_{R}$ para os inversos-direitos grantidos pela (G3R); e
$a_{L}$ para os inversos-esquerdos garantidos pela (G3L).

\hint
Precisas mostrar as (G2)--(G3).
Ou seja, verificar que o $e_r$ é uma identidade-esquerda,
$$
\align
\pforall {a\in G} & \bracket{e_r \ast a = a}           \tag{G2'}\\
\intertext{e que para todo $a\in G$,
seu inverso-direito $a_{R}$ é um inverso-esquerdo também:}
\pforall {a\in G} &\bracket{a_{R} \ast a = e}.          \tag{G3'}
\endalign
$$

\hint
Para provar as (G2') e (G3'),
tome um $a\in G$ e comece com:
$$
\xalignat2
e \ast a &= (a \ast a_R) \ast a     & e \ast a &= (e \ast a) \ast e\\
         &= \dotsb                  &          &= e \ast (a \ast e)\\
         &=                         &          &= e \ast (a \ast (\;?\;))\\
         &=                         &          &= \dotsc
\endxalignat
$$

\hint
Espero que já conseguiu a (G2').
Para a (G3'), qual produto podes botar no lugar do $(\;?\;)$ da dica anterior?
Sabendo que (G2G) é válida, faz sentido o substituir com um termo
$\paren{x \ast x_R}$ para algum $x\in G$, mas qual seria esse $x$?
\emph{Não precisamos adivinhar ainda!}
Continue assim com um $x$ não-especificado por enquanto,
e logo tu vai chegar numa expressão que vai te ajudar escolher teu $x$ para
continuar.

\endexercise
%%}}}

%%{{{ x: splitsided_group_notdef 
\exercise.
\label{splitsided_grou_notdef}%
Podemos substituir a (G3R) do~\ref{onesided_group_def} por
$$
\align
\pforall {a\in G} \pexists {a'\in G}  &\bracket{a' \ast a = e}                    \tag{G3L} \\
\endalign
$$
e ainda concluir que $\ssetfont G$ é grupo?

\hint
Não!

\hint
Procure um contraexemplo.
(Claramente, a operação não pode ser comutativa.)

\endexercise
%%}}}

\endsection

%%}}}

%%{{{ Cayley tables 
\section Tabelas Cayley.

%%{{{ Q: In how many ways can we define an operation to create a finite group? 
\question.
De quantas maneiras podemos definir uma operação binária $\ast$ num conjunto
finito $G$, tal que $\sset G \ast$ é um grupo?
%%}}}
\spoiler.

%%{{{ What determines an operation 
\note O que determina uma operação.
O que significa \emph{definir uma operação} (binária)?
Seguindo nossa definição de igualdade (extensional) entre funções,
precisamos deixar claro para qualquer $\tup{x,y}\in G\times G$,
seu único valor $x \ast y \in G$.
Vamos brincar com os casos mais simples.
Se $\card G = 0$, não tem como virar um grupo, graças ao~(G2).
Se $\card G = 1$, só tem uma operação possível, pois não existe
nenhuma opção para o valor $e \ast e$: necessariamente $e \ast e = e$.
E essa opção realmente vira-se o $\sset G \ast$ um grupo (trivial).
%%}}}

%%{{{ 234_groups 
\note Os casos 2,3,4.
Vamos dizer que temos um conjunto $G$ com $\card G = 4$.
Não sabemos nada sobre seus membros, podem ser números, letras, pessoas,
funções, conjuntos, sapos, sei-lá.
$$
G = \set{ \bullet, \bullet, \bullet, \bullet }
$$
Então faz sentido começar nossa investigação dando uns nomes para
esses membros, por exemplo $a,b,c,d$, onde não vamos supor nada mais
sobre eles exceto que são distintos dois a dois.
$$
\text{<<Sejam $G\eqass\set{a,b,c,d}$.>>}
$$
Sera que podemos fazer algo melhor?
Querendo tornar o $G$ em grupo, sabemos que ele vai ter exatamente uma
identidade, então melhor denotar com $e$ sua a identidade,
e escolher nomes para os outros três membros do $G$:
$$
G = \set {e, a, b, c}.
$$
Similarmente, caso que $\card G = 2$ ou $3$, teremos
$G = \set {e, a}$
ou
$G = \set {e, a, b}$
respectivamente.
%%}}}

%%{{{ Cayley tables 
\note Tabelas Cayley.
\tdefined{tabela!Cayley}%
Temos então que ver o que podemos botar nos $\faded?$ para completar
as \dterm{tabelas Cayley}\Cayley[tabela]{} em baixo:
$$
\xalignat3
&\matrix
\ast& e & a \\
e   & \faded? & \faded? \\
a   & \faded? & \faded?
\endmatrix
&
&\matrix
\ast& e & a & b \\
e   & \faded? & \faded? & \faded? \\
a   & \faded? & \faded? & \faded? \\
b   & \faded? & \faded? & \faded?
\endmatrix
&
&\matrix
\ast& e & a & b & c \\
e   & \faded? & \faded? & \faded? & \faded? \\
a   & \faded? & \faded? & \faded? & \faded? \\
b   & \faded? & \faded? & \faded? & \faded? \\
c   & \faded? & \faded? & \faded? & \faded?
\endmatrix
\endxalignat
$$
Mas, não todos os $\faded?$ realmente representam uma escolha,
pois certos deles são determinados; e cada vez que fazemos uma escolha
para um deles, possivelmente nossas opções próximas deminuiam.
Para começar, como $e\ast x = x = x \ast e$ para qualquer $x$ do grupo,
a primeira linha e a primeira coluna da tabela já são determinadas:%
\footnote{De fato, foi por isso que Cayley realmente nem escreveu a coluna e a linha ``exterior'', tomando a convenção que o elemento que aparece primeiro é a sua identidade.
Para um grupo de três elementos então, ele começaria assim:
$$
\matrix
a & b       & c       \\
b & \faded? & \faded? \\
c & \faded? & \faded?
\endmatrix
\qquad
\text{que, seguindo nossa convenção com `$e$', escreveríamos}
\qquad
\matrix
e & a       & b       \\
a & \faded? & \faded? \\
b & \faded? & \faded?
\endmatrix
$$
}
$$
\xalignat3
&\matrix
\ast& e & a \\
e   & e & a \\
a   & a & \faded?
\endmatrix
&
&\matrix
\ast& e & a & b \\
e   & e & a & b \\
a   & a & \faded? & \faded? \\
b   & b & \faded? & \faded?
\endmatrix
&
&\matrix
\ast& e & a & b & c \\
e   & e & a & b & c \\
a   & a & \faded? & \faded? & \faded? \\
b   & b & \faded? & \faded? & \faded? \\
c   & c & \faded? & \faded? & \faded?
\endmatrix
\endxalignat
$$
%%}}}

%%{{{ Q: how can we replace the blanks? 
\question.
O que tu podes botar nos $\faded?$ para chegar em grupo?
O que muda se tu queres construir um grupo abeliano?
%%}}}
\spoiler.

%%{{{ 2 members 
\note 2 membros.
Vamos começar no caso mais simples, onde temos apenas um $\faded?$ para preencher.
Em teoria temos duas opções: $e,a$.  Mas precisamos verificar se o conjunto
realmente torna-se um grupo ou não.  Escolha $a$:
$$
\matrix
\ast& e & a \\
e   & e & a \\
a   & a & \alert{a}
\endmatrix
$$
Qual seria o inverso do $a$?
Nenhum!
Assim o~(G3) será violado, ou seja, não podemos escolher o $a$.
Se escolher nossa única outra opção ($e$) temos:
$$
\matrix
\ast& e & a \\
e   & e & a \\
a   & a & \alert{e}
\endmatrix
$$
Que realmente é um grupo.
%%}}}

%%{{{ x 
\exercise.
Verifique!

\endexercise

%%}}}

%%{{{ x: find_all_groups_of_order_3 
\exercise.
\label{find_all_groups_of_order_3}%
Ache todas as operações possíveis que tornam um conjunto com $3$ elementos um grupo.

\hint
Só tem uma maneira.  Qual?  Por quê?

\endexercise
%%}}}

%%{{{ Playing ``grupoku'' 
\note Jogando ``Grupoku''.
\tdefined{Grupoku}%
Investigar todas as possíveis escolhas para os~$\faded?$ parece como um jogo
de Sudoku, só que nossa restrição não é com a soma dos números de cada linha e
cada coluna como no Sudoku---nem poderia ser isso: nossos membros possivelmente
nem são números---mas as leis~(G0)--(G3) que tem que ser satisfeitas.
E caso que queremos criar um grupo abeliano, a~(G4) também.
%%}}}

%%{{{ Find the rules of grupoku 
\exercise.
\label{find_the_rules_of_grupoku}%
Que restrições pode afirmar que temos nesse jogo de ``Grupoku'', graças todos os resultados
que temos provado até agora sobre grupos?
E se queremos um grupo abeliano, muda o quê?

\endexercise
%%}}}

%%{{{ x: find_all_groups_of_order_4 
\exercise.
\label{find_all_groups_of_order_4}%
Ache todas as operações possíveis que tornam um conjunto com $4$ elementos
um grupo.

\hint
\emph{Essencialmente} são apenas $2$.
Se achar mais, verifique que renomeando seus membros umas viram iguais, e só
tem dois que realmente não tem como as identificar, mesmo renomeanos seus
membros.
Tudo isso vai fazer bem mais sentido daqui umas secções onde vamos estudar
o conceito de isomorfia~(\refn{Group_morphisms}).

\endexercise
%%}}}

%%{{{ x: find_all_groups_of_order_0_and_1 
\exercise.
\label{find_all_groups_of_order_0_and_1}%
Tem grupos com ordem 1?  Com 0?

\solution
Com ordem $1$ sim.  Cada um tem a mesma forma: seu único elemento é sua identidade.
Com ordem $0$, não: a lei (G2) \emph{manda a existência} de um certo membro do grupo (a sua identidade).

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Powers and orders 
\section Potências e ordens.

%%{{{ df: exp_in_group 
\definition.
\label{exp_in_group}%
\sdefined {{\holed a}^{\holed m}} {$a \ast \dotsb \ast a$ ($m$ vezes)}
Seja $a$ elemento dum grupo $\sset G {e, \ast}$.
Definimos suas potências $a^n$ onde $n\in\nats$ recursivamente:
$$
\align
a^0     &\defeq e\\
a^{n+1} &\defeq a \ast a^n
\endalign
$$
%%}}}

%%{{{ x: exp_in_group_altdef 
\exercise.
Demostre que a definição alternativa de exponenciação ao natural
$$
\align
a^0     &= e\\
a^{n+1} &= a^n \ast a
\endalign
$$
é equivalente.

\hint%%{{{
Como o proprio ``operador'' de exponenciar não aparece na notação comum $a^b$,
melhor escrever temporariamente as duas definições como:
$$
\xalignat2
a \uparrow_1 0 &= e &
a \uparrow_2 0 &= e \\
a \uparrow_1 (n+1) &= a \ast (a \uparrow_1 n) &
a \uparrow_2 (n+1) &= (a \uparrow_2 n) \ast a
\endxalignat
$$
Agora tem uma notação melhor para provar o que queremos: ${\uparrow_1} = {\uparrow_2}$.
O que significa que duas operações (funções) são iguais?
%%}}}

\hint%%{{{
Precisamos mostrar que:
$$
\text{para todo $a\in G$ e todo $n\in\nats$,}\quad
a \uparrow_1 n = a \uparrow_2 n
$$
ou, simbolicamente:
$$
\align
\pforall {a \in G}
&\lforall {n\in\nats} {a \uparrow_1 n = a \uparrow_2 n}.
\intertext{\emph{Seja $a\in G$.}  Agora queremos provar:}
&\lforall {n\in\nats} {a \uparrow_1 n = a \uparrow_2 n}.
\endalign
$$
Como provar isso?
%%}}}

\hint%%{{{
As definições envolvidas são recursivas.
%%}}}

\hint%%{{{
Ou seja: indução.
%%}}}

\hint%%{{{
\proofpart{Base:} provar que $a \uparrow_1 0 = a \uparrow_2 0$.
%%}}}

\hint%%{{{
Seja $k\in\nats$ tal que $a \uparrow_1 k = a \uparrow_2 k$ (hipótese indutiva).
Queremos mostrar que
$$
a \uparrow_1 (k+1) = a \uparrow_2 (k+1).
$$
%%}}}

\hint%%{{{
Seguinto as dicas anteriores, provavelmente tu chegou aqui:
$$
\alignat2
a \uparrow_1 (k+1)
&= a \ast (a \uparrow_1 k)   \qqby{def.~$\uparrow_1$}\\
&= a \ast (a \uparrow_2 k)   \qqby{HI}
\intertext{\dots e agora?
\emph{Se} $\ast$ fosse comutativa (ou seja, se o grupo fosse abeliano),
a gente \emph{poderia} continuar assim:}
&= (a \uparrow_2 k) \ast a   \qqby{comutatividade~(G4)}\\
&= a \uparrow_2 (k+1).       \qqby{def.~$\uparrow_2$}
\intertext{\emph{So que não!}
Sobre o $G$ sabemos apenas que é um grupo, então não podemos contar na
comutatividade da sua operação $\ast$.
Voltando no passo que tivemos colado}
a \uparrow_1 (k+1)
&= a \ast (a \uparrow_1 k)   \qqby{def.~$\uparrow_1$}\\
&= a \ast (a \uparrow_2 k)   \qqby{HI}
\endalignat
$$
percebemos que precisamos ``abrir mais'' a expressão $(a \uparrow_2 k)$,
aplicando a definição de $\uparrow_2$, mas não podemos, pois não sabemos se $k=0$ ou não.
Neste momento então percebemos que saber a vericidade dessa equação apenas para o valor $n=k$ não é suficiente.
Tu vai precisar o $n=k-1$ também.
\endgraf
Ou seja, tu vai precisar \emph{duas} bases ($n=0,1$),
e supor que tem um $k \geq 2$ tal que ambos os $k-1$ e $k-2$ satisfazem a
$a \uparrow_1 n = a \uparrow_2 n$.
Ou seja, tu ganharás as \emph{duas} hipoteses indutivas:
$$
\align
a \uparrow_1 (k-1) &= a \uparrow_2 (k-1) \tag{HI1}\\
a \uparrow_1 (k-2) &= a \uparrow_2 (k-2) \tag{HI2}
\endalign
$$
e só bastará provar que $a \uparrow_1 k = a \uparrow_2 k$.
%%}}}

\solution%%{{{
Seja $a \in G$.
Vamos provar que para todo $n\in\nats$, $a \uparrow_1 n = a \uparrow_2 n$
por indução no $n$.
\endgraf\noindent
\proofpart{Bases $n=0,1$:}
Temos
$$
\alignedat2
a \uparrow_1 0
&= e               \qqby{def.~$\uparrow_1$} \\
&= a \uparrow_2 0  \qqby{def.~$\uparrow_2$}
\endalignedat
\qqqquad
\alignedat2
a \uparrow_1 1
&= a \ast (a \uparrow_1 0)  \qqby{def.~$\uparrow_1$} \\
&= a \ast e                 \qqby{def.~$\uparrow_1$} \\
&= a                        \qqby{def.~$e$} \\
&= e \ast a                 \qqby{def.~$e$} \\
&= (a \uparrow_2 0) \ast a  \qqby{def.~$\uparrow_2$} \\
&= a \uparrow_2 1           \qqby{def.~$\uparrow_2$} \\
\endalignedat
$$
\noindent
\proofpart{Passo indutivo:}
Seja $k\in\nats$, tal que $k\geq 2$ e:
$$
\align
a \uparrow_1 (k-1) &= a \uparrow_2 (k-1) \tag{HI1}\\
a \uparrow_1 (k-2) &= a \uparrow_2 (k-2).\tag{HI2}
\endalign
$$
Precisamos provar que $a \uparrow_1 k = a \uparrow_2 k$.
Calculamos:
$$
\alignat2
a \uparrow_1 k
&= a \ast \paren{a \uparrow_1 (k-1)}                \qqby{def.~$\uparrow_1$} \\
&= a \ast \paren{a \uparrow_2 (k-1)}                \qqby{HI1} \\
&= a \ast \paren{\paren{a \uparrow_2 (k-2)} \ast a} \qqby{def.~$\uparrow_2$} \\
&= a \ast \paren{\paren{a \uparrow_1 (k-2)} \ast a} \qqby{HI2} \\
&= \paren{a \ast \paren{a \uparrow_1 (k-2)}} \ast a \qqby{associatividade~(G1)} \\
&= \paren{a \uparrow_1 (k-1)} \ast a                \qqby{def.~$\uparrow_1$} \\
&= \paren{a \uparrow_2 (k-1)} \ast a                \qqby{HI1} \\
&= a \uparrow_2 k.                                  \qqby{def.~$\uparrow_2$}
\endalignat
$$
Pelo principio da indução segue que para todo $n\in\nats$,
$a \uparrow_1 n = a \uparrow_2 n$.
Como $a$ foi arbitrário membro de $G$, isso termina nossa prova que
${\uparrow_1} = {\uparrow_2}$.
%%}}}

\endexercise
%%}}}

%%{{{ x: sq_of_prod_not_prod_of_sq 
\exercise.
\label{sq_of_prod_not_prod_of_sq}%
Mostre que, \emph{em geral}, $(a \ast b)^2 \neq a^2 \ast b^2$.

\endexercise
%%}}}

\beware.
Neste momento então, para qualquer grupo $G$ e qualquer $a\in G$,
o símbolo $a^w$ é definido \emph{apenas} para $w \asseq -1, 0, 1, 2, \dots$
e nada mais!
Vamos agora estender para os valores $w \asseq -2, -3, -4, \dots$
num jeito razoável.

%%{{{ Q: what do you think a^{-2} should mean? 
\question.
O que você acha que deveria ser denotado por $a^{-2}$?
%%}}}
\spoiler.

%%{{{ A 
\blah Resposta.
Bem, tem duas interpretações, ambas razoáveis:
$$
a^{-2} =
\knuthcases{
\paren{a^{-1}}^2  & (o quadrado do inverso do $a$)\cr
\paren{a^2}^{-1}  & (o inverso do quadrado do $a$)
}
$$
Prove que as duas interpretações são equivalentes, ou seja:
%%}}}

%%{{{ x: inv_of_square_eq_square_of_inv 
\exercise.
\label{inv_of_square_eq_square_of_inv}%
Seja $G$ grupo.  Para todo $a\in G$,
$\paren{a^{-1}}^2 = \paren{a^2}^{-1}$.
Ou seja, o diagrama
$$
\cdopt{sep=2cm}
G \ar[r, "\ginv\bhole"] \ar[d, "\bhole^2"] \| G \ar[d, "\bhole^2"]\\
G \ar[r, "\ginv\bhole"]                    \| G
\endcd
$$
comuta.

\hint
Seja $a\in G$.
O que tu precisas mostrar, é que $\paren{\ginv a}^2$ é o inverso do $a^2$.
O que significa <<ser o inverso do $a^2$>>?

\hint
$
\paren{\ginv a}^2 \ast {a^2}
\askeq e
\askeq {a^2} \ast \paren{\ginv a}^2
$.

\solution
Graças ao~\ref{cheaper_ginv}, basta provar que $\paren{\ginv a}^2 \ast a^2 = e$.
Calculamos então:
$$
\alignat2
\paren{a^{-1}}^2 \ast {a^2}
&= (\ginv a \ast \ginv a) \ast {a^2}             \qqby{def.~$\paren{\ginv a}^2$}\\
&= (\ginv a \ast \ginv a) \ast \paren{a\ast a}   \qqby{def.~$a^2$}\\
&= \paren{(\ginv a \ast \ginv a) \ast a}\ast a   \qqby{ass.}\\
&= \paren{\ginv a \ast (\ginv a \ast a)}\ast a   \qqby{ass.}\\
&= \paren{\ginv a \ast e}\ast a                  \qqby{def.~$\ginv a$}\\
&= \ginv a \ast a                                \qqby{def.~$e$}\\
&= e                                             \qqby{def.~$\ginv a$}
\endalignat
$$
Logo $\paren{\ginv a}^2$ é o inverso de $a^2$.

\endexercise
%%}}}

%%{{{ x: inv_of_npow_eq_npow_of_inv 
\exercise.
\label{inv_of_npow_eq_npow_of_inv}%
Generalize o~\ref{inv_of_square_eq_square_of_inv} para $n\in\nats$:
\emph{para todo grupo $G$ e todo $n\in\nats$, se $a\in G$ então
$\paren{a^{-1}}^n = \paren{a^n}^{-1}$}.

\hint
As ``potências'' $\bhole^n$ de elementos de grupo foram definidas \emph{recursivamente}.

\hint
Indução.

\endexercise
%%}}}

%%{{{ df: negexp_in_group 
\definition.
\label{negexp_in_group}%
Seja $a$ elemento dum grupo $\sset G {e, \ast}$.
Definimos para todo $n\in\nats_{>0}$.
$$
a^{-n} \defeq \paren{a^{-1}}^n
$$
%%}}}

%%{{{ x: negexp_in_group_altdef 
\exercise.
Demostre que a definição alternativa de exponenciação ao inteiro negativo
$$
a^{-n} \defeq \paren{a^n}^{-1}
$$
é equivalente; ou seja prove que para todo $n\in\nats$,
$$
\paren{a^{-1}}^n = \paren{a^n}^{-1}.
$$

\endexercise
%%}}}

%%{{{ property: properties_of_exp_in_groups 
\property Potências.
\label{properties_of_exp_in_groups}%
Sejam $G$ grupo, $a \in G$, e $m,n\in\ints$.
Temos:
\item{\rm (1)} $a^m \ast a^n = a^{m+n}$;
\item{\rm (2)} $(a^m)^n = a^{m\ntimes n}$;
\item{\rm (3)} $a^{-n} = \paren{a^n}^{-1} = \paren{a^{-1}}^n$.
\sketch.
Provamos primeiro para $m,n\in\nats$ por indução.
Depois consideramos os casos de inteiros negativos.
\qes
%%}}}

%%{{{ x: square_of_product_abelian_criterion
\exercise.
\label{square_of_product_abelian_criterion}%
Seja $G$ grupo tal que para todo $a,b \in G$, $(ab)^2 = a^2 b^2$.
Logo, $G$ é abeliano.

\hint
Sejam $x,y\in G$.
Calcule o $(xy)^2$ em dois jeitos.

\solution
Sejam $x,y\in G$.
Pela hipótese temos:
$$
\align
(xy)^2 &= x^2y^2 = xxyy;
\intertext{e pela definição de $(xy)^2$ temos}
(xy)^2 &= xyxy.
\endalign
$$
Ou seja
$$
xxyy = xyxy
$$
e cancelando os $x$ pela esquerda e os $y$ pela direita, chegamos no desejado:
$$
xy = yx.
$$

\endexercise
%%}}}

%%{{{ df: order_of_member_in_group 
\definition Ordem de membro em grupo.
\label{order_of_member_in_group}%
\tdefined{ordem!de membro em grupo}%
\sdefined {\gord {\holed a}} {a ordem do elemento $\holed a$ num grupo}%
Seja $\sset G {e,\ast}$ grupo e $a\in G$.
Chamamos \dterm{ordem} de $a$ o menor positivo $n\in\nats$ tal que
$a^n = e$, se tal $n$ existe; caso contrário, dizemos que o $a$ tem ordem infinita.
Usamos a mesma notação como no caso de ordem de grupos:
$\gord a$, $\tord a$, ou $\bord a$, com os mesmos cuidados.
Logo:
$$
\gord a =
\knuthcases{
\min\set{ n\in\nats_{>0} \st a^n = e }, & se $\set{ n\in\nats_{>0} \st a^n = e }\neq\emptyset$\cr
\infty,                                 & caso contrário.
}
$$
%%}}}

%%{{{ eg: orders_of_members_of_S3 
\example.
\label{orders_of_members_of_S3}%
No $S_3$, temos
$$
\xalignat3
\gord {\id} &= 1 & \gord {\phi}         &= 2  &  \gord {\psi}   &= 3\\
            &    & \gord {\phi\com\psi} &= 2  &  \gord {\psi^2} &= 3.\\
            &    & \gord {\psi\com\phi} &= 2  &  
\endxalignat
$$
\endexample
%%}}}

%%{{{ x: verify the numbers of orders_of_members_of_S3 
\exercise.
Verifique os números do~\ref{orders_of_members_of_S3}.

\endexercise
%%}}}

%%{{{ x: non-zero integer power = e guarantees positive one 
\exercise.
Seja $G$ grupo e $a\in G$.
Se existe $m\in\ints_{\neq 0}$ tal que $a^m = e$, então $\gord a < \infty$.

\hint
Precisamos mostrar que existe $n\in\nats_{>0}$ com $a^n = e$.

\hint
Se $m>0$, tome $n\leteq m$.  Se não?

\solution%%{{{
Precisamos mostrar que existe $n\in\nats_{>0}$ com $a^n = e$.
Se $m>0$, o conjunto $N \leteq \set{ n\in\nats_{>0} \st a^n = e}$ não é vazio,
então pelo princípio da boa ordem~\ii{princípio!da boa ordem}(PBO)
possui elemento mínimo e logo
$\gord a = \min N < \infty$
Se $m<0$, observe que $-m > 0$, e calcule:
$$
a^{-m} = \ginvp{a^m} = \ginv e = e,
$$
e novamente
$N\neq\emptyset$ e $\gord a < \infty$.
%%}}}

\endexercise
%%}}}

%%{{{ lm: a_has_exactly_gord_a_powers 
\lemma.
\label{a_has_exactly_gord_a_powers}%
Sejam $G$ grupo e $a\in G$, e suponha $\gord a = n\in\nats$.
Existem exatamente $n$ potências diferentes de $a$.
\sketch.
As potências de $a$ são as:
$$
\dotsc, a^{-2}, a^{-1}, a^0, a^1, a^2, \dotsc, a^{n-1}, a^n, a^{n+1}, a^{n+2}, \dotsc
$$
Queremos provar que, no final das contas, nesta lista aparecem exatemente $n$
distintos membros de $G$.  Ou seja,
$$
\card{\set{ a^k \st k \in \ints }} = n.
$$
Consideramos os
$$
a^0, a^1, \dotsc, a^{n-1}
$$
e usando a definição de $\gord a$ provamos:
\endgraf
\proofpart{Existência:} os $a^0,\dotsc,a^{n-1}$ são distintos dois a dois.
\endgraf\noindent
Ou seja: para todo $i,j\in \set{0,\dotsc,n-1}$ com $i\neq j$, temos $a^i \neq a^j$.
\endgraf
\proofpart{Unicidade:} para todo $M\in\ints$ o $a^M$ é um dos $a^0,\dotsc,a^{n-1}$.
\endgraf\noindent
Sabemos diretamente pela sua definição que $a^0 = e$, e que $a^n = e$, pois $\gord a = n$.
Com pouca imaginação chegamos na idéia que a cadeia de membros
$$
\alignat{12}
&\dotsc,\ && a^{-2},\ && a^{-1},\ && a^0,\ && a^1,\ && a^2,\ && \dotsc,\ && a^{n-1},\ && a^n,\ && a^{n+1},\ && a^{n+2},\ && \dotsc\\
\intertext{é feita por uma copia de $a^0, \dotsc, a^{n-1}$ se repetindo infinitamente para as duas direções:}
&\dotsc,\ && a^{n-2},\ && a^{n-1},\ && a^0,\ && a^1,\ && a^2,\ && \dotsc,\ && a^{n-1},\ && a^0,\ && a^1,\ && a^2,\ && \dotsc
\endalignat
$$
Aplicando a divisão de \Euclid[divisão]Euclides~(\ref{euclidean_division})
no~$M$ por~$n$, ganhamos $q,r\in\ints$ tais que:
$$
M = q\ntimes n + r,\qquad 0 \leq r < n.
$$
Só basta calcular o $a^M$ para verificar que realmente é um dos $a^0, \dotsc, a^{n-1}$.
\qes
\proof.
\proofpart{Existência:}
existem $n$ potências de $a$.
\endgraf\noindent
Provamos isso demonstrando que os $a^0,\dotsc,a^{n-1}$ são distintos dois a dois.
Sejam $i,j\in \set{0,\dotsc,n-1}$ com $i\neq j$.
\emph{Sem perda de generalidade}, suponha que $i<j$, ou seja:
$$
0 \leq i < j < n.
$$
Para chegar num absurdo, suponha que $a^i = a^j$.
Assim temos:
$$
\align
\munderbrace{aa\dotsb a} i &= \munderbrace{aa\dotsb aaa\dotsb a} j
\intertext{E como $i<j$, quebramos o lado direito assim:}
\munderbrace{aa\dotsb a} i &= \munderbrace{\moverbrace{aa\dotsb a} i \moverbrace{aa\dotsb a} {j-i}} j
\intertext{Ou seja,}
a^i &= a^i a^{j-i}
\intertext{e multiplicando ambos lados pela esquerda por $\ginvp{a^i}$ chegamos no}
e &= a^{j-i}.
\endalign
$$
Achamos então uma potência de $a$ igual à identidade $e$: $a^{j-i} = e$.
Como $0 < j-i < n$, isso contradiza a definição de $n$ como a ordem de $a$:
$n = \gord a$.
Logo $a^i \neq a^j$, que foi o que queremos provar.
\endgraf\noindent
\proofpart{Unicidade:}
os $a^0,\dotsc,a^{n-1}$ são as \emph{únicas} potências de $a$.
Ou seja, para todo $M\in\ints$ o $a^M$ é um dos $a^0,\dotsc,a^{n-1}$.
\endgraf\noindent
Tome $M\in \ints$.
Aplicando a divisão de \Euclid[divisão]Euclides~(\ref{euclidean_division})
no~$M$ por~$n$, ganhamos $q,r\in\ints$ tais que:
$$
M = q\ntimes n + r,\qquad 0 \leq r < n.
$$
Só basta calcular o $a^M$ para verificar que realmente é um dos $a^0, \dotsc, a^{n-1}$:
$$
a^M
= a^{q\ntimes n + r}
= a^{q\ntimes n} a^r
= \paren{a^n}^q a^r
= e^q a^r
= e a^r
= a^r
$$
e como $0\leq r < n$, provamos o que queriamos provar.
\qed
%%}}}

\question.
Se $a^m = e$ para algum $m\in\ints$, o que podemos concluir sobre o $m$ e a $\gord a$?
Se $\gord a = \infty$, o que podemos concluir sobre todas as potências de $a$?
\spoiler.

%%{{{ lm: a_exp_m_is_e_iff_gord_a_divides_m 
\lemma.
\label{a_exp_m_is_e_iff_gord_a_divides_m}%
Sejam $\sset G \ast$ grupo, $a\in G$, e $m\in\ints$.
Logo
$$
a^m = e \iff \gord a \divides m.
$$
\proof.
\rldir:
Como $\gord a \divides m$,
temos $m = k\gord a$ para algum $k\in\ints$.
Calculamos:
$$
a^m = a^{k\gord a} = a^{\gord a k} = \paren{a^{\gord a}}^k = e^k = e.
$$
\endgraf
\lrdir:
Para provar que $\gord a \divides m$,
aplicamos o~\ref{euclidean_division} da divisão de Euclides\Euclid[lema da divisão],
dividindo o $m$ por $\gord a$, e ganhando assim inteiros $q$ e $r$ tais que
$$
m = \gord a q + r
\qquad
0\leq r < \gord a.
$$
Vamos provar que o resto $r=0$.
Calculamos:
$$
e
= a^m
= a^{\gord a q + r}
= a^{\gord a q} \ast a^r
= \paren{a^{\gord a}}^q \ast a^r
= e^q \ast a^r
= e \ast a^r
= a^r.
$$
Ou seja, $a^r = e$ com $0\leq r < \gord a$, então pela definição de $\gord a$
como o mínimo inteiro positivo $n$ que satisfaz a $a^n = e$,
o $r$ não pode ser positivo.
Logo $r=0$ e $\gord a \divides m$.
\qed
%%}}}

%%{{{ lm: infinite_order_of_a_guarantees_all_powers_distinct 
\lemma.
\label{infinite_order_of_a_guarantees_all_powers_distinct}%
Sejam $G$ grupo e $a\in G$.  Se $\gord a = \infty$,
então as potências de $a$ são distintas dois a dois.
\sketch.
Precisamos provar que para todo $r,s\in\ints$,
$$
a^r = a^s \implies r = s.
$$
Sem perda de generalidade suponhamos $s\leq r$ e cancelamos pela direita
o $a^s$.  Usando a definição de $\gord a$ concluimos que $r-s=0$ e logo $r=s$.
\qes
%%}}}

\endsection
%%}}}

%%{{{ Subgroups 
\section Subgrupos.

%%{{{ df: subgroup 
\definition Subgrupo.
\label{subgroup}%
\tdefined{subgrupo}%
\tdefined{subgrupo!trivial}%
\sdefined {\holed H \subgroup \holed G} {$\holed H$ é um subgrupo de $\holed G$}
Seja $\sset G {e, \ast}$ grupo.
Um subconjunto $H\subseteq G$ é um \dterm{subgrupo} de $G$ sse
$H$ é um grupo com a mesma operação $\ast$.
Escrevemos $H \subgroup G$.
Chamamos os $\set e$ e $G$ \dterm{subgrupos triviais} de $G$.
%%}}}

%%{{{ x: singleton_e_is_a_subgroup 
\exercise.
\label{singleton_e_is_a_subgroup}%
Verifique que para todo grupo $\sset G {e, \ast}$, temos $\set e \subgroup G$.

\endexercise
%%}}}

%%{{{ eg: Numbers 
\example Números reais.
(1) Considere o grupo $\sset \reals {+}$.
Observe que $\rats$ e $\ints$ são subgrupos dele, mas $\nats$ não é.
\endgraf\noindent
(2) Considere o grupo $\sset {\reals_{\neq0}} {\ntimes}$.
Observe que $\set{1, -1}$, $\rats_{\neq0}$, e para qualquer
$\alpha\in\reals_{\neq0}$ o conjunto $\set{ \alpha^k \st k\in\ints }$ são todos
subgrupos dele, mas $\ints$ e $\set{ \alpha^n \st n\in\nats }$ não são.
\endexample
%%}}}

%%{{{ x: rationals 
\exercise.
Considere o grupo $\ssetfont Q \leteq \sset {\rats\setminus\set0} {\ntimes}$
e seus subconjuntos:
$$
\align
Q_1 &\leteq \setst { p/q } { p, q \in \ints,\ \text{$p$ e $q$ ímpares} }\\
Q_2 &\leteq \setst { p/q } { p, q \in \ints,\ \text{$p$ ímpar, $q$ par} }\\
Q_3 &\leteq \setst { p/q } { p, q \in \ints,\ \text{$p$ par, $q$ ímpar} }.
\endalign
$$
Para quais dos $i=1,2,3$ temos $Q_i \subgroup \ssetfont Q$?

\endexercise
%%}}}

%%{{{ property: empty_is_never_a_subgroup 
\property.
\label{empty_is_never_a_subgroup}%
$H\subgroup G \implies H \neq\emptyset$.
\proof.
Como $H$ é um grupo, necessariamente $e\in H$.
\qed
%%}}}

%%{{{ x: nontrivial_subgroups_of_multiplicative_reals 
\exercise.
\label{nontrivial_subgroups_of_multiplicative_reals}%
Ache uns subgrupos não-triviais do
$\sset {\reals\setminus\set0} {\ntimes}$?

\endexercise
%%}}}

%%{{{ remark: ass_for_free_in_subgroup
\remark Associatividade de graça.
\label{ass_for_free_in_subgroup}%
Seja $\sset G \ast$ grupo, e tome um $H\subseteq G$.
Para ver se $H \subgroup G$, seguindo a definição,
precisamos verificar as (G0)--(G3) no $\sset H \ast$.
Mas a lei~(G1) da associatividade não tem como ser violada no $\sset H \ast$.
O que significaria violar essa lei?
$$
\text{Teriamos $a,b,c \in H$, tais que $a\ast (b\ast c) \neq (a \ast b) \ast c$.}
$$
Mas como $H \subseteq G$, nos teriamos o mesmo contraexemplo para a (G1) de $G$,
impossível pois $G$ é um grupo mesmo (e a operação é a mesma).
Logo, jamais precisaramos verificar a~(G1) para um possível subgrupo.
%%}}}

\blah.
E isso não é o único ``desconto'' que temos quando queremos provar
que~$H \subgroup G$.  Vamos ver mais dois critéria agora:

%%{{{ criterion: subgroup_criterion 
\criterion Subgrupo.
\label{subgroup_criterion}%
Se $H$ é um subconjunto não vazio do grupo $\sset G {e,\ast}$, então:
$$
\left.
\alignedat3
\textrm{(0)} &\quad &            &\emptyset \neq H \subseteq G  &\qquad &\textrm{($H$ é não vazio)}\\
\textrm{(1)} &\quad & a, b \in H &\implies a\ast b \in H        &\qquad &\textrm{($H$ é $\ast$-fechado)}\\
\textrm{(2)} &\quad & a \in H    &\implies a^{-1}  \in H        &\qquad &\textrm{($H$ é $^{-1}$-fechado)}
\endalignedat
\right\}
\implies
H \subgroup G
$$
\sketch.
A direção \lrdir\ é trivial.
Para a \rldir\ observamos que a associatividade é garantida pelo fato que $G$ é grupo,
então basta provar que $e\in H$.
Por isso, usamos a hipótese $H\neq\emptyset$ para tomar um $a\in H$
e usando nossas (poucas) hipoteses concluimos que $e\in H$ também.
\qes
\proof.
\lrdir: Trivial.
\endgraf
\rldir:
Precisamos verificar as leis (G0)--(G3) para o $\sset H {\ast}$.
Os (1) e (2) garantam as (G0) e (G3) respectivamente,
e o fato que $G$ é grupo garanta a (G1) também.
Basta verificar a (G2), ou seja, que $e\in H$:
$$
\stepproof{
\proofsteptby {Tome $a\in H$.}     {$H\neq\emptyset$\,}\\
\thereforemby {a^{-1} \in H}       {pela (ii)}\\
\thereforemby {a\ast a^{-1} \in H} {pela (i)}\\
\thereforemby {e \in H}            {def.~$a^{-1}$}
}
$$
\qed
%%}}}

%%{{{ criterion: finite_subgroup_criterion 
\criterion Subgrupo finito.
\label{finite_subgroup_criterion}%
Se $\sset G {e, \ast}$ é um grupo e $H$ é um subconjunto finito e não vazio do $G$,
fechado sobre a operação $\ast$, então $H$ é um subgrupo de $G$.
Em símbolos:
$$
\left.
\alignedat3
\textrm{(0)} &\quad &            &\emptyset \neq H \finsubseteq G   &\qquad &\textrm{($H$ é \emph{finito} e não vazio)}\\
\textrm{(1)} &\quad & a, b \in H &\implies a\ast b \in H            &\qquad &\textrm{($H$ é $\ast$-fechado)}
\endalignedat
\right\}
\implies
H \subgroup G
$$
\sketch.
Basta demonstar o (2) para aplicar o~\ref{subgroup_criterion}.
Tome um $a\in H$ e considere a seqüência das suas potências
$a, a^2, a^3, \dotsc \in H$.
Como o $H$ é finito vamos ter um elemento repetido,
$a^r = a^s$ com inteiros $r > s > 0$, e usamos isso
para achar qual dos $a, a^2, a^3, \dotsc$ deve ser o $\ginv a$,
provando assim que $\ginv a\in H$.
\qes
\proof.
Graças ao~\ref{subgroup_criterion}, basta mostrar que todos os membros
de $H$ têm seu inverso dentro do $H$.
Tome um $a\in H$ e considere a seqüência das suas potências positivas:
$$
\alignat2
a, a^2, a^3, \dotsc \in H
\qqby{graças à hipótese (1)}
\endalignat
$$
Como o $H$ é finito vamos ter um elemento repetido,
$a^r = a^s$ para alguns distintos positivos $r,s \in \nats$.
Sem perda de generalidade, suponha $r > s$.
Temos
$$
\align
\toverbrace{a\ast a \ast \dotsb \ast a}{$r$ vezes}
&=\toverbrace{a\ast a \ast \dotsb \ast a}{$s$ vezes}
\intertext{e como $r>s$, reescrevemos assim:}
\toverbrace{
\tunderbrace{a\ast a \ast \dotsb \ast a}{$r-s$ vezes}
\ast
\tunderbrace{\cancel{a\ast a \ast \dotsb \ast a}}{$s$ vezes}
}{$r$ vezes}
&=\toverbrace{\cancel{a\ast a \ast \dotsb \ast a}}{$s$ vezes}.
\intertext{Agora usamos a lei de cancelamento-direito:}
\toverbrace{a\ast a \ast \dotsb \ast a}{$r-s$ vezes}
&=e
\intertext{Ou seja, $e = a^{r-s}$ e acabamos de provar que $e\in H$.
Observe que $r-s>0$, então temos:}
\toverbrace{a\ast \tunderbrace{a \ast \dotsb \ast a}{$r-s-1$ vezes}}{$r-s$ vezes}
&=e
\endalign
$$
e agora \emph{precisamos} considerar dois casos:
\endgraf\noindent
\case{Caso $r-s = 1$:}
Nesse caso então temos $e = a^1 = a$,
e logo $\ginv a = \ginv e = e = a \in H$.
\endgraf\noindent
\case{Caso $r-s > 1$:}
Nesse caso, temos $e = aa^{r-s-1}$, ou seja,
achamos o inverso do $a$: é o $a^{r-s-1}$, e ele pertence no $H$, pois é potência positiva de $a$ (e $H$ é fechado pela operação).
\endgraf
Em ambos os casos mostramos que $\ginv a \in H$ e podemos
aplicar o~\ref{subgroup_criterion} para concluir o desejado
$H\subgroup G$.
\qed
%%}}}

%%{{{ criterion: subgroup_single_check_criterion 
\criterion.
\label{subgroup_single_check_criterion}%
Sejam $G$ grupo e $\emptyset\neq H \subseteq G$.
Logo:
$$
H\subgrp G \iff \text{para todo $a,b\in H$},\ a\ginv b\in H.
$$
\proof.
\lrdir:
Sejam $a,b\in H$.
Como $b\in H$ e $H\subgroup G$, $\ginv b \in H$, e logo, $a\ginv b \in H$.
\endgraf
\rldir:
Como $H\neq\emptyset$, tome $h\in H$.
Pela hipótese, $h\ginv h\in H$, ou seja $e\in H$.
Como $e,h\in H$, de novo pela hipótese temos $e\ginv h \in H$,
ou seja $\ginv h \in H$.
Temos então que o $H$ é fechado pelos inversos.
Basta provar que é fechado pela operação de $G$ também:
tomando $a,b\in H$, ganhamos $a,\ginv b\in H$,
então pela hipótese $a\ginvp{\ginv b} \in H$, ou seja, $ab \in H$.
\qed
%%}}}

%%{{{ x: subgroup_is_an_order 
\exercise.
\label{subgroup_is_an_order}%
Mostre que $\subgroup$ é uma relação de ordem:
$$
\gather
G \subgroup G\\
K \subgroup H \mland H \subgroup G \implies K\subgroup G\\
H \subgroup G \mland G \subgroup H \implies H = G.
\endgather
$$

\endexercise
%%}}}

%%{{{ x: Matrices 
\exercise Matrizes.
Verificamos que
$$
G \leteq \setst{ \matrixp{a & b\\c & d}\in\reals^{2\times2}} {ad - bc \neq 0 }
$$
com multiplicação é um grupo no~\ref{matrix_group_examples}.
Considere seus subconjuntos:
$$
\xalignat2
G_{\rats} &\leteq \setst{ \matrixp{a & b\\c & d}\in\rats^{2\times2}} {ad - bc \neq 0 }&\quad H &\leteq \setlst { \matrixp{a & b\\0 & d}      } { a,b,d \in\reals,\ ad \neq 0 }\\
G_{\ints} &\leteq \setst{ \matrixp{a & b\\c & d}\in\ints^{2\times2}} {ad - bc \neq 0 }&\quad K &\leteq \setlst { \matrixp{1 & b\\0 & 1}      } { b\in\reals }                 \\
G_{\nats} &\leteq \setst{ \matrixp{a & b\\c & d}\in\nats^{2\times2}} {ad - bc \neq 0 }&\quad L &\leteq \setlst { \matrixp{a & 0^{\phantom{-1}}\\0 & a^{-1}} } { a\in\reals,\ a\neq 0 }
\endxalignat
$$
Para cada relação de $\subseteq$ válida entre 2 dos 7 conjuntos acima,
decida se a correspondente relação~$\subgroup$ também é válida.

\endexercise
%%}}}

%%{{{ eg: Modular arithmetic 
\example Aritmética modular.
Considere o grupo $\sset {\finord 6} {+_6}$ onde $+_6$ é a adição modulo $6$.
Os $\set{0,2,4}$ e $\set{0,3}$ são seus únicos subgrupos não-triviais.
\endexample
%%}}}

%%{{{ eg: Permutations (bijections) 
\example Permutações (bijecções).
O $\set{\id, \phi}$ é um subgrupo de $S_3$, onde $\phi = \permc{1 & 2}$.
\endexample
%%}}}

%%{{{ eg: Real functions 
\example Funções reais.
Seja $F = (\reals\to\reals_{\neq0})$ com operação a
multiplicação pointwise~(\ref{pointwise_operation}).
Os subconjuntos seguintes de $F$ são todos subgrupos dele:
$$
\xalignat2
&\setstt {f\in F} {$f$ continua} &
&\setst  {f\in F} {f(0) = 1} \\
&\setstt {f\in F} {$f$ constante} &
&\setstt {f\in F} {$f(r) = 1$ para todo $r\in\rats$}
\endxalignat
$$
\endexample
%%}}}

%%{{{ eg: Sets 
\example Conjuntos.
Sejam $A$ conjunto, e $X\subseteq A$.
Lembra que $\sset {\pset A} {\symdiff}$ é um
grupo~(\ref{pset_with_setops_group}).
Os $\set{\emptyset, X}$, $\set{\emptyset, X, A\setminus X}$,
e $\set{\emptyset, X, A\setminus X, A}$ são todos subgrupos dele,
mas o $\set{\emptyset, X, A}$ não é.
\endexample
%%}}}

%%{{{ x: why not? 
\exercise.
Por quê não?

\hint
(G0).

\solution
O $H = \set{\emptyset, X, A}$ em geral não é um subgrupo, pois pode violar a
lei~(G0) no caso que $A\setminus X \notin H$, pois~$A \symdiff X = A \setminus X$.

\endexercise
%%}}}

%%{{{ x: intersection_of_subgroups_is_a_subgroup 
\exercise.
\label{intersection_of_subgroups_is_a_subgroup}%
Seja $G$ grupo, e $H_1,H_2\subgroup G$.
Então $H_1\inter H_2 \subgroup G$.

\hint
Precisa mostrar que $H_1\inter H_2$ é fechado sobre a operação do grupo
e sobre inversos.

\hint
Para mostrar que é fechado sobre a operação do grupo
suponha $a,b\in H_1\inter H_2$ e mostre que
$ab\in H_1\inter H_2$.
Similarmente, para mostrar que é fechado sobre os inversos,
suponha $a\in H_1\inter H_2$ e mostre que
$a^{-1} \in H_1\inter H_2$.

\solution%%{{{
Como $H_1\inter H_2 \subseteq G$,
precisamos mostrar que é fechado sobre a operação:
$$
\stepproof{
\proofsteptnb {$a,b \in H_1\inter H_2$}\\
\thereforetby {$a,b \in H_1$ e $a,b\in H_2$} {def.~$\inter$}\\
\thereforetby {$ab  \in H_1$ e $ab\in H_2$}  {$H_1$ e $H_2$ grupos}\\
\thereforetby {$ab  \in H_1\inter H_2$}      {def.~$\inter$}
\intertext{e sobre os inversos:}
\proofsteptnb {$a \in H_1\inter H_2$}\\
\thereforetby {$a      \in H_1$ e $a\in H_2$}      {def.~$\inter$}\\
\thereforetby {$a^{-1} \in H_1$ e $a^{-1}\in H_2$} {$H_1$ e $H_2$ grupos}\\
\thereforetby {$a^{-1} \in H_1\inter H_2$}         {def.~$\inter$}
}
$$
%%}}}

\endexercise
%%}}}

%%{{{ x: union_of_subgroups_is_a_subgroup_wrong 
\exercise.
\label{union_of_subgroups_is_a_subgroup_wrong}%
Trocamos o $\inter$ para $\union$
no~\ref{intersection_of_subgroups_is_a_subgroup}.
\item{(i)} Ache o erro na prova seguinte:
\quote{
<<Como $H \leteq H_1\inter H_2 \subseteq G$,
precisamos mostrar que $H$ é fechado sobre a operação:
$$
\stepproof{
\proofsteptnb {$a,b \in H_1\union H_2$}\\
\thereforetby {$a,b \in H_1$ ou $a,b\in H_2$} {def.~$\union$}\\
\thereforetby {$ab \in H_1$ ou $ab\in H_2$  } {$H_1$ e $H_2$ grupos}\\
\thereforetby {$ab \in H_1\union H_2$       } {def.~$\union$}
\intertext{e sobre os inversos:}
\proofsteptnb {$a \in H_1\union H_2$}\\
\thereforetby {$a \in H_1$ ou $a\in H_2$          } {def.~$\union$}\\
\thereforetby {$a^{-1} \in H_1$ ou $a^{-1}\in H_2$} {$H_1$ e $H_2$ grupos}\\
\thereforetby {$a^{-1} \in H_1\union H_2$         } {def.~$\union$}
}
$$
Logo, $H_1 \union H_2 \subgroup G$.>>
}
\item{(ii)} Prove que a proposição não é válida.

\endexercise
%%}}}

%%{{{ x: arbitrary_intersection_of_subgroups_is_a_subgroup 
\exercise.
\label{arbitrary_intersection_of_subgroups_is_a_subgroup}%
Generalize a~\ref{intersection_of_subgroups_is_a_subgroup} para
intersecções arbitrárias:
se $G$ é um grupo, e $\scr H$ uma famílica de subconjuntos de $G$,
então $\Inter {\scr H} \subgroup G$.

\endexercise
%%}}}

%%{{{ x: congruence_mod_H_teaser 
\exercise.
\label{congruence_mod_H_teaser}%
Seja $G$ conjunto e $H\subgroup G$.
Defina no $G$ a relação $\rel R$ pela
$$
a \rel R b \defiff ab^{-1} \in H.
$$
Decida se a relação $\rel R$ é uma
relação de ordem parcial, de ordem total, de equivalência, ou nada disso.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Orders, generators, and cyclic groups 
\section Ordens, geradores, e grupos cíclicos.

%%{{{ df: subgroup_generated_by_a 
\definition.
\label{subgroup_generated_by_a}%
\tdefined{grupo}[subgrupo!gerado por elemento]%
\sdefined {\generate {\holed a}} {O subgrupo gerado por o elemento $\holed a$}%
Sejam $G$ grupo e $a\in G$.
Chamamos o
$$
\align
\generate{a}
&\defeq
\set{a^m\st m\in\ints}\\
&=\set{\dotsc,a^{-2},a^{-1},a^0,a^1,a^2,\dotsc}
\endalign
$$
o \dterm{subgrupo de $G$ gerado por $a$}.
%%}}}

%%{{{ x: justify_subgroup_on_subgroup_generated_by_a 
\exercise.
\label{justify_subgroup_on_subgroup_generated_by_a}%
Justifica a palavra ``subgrupo'' na~\ref{subgroup_generated_by_a}.
Ou seja, prove que para qualquer grupo $G$ e qualquer $a\in G$,
$\generate a \subgroup G$.

\hint
Use o~\ref{subgroup_criterion}.

\solution
Graças ao~\ref{subgroup_criterion},
precisamos verificar que $\generate a$ é fechado pela operação e pelos inversos.
\endgraf\noindent
\proofpart{Fechado pela operação:}
Sejam $h_1,h_2\in\generate a$.
Logo
$h_1 = a^{k_1}$\fact1
e 
$h_2 = a^{k_2}$\fact2
para alguns $k_1,k_2\in\ints$.
Precisamos mostrar que $h_1h_2\in\generate a$.
Calculamos:
$$
\alignat2
h_1h_2
&= a^{k_1} a^{k_2}  \qqby{pelas~\byfact1,\byfact2}\\
&= a^{k_1 + k_2}    \qqby{pela~\ref{properties_of_exp_in_groups}~(1)}\\
&\in \generate a.   \qqby{def.~$\generate a$, pois $k_1+k_2\in\ints$}
\endalignat
$$
\proofpart{Fechado pelos inversos:}
Seja $h \in \generate a$,
logo $h = a^k$ para algum $k\in\ints$.
Pela~\ref{properties_of_exp_in_groups}~(3),
$$
\ginv h = \ginvp {a^k} = a^{-k} \in \generate a.
$$

\endexercise
%%}}}

%%{{{ x: Cyclic group of e 
\exercise.
Seja $\sset G {e,\ast}$ grupo.
Calcule o $\generate e$.

\endexercise
%%}}}

%%{{{ Calculate some sets and subgroups of ints 
\exercise.
Nos inteiros com adição, calcule os
$\generate 4$,
$\generate 4 \inter \generate 6$,
$\generate 4 \inter \generate {15}$,
e
$\generate 4 \union \generate 6$.
\endgraf\noindent
Quais deles são subgrupos do $\ints$?

\endexercise
%%}}}

%%{{{ Q: How would you generalize gen a to gen A? 
\question.
Como tu generalizarias o
<<subgrupo gerado por $a\in G$>>
para
<<subgrupo gerado por $A \subseteq G$>>?
Ou seja, como definirias o $\generate A$ para qualquer $A \subseteq G$?
%%}}}

Falando de \emph{generalização}, a idéia é que queremos definir o $\gen A$ num jeito
\emph{razoável} e tal que $\gen {\set a} = \gen a$.

\spoiler.

%%{{{ A wrong generalization of <a> to <A> 
\note.
\label{wrong_generalization_of_gord_a_to_gord_A}%
Queremos generalizar o conceito de geradores para definir $\generate A$,
onde $A\subseteq G$.
Seguindo ingenuamente a definição de $\generate a$,
uma primeira abordagem seria botar
$$
\generate A = \set{ a^m \st a \in A,\  m \in\ints }
$$
e chamar $\generate A$ o subgrupo de $G$ gerado por $A$.\mistake
%%}}}

%%{{{ x: find_the_problem_in_wrong_generalization_of_gord_a_to_gord_A 
\exercise.
\label{find_the_problem_in_wrong_generalization_of_gord_a_to_gord_A}%
Qual o problema com a definição de $\generate A$ acima?

\hint
Calcule o $\generate {4,6}$ no $\sset \ints +$.

\hint
Ele é um subgrupo?

\endexercise
%%}}}

%%{{{ x: subgroup_generated_by_two_members 
\exercise.
\label{subgroup_generated_by_two_members}%
Tentando generalizar primeiramente para o caso mais simples de <<subgrupo gerado por dois membros $a,b\in G$>>,
alguém definiu o $\gen {a,b}$ para quaisquer $a,b \in G$ assim:
$$
\generate {a,b} \defeq \setst {a^m b^n} {m,n \in \ints}.
$$
Existe um problema.  Qual?

\hint
Se $G$ fosse abeliano, daria certo.

\solution
O problema é que não podemos chamar isso \emph{subgrupo}, pois não é garantidamente fechado pela operação.
Por exemplo,
sabendo que $a \in \gen{a,b}$ e $a\ast b\in\gen{a,b}$, deveriamos ter
$(ab)a \in \gen{a,b}$, mas o $(ab)a$ \emph{em geral} não pode ser escrito na
forma $a^m b^n$.
Uma outra observação similar que serve também é que o inverso de
$ab \in \gen{a,b}$ é o $\ginv b \ginv a$ que também \emph{em geral} não
pode ser escrito na forma $a^m b^n$.

\endexercise
%%}}}

\blah.
Vamos finalmente definir o $\gen A$.

%%{{{ df: subgroup_generate_A_direct 
\definition direta.
\label{subgroup_generate_A_direct}%
\tdefined{grupo}[subgrupo!gerado por subconjunto]%
\sdefined {\generate {\holed A}} {O subgrupo gerado por o conjunto $\holed A$}%
Sejam $\sset G \ast$ grupo e $A\subseteq G$.
Chamamos o
$$
\align
\generate{A}
&\defeq
\set{a_0^{m_0}\ast\dotsb\ast a_{k-1}^{m_{k-1}}\st
a_i \in A,\ 
m_i \in \ints,\ 
i\in\finord k,\ 
k\in\nats
}
\endalign
$$
o \dterm{subgrupo de $G$ gerado por $A$}.
Abusando a notação, escrevemos também $\generate{ a_1, a_2,\dotsc, a_n }$
para o $\generate{ \set{a_1, a_2,\dotsc, a_n}}$.
%%}}}

%%{{{ x: Calculate <> and <G> 
\exercise.
Dado grupo $G$,
calcule os $\generate \emptyset$ e $\generate G$.

\endexercise
%%}}}

%%{{{ x: justify_subgroup_on_subgroup_generate_A_direct 
\exercise.
\label{justify_subgroup_on_subgroup_generate_A_direct}%
Prove que $\generate A \subgroup G$ para qualquer grupo $G$ e qualquer $A\subseteq G$.

\endexercise
%%}}}

%%{{{ Top-down and bottom-up 
\note ``Top-down'' e ``bottom-up''.
Temos então duas caracterizações do~$\generate A$:
\endgraf
\proofpartstyle{Bottom-up:}
Começamos com um conjunto~$T$ onde botamos todos os elementos que desejamos
no subgrupo (os elementos de~$A$ nesse caso),
e enquanto isso não forma um grupo, ficamos nos perguntando \emph{por que não}.
A resposta sempre é que (pelo menos) uma lei de grupo ((G0)--(G3)) está sendo
violada.
Vendo as leis, isso sempre quis dizer que um certo elemento tá faltando:
\beginul
\li (G0) violada: para alguns~$s,t \in T$, o~$s\ast t \notin T$.
\li (G1) violada é impossível: (veja~\ref{ass_for_free_in_subgroup}).
\li (G2) violada: a identidade~$e \notin T$.
\li (G3) violada: para algum~$t \in T$, seu inverso~$\ginv t \notin T$.
\endul
\noindent
Então ficamos \emph{adicionando} os elementos faltantes, e repetindo a mesma
pergunta, até chegar num conjunto que não viola nenhuma das leis, ou seja, um
grupo mesmo.  É o conjunto~$T$ que tem todos os elementos de~$A$ e todos os
necessários de~$G$ para formar um grupo.
\endgraf
\proofpartstyle{Top-down:}
Começamos com a família~$\cal F$ de \emph{todos} os subgrupos de~$G$
que contenham o~$A$.
\emph{Primeiramente verificamos que essa família não é vazia:}
fato, pois já temos um membro dela: o proprio~$G$ já é um grupo que~$G \supseteq A$.
Mas no~$G$ existe possível ``lixo'': membros fora do~$A$ cuja presença não
foi justificada como necessária pelas leis de grupo.
Precisamos filtrar esse lixo, para ficar apenas com os membros ``necessários''.
Quais são esses membros?  São aqueles que pertencem em \emph{todos} os grupos
dessa família~$\cal F$.  Ou seja, a intersecção~$\Inter \cal F$ é o
desejado~$\generate A$.
%%}}}

%%{{{ prop: subgroup_generate_A_topdown 
\proposition Definição top-down.
\label{subgroup_generate_A_topdown}%
Sejam $\sset G \ast$ grupo e $A \subseteq G$.
$$
\generate A = \Inter \setst { H \subgroup G } { H \supseteq A }.
$$
\sketch.
Provamos cada direção separadamente:
Para a \lrdirset, tome um arbitrário membro $\alpha \in \generate A$
e um arbitrário $H \subgroup G$ tal que $H \supseteq A$, e mostre
que $\alpha\in H$.
Para a \rldirset, tome um $\alpha$ que pertence em todos os subgrupos de $G$ que contenham o $A$
e mostre que ele pode ser escrito na forma desejada (da definição de~$\generate A$).
\qes
%%}}}

%%{{{ prop: subgroup_generate_A_bottomup 
\proposition Definição bottom-up.
\label{subgroup_generate_A_bottomup}%
Sejam $\sset G \ast$ grupo e $A \subseteq G$.
Definimos a seqüência de conjuntos:
$$
\align
T_1     &= A\\
T_{n+1} &= T_n
\union \tunderbrace {\setst { s \ast t } {s,t \in T_n}} {(G0)}
\union \tunderbrace {\set e} {(G2)}
\union \tunderbrace {\setst {\ginv t} {t \in T_n}} {(G3)}
\endalign
$$
Temos
$$
\generate A = \Union_{n=1}^{\infty} T_n.
$$
\sketch.
Provamos cada direção separadamente:
Para a \lrdirset, tome um arbitrário membro $\alpha \in \generate A$
e ache um inteiro $w \geq 1$ tal que $\alpha \in T_w$.
Para a \rldirset, basta provar que cada um dos $T_1, T_2, T_3, \dots$
é subconjunto de $\generate A$.  Podes usar indução.
\qes
%%}}}

%%{{{ df: cyclic_group 
\definition Grupo cíclico.
\label{cyclic_group}%
\tdefined {Grupo}[cíclico]%
Um grupo $G$ é \dterm{cíclico} sse existe $a\in G$ tal que $\generate a = G$.
%%}}}

%%{{{ x: cyclic_and_noncyclic_groups 
\exercise.
\label{cyclic_and_noncyclic_groups}%
Quais dos grupos seguintes são cíclicos?
$$
\xalignat8
& \sset \reals + &
& \sset \rats +  &
& \sset \ints +  &
& \sset {\reals_{\neq0}} \ntimes &
& \sset {\rats_{\neq0}} \ntimes  &
& \sset {\ints_6} {+} &
& \sset {\ints_6\setminus\set0} {\ntimes} &
& S_3
\endxalignat
$$

\endexercise
%%}}}

%%{{{ x: generators_of_S3 
\exercise.
\label{generators_of_S3}%
Ache todos os geradores $A$ de $S_3$ com tamanho $2$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Congruences and cosets 
\section Congruências e cosets.

%%{{{ The relation R was actually congruence mod subgroup 
\note.
A relação de equivalência que definimos no~\ref{congruence_mod_H_teaser}
não é tão desconhecida como talvez apareceu ser.
Vamos a redefinir com seu próprio nome e sua própria notação:
%%}}}

%%{{{ df: congruence mod H 
\definition Congruência.
\label{congruence_mod_H}%
\tdefined{congruência}[módulo subgrupo]%
\tdefined{módulo!subgrupo}%
\sdefined{\holed a \cong {\holed b} \pmodr {\holed H}}{\holed a é congruente com \holed b módulo-direito \holed H, onde $\holed H \subgroup G$}
Seja $G$ grupo e $H\subgroup G$.
Definimos
$$
a \cong b \pmodr H \defiff ab^{-1} \in H.
$$
%%}}}

%%{{{ x: mod_m_as_a_special_case_of_mod_H 
\exercise.
\label{mod_m_as_a_special_case_of_mod_H}%
Explique a notação da~\ref{congruence_mod_H} a comparando com a
congruência módulo algum inteiro da~\ref{congruence}.
Ou seja, mostre como a definição nos inteiros é apenas um caso especial da definição nos grupos.

\endexercise
%%}}}

%%{{{ Investigating the congruence 
\note Investigando a congruência.
\label{investigation_of_cong_mod_H}%
Vamos supor que temos um grupo $G$ e um subgrupo $H\subgroup G$.
Tomamos $a,b\in G$ e queremos ver se $a\cong b\pmodr H$.
Separamos em casos:
\beginil
\item{\case{Caso 1:}} os dois elementos $a$ e $b$ estão no $H$;
\item{\case{Caso 2:}} um dos elementos está dentro do $H$, o outro fora;
\item{\case{Caso 3:}} os dois estão fora do $H$.
\endil
\topinsert
\centerline{
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestbase;
\node at (-1,0.5)    (a) {$\bullet$};
\node at (-0.5,-0.5) (b) {$\bullet$};
\node[above right, outer sep=1pt] at (a) {$a$};
\node[above right, outer sep=1pt] at (b) {$b$};
\endtikzpicture
%%}}}
\hfil
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestbase;
\node at (-1,0.5)   (a) {$\bullet$};
\node at (1,-0.5)   (b) {$\bullet$};
\node[above right, outer sep=1pt] at (a) {$a$};
\node[above right, outer sep=1pt] at (b) {$b$};
\endtikzpicture
%%}}}
\hfil
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestbase;
\node at (0.5,1)    (a) {$\bullet$};
\node at (1,-0.5)   (b) {$\bullet$};
\node[above right, outer sep=1pt] at (a) {$a$};
\node[above right, outer sep=1pt] at (b) {$b$};
\endtikzpicture
%%}}}
}
\botcaption{}
Os 3 casos da Investigação~\refn{investigation_of_cong_mod_H}.
\endcaption
\endinsert
\noindent
Para cada caso, queremos decidir se:
\beginil
\item{(i)} podemos concluir que $a \cong b \pmodr H$;
\item{(ii)} podemos concluir que $a \ncong b \pmodr H$;
\item{(iii)} nenhum dos (i)--(ii).
\endil
Vamos ver qual dos (i)--(iii) aplica no \casestyle{caso 1}.
Temos
$$
a \cong b \pmodr H
\defiff a\ginv b \in H
$$
Como $b\in H$ e $H$ é um grupo ($H\subgroup G$) concluimos que
$\ginv b \in H$.
Agora, como $a, \ginv b \in H$ ganhamos $a\ginv b\in H$, ou seja,
$a \cong b \pmodr H$:
\topinsert
\centerline{
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestcase1base;
\node[color=blue,inner sep=1pt] at (-1.5,-0.5)  (binv)  {$\bullet$};
\draw[->,dashed,color=blue] (b)--(binv);
\node[above,  outer sep=1pt] at (binv) {$\ginv b$};
\endtikzpicture
%%}}}
\hfil
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestcase1base;
\node[inner sep=1pt] (binv)  at (-1.5,-0.5)  {$\bullet$};
\node[color=blue,inner sep=1pt] (abinv)  at (-0.75,-0.75) {$\bullet$};
\node[above, outer sep=1pt] at (binv) {$\ginv b$};
\node[below, inner sep=1pt, outer sep=1pt] at (abinv) {$a\ginv b$};
\draw[|-,color=blue]  (a)    edge[out=240,  in=135] (abinv);
\draw[|->,color=blue] (binv) edge[out=60, in=135] (abinv);
\endtikzpicture
%%}}}
}
\botcaption{}
Os passos do \casestyle{caso 1} do~\refn{investigation_of_cong_mod_H}.
\endcaption
\endinsert
%%}}}

%%{{{ x: do case 2 
\exercise.
\label{investigation_of_cong_mod_H_case_2}%
Decida qual dos (i)--(iii) aplica no \casestyle{caso 2}
do~\refn{investigation_of_cong_mod_H}.

\hint
Sem perca de generalidade, podes supor que $a \in H$ e $b \notin H$.
Comece desenhando como fizermos no \casestyle{caso 1}.

\hint
Mostre que $b^{-1}\notin H$.  (Qual seria o problema se $b^{-1} \in H$?)

\hint
Se $b{-1} \in H$ seu inverso também deveria estar no $H$, pois $H$ é um grupo.

\hint
Suponha que $ab^{-1} \in H$ para chegar num absurdo, mostrando assim que necessariamente,
$a \ncong b \pmodr H$.  Cuidado:
$$
xy \in H \nimplies x \in H \mland y \in H.
$$

\hint
Mostre que $a^{-1}\in H$.

\solution%%{{{
Sem perda de generalidade, suponha $a\in H$ e $b\notin H$.
Primeiramente mostramos que $b^{-1} \notin H$:
$$
b^{-1}\in H \implies \paren{b^{-1}}^{-1} \in H \implies b \in H,
$$
logo $b^{-1}\notin H$.
Para chegar num absurdo, vamos supor que $ab^{-1} \in H$.
\topinsert
\centerline{
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestcase2base;
\endtikzpicture
%%}}}
\hfil
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestcase2base;
\node[inner sep=1pt, color=blue] at (0,1.5) (binv) {$\bullet$};
\draw[->,dashed,color=blue] (b) edge[out=180, in=225] (binv);
\node[above, inner sep=3pt, outer sep=1pt] at (binv) {$\ginv b$};
\endtikzpicture
%%}}}
\hfil
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestcase2base;
\node[inner sep=1pt] at (0,1.5) (binv) {$\bullet$};
\node[color=red] at (-0.5,-1) (abinv) {$\bullet$};
\node[above, inner sep=3pt, outer sep=1pt] at (binv) {$\ginv b$};
\node[below, inner sep=1pt, outer sep=1pt] at (abinv) {$a\ginv b$};
\endtikzpicture
%%}}}
}
\medskip
\centerline{
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestcase2base;
\node[inner sep=1pt] at (0,1.5) (binv) {$\bullet$};
\node[inner sep=1pt, color=blue] at (-1.25,-1) (ainv) {$\bullet$};
\node[color=red] at (-0.5,-1) (abinv) {$\bullet$};
\draw[->,dashed,color=blue] (a) to (ainv);
\node[below, inner sep=1pt, outer sep=1pt] at (ainv) {$\ginv a$};
\node[above, inner sep=3pt, outer sep=1pt] at (binv) {$\ginv b$};
\node[below, inner sep=1pt, outer sep=1pt] at (abinv) {$a\ginv b$};
\endtikzpicture
%%}}}
\hfil
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestcase2base;
\node at (0,1.5) (binv) {$\bullet$};
\node at (-1.25,-1) (ainv) {$\bullet$};
\node[color=red] at (-0.5,-1) (abinv) {$\bullet$};
\node[below, inner sep=1pt, outer sep=1pt] at (ainv) {$\ginv a$};
\node[below, inner sep=1pt, outer sep=1pt] at (abinv) {$a\ginv b$};
\node[above, outer sep=1pt] at (binv) {$\ginv b$};
\draw[|-]  (ainv)  edge[out=60, in=250] (binv);
\draw[|->,color=red] (abinv) edge[out=90, in=250] (binv);
\endtikzpicture
%%}}}
\hfil
\tikzpicture[>=stealth]%%{{{
\tikzi groupconginvestcase2base;
\node at (0,1.5) (binv) {$\bullet$};
\node at (-1.25,-1) (ainv) {$\bullet$};
\node[inner sep=1pt,color=blue] at (1,1) (abinv) {$\bullet$};
\node[below, inner sep=1pt, outer sep=1pt] at (ainv) {$\ginv a$};
\node[below, inner sep=1pt, outer sep=1pt] at (abinv) {$a\ginv b$};
\node[above, outer sep=1pt] at (binv) {$\ginv b$};
\draw[-,dashed,color=blue] (a) edge[out=20,  in=160] (abinv);
\draw[->,dashed,color=blue] (b) edge[out=110, in=160] (abinv);
\endtikzpicture
%%}}}
}
\botcaption{}
Os passos da resolução do~\ref{investigation_of_cong_mod_H_case_2}.
\endcaption
\endinsert
\noindent
Vamos deduzir a contradição $b^{-1}\in H$.
Para conseguir isso, observamos que $a^{-1} \in H$ (pois $a\in H$),
e logo
$$
\overbrace{\underbrace{\vphantom{(}a^{-1}}_{\in H}\underbrace{(ab^{-1})}_{\in H}}^{\dsize b^{-1}} \in H.
$$
\noindent
Achamos assim nossa contradição:
$$
b^{-1} = eb^{-1} = (a^{-1}a)b^{-1} = a^{-1}(ab^{-1}) \in H.
$$
Concluimos então que $ab^{-1} \notin H$, ou seja $a \ncong b \pmodr H$.
%%}}}

\endexercise
%%}}}

%%{{{ x: do case 1 
\exercise.
Decida qual dos (i)--(iii) aplica no \casestyle{caso 3} do~\refn{investigation_of_cong_mod_H}.

\hint
Ache dois exemplos com $a,b\notin H$, tais que num
$a \cong b \pmodr H$ e no outro $a \ncong b \pmodr H$.

\hint
Um exemplo consiste em: um grupo $G$, um subgrupo $H\subgroup G$, e dois elementos $a,b\in G\setminus H$ tais que satisfazem (ou não) a congruência $a\cong b \pmodr H$.

\hint
Procure teus exemplos no grupo dos inteiros com adição $\sset \ints +$.

\hint
Tome $G \leteq \sset \ints +$, $H \leteq 2\ints$, $a \leteq 1$, $b \leteq 3$
e observe que $1 \cong 3 \pmodr {2\ints}$.

\hint
Não é possível achar o outro exemplo com o mesmo subgrupo $2\ints$,
mas pode sim no $3\ints$.

\solution%%{{{
No grupo $G\leteq\sset \ints +$ considere seu subgrupo $H\leteq 5\ints$.
Temos:
$$
\xalignat2
\left.
\aligned
G&\leteq \sset \ints +\\
H&\leteq 5\ints\\
a&\leteq 1  \\
b&\leteq 6  
\endaligned
\right\}
&\implies a \cong b \pmodr H
&
\left.
\aligned
G&\leteq \sset \ints +\\
H&\leteq 5\ints\\
a&\leteq 1  \\
b&\leteq 3  
\endaligned
\right\}
&\implies a \ncong b \pmodr H,
\endxalignat
$$
porque $1 + (-6) = -5 \in 5\ints$ e $1 + (-3) = -2 \notin 5\ints$ respectivamente.
%%}}}

\endexercise
%%}}}

%%{{{ def: cosets 
\definition Cosets.
\label{coset}%
\tdefined{coset}%
\iisee{coclasse}{coset}%
\sdefined{\holed a H} {o left-coset do $H\subgrp G$ através do $a\in G$}%
\sdefined{H\holed a} {o right-coset do $H\subgrp G$ através do $a\in G$}%
Seja $G$ grupo e $H\subgrp G$.  Para $a\in G$ definimos
$$
\xalignat2
aH &\defeq \set{ ah \st h\in H }.
&
Ha &\defeq \set{ ha \st h\in H }
\endxalignat
$$
Chamamos o $aH$ o \dterm{left-coset} do $H$ através de $a$,
e similarmente o $Ha$ seu \dterm{right-coset}.
Também usamos os termos \dterm{coclasse (lateral) à esquerda/direita}.
%%}}}

%%{{{ x: Ha_eq_H_iff_a_in_H 
\exercise.
\label{Ha_eq_H_iff_a_in_H}%
Sejam $G$ grupo, $H\subgrp G$, e $a \in G$.
$$
Ha = H \iff a \in H.
$$

\endexercise
%%}}}

%%{{{ Q: How many cosets? 
\question.
\emph{Dados um grupo $G$ e $H\subgroup G$, quantas coclasses $Ha$ tem?
Ou seja, qual é a cardinalidade do conjunto $\set { Ha \st a \in G }$?}
%%}}}

%%{{{ thm: the cosets of H are the quotient set G / congmodR 
\theorem.
\ii{partição}%
\ii{relação!de equivalência}%
Sejam $G$ grupo e $H\subgroup G$.
A família $\scr A = \set { Ha \st a\in G }$ é uma partição do $G$
e sua correspondente relação de equivalência é a congruência módulo-direito $H$.
\proof.
Vamos denotar por $\eqclassimp a$ a classe de equivalência de $a\in G$.
Provamos que $\eqclassimp a = Ha$.
\endgraf
``$\subseteq$'':
Suponha $x \in \eqclassimp a$.
Logo $x \cong a \pmodr H$, ou seja, $xa^{-1} \in H$.
Pela definição de $Ha$ então temos
$$
Ha\ni
\underbrace{\paren{xa^{-1}}}_{\in H}a
= x\paren{a^{-1}a}
= x.
$$
\endgraf
``$\supseteq$'':
Suponha que $x\in Ha$.
Logo $x=ha$ para algum $h\in H$ e queremos mostrar que $ha\in\eqclassimp a$,
ou seja $ha \cong a \pmodr H$.
Confirmamos:
$$
\paren{ha} a^{-1}
= h \paren{aa^{-1}}
= h
\in H
$$
e pronto.
\qed
%%}}}

%%{{{ x: direct proof that coclasses form a partition 
\exercise.
\ii{partição}%
Prove diretamente (sem passar pela relação de equivalência) que
a família de todas as coclasses dum $H\subgroup G$ é uma partição de $G$:
\beginil
\item{(i)}   para todo $x\in G$, existe coclasse $Ha$ com $x \in Ha$;
\item{(ii)}  para todo $c\in G$, se $c\in Ha\inter Hb$ então $Ha = Hb$;
\item{(iii)} nenhuma coclasse $Ha$ é vazia.
\endilnoskip

\hint%%{{{
Para os (i) e (iii) explique porque $a \in Ha$ para todo $a\in G$ e vice versa.
Para o (ii) tome um elemento comum $c\in G$ tal que
$$
h_a a = c = h_b b.
$$
Agora mostra que $Ha \subseteq Hb$; a outra diração será similar.
%%}}}

\hint%%{{{
Para os (i) e (iii) lembra que $H$ sendo subgrupo de $G$ ele também é grupo.
Qual elemento é garantido de pertencer no $H$ e como podemos usar esse fato aqui?
Para o (ii) tome $ha \in Ha$ e mostre que $ha \in Hb$.
Aplique uma série de substituições $ha = \dotsb$ para chegar num elemento
do $Hb$, ou seja, um produto que começa com elementos de $H$ e termina em $b$.
%%}}}

\hint%%{{{
Para o (ii):
como temos que $h_aa=h_bb$, precisamos ``criar'' a expressão
``$h_aa$'' para a substituir por $h_bb$.
Com que precisamos e podemos multiplicar o $ha$ pela equerda para conseguir isso?
Cuidado: para garantir igualdade só pode multiplicar com $e$,
mas pode substituir o $e$ com muitos produtos iguais ao $e$.
%%}}}

\solution%%{{{
Como $H$ é um grupo, sabemos que $e\in H$, então para qualquer $x\in G$,
temos que $x = ex \in Hx$, ou seja todos os elementos de $G$ pertencem em
alguma coclasse, e vice versa:
toda coclasse $Ha$ tem pelo menos um elemento: o proprio $a$.
Para o (iii) suponha que $Ha\inter Hb\neq \emptyset$ e tome $c\in Ha\inter Hb$.
Logo
$$
h_aa = c = h_bb
\qqquad
\text{para alguns $h_a, h_b\in H$}
$$
Para provar que $Ha = Hb$, mostramos que $Ha\subseteq Hb$ e $Hb\subseteq Ha$.
Suponha então que $x \in Ha$, logo $x = ha$ para algum $h\in H$.
Precisamos mostrar que $x \in Hb$.
Calculamos:
$$
\align
x
&= ha\\
&= e(ha)\\
&= \paren{\paren{h_a h^{-1}}^{-1}\paren{h_a h^{-1}}} (ha)\\
&= \paren{\paren{h^{-1}}^{-1} h_a^{-1}} h_a \cancel{\paren{h^{-1} h}} a\\
&= \paren{h h_a^{-1}} \paren{h_a a}\\
&= \paren{h h_a^{-1}} \paren{h_b b}\\
&= \paren{h h_a^{-1} h_b} b\\
&\in Hb.
\endalign
$$%%}}}

\endexercise
%%}}}

%%{{{ x: cosets_are_equinumerous 
\exercise.
\label{cosets_are_equinumerous}%
Prove que todas as coclasses dum $H\subgrp G$ tem a mesma quantidade de
elementos com o próprio $H$.

\endexercise
%%}}}

\question.
Por que os direitos?
O que acontece se considerar a colecção de todos os cosets esquerdos?
É uma partição também?
E se sim, qual é sua relação de equivalência correspondente?

%%{{{ df: index_of_subgroup 
\definition Índice.
\label{index_of_subgroup}%
\tdefined{grupo}[índice de subgrupo]%
\sdefined {\groupind {\holed G} {\holed H}} {o índice do subgrupo \holed H no grupo \holed G}%
Sejam $G$ grupo e $H\subgroup G$.
O \dterm{índice} de $H$ no $G$ é o número de right-cosets de $H$ no $G$.
Denotamos-lo com os símbolos $\groupind G H$ ou $\altgroupind G H$.
%%}}}

%%{{{ x: number_of_cosets_independend_of_side 
\exercise.
\label{number_of_cosets_independend_of_side}%
Sejam $G$ grupo, $H\subgrp G$.
Prove que o número de coclasses à esquerda de $H$ é o mesmo com o número de coclasses à direita de $H$.

\endexercise
%%}}}

%%{{{ thm: lagrange_theorem 
\theorem Lagrange.
\label{lagrange_theorem}%
\Lagrange[teorema]%
\ii{teorema}[Lagrange]%
Seja $G$ grupo finito e $H\subgroup G$.
Então $\groupord H \divides \groupord G$.
\sketch.
Sabemos que o $G$ pode ser particionado pelos right cosets de $H$,
e que cada um deles tem a mesma cardinalidade com o proprio $H$.
\qes
%%}}}

%%{{{ Corollaries as exercises 
\note Corollários.
Graças ao teorema de Lagrange~\refn{lagrange_theorem}
ganhamos muitos corollários diretamente,
como tu vai verificar agora resolvendo os exercícios seguintes:
%%}}}

%%{{{ x: subgroups_of_group_with_prime_order 
\exercise.
\label{subgroups_of_group_with_prime_order}%
Seja $G$ grupo com $\gord G = p$, onde $p$ primo.
Quais são todos os subgrupos de $G$?

\hint
Se $H\subgroup G$, pelo teorema de Lagrange temos que
$\gord H \divides \gord G$.  Quais são os divisores de $\gord G$?

\solution
Se $H\subgroup G$, pelo teorema de Lagrange temos que
$\gord H \divides \gord G = p$, logo $\gord H = 1$ ou $p$.
No primeiro caso $H = \set e$, no segundo, $H = G$.
Ou seja:
\emph{um grupo com ordem primo não tem subgrupos não-triviais}.

\endexercise
%%}}}

%%{{{ x: order_of_generate_a_divides_order_of_G 
\exercise.
\label{order_of_generate_a_divides_order_of_G}%
Seja $G$ grupo finito e $a\in G$.  Então $\gord a \divides \gord G$.

\hint
Se achar um subgrupo $H\subgroup G$ com $\gord H = \gord a$,
acabou (graças ao Lagrange).

\hint
Lembra que $\generate a$ é um subgrupo do $G$\dots?

\hint
\dots e que sua ordem é $\gord {\generate a} = \gord a$?

\solution
Sabemos que $\generate a$ é um subgrupo de $G$, com ordem
$\gord {\generate a} = \gord a$,
e pelo teorema de Lagrange, como $\generate a \subgroup G$
e $G$ é finito temos
$$
\gord a = \gord {\generate a} \divides \gord G.
$$

\endexercise
%%}}}

%%{{{ x: a_to_the_order_of_G_is_e 
\exercise.
\label{a_to_the_order_of_G_is_e}%
Seja $G$ grupo finito e $a\in G$.
Então $a^{\gord G} = e$.

\hint
Resolveu já o~\ref{order_of_generate_a_divides_order_of_G}?

\solution
Graças ao~\ref{order_of_generate_a_divides_order_of_G} temos que
$\gord a \divides \gord G$, ou seja, $\gord G = k\gord a$ para algum
$k\in\ints$.
Agora calculamos:
$$
a^{\gord G}
= a^{k\gord a}
= a^{\gord a k}
= \paren{a^{\gord a}}^k
= e^k
= e.
$$

\endexercise
%%}}}

\blah.
Vamos agora generalizar a notação que usamos nos cosets de
``multiplicação de subgrupo por elemento'' para
``multiplicação de subgrupo por subgrupo''.

%%{{{ df: HK 
\definition.
\label{HK_of_groups}%
Seja $G$ grupo e $H,K\subgroup G$.  Definimos
$$
HK \defeq \set { hk \st h\in H,\ k\in K }.
$$
%%}}}

%%{{{ Q: are HK and KH subgroups of G? 
\question.
$HK = KH$?
$HK \subgroup G$?
$KH \subgroup G$?
%%}}}

%%{{{ eg: calculate_HK_KH_S3 
\example.
No grupo $S_3$, sejam seus subgrupos
$$
\xalignat2
H &\leteq \set{ \id, \phi }
&
K &\leteq \set{ \id, \psi\phi }.
\endxalignat
$$
Calcule os $HK$ e $KH$ e decida se $HK=KH$ e se $HK$ e $KH$ são subgrupos de $S_3$.

\solution%%{{{
Pela definição
$$
\xalignat2
HK &= \set{ hk \st h\in H,\ k\in K}
& 
KH &= \set{ kh \st h\in H,\ k\in K}
\\
&= \set{
\id\compose\id,
\id\compose(\psi\compose\phi),
\phi\compose\id,
\phi\compose(\psi\compose\phi)
}
&
&= \set{
\id\compose\id,
\id\compose\phi,
(\psi\compose\phi)\compose\id,
(\psi\compose\phi)\compose\phi)
}
\\
&= \set{ \id, \psi\phi, \phi, \phi\psi\phi }
&
&= \set{ \id, \phi, \psi\phi, \psi\phi^2 }
\\
&= \set{ \id, \psi\phi, \phi, \psi^2}
&
&= \set{ \id, \phi, \psi\phi, \psi }.
\endxalignat
$$
Observamos que $HK\neq KH$ (pois, por exemplo, $\psi \in KH$ mas $\psi \notin HK$).
E nenhum deles é subgrupo de $S_3$.
Por quê?
Em invez de fazer o trabalho tedioso e verificar se cada um dos $HK,\,KH$ é um subgrupo do $S_3$,
observamos que cada um tem $4$ elementos---verifique que são \emph{realmente} $4$.
Mas, graças ao Lagrange~(\refn{lagrange_theorem}) $S_3$ não tem subgrupos
de ordem $4$, pois $4$ não divide o $6$.  Pronto.
%%}}}
\endexample
%%}}}

\blah.
Então descobrimos que, em geral, nem $HK=KH$, nem $HK\subgroup G$,
nem $KH\subgroup G$ são garantidos.
Pode acontecer que $HK \subgroup G$ mas $KH \not\subgroup G$?
E o que a igualdade $HK=KH$ tem a ver com a ``subgrupidade'' dos $HK$ e $KH$?
Vamos responder em todas essas perguntas com o teorema seguinte:

%%{{{ thm: HK = KH <=> HK subgrp G 
\theorem.
\label{HK_equals_KH_iff_HK_subgroup}
Seja $G$ grupo e subgrupos $H,K \subgrp G$.  Então:
$$
HK = KH
\iff
HK \subgrp G
$$
%%{{{ sketch and proof 
\sketch.
Para a direção \lrdir, precisamos mostrar que $HK$ é fechado sobre a operação e fechado sobre os inversos.
Tomamos aleatorios $h_1k_1,h_2k_2\in HK$ e aplicando as propriedades de grupo e nossa hipótese,
mostramos que $(h_1k_1)(h_2k_2) \in HK$.  Similarmente para os inversos: consideramos um
arbitrário elemento $hk\in HK$ e mostramos que seu inverso $\ginvp{hk} \in HK$.  Aqui, alem da
hipótese precisamos o~\ref{inverse_of_product_in_group}.
Para a direção \rldir, mostramos as ``$\subseteq$'' e ``$\supseteq$'' separadamente,
usando idéias parecidas.
\qes
\proof.
\lrdir:
Precisamos mostrar que $HK$ é fechado sobre a operação e fechado sobre os inversos.
Tomamos aleatorios $h_1k_1,h_2k_2\in HK$ e calculamos:
$$
\alignat2
(h_1k_1)(h_2k_2)
&= h_1(k_1h_2)k_2 \qqby{ass.}\\
&= h_1(h_3k_3)k_2\quad\text{para alguns $h_3\in H$ e $k_3 \in K$} \qqby{$k_1h_2\in KH = HK$}\\
&= (h_1h_3)(k_3k_2)\qqby{ass.}\\
&\in HK
\endalignat
$$
Para os inversos temos:
$$
\ginvp {h_1k_1} = \ginv{k_1} \ginv{h_1} \in KH = HK.
$$
\endgraf
\rldir:
Mostramos as ``$\subseteq$'' e ``$\supseteq$'' separadamente.
``$\subseteq$'':
Tome $x \in HK$, logo $x^{-1} \in HK$ e $x^{-1} = hk$ \emph{para alguns}
$h\in H$ e $k\in K$.  Como $H$ e $K$ são sub\emph{grupos} de $G$ seus inversos
também estão em $H$ e $K$ respectivamente.
Mas
$$
x = \ginvp{\ginv x} = \ginvp{hk} \ginv k \ginv h \in KH.
$$
``$\supseteq$'':
Tome $x \in KH$, logo $x = kh$ \emph{para alguns} $k\in K$, $h\in H$.
Logo $\ginv k \in K$ e $\ginv h \in H$.
Como $HK\subgrp G$, basta apenas provar que $\ginv x \in HK$ pois isso
garantará que $x \in HK$ também.
Realmente, $\ginv x = \ginvp{kh} = \ginv h \ginv k \in HK$.
\qed
%%}}}
%%}}}

\endsection
%%}}}

%%{{{ Number theory revisited 
\section Teoria de números revisitada.

%%{{{ x: the_multiplicative_group_Zp 
\exercise.
\label{the_multiplicative_group_Zp}%
Seja $p$ primo e defina
$\cal Z_p = \sset {\finord p \setminus \set0} {\ntimes}$
onde $\ntimes$ é a multiplicação módulo~$p$.
Mostre que $\cal Z_p$ é um grupo e ache sua ordem.

\endexercise
%%}}}

%%{{{ x: the_multiplicative_group_Zn 
\exercise.
\label{the_multiplicative_group_Zn}%
Seja $n\in\nats$ com $n>1$ e defina
$\cal Z_n = \sset {\set{a \in \finord n \st \gcd a n = 1}} {\ntimes}$
onde $\ntimes$ é a multiplicação módulo~$n$.
Mostre que $\cal Z_n$ é um grupo e ache sua ordem.

\endexercise
%%}}}

\blah.
Já estamos em posição de ganhar o teorema de congruências
de~\Euler{}Euler~\refn{euler_congruence_theorem} como um corolário fácil
das nossas novas ferramentas grupoteóricas.

%%{{{ cor: euler_congruence_theorem_revisited 
\corollary Teorema de Euler.
\label{euler_congruence_theorem_revisited}%
Sejam $a,m\in\ints$ com $\gcd a m = 1$.
Então
$$
a^{\tot m} \cong 1 \pmod m.
$$
\sketch.
Consequência do teorema de~\Lagrange{}Lagrange~\refn{lagrange_theorem}
graças ao~\ref{the_multiplicative_group_Zn}.
\qes
%%}}}

\endsection
%%}}}

%%{{{ Normal subgroups 
\section Subgrupos normais.

%%{{{ Notation 
\note Notação.
Observe que definimos os $aH$, $Ha$, e $HK$, num grupo $G$
para \emph{subgrupos} $H,K\subgroup G$.
Mas não usamos nenhuma propriedade de subgrupo mesmo.
Podemos realmente estender essa notação para arbitrários
\emph{subconjuntos} de $G$, e, por que não,
até usar notação como a seguinte abominágem:
$$
g_1ABg_2B\ginv{g_3}Ag_1CB
\defeq
\set{
g_1abg_2b'\ginv{g_3}a'g_1cb''
\st
a, a' \in A,\ 
b, b', b'' \in B,\ 
c \in C
}
$$
dados $g_1,g_2,g_3\in G$ e $A,B,C\subseteq G$.
Observe primeiramente que \emph{precisamos} usar variáveis diferentes
para cada instância de elemento de $A$, etc.
Observe também que todos esses objetos que escrevemos juxtaposicionando
elementos e subconjuntos de $G$ são subconjuntos de $G$ se usamos
pelo menos um subconjunto de $G$ na expressão:
$$
\xalignat2
g_1abg_5ab' &\in G
&
g_1aBg_5ab' &\subseteq G.
\endxalignat
$$
Finalmente, \emph{confira} que graças à associatividade da operação do grupo $G$,
não precisamos botar parenteses:
$$
g_1ABg_2B\ginv{g_3}Ag_1CB
=
g_1A(Bg_2B)\ginv{g_3}(Ag_1CB)
=
(g_1A)(Bg_2)(B\ginv{g_3})(Ag_1)(CB)
= \dotsb
$$
etc.
%%}}}

%%{{{ eg: cosets_of_K_subgroup_S3 
\example.
\label{cosets_of_K_subgroup_S3}%
Para o subgrupo $K \subgroup S_3$
$$
K \leteq \set{ \id, \psi\phi }
$$
Calcule todos os left e right cosets de $K$,
e decida se as duas colecções são iguais.

\solution
Queremos calcular primeiramente todas as coclasses de $K$.
Como $\gord K = 2$, e o $G$ tem $6$ membros em total,
sabemos que o $K$ tem $3$ coclasses esquerdas, e $3$ coclasses direitas:
$$
\xalignat4
\text{esquerdas:} &  & K &= \set {\id, \psi\phi }  &   \holed? K &= \set{\holed?,\holed?}  &  \holed? K &= \set{ \holed?, \holed? }   \\
\text{direitas:}  &  & K &= \set {\id, \psi\phi }  &   K\holed?  &= \set{\holed?,\holed?}  &  K\holed?  &= \set{ \holed?, \holed? }
\endxalignat
$$
Vamos escolher o primeiro representante para escrever a primeira coclasse esquerda ``própria'' de $K$.
Temos $4$ opções, pois se escolher qualquer um dos dois membros do $K$, vamos ``cair'' na mesma coclasse $K$.
Escolhemos o $\psi$.  Calculamos:
$$
\psi K = \set { \psi, \psi\psi\phi } = \set { \psi, \psi^2\phi } = \set { \psi, \phi\psi }.
$$
Observe que seria a mesma coclasse esquerda, se tivemos escolhido o $\phi\psi$.
Vamos calcular a última.  Qual seria o represetante agora?
Precisamos evitar todos os membros de $K$ e de $\psi K$.
Vamos escolher o $\phi$, e bora calular o $\phi K$.  Ou não?
Não precisamos fazer nenhum cálculo, pois so sobraram $2$ membros de $S_3$, então esses $2$ formam a última coclasse esquerda:
$$
\phi K = \set { \phi, \psi^2 }.
$$
Basta calcular as coclasses direitas agora.  Para a primeira, escolhemos de novo o $\psi$, já que observamos que $\psi\notin K$.  Calculamos:
$$
K \psi = \set { \psi, \psi\phi\psi } = \set { \psi, \phi }
$$
Qual seria o representante ta próxima?  Aqui não pode ser novamente o $\phi$, pois o $\phi$ apareceu no $K\psi$.
Escolhemos um dos dois restantes então, vamos tomar o $\psi^2$, e junto com o último restante ele forma a última coclasse direita:
$$
K \psi^2 = \set { \psi^2, \phi\psi }.
$$
Finalmente achamos todas:
$$
\xalignat4
\text{esquerdas:} &  & K &= \set {\id, \psi\phi }  &   \psi K &= \set{\psi, \phi\psi}  &  \phi K   &= \set{ \phi, \psi^2 }   \\
\text{direitas:}  &  & K &= \set {\id, \psi\phi }  &   K\psi  &= \set{\phi, \psi}      &  K\psi^2  &= \set{ \psi^2, \phi\psi }.
\endxalignat
$$
Para responder na pergunta, precisamos comparar as duas \emph{colecções}, ou seja a pergunta é:
$$
\set{ K, \psi K, \phi K }
\askeq
\set{ K, K\psi, K\psi^2 }
$$
e facilmente observamos que não são iguais, pois, por exemplo,
$\psi K$ não é igual a nenhuma das coclasses direitas,
algo que verificamos comparando o conjunto $\psi K$
com cada um dos conjuntos $K, K\psi, K\psi^2$.
\endexample
%%}}}

%%{{{ x: cosets_of_H_N_subgroup_S3 
\exercise.
\label{cosets_of_H_N_subgroup_S3}%
Calcule todos os left e right cosets dos
$$
\xalignat3
H &\leteq \set{ \id, \phi }&
N &\leteq \set{ \id, \psi, \psi^2 }
\endxalignat
$$
Quantos right-cosets diferentes cada um deles tem?
Quantos left?  Explique sua resposta.
Os conjuntos de todos os right-cosets de $H$ é igual
com o conjunto de todos os left-cosets de $H$?
Similarmente para os $K$ e $N$.

\endexercise
%%}}}

%%{{{ df: conjugate_of_group_element 
\definition Conjugado.
\label{conjugate_of_group_element}%
\tdefined{conjugado}[de elemento de grupo]%
Seja $G$ grupo e $a\in G$.
Para qualquer $g\in G$, o $ga\ginv g$ é chamado
um \dterm{conjugado} de $a$.
%%}}}

%%{{{ x: is_conjugate_of_is_a_releq
\exercise.
\label{is_conjugate_of_is_a_releq}%
Seja $G$ um grupo.
A relação $\sim$ definida pela
$$
\align
a \sim b
&\defiff \text{$a$ é um conjugado de $b$}\\
&\iff \lexists {g\in G} {a = gb\ginv g}
\endalign
$$
é uma relação de equivalência.

\solution
\proofpart{Reflexividade:}
Seja $a \in G$.
Procuramos $g\in G$ tal que $a = ga\ginv g$.
Como $a = e a \ginv e$, temos que realmente $a \sim a$.
\endgraf
\proofpart{Simetria:}
Sejam $a,b \in G$ tais que $a \sim b$.
Daí, seja $x\in G$ tal que $a = xb\ginv x$.
Operando pela esquerda com $\ginv x$ e pela direita com $x$, temos:
$$
\ginv x a x = \ginv x x b \ginv x x = b.
$$
Mas $x = \ginvp {\ginv x}$, ou seja
$b = \ginv x a \ginvp{\ginv x}$
e logo $b \sim a$.
\endgraf
\proofpart{Transitividade:}
Sejam $a,b,c \in G$ tais que $a \sim b$ e $b \sim c$.
Daí, sejam $x,y \in G$ tais que:
$$
\alignat2
a &= x b \ginv x \\
b &= y c \ginv y.
\intertext{Substituindo a segunda na primeira, temos}
a &= x \paren{ y c \ginv y } \ginv x                \\
  &= \paren{ xy } c \paren{ \ginv y \ginv x} \qqby{ass.}\\
  &= \paren{ xy } c \ginvp{ xy }.            \qqby{inverso de produto (\refn{inverse_of_product_in_group})}
\endalignat
$$
Ou seja, $a \sim c$.

\endexercise
%%}}}

%%{{{ df: normal_subgroup 
\definition Subgrupo normal.
\label{normal_subgroup}%
\tdefined{subgrupo}[normal]%
\sdefined{\holed N \normal \holed G}{$\holed N$ é um subgrupo normal de $\holed G$}%
\iisee{normal}{subgrupo normal}%
Seja $G$ grupo e $N\subgroup G$.
O $N$ é um \dterm{subgrupo normal} de $G$
sse $N$ é fechado sobre os conjugados.
Em símbolos,
$$
\align
N \normal G
&\defiff
\pforall {n\in N}
\lforall{g\in G}
{ gn\ginv g \in N }\\
&\iff
\pforall {g\in G}
\munderbrace {
\lforall{n\in N}
{ gn\ginv g \in N }
} 
{ gN\ginv g \subseteq N }.
\endalign
$$
%%}}}

\blah.
Seguem umas definições alternativas.

%%{{{ lemma: normal_subgroup_altdef_gNginvg_eq_N 
\lemma.
\label{normal_subgroup_altdef_gNginvg_eq_N}%
\ii{subgrupo!normal}%
Sejam $G$ grupo, e $N\subgroup G$.
$$
N\normal G
\iff
\lforall{g\in G}
{gN\ginv g = N}.
$$
\sketch.
A \rldir\ é trivial, pois o que precisamos provar ($N \normal G$) é obviamente uma afirmação mais fraca da nossa hipótese.
Para a \lrdir, suponha $N \normal G$ e seja $g\in G$.  Ja temos a inclusão $gN\ginv g \subseteq N$, então só basta provar
a $N \subseteq gN\ginv g$.  Seja $n \in N$.
Como $n \in N$ e $N$ normal, temos $\ginv g n \ginvp{\ginv g} \in N$.
Logo
$$
\munderbrace {g \paren{\ginv g n \ginvp{\ginv g}} \ginv g} {=n} \in gN\ginv g.
$$
\qes
%%}}}

%%{{{ lemma: normal_subgroup_altdef_gN_eq_Ng 
\lemma.
\label{normal_subgroup_altdef_gN_eq_Ng}%
\ii{subgrupo!normal}%
Sejam $G$ grupo, e $N\subgroup G$.
$$
N\normal G
\iff
\lforall{g\in G}
{gN = Ng}.
$$
\sketch.
Para a \lrdir, tome $g\in G$ e $x \in gN$.
Assim $x = gn$ para algum $n\in N$.
\qes
%%}}}

%%{{{ beware: g n g^{-1} \neq n 
\beware.
Se tivemos $N \normal G$ temos sim que $gn\ginv g \in N$,
mas isso \emph{não garanta} que $gn\ginv g = n$ não!
Sabemos que para todo $n\in N$, temos $gn\ginv g = n'$ \emph{para algum}
$n' \in N$, mas nada nos permite concluir que esse $n'$ é nosso $n$.
%%}}}

%%{{{ x: gnginvg_neq_n 
\exercise.
\label{gnginvg_neq_n}%
Ache um contraexemplo que mostra que não necessariamente
$gn\ginv g = n$, mesmo com $n\in N \normal G$.

\endexercise
%%}}}

%%{{{ x: cosets_of_subgroup_of_index_2 
\exercise.
\label{cosets_of_subgroup_of_index_2}
Se $H\subgroup G$ de indice $2$, então $H \normal G$.

\solution
Suponha $H\subgroup G$ com 
Precisamos mostrar que $aH = Ha$ para todo $a\in G$.
Como o índice de $H$ é 2, só tem 2 cosets, logo, fora do proprio $H$, seu
complemento $G\setminus H$ tem que ser um coset.
Agora para qualquer $aH$ com $a \notin H$, temos
$$
aH = G\setminus H = Ha.
$$

\endexercise
%%}}}

%%{{{ ex: inter_of_subgroup_and_normal_is_normal_in_subgroup 
\exercise.
\label{inter_of_subgroup_and_normal_is_normal_in_subgroup}%
Se $H\subgroup G$ e $N\normal G$, então $H\inter N \normal H$.

\hint
Temos $H \inter N \subgroup N \subgroup G$ como intersecção de subgrupos
(veja exercícios~\refn{intersection_of_subgroups_is_a_subgroup}
e~\refn{subgroup_is_an_order}).
Para mostrar que $H \inter N \normal H$,
tente provar que $H\inter N$ é fechado pelos conjugados no $H$.

\solution
Temos $H \inter N \subgroup N \subgroup G$ como intersecção de subgrupos
(veja exercícios~\refn{intersection_of_subgroups_is_a_subgroup}
e~\refn{subgroup_is_an_order}).
Basta mostrar que $H \inter N \normal H$,
ou seja, que $H\inter N$ é fechado pelos conjugados no $H$.
Tome $x \in H\inter N$ e $h\in H$.
Temos:
$$
\alignat2
h x \ginv h &\in H  \qqby{$H \subgroup G$}\\
h x \ginv h &\in N  \qqby{$N \normal G$}
\endalignat
$$
Logo $hx\ginv h \in H\inter N$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Quotient group 
\section O grupo quociente.

\note.
Acabamos de identificar certos subgrupos dum grupo $G$---que chamamos \dterm{normais}---com uma propriedade legal:
a colecção de todas as suas coclasses esquerdas e a mesma com a colecção
de todas as suas coclasses direitas.
Começando então com um $N\normal G$, podemos falar \emph{da} partição correspodente de $G$,
sem specificar se estamos considerando a colecção das coclasses esquerdas ou das direitas.
Ou seja, nesse caso, as duas relações de equivalência
$$
\bhole \cong \bhole \pmodl N
\qqqqtext{e}
\bhole \cong \bhole \pmodr N
$$
são a \emph{mesma} relação, e por isso escrevemos simplesmente
$$
\bhole \cong \bhole \pmod N.
$$
Vamos começar com um certo grupo $G$:
 e um subgrupo normal dele
$$
\tikzpicture%%{{{
\tikzi quogrpbefore;
\endtikzpicture
%%}}}
$$
Identificamos nele um subgrupo normal $N\normal G$.
Assim que fizermos isso, todo o $G$ se-arruma
graças à partição de todas as coclasses de $N$:
$$
\gathered
\tikzpicture%%{{{
\tikzi quogrpnormal;
\endtikzpicture
%%}}}
\endgathered
\qquad\leadsto\qquad
\gathered
\tikzpicture%%{{{
\tikzi quogrppartitioned;
\endtikzpicture
%%}}}
\endgathered
$$
E agora comece se afastar mais e mais, até não dá mais pra ver
os pontinhos \emph{dentro} dessas classes, e até as proprias
classes viram pontinhos:
$$
\tikzpicture%%{{{
\tikzi quogrpzoomout;
\endtikzpicture
%%}}}
$$
Denotamos esse conjunto por $\quogrp G N$:
$$
\quogrp G N = \setst {Ng} {g \in G}
$$
Observe que esse conjunto é o
\ii{conjunto}[quociente]{}\emph{conjunto quociente} de $G$
através da relação de congruência módulo $N$.%
\footnote{Lembra-se que dada qualquer relação de equivalência
num conjunto, definimos seu conjunto quociente?
Veja a~\ref{quoset}.}

%%{{{ Q: How can we turn the quotient set into a group? 
\question.
Como podemos definir uma operação interessante $\ast$
nos elementos de $\quogrp G N$, tal que o
$\sset {\quogrp G N} \ast$ vira um grupo?
Qual seria sua identidade, e para cada um dos seus membros,
qual seria o seu inverso?
%%}}}
\spoiler.

%%{{{ df: quogrp 
\definition Grupo quociente.
\label{quogrp}%
\tdefined{grupo}[quociente]%
\sdefined {\quogrp {{\holed G}} {{\holed N}}} {o grupo quociente de $\holed G$ por $\holed N$}%
Sejam $G$ grupo e $N \normal G$.
O conjunto
$$
\setst { Na } { a \in G }
\quad
\bigparen{ =
\setst { aN } { a \in G }
}
$$
com operação a $\ast$ definida pela
$$
H \ast K \defeq HK
$$
é chamado o \dterm{grupo quociente} de $G$ por $N$,
e é denotado por $\quogrp G N$.
%%}}}

\blah.
Para merecer esse nome, o $\quogrp G N$ deve ser um grupo mesmo.
Vamos provar isso agora.

%%{{{ prop: quogrp_is_a_group 
\proposition.
\label{quogrp_is_a_group}%
Sejam $G$ grupo e $N\normal G$.
O $\quogrp G N$ é um grupo.
\sketch.
Precisamos verificar as leis de grupo (G0)--(G3) para o $\quogrp G N$.
\endgraf
(G0):
Sejam $C,D \in \quogrp G N$.  Mostramos que $CD \in \quogrp G N$, ou seja,
escrevemos o $CD$ como $Nw$ para algum certo $w \in G$.
\endgraf
(G1):
Sejam $C,D,E \in \quogrp G N$.  Mostramos que $(CD)E = C(DE)$.
\endgraf
(G2):
Procuramos um membro de $\quogrp G N$ que satisfaz as leis de identidade.
O candidato óbvio é o próprio $N$.
Basta confirmar essa afirmação, ou seja, mostrar que para todo $C \in \quogrp G N$,
temos $NC = C = CN$.
\endgraf
(G3):
Para mostrar que cada um dos membros de $\quogrp G N$ tem um inverso,
seja $C\in \quogrp G N$, e mostre como achar o seu inverso.
Aqui o candidato que faz sentido considerar, seria o $N(\ginv c)$,
onde $c$ é qualquer membro de $C$.
\qes
%%}}}

\endsection
%%}}}

%%{{{ Symmetries 
\section Simetrias.

\TODO O que é uma simetria.

\note As simetrias dum triângulo equilátero.
\label{Dih3}%
$$
\tikzpicture
\tikzi dih3base;
\endtikzpicture
$$
$$
\tikzpicture
\tikzi dih3rot1;
\endtikzpicture
$$
$$
\tikzpicture
\tikzi dih3rot2;
\endtikzpicture
$$
$$
\tikzpicture
\tikzi dih3flip1;
\endtikzpicture
$$
$$
\tikzpicture
\tikzi dih3flip2;
\endtikzpicture
$$
$$
\tikzpicture
\tikzi dih3flip3;
\endtikzpicture
$$

\TODO Complete the figure.

\TODO Como definir uma operação no conjunto de simetrias do triângulo,
tal que ele vira um grupo.

\note Um primeiro exemplo de isomorfismo.

%%{{{ df: dih_n 
\definition Os grupos dihedrais.
\label{dih_n}%
\tdefined{grupo}[dihedral]%
\iisee{dihedral}{grupo dihedral}
%%}}}

%%{{{ x: dih4 
\exercise.
\label{dih4}%
Ache todas as simetrias num quadrado.

\hint
Todas as simetrias são 8.

\endexercise
%%}}}

%%{{{ x: gord_dih_n 
\exercise.
\label{gord_dih_n}%
Qual a $\gord{\dih n}$?

\endexercise
%%}}}

\note Diagramas Hasse.
\label{hasse_diagrams_first_encounter}%

%%{{{ x: dih_4_isomorphic_to_what 
\exercise.
\label{dih_4_isomorphic_to_what}%
Consegue achar um grupo diferente, que é isomórfico com o $\dih 4$?

\hint
Não pode ser o $S_4$ obviamente, por questão de tamanho!

\hint
Mas olhe dentro do $S_4$: no seus subgrupos!

\endexercise
%%}}}

%%{{{ x: rectangle_symmetries 
\exercise Simetrias de rectângulo.
\label{rectangle_symmetries}%
Ache todas as simetrias de rectângulo e estude seu grupo.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Morphisms 
\section Morfismos.
\label{Group_morphisms}%

%%{{{ Idea 
\note Idéia.
Queremos formalizar a idéia de <<o grupo $\dih 3$ \emph{parece com} o $S_3$>>.
O que precisa ser satisfeito (ou mostrado) para convencer alguém que,
no final das contas, trabalhar com um grupo $\cal A$ é \emph{essencialmente
a mesma coisa} de trabalhar com um grupo $\cal B$?
%%}}}

%%{{{ pseudodf: group_homomorphism_first_attempt 
\pseudodefinition Homomorfismo.
\label{group_homomorphism_first_attempt}%
Sejam $\cal A, \cal B$ grupos.
A função $\phi : A \to B$ é um \dterm{homomorfismo} de $\cal A$ para $\cal B$
sse ela \emph{preserve a estrutura de $\cal A$ no $\cal B$}.
%%}}}

%%{{{ Preserving the structure 
\note Preservando a estrutura.
Mas o que é a estrutura dum grupo?
Num grupo temos a sua operação (binária), podemos pegar inversos (operação unária),
e temos também em cada grupo um membro especial chamado identidade do grupo (constante).
Ou seja, \emph{preservar a estrutura} faz sentido significar as três coisas seguintes:
$$
\xalignat2
&\text{preservar a operação:}   & \phi(x \ast_A y)    &= \phi(x) \ast_B \phi(y)   \tag{i}   \\
&\text{preservar a identidade:} & \phi(e_A)           &= e_B                      \tag{ii}  \\
&\text{preservar os inversos:}  & \phi(\ginvt_A (x))  &= \ginvt_B\paren{\phi(x)}. \tag{iii} 
\endxalignat
$$
%%}}}

%%{{{ Two paths 
\note Dois caminhos.
Considere que temos uma \emph{função} $\phi$ de $\cal A$ para $\cal B$.
Comece no grupo $\cal A$ (o domínio de $\phi$) e tome uns membros
$a_1,\dots,a_n$ do seu carrier set $A$.
Faça quaisquer coisas aí que a estrutura de grupo te permite fazer:
tome inversos, combine eles com a operação do grupo, etc.
Assim tu chega num certo membro $x$ do grupo $\cal A$.
Agora use a $\phi$ nesse resultado $x$, passando assim
para um certo membro $y$ do grupo $\cal B$.
Alternativamente, \emph{começando com os mesmos membros}
$a_1,\dots,a_n$ do~$\cal A$,
use a~$\phi$~em cada um deles para passar no grupo $\cal B$,
chegando assim nuns membros $b_1,\dots,b_n$ do~$\cal B$.
Sendo num grupo agora, podes performar exatamente as mesmas operações, na mesma
ordem, nos correspondentes membros que tu fez antes (no grupo $\cal A$),
e assim tu chegarás num certo resultado $b$ no $\cal B$.
Vamos chamar a função $\phi$ um homomorfismo exatamente quando ela garanta que
em qualquer situação como essa, os dois caminhos de $\cal A$ para $\cal B$,
chegam no mesmo membro, ou seja, $b = y$.
%%}}}

%%{{{ note: Diagramas comutativos 
\note Diagramas comutativos.
Essa idéia é bem melhor desenhada do que escrita, usando diagramas comutativos.
Por exemplo, a lei (iii) é equivalente à comutatividade do diagrama seguinte:
$$
\cdopt{sep=2cm}
A   \ar[r, "\phi"]\ar[d, "\ginvt_A"'] \| B\ar[d, "\ginvt_B"]\ \\
A   \ar[r, "\phi"]                    \| B
\endcd
$$
%%}}}

%%{{{ x: cd for (i) 
\exercise.
Desenha um diagrama cuja comutatividade é a lei (i).

\solution
$$
\cdopt{sep=2cm}
A\times A   \ar[r, "\phi \times \phi"]\ar[d, "\ast_A"'] \| B\times B \ar[d, "\ast_B"]\ \\
A           \ar[r, "\phi"]                              \| B
\endcd
$$

\endexercise
%%}}}

%%{{{ Different structures for groups 
\note Diferentes estruturas para grupos.
Já viermos como definir ``grupo'' como conjunto estruturado usando três
estruturas diferentes:
$$
\xalignat3
\sset A {\ast_A} &
&\sset A {e_A, \ast_A} &
&\sset A {e_A, \ginvt_A, \ast_A}. &
\endxalignat
$$
Então, dependendo na estrutura que escolhemos para nossa definição
de grupo, precisamos definir ``morfismo'' em forma diferente:
No caso de estrutura $\sset A {\ast_A}$ o morfismo deve satisfazer
o~(i); no caso de $\sset A {e_A, \ast_A}$, os~(i)--(ii), e no caso
de $\sset A {e_A, \ginv{\phantom{\cdot}}, \ast_A}$ todos os~(i)--(iii).
Parece então que chegamos no primeiro ponto onde a estrutura
escolhida na definição de grupo será crucial.
Felizmente, como nos vamos provar logo após, as leis de grupo
são suficientes para garantir que qualquer função $\phi$ que
satisfaz apenas o~(i)~acima, obrigatoriamente satisfaz
os~(ii)~e~(iii) também!
Mesmo assim, vamos botar em nossa definição todos os~(i)--(iii),
pois isso captura melhor a idéia geral de ``homomorfismo''.
E assim que provar nossa afirmação ganhamos um critérion forte
para decidir se alguma função é um homomorfismo.
%%}}}

%%{{{ df: group_homomorphism 
\definition Homomorfismo.
\label{group_homomorphism}%
\tdefined{homomorfismo}%
Sejam $\cal A = \sset A {e_A, \ast_A}$ e $\cal B = \sset B {e_B, \ast_B}$ grupos.
A função $\phi : A \to B$ é um \dterm{homomorfismo} de $\cal A$ para $\cal B$
sse:
$$
\align
&\phi(e_A) = e_B\\
\text{para todo $x,y\in A$},\quad
&\phi(x \ast_A y) = \phi(x) \ast_B \phi(y)\\
\text{para todo $x\in A$},\quad
&\phi(\ginv x) = \ginvp{\phi(x)}
\endalign
$$
As vezes escrevemos $\phi : \cal A \to \cal B$ (em vez de $\phi:A\to B$)
para enfatisar que o $\phi$ nos leva do \emph{grupo} $\cal A$ para o
\emph{grupo} $\cal B$.
%%}}}

%%{{{ note: safe juxtaposition 
\note.
Quando pelo contexto podemos inferir qual é a operação involvida,
optamos para denotá-la com juxtaposição como produto mesmo.
Por exemplo, escrevemos:
$$
\text{para todo $x,y\in A$},
\quad
\phi(xy) = \phi(x)\phi(y)
$$
sem ambiguidade nenhuma:
o $xy$ que aparece no lado esquerdo,
só pode denotar o $x \ast_A y$, pois $x,y \in A$.
,o outro lado, o $\phi(x) \phi(y)$ só pode denotar o $\phi(x) \ast_B \phi(y)$,
pois $\phi(x),\phi(y) \in B$.
A mesma coisa acontece com os inversos:
$\phi(\ginv x)$ só pode denotar ``a imagem do inverso (no $A$) de $x$'',
e $\ginvp{\phi(x)}$ só pode denotar ``o inverso (no $B$) de $\phi(x)$'',
pois, no primeiro caso o $\ginv{}$ é aplicado num membro de $A$,
e no segundo caso num membro de $B$.
%%}}}

%%{{{ criterion: in_groups_respecting_products_means_morphism 
\criterion de homomorfismo.
\label{in_groups_respecting_products_means_morphism}%
Sejam grupos $\cal A = \sset A {\ast_A}$ e $\cal B = \sset B {\ast_B}$,
e função $\phi : \cal A \to \cal B$ que preserva a operação, ou seja, tal que
$$
\align
\phi(x \ast_A y) &= \phi(x) \ast_B \phi(y)
\quad\text{para todo $x,y\in A$}.\\
\intertext{Então:}
\phi(e_A)     &= e_B             \tag{i}  \\
\phi(\ginv x) &= \ginvp{\phi(x)} \text{para todo $x\in A$}. \tag{ii} 
\endalign
$$
\sketch.
Para o~(i), calculamos $\phi(e_A) = \phi(e_A) \phi(e_A)$
para concluir que $e_B = \phi(e_A)$;
para o~(ii), mostramos que o $\phi(\ginv x)$ satisfaz a
propriedade característica de ser inverso de $\phi(x)$:
$$
\phi(\ginv x) \phi(x) = e_B.
$$
\qes
%%}}}

%%{{{ df: group_morphisms 
\definition -morfismos.
\label{group_morphisms}%
\tdefined{morfismo}%
\tdefined{homomorfismo}%
\tdefined{epimorfismo}%
\tdefined{monomorfismo}%
\tdefined{isomorfismo}%
\tdefined{endomorfismo}%
\tdefined{automorfismo}%
Sejam grupos $\cal A$ e $\cal B$, e $\phi : \cal A \to \cal B$ um homomorfismo.
Usamos os termos:
$$
\align
\text{$\phi$ monomorfismo} &\defiff \text{$\phi$ injetora}\\
\text{$\phi$ epimorfismo}  &\defiff \text{$\phi$ sobrejetora}\\
\text{$\phi$ isomorfismo}  &\defiff \text{$\phi$ monomorfismo~\&~epimorfismo}\\
\text{$\phi$ endomorfismo} &\defiff \text{$\dom\phi = \cod\phi$}\\
\text{$\phi$ automorfismo} &\defiff \text{$\phi$ endomorfismo~\&~isomorfismo}
\endalign
$$
{Rascunho:}
$$
\align
\text{mono} &= \text{injetora}\\
\text{epi}  &= \text{sobre}\\
\text{iso}  &= \text{mono $+$ epi}\\
\text{endo} &= \text{$\phi : \cal A \to \cal A$}\\
\text{auto} &= \text{endo $+$ iso}
\endalign
$$
%%}}}

%%{{{ df: isomorphic_groups 
\definition Grupos isomórficos.
\label{isomorphic_groups}%
\tdefined{grupo}[isomórficos]%
Sejam grupos $G$ e $G'$.
Chamamos o $G$ \dterm{isomórfico} com o $G'$ sse
existe isomorfismo $\phi : G \to G'$.
Escrevemos $G \iso G'$.
Escrevemos também $\phi : G \iso G'$ para ``$\phi$ é um isomorfismo de $G$ para $G'$''.
%%}}}

%%{{{ x: isomorphic_is_an_equivalence_relation 
\exercise.
\label{isomorphic_is_an_equivalence_relation}%
Mostre que $\isomorphic$ é uma relação de equivalência.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Kernel and Image 
\section Kernel e Image.

%%{{{ df: kernel 
\definition Kernel.
\label{kernel}%
\tdefined{kernel de homomorfismo}%
\sdefined {\ker{\holed \phi}} {o kernel do homomorfismo $\holed \phi$}
Sejam $G, G'$ grupos e $\phi$ um homomorfismo de $G$ para $G'$.
Definimos
$$
\align
\ker\phi
&\defeq
\set { g \in G \st \phi(g) = e_{G'} }\\
&=
\pre{\phi}{\set{e_{G'}}}
\endalign
$$
e o chamamos o \dterm{kernel} do $\phi$.
%%}}}

%%{{{ x: kernel_subgroup 
\exercise.
\label{kernel_subgroup}%
Sejam $G$ e $G'$ grupos e $\phi$ um homomorfismo de $G$ para $G'$.
Prove que $\ker\phi\subgroup G$.

\hint
Graças ao~\ref{subgroup_criterion}, precisas provar:
(i)~$\ker\phi$ é~$\ast$-fechado;
(ii)~$\ker\phi$ é~$^{-1}$-fechado.

\hint
Para o (i), tome $x,y\in\ker\phi$ e mostre que $xy\in\ker\phi$, ou seja, que $\phi(xy) = e_{G'}$.

\hint
Para o (ii), tome $x\in\ker\phi$ e mostre que $\ginv x\in\ker\phi$, ou seja, que $\phi\funparen{\ginv x} = e_{G'}$.

\solution
Graças ao~\ref{subgroup_criterion}, basta provar:
\endgraf
\proofpart{$\ker\phi$ é fechado pela operação:}
Sejam $x,y\in\ker\phi$.
Precisamos mostrar que $xy\in\ker\phi$, ou seja, que $\phi(xy) = e_{G'}$.
Calculamos:
$$
\alignat2
\phi(xy)
&= \phi(x) \phi(y)  \qqby{$\phi$ homo (oper.)}\\
&= e_{G'} e_{G'}    \qqby{$x,y\in\ker\phi$}\\
&= e_{G'}           \qqby{def.~$e_{G'}$}
\endalignat
$$
\endgraf
\proofpart{$\ker\phi$ é fechado pelos inversos:}
Seja $x\in\ker\phi$.
Precisamos mostrar que $\ginv x\in\ker\phi$, ou seja, que $\phi\funparen{\ginv x} = e_{G'}$.
Calculamos:
$$
\alignat2
\phi\funparen{\ginv x}
&= \ginvp{\phi(x)}  \qqby{$\phi$ homo (inv.)}\\
&= \ginvp{e_{G'}}   \qqby{$x\in\ker\phi$}\\
&= e_{G'}           \qqby{inverso da identidade~(\ref{inverse_of_identity_in_group})}
\endalignat
$$

\endexercise
%%}}}

%%{{{ x: kernel_normal 
\exercise.
\label{kernel_normal}%
Sejam $G$ e $G'$ grupos e $\phi$ um homomorfismo de $G$ para $G'$.
Prove que $\ker\phi\normal G$.

\hint
Acabamos de provar que $\ker\phi\subgrp \cal G$ no~\ref{kernel_subgroup}.
Basta provar que $\ker\phi$ é fechado pelos conjugados.
Seja $n\in\ker\phi$ e tome $g\in G$.
Precisamos provar que o $g$-conjugado de $n$, também está no $\ker\phi$:
$gn\ginv g \in \ker\phi$.
Ou seja, basta verificar que realmente $\phi(gn\ginv g) = e_{\cal G'}$.

\solution
Seja $n\in\ker\phi$ e tome $g\in \cal G$.
Precisamos provar que o $g$-conjugado de $n$, também está no $\ker\phi$:
$gn\ginv g \in \ker\phi$.
Calculamos:
$$
\alignat2
\phi\funparen{gn\ginv g}
&= \phi(g) \phi(n) \phi\funparen{\ginv g}       \qqby{$\phi$ homo}\\
&= \phi(g) e_{\cal G'} \phi\funparen{\ginv g}   \qqby{$n\in\ker\phi$}\\
&= \phi(g) \phi\funparen{\ginv g}               \qqby{def.~$e_{\cal G'}$}\\
&= \phi(g) \ginvp{\phi(g)}                      \qqby{$\phi$ homo}\\
&= e_{\cal G'}                                  \qqby{def.~$\ginvp{\phi(g)}$}
\endalignat
$$
Logo $gn\ginv g\in\ker\phi$ como queremos provar.

\endexercise
%%}}}

%%{{{ x: kernel_normal_alt_proof 
\exercise.
\label{kernel_normal_alt_proof}%
Veja a prova completa do~\ref{kernel_normal}.
No seu cálculo, mostre como continuar num caminho diferente depois da terceira
igualdade para chegar no mesmo resultado desejado: $e_{G'}$.

\hint
Aplicamos a propriedade que homomorfismos preservem os inversos.
Aplique outra propriedade de homomorfismos.

\solution
Calculamos:
$$
\alignat2
\phi\funparen{gn\ginv g}
&= \phi(g) \phi(n) \phi\funparen{\ginv g}   \qqby{$\phi$ homo (oper.)}\\
&= \phi(g) e_{G'} \phi\funparen{\ginv g}    \qqby{$n\in\ker\phi$}\\
&= \phi(g) \phi\funparen{\ginv g}           \qqby{def.~$e_{G'}$}\\
&= \phi(g \ginv g)                          \qqby{$\phi$ homo (oper.)}\\
&= \phi(e_G)                                \qqby{def.~$\ginv g$}\\
&= e_{G'}                                   \qqby{$\phi$ homo (iden.)}
\endalignat
$$

\endexercise
%%}}}

%%{{{ x: image_subgroup 
\exercise.
\label{image_subgroup}%
Sejam $G$ e $G'$ grupos e $\phi$ um homomorfismo de $G$ para $G'$.
Prove que $\Img\phi\subgrp G'$.

\hint
Precisas mostrar que $\Img\phi$ é fechado pela operação e pelos conjuntos.

\hint
\proofpart{$\Img\phi$ fechado pela operação:}
Tome $a', b' \in \Img\phi$ e ache um $x\in\cal G$ tal que que $\phi(x) = a'b'$.
\endgraf\noindent
\proofpart{$\Img\phi$ fechado pelos conjuntos:}
Tome $a' \in \Img\phi$ e ache um $x\in\cal G$ tal que $\phi(x) = \ginvp{a'}$.

\solution
\proofpart{$\Img\phi$ fechado pela operação:}
Sejam $a', b' \in \Img\phi$.
Logo, sejam $a,b\in\cal G$ tais que $\phi a = a'$, e $\phi b = b'$.
Calculamos:
$$
\alignat2
\phi(ab)
&= \phi(a) \phi(b)  \qqby{$\phi$ homo (oper.)}\\
&= a' b'.           \qqby{pela escolha dos $a,b$}
\endalignat
$$
Ou seja, $a'b' \in \Img\phi$.
\endgraf\noindent
\proofpart{$\Img\phi$ fechado pelos conjuntos:}
Seja $a' \in \Img\phi$.
Logo, seja $a\in\cal G$ tal que $\phi a = a'$.
Calculamos:
$$
\alignat2
\phi(\ginv a)
&= \ginvp{\phi a}   \qqby{$\phi$ homo (inv.)}\\
&= \ginvp{a'}.      \qqby{pela escolha do $a$}
\endalignat
$$
Ou seja, $a'\in\Img\phi$.

\endexercise
%%}}}

%%{{{ thm: first_isomorphism_theorem_groups 
\theorem Primeiro teorema de isomorfismo.
\label{first_isomorphism_theorem_groups}%
\iisee{grupo!teorema de isomorfismo}{teorema de isomorfismo}%
\ii{teorema de isomorfismo}[primeiro (de grupos)]%
\iiseealso{isomorfismo}{teorema de isomorfismo}%
Sejam $\cal G, \cal H$ grupos e $\phi : \cal G \to \cal H$ homomorfismo.
\item{\rm (i)} $\ker\phi\normal \cal G$;
\item{\rm (ii)} $\Img\phi\subgrp \cal H$;
\item{\rm (iii)} $\quogrp G {\ker\phi} \iso \Img\phi$.
\sketch.
Acabamos de provar as (i)~\&~(ii) nos~\refn{kernel_normal}~\&~\refn{image_subgroup}.
Para a (iii) precisamos definir uma função
$$
\psi : \quogrp G {\ker\phi} \to \Img\phi
$$
tal que $\psi$ é um isomorfismo.
Seja $K \asseq \ker\phi$.
Queremos definir, para qualquer coclasse $Kx$ do $K$ pela
$$
\psi(Kx) = \phi(x).
$$
O problema é que $\psi$ não parece \emph{bem-definida}, pois seu valor
pode depender na escolha do representante $x$ da coclasse---veja
o~\ref{not_well_defined_function_danger} caso que o problema
com essa definição não é claro.
Precisamos melhorar essa definição e provar que realmente defina
uma \emph{função} $\psi$; que a $\psi$ é bijetora; que $\psi$ é
um homomorfismo (e logo isomorfismo), ou seja que $\psi$ preserva
a operação.
\qes
%%}}}

%%{{{ beware: not_well_defined_function_danger 
\beware.
\label{not_well_defined_function_danger}%
Caso que o perigo descrito no esboço acima não é óbvio, vamos
pensar como um programador querendo definir essa função $\psi$.
Sua função, quando chamada, recebe uma coclasse, ou seja,
um conjunto com certos elementos membros.
Ela não sabe qual foi o nome que o chamador escolheu para essa
coclasse.
Imagine alguém programando uma função $\code{foo}$
de $\code{int}$ para $\code{int}$ numa linguagem de programação.
O programador e sua função não têm como saber o \emph{nome}
que o chamador da função vai usar quando chamando-la.
Em algum ponto ela pode ser chamada pelo $\code{foo(42)}$
passando assim diretamente o \emph{literal} $\code{42}$,
ou, depois de umas atribuições como $\code{int a = 42; int num = 42;}$,
chamá-la $\code{foo(a)}$ ou $\code{foo(num)}$.
Não tem como programar a função depender nesses nomes.
Por exemplo:
<<se for chamada com nome que começa com vogal, retorna o inteiro 0;
caso contrário, retorna o inteiro 1>>;
ou
<<retorna o tamanho do nome do teu argumento>>
(querendo retornar $\code{1}$ caso que for chamada pelo $\code{foo(a)}$,
e $\code{3}$ caso que for chamada pelo $\code{foo(num)}$).
\endgraf
Mesmo se definir ela pela
$$
\psi(C) = \phi(c),\quad
\text{onde $c$ é algum membro de $C$}
$$
temos uma tarefa para fazer:
\emph{precisamos provar que seu valor $\psi(C)$ não depende na escolha de $c$}.
Até conseguir provar isso, não podemos considerar a $\psi$ uma função
\ii{função}[bem-definida]\emph{bem-definida}.
Veja bem a prova do~\ref{first_isomorphism_theorem_groups}.
%%}}}

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ Direct products 
\blah.
Lembre que já usamos $\times$ entre \emph{conjuntos} $A,B$ para formar seu
produto cartesiano $A \times B$; e também entre \emph{funções} $f : A \to B$,
$g : C \to D$ para formar seu produto
$f \times g : (A\times C) \to (B \times D)$.
Vamos agora sobrecarregar ainda mais esse $\times$:

\definition Produtos diretos.
Sejam $\cal G_1 = \sset {G_1} {\ast_1}$ e $\cal G_2 = \sset {G_2} {\ast_2}$ grupos.
Definimos o grupo
$$
\cal G_1 \times \cal G_2 = \sset {G_1 \times G_2} {{\ast_1} \times {\ast_2}}.
$$

\problem.
Prove que realmente é um grupo.

\endproblem
%%}}}

%%{{{ bust_proof_of_uniqueness_of_identity_in_group 
\problem.
\label{bust_proof_of_uniqueness_of_identity_in_group}%
Considere essa suposta prova da unicidade da identidade~(\ref{uniqueness_of_identity_in_group}):
\endgraf
<<Seja $G$ grupo e suponha que temos identidades $e_1,e_2 \in G$.
Seja $a\in G$.
Como $e_1$ é identidade, temos $a \ast \ginv a = e_1$\fact1.
Como $e_2$ é identidade, também temos $a \ast \ginv a = e_2$\fact2.
Pelas \byfact1~e~\byfact2, como os lados esquerdos são iguais, o lados direitos também são.
Ou seja, $e_1 = e_2$ que foi o que queremos provar.>>
\endgraf
Identifique todos os erros nessa tentativa de prova.

\endproblem
%}}}

%%{{{ prob: aut_G_is_a_group 
\problem.
\label{aut_G_is_a_group}%
Mostre que dado um grupo $G$, o conjunto de todos os seus automorfismos
$$
\Aut G
\defeq
\set{
\phi : G\bijto G
\st
\text{$\phi$ é um automorfismo}
}
$$
com operação $\compose$ é um grupo.

\endproblem
%%}}}

%%{{{ prob: bij_G_subgrp_aut_G 
\problem.
\label{aut_G_subgrp_bij_G}%
Sabendo que $\namedop{Bij} G \defeq \sset {(G \bijto G)} {\compose}$ é um grupo,
mostre que
$$
\Aut G \subgroup \namedop{Bij} G.
$$

\hint
Se $F$ é injetora, então $x=y \impliedby F(x) = F(y)$.

\solution
Como $\Aut G \subseteq \namedop{Bij} G$, precisamos verificar apenas que $\Aut G$ é:
\endgraf\noindent
\proofpart{Fechado pela operação:}
Tome $\phi,\psi\in\Aut G$, e $x,y\in G$.  Calculamos:
$$
\alignat2
(\phi\compose\psi)(x\cdot y)
&=\phi\paren{\psi(x\cdot y)}                                    \qqby{def.~$\compose$}\\
&=\phi\paren{\psi(x) \cdot \psi(y)}                             \qqby{$\psi$ homo}\\
&=\phi\paren{\psi(x)} \cdot \phi\paren{\psi(y)}                 \qqby{$\phi$ homo}\\
&=\paren{\phi\compose\psi}(x) \cdot \paren{\phi\compose\psi}(y). \qqby{def.~$\compose$}
\endalignat
$$
\endgraf\noindent
\proofpart{Fechado pelos inversos:}
Tome $\phi\in\Aut G$.
Precisamos verificar que a bijecção $\phi^{-1}$
é realmente um homomorfismo.
Ou seja, precisamos mostrar que
$$
\phi^{-1}(x\cdot y) = \phi^{-1}(x)\cdot \phi^{-1}(y)
$$
para todos os $x,y\in G$.
Seguindo a dica, basta provar que
$$
\phi\paren{\phi^{-1}(x\cdot y)} = \phi\paren{\phi^{-1}(x)\cdot \phi^{-1}(y)}
$$
O lado esquerdo é igual ao $x\cdot y$.
Calculamos o lado direito:
$$
\alignat2
\phi\paren{\phi^{-1}(x) \cdot \phi^{-1}(y)}
&=\phi\paren{\phi^{-1}(x)} \cdot \phi\paren{\phi^{-1}(y)}   \qqby{$\phi$ homo}\\
&=x\cdot y.  \qqby{def.~$\phi^{-1}$}
\endalignat
$$

\endproblem
%%}}}

%%{{{ df: group_center 
\definition Centro.
\label{group_center}%
\tdefined{grupo}[centro]%
\sdefined{Z(\holed G)} {o centro do grupo $\holed G$}%
Dado um grupo $G$, definimos seu \dterm{centro} $Z(G)$
como o conjunto de todos os membros de $G$ que ``comutam'' com todos os membros de $G$:
$$
Z(G) \defeq \setstt {z \in G} {para todo $g\in G$, $zg = gz$}.
$$
%%}}}

%%{{{ prob: center_G_is_a_subgroup 
\problem.
\label{center_G_is_a_subgroup}%
Mostre que dado um grupo $G$, seu centro $Z(G)\subgrp G$.

\solution
Como $Z(G) \subseteq G$, precisamos apenas mostrar que:
\endgraf\noindent
\proofpart{Fechado pela operação:}
Sejam $x,y\in Z(G)$.
Para provar que $xy\in Z(G)$,
verificamos que o $(xy)$ comuta com todos os elementos de $G$.
Seja $g\in G$.
Calculamos:
$$
\alignat2
(xy)g
&= x(yg)  \qqby{(G1)}\\
&= x(gy)  \qqby{$g\in Z(G)$}\\
&= (xg)y  \qqby{(G1)}\\
&= (gx)y  \qqby{$g\in Z(G)$}\\
&= g(xy). \qqby{(G1)}
\endalignat
$$
\endgraf\noindent
\proofpart{Fechado pelos inversos:}
Seja $x\in Z(G)$.
Para provar que $\ginv x\in Z(G)$,
verificamos que o $\ginv x$ comuta com todos os elementos de $G$.
Seja $g\in G$.
Calculamos:
$$
\alignat2
(\ginv x)g
&= \ginvp{\ginv g x}       \qqby{$G$ grupo}\\
&= \ginvp{x \ginv g}       \qqby{$x \in Z(G)$}\\
&= \ginvp{\ginv g} \ginv x \qqby{$G$ grupo}\\
&= g \ginv x.              \qqby{$G$ grupo}
\endalignat
$$

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

Para practicar com propriedades de operações vale a pena
resolver os primeiros 15 problemas do~\cite{halmoslapb}.

Livros introdutórios em álgebra abstrata tratam em geral
a teoria dos grupos mais profundamente que podemos tratar aqui.
\cite{pinteralgebra} é um desses livros, bastante acessível,
com exemplos de diversas áreas, mostrando várias aplicações.
Uma \emph{excelente} introdução em vários tópicos de álgebra é
o~\cite{hersteintopics}, famoso para sua exposição e didática.

A álgebra abstrata foi introduzida nos currículos de graduação
com o clássico~\cite{babybm}.  Os mesmos autores, no~\cite{papamb},
apresentam álgebra mais profundamente e com um cheiro
categórico (veja~\ref{Category_theory}).
O bem-legível \cite{aluffialgebra} começa já introduzindo a linguagem
e as idéias das categorias e trata assim todos os assuntos principais
de álgebra abstrata.

Depois de se acostumar com as idéias algébricas em geral,
dois livros focados especialmente em teoria dos grupos
são os~\cite{rosegroups} e~\cite{rotmangroups}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Estruturas algébricas 
\chapter Estruturas algébricas.
\label{Algebraic_structures}%

%%{{{ Monoids 
\section Monóides.
\label{Monoids}%

%%{{{ df: monoid 
\definition Monóide.
\label{monoid}%
\tdefined{monóide}%
Um conjunto estruturado $\cal M = \sset M {\epsilon, \cdot}$
é um \dterm{monóide} sse:
$$
\alignat2
\pforall {a,b\in M}    &\bracket{a\cdot b \in G}                       &\tag{G0}\\
\pforall {a,b,c\in M}  &\bracket{a\cdot(b\cdot c) = (a\cdot b)\cdot c} &\tag{G1}\\
\pforall {a\in M}      &\bracket{\epsilon\cdot a = a = a\cdot\epsilon} &\tag{G2}
\endalignat
$$
Naturalmente, se a $\cdot$ é comutativa chamamos-lo \dterm{monóide comutativo}.
%%}}}

%%{{{ eg: nats 
\example.
Os naturais com adição formam um monóide.
\endexample
%%}}}

%%{{{ eg: strings 
\example.
Considere um alfabeto finito $\Sigma$ e seja $S$ o conjunto de todos strings formados por letras do $\Sigma$.
O $S$ com a operação a concatenação de strings, é um monóide.  Sua identidade é o string vazio.
\endexample
%%}}}

\question.
Como tu definirias o homomorfismo entre monóides?
\spoiler.

%%{{{ df: monoid_homomorphism 
\definition Homomorfismo.
\label{monoid_homomorphism}%
\tdefined{homomorfismo}[de monóide]
Sejam $\cal M = \sset M {\epsilon_M, \cdot_M}$
e $\cal N = \sset N {\epsilon_N, \cdot_N}$ monóides.
Uma função $\phi : M \to N$ é um \dterm{homomorfismo} sse:
\beginol
\li $\phi(\epsilon_M) = \epsilon_N$;
\li para todo $x,y\in M$,\quad $\phi(x \cdot_M y) = \phi(x) \cdot_N \phi(y)$.
\endol
%%}}}

%%{{{ x: in_monoids_preservation_of_oper_does_not_imply_preservation_of_identity 
\exercise.
\label{in_monoids_preservation_of_oper_does_not_imply_preservation_of_identity}%
Podemos provar um critérion parecido com
o~\ref{in_groups_respecting_products_means_morphism} para os monóides?
Ou seja, se $\phi$ preserva a operação do monóide,
ela necessariamente preserva a identidade também?

\hint
Não!
Mas como podemos provar que não tem como provar isso?

\endexercise
%%}}}

%%{{{ x: monoid_epimorphism_criterion 
\exercise Critérion.
\label{monoid_epimorphism_criterion}%
Uma função sobrejetora $\phi : M \surto N$ tal que
$$
\text{para todo $x,y\in M$},\quad
\phi(x \cdot_M y) = \phi(x) \cdot_N \phi(y)
$$
é um homomorfismo (e logo um epimorfismo).

\hint
Precisamos provar que $\phi(\epsilon_M) = \epsilon_N$.
Como podemos ler essa igualdade em lingua (mais) natural?

\hint
Queremos: <<o $\phi(\epsilon_M)$ é a identidade do $\cal N$>>.
O que significa <<ser a identidade dum monóide>>?
Ou seja, o que precisamos provar sobre esse objeto, $\phi(\epsilon_M)$
para mostrar que realmente ele é a identidade?

\hint
Precisamos provar que:
$$
\lforall {n \in N} {n \cdot_N \phi(\epsilon_M) = n = \phi(\epsilon_M) n}.
$$
Como começaria essa prova?

\hint
``Seja $n \in N$.''
Depois dessa frase, queremos provar que
$$
n \cdot_N \phi(\epsilon_M) = n = \phi(\epsilon_M) n.
$$

\hint
Já provamos no~\ref{in_monoids_preservation_of_oper_does_not_imply_preservation_of_identity} que não tem como ganhar a preservação da identidade como conseqüência da preservação da operação tendo uma função $\phi : M \to N$ qualquer.  Então com certeza precisamos usar nossa hipótese nova aqui, que a $\phi$ é sobrejetora.

\hint
Seja $n \in N$.
Como $\phi$ é sobrejetora, tome $m \in M$ tal que $\phi(m) = n$.

\solution
Precisamos provar que $\phi(\epsilon_M) = \epsilon_N$, ou seja, que para todo $n\in N$, 
$$
n \cdot_N \phi(\epsilon_M) = n = \phi(\epsilon_M) \cdot_N n.
$$
Seja $n \in N$.
Logo $n = \phi(m)$ para algum $m \in M$.
Calculamos:
$$
\alignat2
n\cdot_N \phi(\epsilon_M)
&= \phi(m) \cdot_N \phi(\epsilon_M) \qqby{pela escolha do $m$}\\
&= \phi(m \cdot_M \epsilon_M)       \qqby{$\phi$ homo (oper.)}\\
&= \phi(m)                          \qqby{pela (G2)}\\
&= n                                \qqby{pela escolha do $m$}
\endalignat
$$
Similarmente, $n = \phi(\epsilon_M) \cdot_N n$.

\endexercise
%%}}}

%%{{{ eg 
\example.
Considere os monóides $\cal N = \sset \nats {0, +}$ e $\cal B = \sset B {\epsilon, \concat}$,
onde $S$ é o conjunto de todos os strings (finitos) formados por o alfabeto
$\Sigma = \set{\digit 0,\digit 1}$, $\epsilon$ é o string vazio ``$\,$'', e~$\concat$ a concatenação.
A $\phi : \cal N \to \cal B$ definida recursivamente pelas
$$
\align
\phi(0)     &= \epsilon\\
\phi(n+1)   &= \phi(n) \concat \digit0
\endalign
$$
é um monomorfismo.
A $\namedfun{length} : \cal B \to \cal N$ que retorna o tamanho da sua entrada é um epimorfismo.
\endexample
%%}}}

%%{{{ noneg 
\nonexample.
Com o contexto do exemplo anterior, a $\psi : \cal N \to \cal B$
definida recursivamente pelas:
$$
\align
\psi(0)     &= \epsilon\\
\psi(n+1)   &=
\knuthcases{
 \psi(n) \concat \digit0, & se $\psi(n)$ não termina com $\digit0$\cr
 \psi(n) \concat \digit1, & caso contrário
}
\endalign
$$
não é um homomorfismo.
\endnonexample
%%}}}

%%{{{ x: why? 
\exercise.
Por quê?

\solution
Temos:
$$
\psi(1+1)
= \digit0\digit1
\neq \digit0\digit0
= \psi(1)\concat\psi(1).
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Rings 
\section Aneis.
\label{Rings}%

\blah.
Vamos estudar pouco a estrutura de \emph{anel},
cuja definição foi dada primeiramente por \Fraenkel{}Fraenkel.
Nossa inspiração e guia para os grupos, foram os mapeamentos e as permutações.
Para os anéis, nossa guia são os inteiros.

%%{{{ df: ring 
\definition Anel.
\label{ring}%
\tdefined{anel}%
\tdefined{anel}[comutativo]%
Seja $\cal R = \sset R {0, 1, \plus, \times}$ um conjunto estruturado,
onde $0,1$ são constantes e $\plus,\times$ são operações binárias.
$\cal R$ é um \dterm{anel} (ou \dterm{ring}) sse
$$
\alignat2
\pforall {a,b\in R}                 &\bracket{a\plus b \in R}                          &\tag{RA0} \\
\pforall {a,b,c\in R}               &\bracket{a\plus(b\plus c) = (a\plus b)\plus c}    &\tag{RA1} \\
\pforall {a \in R}                  &\bracket{0\plus a = a = a\plus 0}                 &\tag{RA2} \\
\pforall {a\in R} \pexists {y\in R} &\bracket{y\plus a = 0 = a \plus y}                &\tag{RA3} \\
\pforall {a,b\in R}                 &\bracket{a\plus b = b \plus a}                    &\tag{RA4} \\
\pforall {a,b\in R}                 &\bracket{a\times b \in R}                         &\tag{RM0} \\
\pforall {a,b,c\in R}               &\bracket{a\times(b\times c) = (a\times b)\times c}&\tag{RM1} \\
\pforall {a \in R}                  &\bracket{1\times a = a = a\times 1}               &\tag{RM2} \\
\pforall {a,b,c \in R}              &\bracket{a\times (b \plus c) = (a\times b) \plus (a \times c)}  &\tag{RDL}\\
\pforall {a,b,c \in R}              &\bracket{(b \plus c)\times a = (b\times a) \plus (c \times a)}  &\tag{RDR}\\
\intertext{Caso que também é satisfeita a lei}
\pforall {a,b\in R}                 &\bracket{a\times b = b \times a}                  &\tag{RM4}
\endalignat
$$
chamamos o $\cal R$ \dterm{anel comutativo}.
%%}}}

%%{{{ x: ring_definition_using_groups 
\exercise.
\label{ring_definition_using_groups}%
Como podemos definir o que é um anel usando definições de estruturas algébricas que já conhecemos?

\solution
Seja $\cal R = \sset R {0, 1, \plus, \times}$ um conjunto estruturado,
onde $0,1$ são constantes e $\plus,\times$ são operações binárias.
O $\cal R$ é um \dterm{anel} sse:
\item{(i)} $\sset R {0, \plus}$ é um grupo abeliano;
\item{(ii)} $\sset R {1, \times}$ é um monóide;
\item{(iii)} as seguindes leis são satisfeitas:
$$
\alignat2
\pforall {a,b,c \in R} &\bracket{a\times (b \plus c) = (a\times b) \plus (a \times c)}  &\tag{RDL}\\
\pforall {a,b,c \in R} &\bracket{(b \plus c)\times a = (b\times a) \plus (c \times a)}  &\tag{RDR}
\endalignat
$$

\endexercise
%%}}}

%%{{{ note: notation 
\note Notação.
Dado $x\in R$, denotamos com $(-x)$ o objeto garantido pela~(RA3).
Seguindo nossa experiência com adição e multiplicação de números,
adoptamos as mesmas convenções para os anéis: denotamos pela juxtaposição
a ``multiplicação'' do anel, e consideramos que ela tem precedência contra a ``adição''.
Note também que como não temos alguma operação binária $-$ de subtraição,
a expressão $x-y$ num anel não é definida.
Introduzimos aqui sua definição como açúcar sintáctico:
$$
\align
x - y   &\sugareq x + (-y)
\intertext{Similarmente, se $n\in\nats$, usamos:}
nx      &\sugareq \toverbrace{x + x + \dotsb + x} {$n$ vezes}\\
x^n     &\sugareq \tunderbrace{x x \dotsb x} {$n$ vezes}
\endalign
$$
%%}}}

%%{{{ eg: first_ring_examples 
\example.
\label{first_ring_examples}%
Todos os seguintes conjuntos são exemplos de anéis:
$$
\xalignat7
&\sset \ints        {+,\ntimes}&
&\sset \rats        {+,\ntimes}&
&\sset \reals       {+,\ntimes}&
&\sset \complex     {+,\ntimes}&
&\sset {\reals[x]}  {+,\ntimes}&
&\sset {C[a,b]}     {+,\ntimes}&
&\sset {\reals^{n\times n}} {+,\ntimes}
\endxalignat
$$
onde lembramos que
$\reals[x]$ é o conjunto de todos os polinómios numa variável $x$ com coeficientes
reais,
e $\reals^{n\times n}$ é o conjunto de todas as matrices reais $n\times n$.
Temos também
$$
C[a,b]
\defeq
\setstt {f : [a,b]\to\reals} {$f$ é contínua}
$$
para quaisquer $a,b\in\reals$ com $a\leq b$.
A adição e multiplicação no $C[a,b]$ são as
\emph{operações~\ii{pointwise}[operação]pointwise},
definidas pelas:
$$
\xalignat2
f + g       &= \lam x {f(x) + g(x)}         &
f \ntimes g &= \lam x {f(x) \ntimes g(x)}.
\endxalignat
$$
(Veja a~\ref{pointwise_operation}.)
\endexample
%%}}}

%%{{{ lemma: zero_annihilator_in_ring 
\lemma Zero aniquila.
\label{zero_annihilator_in_ring}%
Seja $R$ um anel.
Então:
$$
\text{para todo $x\in R$,}\quad
0x = 0 = x0.
$$
%%}}}

%%{{{ lemma: negation_of_product 
\lemma Negação de produto.
\label{negation_of_product}%
Seja $R$ um anel.  Logo,
$$
\text{para todos $a,b\in R$,}\quad
(-a)b = -(ab) = a(-b).
$$
%%}}}

%%{{{ corollary 
\corollary.
Em qualquer anel $\cal R$, para todos $x,y\in\cal R$ temos:
\item{\rm (i)}   $(-x)(-y) = xy$;
\item{\rm (ii)}  $(-1)x = -x$;
\item{\rm (iii)} $(-1)(-1) = 1$;
\item{\rm (iv)}  $-(x+y) = (-x) + (-y)$.
%%}}}

%%{{{ x: pset_with_setops_ring 
\exercise.
\label{pset_with_setops_ring}%
Seja $X$ conjunto.
Defina no $\pset X$ duas operações tais que $\pset X$ vira um anel.
Identifique quas são seus $0,1$ e prove que realmente é um anel.

\hint
Lembre o~\ref{pset_with_setops_group}?

\hint
Graças ao~\ref{pset_with_setops_group}, a adição do anel deve ser a $\symdiff$.

\hint
$\sset {\pset X} {\symdiff, \inter}$.

\endexercise
%%}}}

%%{{{ df: boolean_ring 
\definition Anel booleano.
\label{boolean_ring}%
\tdefined{anel}[booleano]%
Chamamos o anel $\cal R$ um \dterm{anel booleano} sse
sua multiplicação é \ii{idempotência}\emph{idempotente}, ou seja:
$$
\text{para todo $a\in \cal R$},\quad
a^2 = a.
$$
%%}}}

%%{{{ eg 
\example.
Dado conjunto $X$, o $\sset {\pset X} {\symdiff, \inter}$
é um anel booleano.
\endexample
%%}}}

%%{{{ x: boolean_rings_are_idempotent 
\exercise.
\label{boolean_rings_are_idempotent}%
Seja $\cal R$ um anel booleano.
Prove que:
$$
\
\text{para todo $p\in \cal R$},\quad
p = -p.
$$

\hint
Calcule o $(p+q)^2$.

\solution
Sejam $p,q \in R$.
Calculamos:
$$
\alignat2
(p+q)^2
&= (p+q)(p+q)           \\
&= (p+q)p + (p+q)q      \\
&= pp + qp + pq + qq    \\
&= p^2 + qp + pq + q^2  \\
&= p + qp + pq + q.     \qqby{$B$ booleano}
\endalignat
$$
Mas como $B$ é booleano temos também $(p+q)^2 = p+q$.
Ou seja
$$
\align
p + q &= p + qp + pq + q\\
\intertext{e cancelando os $p$ e $q$ ganhamos}
0 &= qp + pq    \tag{\fact{1}}
\endalign
$$
ou seja, $pq = -qp$.
\endgraf
Seja $a \in R$.
Calculamos:
$$
\alignat2
0
&= aa + aa      \qqby{tome $p\asseq a$ e $q \asseq a$}\\
&= a + a.       \qqby{$\cal R$ é booleano}
\endalignat
$$
logo, $a = -a$.

\endexercise
%%}}}

%%{{{ x: boolean_rings_are_commutative 
\exercise.
\label{boolean_rings_are_commutative}%
Cada anel booleano é comutativo.

\hint
Use o~\ref{boolean_rings_are_idempotent}.

\solution
Sejam $p,q \in R$.
Queremos mostrar que $pq = qp$.
Usando o~\ref{boolean_rings_are_idempotent} e
a~\byfact1~da sua resolução,
ganhamos
$$
pq + pq = 0 = qp + pq
$$
e cancelando os $pq$ na direita chegamos no $pq = qp$.
Ou seja, o $\cal R$ é comutativo.

\endexercise
%%}}}

%%{{{ Q: How would you define subring and ring homomorphism? 
\question.
Como tu definirias o conceito de subanel?
Pode definir algum critérion parecido com os critéria~\refn{subgroup_criterion}
ou~\refn{finite_subgroup_criterion} para decidir se algo é subanel dum dado anel?
E o homomorfismo de anel?  Como definirias isso?  E pode definir algum critérion
parecido com o~\refn{in_groups_respecting_products_means_morphism}?
\spoiler.
%%}}}

%%{{{ df: subring 
\definition Subanel.
\label{subring}%
\tdefined{subanel}%
Seja $\cal R$ um anel.
O $S\subseteq R$ é um \dterm{subanel} de $\cal R$ sse
$\sset S {0_R, 1_R, +_R, \cdot_R}$ é um anel.
%%}}}

%%{{{ criterion: subring_criterion 
\criterion de subanel.
\label{subring_criterion}%
Sejam $R$ anel e $S \subseteq R$.
O $S$ é um subanel de $R$ sse:
\item{\rm (i)}  $S$ tem a identidade do $R$: $1_R \in S$;
\item{\rm (ii)} $S$ é fechado pela adição: para todo $a,b \in S$, $a+b \in S$;
\item{\rm (iii)}$S$ é fechado pela multiplicação: para todo $a,b \in S$, $ab \in S$;
\item{\rm (iv)} $S$ é fechado pelos negativos: para todo $a \in S$, $-a\in S$.
%%}}}

%%{{{ df: ring_homomorphism 
\definition Homomorfismo.
\label{ring_homomorphism}%
\tdefined{homomorfismo}[de anel]%
Sejam os anéis
$\cal R = \sset R {0_R, 1_R, +_R, \cdot_R}$ e
$\cal S = \sset S {0_S, 1_S, +_S, \cdot_S}$.
A~função $\phi : R \to S$ é um homomorfismo sse:
\item{\rm (i)}   $\phi(0_R) = 0_S$;
\item{\rm (ii)}  $\phi(1_R) = 1_R$;
\item{\rm (iii)} para todo $x,y\in R$, $\phi(x+_R y) = \phi(x) +_S \phi(y)$;
\item{\rm (iv)}  para todo $x,y\in R$, $\phi(x\cdot_R y) = \phi(x) \cdot_S \phi(y)$;
\item{\rm (v)}   para todo $x\in R$, $\phi(-x) = -(\phi(x))$.
%%}}}

%%{{{ criterion: ring_homomorphism_criterion 
\criterion de homomorfismo.
\label{ring_homomorphism_criterion}%
Se a função $\phi : \cal R \to \cal S$ satisfaz:
$$
\align
\phi(1_R)           &= 1_S\\
\phi(x +_R y)       &= \phi(x) +_S \phi(y)\quad\text{para todo $x,y\in R$}\\
\phi(x \cdot_R y)   &= \phi(x) \cdot_S \phi(y)\quad\text{para todo $x,y \in R$}
\endalign
$$
então ela é um homomorfismo.
(Ou seja, podemos apagar os itens (i) e (v) na~\ref{ring_homomorphism}.)
\proof.
Como $\sset R {0_R, +_R}, \sset S {0_S, +_S}$ são grupos,
já provamos isso (\ref{in_groups_respecting_products_means_morphism}).
\qed
%%}}}

\blah.
Podemos já provar o equivalente do~\ref{image_subgroup} que encontramos nos
grupos, para os anéis:

%%{{{ lemma: image_subring 
\lemma.
\label{image_subring}%
Seja $\phi : R \to S$ um homomorfismo de anéis.
Sua imagem $\Img\phi$ é um subanel de $S$.
\sketch.
Usamos o~\ref{subring_criterion} e a definição de $\Img\phi$.
\qes
\proof.
Tome $a,b\in \Img\phi$.  Logo
$$
\alignat2
a &= \phi(a') &\quad&\text{para algum $a' \in R$}\\
b &= \phi(b') &\quad&\text{para algum $b' \in R$}.
\endalignat
$$
Calculamos:
$$
\alignat2
1_S
&= \phi(1_R);           \qqby{$\phi$ homo ($1$)}\\
a + b
&= \phi(a') + \phi(b')  \qqby{pela escolha dos $a',b'$}\\
&= \phi(a'+b');         \qqby{$\phi$ homo ($+$)}\\
-a
&= -\phi(a')            \qqby{pela escolha do $a'$}\\
&= \phi(-a');           \qqby{$\phi$ homo ($-$)}\\
ab
&= \phi(a')\phi(b')     \qqby{pela escolha dos $a',b'$}\\
&= \phi(a'b').          \qqby{$\phi$ homo ($\cdot$)}
\endalignat
$$
Ou seja:  $1_S, a+b, -a, ab \in \Img\phi$ e podemos usar
o~\ref{subring_criterion}.
\qed
%%}}}

\endsection
%%}}}

%%{{{ Integral domains 
\section Domínios integrais.
\label{Integral_domains}%

%%{{{ df: zerodivisors 
\definition Divisores de zero.
\label{zerodivisors}%
\tdefined{zerodivisor}%
\iisee{divisor de zero}{zerodivisor}%
Seja $R$ um anel, e $x,y\in R$.
Se $xy = 0_R$ e nem $x=0_R$ nem $y=0_R$, chamamos os $x,y$
\dterm{divisores de zero} (ou \dterm{zerodivisores}) no $R$.
%%}}}

%%{{{ eg: ints_6 
\example.
No anel $\ints_6$, temos $2\ntimes 3 = 0$.
Logo ambos os $2,3$ são divisores de zero nesse anel.
O $4$ também é, pois $3\ntimes 4 = 0$ também.
\endexample
%%}}}

%%{{{ eg: real_continuous_functions_zerodivisors 
\example.
\label{real_continuous_functions_zerodivisors}%
Considere o anel $C[-1,1]$ com as operações~\ii{pointwise}[operação]pointwise
(veja~\ref{first_ring_examples}).
Tome as funções $f,g$ definidas pelas
$$
\xalignat2
f(x) &= \knuthcases{
-x, & se $x\leq 0$\cr
0,  & se $x > 0$
}&
p(x) &= \knuthcases{
x,  & se $x\in\rats$\cr
0,  & se $x\notin\rats$
}\\
g(x) &= \knuthcases{
0,  & se $x\leq 0$\cr
x,  & se $x > 0$
}&
q(x) &= \knuthcases{
0,  & se $x\in\rats$\cr
x,  & se $x\notin\rats$
}
\intertext{Calculamos}
f\ntimes g &= \lam x 0_{C[-1,1]} &
p\ntimes q &= \lam x 0 = 0_{C[-1,1]},
\endxalignat
$$
e logo os $f,g,p,q$ são divisores de zero no $C[-1,1]$.
\endexample
%%}}}

%%{{{ x: design_graphs_of_zerodevisor_real_continuous_functions 
\exercise.
\label{design_graphs_of_zerodevisor_real_continuous_functions}%
Desenhe os gráficos das funções $f,g,p,q$
do~\ref{real_continuous_functions_zerodivisors},
e com um cálculo explique porque $f\ntimes g = 0 = p\ntimes q$.

\endexercise
%%}}}

%%{{{ df: integral_domain ; cancellation_domain 
\definition Domínio de integridade e de cancelamento.
\label{integral_domain}%
\label{cancellation_domain}%
\tdefined{domínio de integridade}%
\tdefined{domínio de cancelamento}%
Seja $\cal D$ um anel comutativo.
Chamamos o $\cal D$ \dterm{domínio de integridade}
sse ele não tem zerodivisores, ou seja, sse:
$$
\text{para todo $x,y \in D$,}\quad
\text{se $xy=0$ então $x=0$ ou $y=0$}.
\tag{NZD}
$$
Chamamos o $\cal D$ \dterm{domínio de cancelamento}
sse
$$
\text{para todo $a,x,y \in D$,}\quad
ax = ay \mland a \neq 0 \implies x=y.
\tag{CL}
$$
%%}}}

%%{{{ criterion: integral_domain_equiv_cancellation_domain 
\criterion.
\label{integral_domain_equiv_cancellation_domain}%
Os termos ``domínio de integridade'' e ``domínio de cancelamento''
são sinônimos, ou seja:
$$
\text{$D$ é um domínio de integridade} \iff \text{$D$ é um domínio de cancelamento}.
$$
\proof.
\lrdir:
    Sejam $a,x,y \in D$ tais que $a \neq 0$ e $ax = ay$.
    Logo $ax - ay = 0$.
    Logo $a(x-y) = 0$.
    Pela hipótese (NZD) então $x-y = 0$,
    ou seja $x = y$.
\endgraf\noindent
\rldir:
    Sejam $x,y \in D$ tais que $xy = 0$ e $x \neq 0$.
    Queremos $y = 0$.
    Temos $xy = 0 = x0$ (pois $0 = 0x$ em todo anel).
    Ou seja $xy = x0$, e como $x\neq 0$, usando a (CL) concluimos $y=0$.
\qed
%%}}}

\endsection
%%}}}

%%{{{ Fields 
\section Corpos.
\label{Fields}%

%%{{{ df: field 
\definition Corpo.
\label{field}%
\tdefined{corpo}%
Seja $\cal K$ um anel comutativo.
Chamamos o $\cal K$ um \dterm{corpo} (ou \dterm{field})
sse todos os seus membros diferentes de $0$ são invertíveis,
ou seja sse:
$$
\text{para todo $a\in K\setminus\set{0}$,
existe $y \in K$, tal que $ay = 1 = ya$.}
\tag{FM3}
$$
%%}}}

%%{{{ criterion: finite_integral_domain_implies_field 
\criterion.
Se $D$ é um domínio de integridade finito então $D$ é um corpo.
\proof.
Suponha que $D$ é um domínio de integridade finito.
Precisamos mostrar que cada $d \neq 0$ no $D$ tem inverso.
Seja $d\in D$, $d\neq 0$.
Procuro $d' \in D$ tal que $dd' = 1$.
Sejam
$$
d_1, d_2, \dotsc, d_n
$$
todos os elementos distintos de $D\setminus\set{0}$.
Considere os
$$
dd_1, dd_2, \dotsc, dd_n.
$$
Observe que:
$$
dd_i = dd_j \impliesbecause{(CL)} d_i = d_j \implies i = j.
$$
Ou seja,
$$
D\setminus\set{0} = \set{dd_1, dd_2, \dotsc, dd_n}.
$$
Ou seja, como $1\in D\setminus\set{0}$,
$$
1 = dd_u \quad\text{para algum $u\in\set{1,\dotsc,n}$}
$$
que é o que queremos provar.
\qed
%%}}}

\endsection
%%}}}

%%{{{ Lattices 
\section Reticulados.
\label{Lattices_as_algebras}%

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ prob 
\problem.
Considere o conjunto $\cal N_{00}$ das seqüências infinitas de naturais
``eventualmente zero'', ou seja
$$
\cal N_{00}
=
\setst {f : \nats\to\nats} {\pexists {N\in\nats} \lforall {n \geq N} {f(n) = 0}}.
$$
Consideramos a operação de \emph{adição~pointwise\ii{pointwise}[operação]} definida pela:
$$
(f + g)(x) = f(x) + g(x).
$$
Prove que $\cal N_{00}$ com essa operação forma um monóide
isómorfo com o monóide $\sset {\nats_{>0}} {\ntimes}$
(com operação a multiplicação usual).

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{pinteralgebra},
\cite{hersteintopics},
\cite{babybm},
\cite{papamb}.
\cite{sharperings}.

\cite{aluffialgebra}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: The real numbers 
\chapter Os números reais.
\label{Real_numbers}%

%%{{{ Axioms 
\section Axiomas.

\endsection
%%}}}

%%{{{ Infimum and supremum 
\section Infimum e supremum.

\endsection
%%}}}

%%{{{ Completude 
\section Completude.

\endsection
%%}}}

%%{{{ Limits 
\section Limites.

\endsection
%%}}}

%%{{{ Series 
\section Séries.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{spivakcalculus},
\cite{hardypuremath},
\cite{apostol1}~\&~\cite{apostol2}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Metric spaces 
\chapter Espaços métricos.
\label{Metric_spaces}%

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{simmonstopology},
\cite{kolmogorovfomin},
\cite{carothersreal}.

``Baby Rudin''~\cite{babyrudin}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Cantor's paradise 
\chapter O paraíso de Cantor.
\label{Cantors_paradise}%

%%{{{ A bit of historical context 
\section Um pouco de contexto histórico.

\TODO
\Cantor{}Cantor;
\Liouville{}Liouville;
\Hermite{}Hermite;
\Fourier{}Fourier;
\vonLindemann{}von~Lindemann;
\Weierstrass{}Weierstrass.

\endsection
%%}}}

%%{{{ What is counting? 
\section O que é contar?.

%%{{{ df: finord 
\definition.
\sdefined {\finord {\holed n}} {o conjunto $\set {0,\dotsc,n-1}$}
\label{finord}
Como usamos bastante o conjunto $\set{0,1,\dotsc,n-1}$,
vale a pena introduzir uma notação para o denotar:
$$
\finord n \pseudodefeq \set{0,\dotsc,n-1}.
$$
%%}}}

%%{{{ x: define \finord using set-builder 
\exercise.
Defina o $\finord n$ usando a notação ``set-builder''.

\hint
Começa com o $\nats$ e filtre seus elementos usando suas relações de ordem.

\solution
Definimos
$$
\finord n \defeq \setst {i \in \nats} { 0 \leq i < n }.
$$

\endexercise
%%}}}

%%{{{ x: define \finord using recursion 
\exercise.
Defina o operador $\finord{\hole} : \nats \to \pset\nats$ recursivamente.

\hint
Cuidado com as operações e os ``tipos'' dos seus argumentos.

\solution
Qualquer uma das definições abaixo serve:
$$
\xalignat 2
\finord 0 &\defeq \emptyset                                     & \finord 0    &\defeq \emptyset\\
\finord n &\defeq \finord {n-1} \union \set{n-1}\qquad(n > 0)   & \finord {Sn} &\defeq \finord n \union \set n
\endxalignat
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Equinumerosity 
\section Eqüinumerosidade.

%%{{{ df: equinumerous 
\definition Eqüinúmeros.
\label{equinumerous}%
\tdefined {eqüinúmeros}%
\sdefined {\holed A \eqc \holed B} {os $A$ e $B$ são equinúmeros}%
Chamamos os conjuntos $A$ e $B$ \dterm{eqüinúmeros} sse
existe bijecção $f : A \bijto B$.
Escrevemos:
$$
A \eqc B \defiff \lexists f {f : A \bijto B}.
$$
%%}}}

Continuamos em definir mais relações para comparar os tamanhos de conjuntos:

%%{{{ df: leqc_and_ltc 
\definition.
\label{leqc_and_ltc}%
\sdefined {\holed A \leqc \holed B} {o $A$ é menor-ou-igual em cardinalidade que o $B$}
\sdefined {\holed A \ltc \holed B}  {o $A$ é menor em cardinalidade que o $B$}
Sejam $A$ e $B$ conjuntos.
Definimos
$$
\align
A \leqc B &\defiff \lexists {B_0\subseteq B} {A \eqc B_0}\\
A \ltc B  &\defiff A\leqc B \mland A\neqc B
\endalign
$$
Seguindo nossa práctica comum, usamos também $A\gtc B$ como sinónimo de $B\ltc A$,
$A \not\geqc B$ para significar que não é o caso que $B \leqc A$, etc.
%%}}}

%%{{{ x: wrong_ltc_def 
\exercise.
Prove ou disprove a afirmação que podemos usar a seguinde definição como alternativa:
$$
A \ltc B \askiff \lexists {B_0\subsetneq B} {A \eqc B_0}.
$$

\hint
$\nats\ltc\ints$?

\endexercise
%%}}}

%%{{{ x: eqc_is_eqrel 
\exercise.
A $\eqc$ é uma relação de equivalência.  Ou seja:
$$
\align
\text{reflexiva:}\quad&  \text{para todo conjunto $A$,     $A \eqc A$};\\
\text{transitiva:}\quad& \text{para todo conjunto $A,B,C$, $A \eqc B \mland B \eqc C \implies A \eqc C$};\\
\text{simétrica:}\quad&  \text{para todo conjunto $A,B$,   $A \eqc B \implies B \eqc A$}.
\endalign
$$

\solution
Usamos as bijecções seguintes: identidade, composição, inversa.

\endexercise
%%}}}

%%{{{ prop: leqc_is_equiorder 
\proposition.
\label{leqc_is_equiorder}%
A $\leqc$ é:
$$
\align
\text{reflexiva:}              \quad &A \leqc A;\\
\text{transitiva:}             \quad &A \leqc B \mland B \leqc C \implies A \leqc C;\\
\text{não antissimétrica:}     \quad &A \leqc B \mland B \leqc A \nimplies A = B;\\
\text{``equiantissimétrica'':} \quad &A \leqc B \mland B \leqc A \implies A \eqc B.
\endalign
$$
\sketch.
Para as duas primeiras usamos a identidade e a composição respectivamente.
Para a próxima tomando $A\asseq \nats$ e $B\asseq \ints$ serve.
Para ver que não é antissimétrica basta achar um contraexemplo: tente os $\set 0$ e $\set 1$.
A última é realmente difícil para provar:
é um corolário direto
do teorema Schröder--Bernstein (\ref{schroder_bernstein}).
\qes
%%}}}

%%{{{ x: times_respects_eqc 
\exercise.
\label{times_respects_eqc}%
$$
A \eqc A' \mland B \eqc B' \implies A\times B \eqc A'\times B'
$$

\solution
Defina $F: A\times B \to A' \times B'$ pela
$
F(a,b) = (f(a), g(b)).
$
Ou seja, $F = f \cross g$.
\proofpart{Injetoridade.}
Tome $\tup{a_1,b_1} \neq \tup{a_2,b_2}$ no $A\times B$.
Logo $a_1\neq a_2$ ou $b_1\neq b_2$ (pela definição de $=$ nas tuplas).
Logo
$$
F(a_1,b_2) = \tup{f(a_1), g(b_1)} \neq \tup{f(a_2), g(b_2)} = F(a_2,b_2).
$$
onde a $\neq$ segue pelas injetoridades das $f,g$:
pois se $a_1\neq a_2$ então $f(a_1)\neq f(a_2)$,
e se $b_1\neq b_2$ então $g(b_1) \neq g(b_2)$.
\proofpart{Sobrejetoridade.}
Tome $\tup{a',b'}\in A'\times B'$.
Logo $a'\in A'$ e $b'\in B'$, e como $f$ e $g$ são sobrejetoras,
sejam $a \in A$ e $b\in B$ tais que $f(a) = a'$ e $g(b) = b'$.
Observe que $F(a,b) = \tup{f(a), g(b)} = \tup{a',b'}$.

\endexercise
%%}}}

%%{{{ x: pset_respects_eqc 
\exercise.
\label{pset_respects_eqc}%
$$
A \eqc A' \implies \pset A \eqc \pset A'
$$

\solution
Defina $F : \pset A \to \pset A'$ pela
$
F(X) = \img f X.
$
\proofpart{Injetoridade.}
Tome $X,Y \in \pset A$ tais que $X\neq Y$.
Ou seja, existe $z\in X\symdiff Y$.
Tome tal $z$ e considere os $F(X)$ e $F(Y)$.
Como $f$ é injetora, o $f(z) \in F(X) \symdiff F(Y)$.
Ou seja: $F(X) \neq F(Y)$.
\proofpart{Sobrejetoridade.}
Tome $X' \in \pset A'$.
Observe que o $\pre f {X'}$ é mapeado no $X'$ atravez da $F$,
graças ao~\ref{composition_with_inverse_conditions}.

\endexercise
%%}}}

%%{{{ x: to_respects_eqc 
\exercise.
\label{to_respects_eqc}%
$$
A \eqc A' \mland B \eqc B' \implies (A\to B) \eqc (A'\to B')
$$

\solution
Defina $F : (A\to B) \to (A' \to B')$ pela
$F(t) = g \compose t \compose f^{-1}$.
\proofpart{Injetoridade.}
Sejam $s,t \in (A\to B)$ com $s\neq t$.
Logo existe $a_0 \in A$ tal que $s(a_0) \neq t(a_0)$.
Calcule:
$$
\alignat2
(F(s))(f(a_0))
&= (g \compose s \compose \finv f)(f(a_0))\\
&= (g \compose s \compose \finv f \compose f)(a_0)\\
&= (g \compose s)(a_0)\\
&= g(s(a_0))\\
&\neq g(t(a_0)) \qqby{$g$ injetora e $s(a_0) \neq t(a_0)$}\\
&= (g \compose t)(a_0)\\
&= (g \compose s \compose \finv f \compose f)(a_0)\\
&= (g \compose s \compose \finv f)(f(a_0))\\
&= (F(t))(f(a_0)).
\endalignat
$$
\proofpart{Sobrejetoridade.}
Seja $t' \in (A'\to B')$.
Defina a $t \in (A\to B)$ pela
$$
    t = g^{-1} \compose t' \compose f
$$
e observe que $F(t) = t'$.

\endexercise
%%}}}

%%{{{ x: which_setops_respect_cardinalities 
\exercise.
\label{which_setops_respect_cardinalities}%
Quais das operações $\Union$, $\Inter$, respeitam as cardinalidades?

\endexercise
%%}}}

%%{{{ x: currying_eqc 
\exercise.
\label{currying_eqc}
Prove que
$$
((A \times B) \to C)
\eqc
(A \to (B\to C))
$$

\hint
Curry!

\hint
Use lambdas (veja~\ref{Lambda_notation}).

\solution
Defina $F : ((A\times B) \to C) \to (A \to (B\to C))$, pela
$$
F(t) = \lam a {\lam b {t(a,b)}}.
$$
\proofpart{Injetoridade.}
Tome $s,t \in ((A\times B) \to C)$ tais que $s\neq t$.
Ou seja, para alguma entrada $\tup{a_0,b_0} \in (A\times B)$,
as saidas são diferentes elementos de $C$:
$$
s(a_0,b_0) \neq t(a_0,b_0).
$$
Observe então que $F(s) \neq F(t)$,
pois para a entrada $a_0$, elas retornam valores diferentes:
a $F(s)$ retorna a função
$\lam b {s(a_0, b)}$,
e a $F(t)$ retorna a função $\lam b {t(a_0, b)}$.
Para confirmar que realmente
$$
\lam b {s(a_0, b)}
\neq
\lam b {t(a_0, b)}
$$
basta observar que seus valores para a entrada $b\asseq b_0$
são diferentes.
\proofpart{Sobrejetoridade.}
Toma um $f\in (A\to (B\to C))$.
Defina a $t : ((A\times B) \to C)$
pela
$$
t(a,b) = (f(a))(b)
$$
e observe que realmente $F(t) = f$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ What is cardinality? 
\section O que é cardinalidade?.

\note A dupla abstracção de Cantor.

\endsection
%%}}}

%%{{{ Finite and infinite; countable and uncountable 
\section Finitos e infinitos; contáveis e incontáveis.

%%{{{ df: finite_set ; infinite_set 
\definition.
\label{finite_set}%
\label{infinite_set}%
\tdefined{finito}%
\tdefined{infinito}%
O conjunto $A$ é \dterm{finito} sse existe $n\in\nats$ tal que $\finord n \eqc A$.
O conjunto $A$ é \dterm{infinito} sse $A$ não é finito.
%%}}}

%%{{{ df: countable_set ; uncountable_set 
\definition.
\label{countable_set}%
\label{uncountable_set}%
\tdefined{contável}[conjunto]%
\tdefined{incontável}[conjunto]%
O conjunto $A$ é \dterm{contável} sse $A$ é finito ou $\nats\eqc A$.
Usamos os termos \dterm{enumerável} e \dterm{denumerável} como sinónimos
de contável.
O conjunto $A$ é \dterm{incontável} sse $A$ não é contável.
%%}}}

%%{{{ df: enumeration 
\definition.
\label{enumeração}%
\tdefined{enumeração}%
Uma \dterm{enumeração} dum conjunto $A$ é qualquer surjecção
$\pi : \nats\surjto A$.
Assim temos:
$$
A = \img \pi {\nats} = \set{\pi(0), \pi(1), \pi(2), \dotsc}
$$
%%}}}

%%{{{ prop: A_is_countable_equiv_statements 
\proposition.
\label{A_is_countable_equiv_statements}%
Seja $A$ conjunto.
O.s.s.e.:
\item{\rm (1)}   $A$ é contável
\item{\rm (2)}  $A \leqc \nats$
\item{\rm (3)} $A=\emptyset$ ou $A$ possui enumeração.
\sketch.
As direcões $(1)\Rightarrow(2)\Rightarrow(3)$ são conseqüências fáceis
das definições.  Para ``fechar o round-robin'' ($(3)\Rightarrow(1)$),
precisamos definir uma \emph{bijecção} $f : \nats\bijto A$, dados uma
\emph{surjecção} $\pi:\nats\surjto A$.  Usamos recursão e o princípio
da boa ordem.
\qes
%%}}}

%%{{{ What do we gain? 
\note O que ganhamos?.
Suponha que um conjunto $A$ é contável.
O que ganhamos realmente com essa informação?
Como podemos usar essa hipótese?
Já sabemos, por exemplo, que o fato ``$C \neq \emptyset$'' nos permite escrever ``Seja $c\in C$.''.
O que o fato ``$A$ é contável'' nos permite fazer?
Bem, podemos escrever: ``seja $a_n$ uma \emph{enumeração} de $A$'', ou, escrever:
``Suponha $A = \set{a_0, a_1, a_2, \dotsc}$.''.
%%}}}

%%{{{ beware 
\beware.
É um erro comum escrever ``Suponha $A = \set{a_0, a_1, a_2, \dotsc}$.''~mesmo quando
não sabemos que $A$ é contável.  Talvez $A$ é \emph{grande demais} para poder ser
escrito nessa forma.  Como o $\reals$, por exemplo, que sabemos que não pode ser escrito
como $\reals = \set{r_0, r_1, r_2, \dotsc}$, pois é um conjunto incontável!%
%}}}

%%{{{ x: countable_or_uncountable 
\exercise.
\label{countable_or_uncountable}%
Para cada um dos conjuntos seguintes, decida se é contável ou não.
$$
\align
I &= \setst {x\in\reals}   {\text{$x$ é irracional}}\\
A &= \setst {x\in\reals}   {\text{$x$ é algébrico}}\\
T &= \setst {x\in\reals}   {\text{$x$ é transcendental}}\\
C &= \setst {z\in\complex} {\modulus z = 1}\\
L &= \set {\text{os programas sintaticamente corretos numa linguagem de programação}}\\
G &= \graph(f), \quad \text{onde $f : \reals\to\reals$ definida pela $f(x) = x^2$}\\
D &= (\nats \to \set{0,2})\\
S &= (\nats \to \nats)\\
P &= (\nats \bijto \nats)\\
Z &= \setst {f\in(\nats\to\nats)} {(\exists n_0\in\nats)(\forall n>n_0)\left[\,f(n)=0\,\right]} 
\endalign
$$

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Cantor's first diagonal argument 
\section O primeiro argumento diagonal de Cantor.

\endsection
%%}}}

%%{{{ Guessing games 
\section Jogos de adivinhar.

%%{{{ no_repetitions_implies_bijection 
\remark.
Para corresponder numa bijecção mesmo, o jogo tem que ser modificado, para
proibir repetições do mesmo palpite.
Observamos que se o jogador tem uma estratégia para ganhar num jogo que 
permite repetições de palpites, ele já pode a adaptar, para ganhar no 
jogo com a restrição: ele apenas segue a estratégia do jogo ``livre''
e quando aparecem palpites que ele já adivinhou, ele pula para o próximo,
até chegar num palpite que ele não tentou ainda, para o tentar. 
Por exemplo, para enumerar os racionais sabendo uma enumeração dos pares
de inteiros, copiamos a estrategia do $\ints^2$, pulando pares que ou não 
correspondem em racionais (como o $(0,0)$ por exemplo), ou que são iguais 
com palpites anteriores (como o $(2,4)$ que pulamos por causa do (1,2)).
%%}}}

%%{{{ codeit: EnumPairs 
\codeit EnumPairs.
\label{program_enumpairs}
Implemente uma estratégia para ganhar no jogo sem repetições com
conjunto-segredos o $\nats^2$.  Ou seja, escreva um programa que imprime (pra
sempre) os palpites do jogador na sua ordem. 
\endcodeit
%%}}}

%%{{{ codeit: EnumRatsReps 
\codeit EnumRatsReps.
\label{program_enumrats}
Modifique o EnumPairs para o caso com conjunto-segredos
o conjunto de racionais não-negativos, mas permitindo repetições. 
Represente cada palpite como fracção,
imprimindo por exemplo o racional $\frac 1 3$ como o string
``{\tt 1/3}''.
\endcodeit
%%}}}

%%{{{ codeit: EnumRats 
\codeit EnumRats.
\label{program_enumratsnoreps}
Modifique o EnumRats para o caso que o jogo proibe
repetições (mas para o mesmo conjunto $\rats_{\geq0}$). 
\endcodeit
%%}}}

%%{{{ x: amnesiac_player 
\exercise Jogador amnésico.
\label{amnesiac_player}%
Ache uma estratégia para ganhar no jogo com conjunto-segredos o 
conjunto dos racionais não-negativos, se o jogador tem memória que o 
permite lembrar apenas seu último palpite!

\endexercise
%%}}}

%%{{{ x: nextPair 
\exercise.
\label{nextPair}
Defina uma função 
$\namedop{nextPair} : \nats^2 \to \nats^2$
tal que para cada entrada $(n,m)$ ela retorna o próximo palpite do jogador 
que acabou de tentar o $(n,m)$, no jogo com conjunto-segredos o $\nats^2$. 
Considera que sua estratégia começa com o palpite $(0,0)$. 
Assim, a enumeração representada por a estratégia do jogador seria a: 
$$
    (0,0), f(0,0), f^2(0,0), f^3(0,0), \dotsc,
$$
ou seja, a seqüência $\set{ f^n (0,0) }_{n}$.

\endexercise
%%}}}

%%{{{ codeit: NextPair 
\codeit NextPair.
\label{NextPair}%
Implemente função do~\ref{nextPair}.
\endcodeit
%%}}}

%%{{{ codeit: RatApprox 
\codeit RatApprox.
\label{RatApprox}%
Usando uma implementação de enumeração $\set{q_n}_n$ do $\rats$
(com ou sem repetições), implemente uma função
$a : \reals\times\reals \to \nats$ que, dados $x\in\reals$ e $\varepsilon>0$
retorna o primeiro $n\in\nats$ com a propriedade $\abs{q_n - x} < \varepsilon$:
$$
a(x,\varepsilon) = \min\setst{n\in\nats}{\abs{q_n-x}<\varepsilon}.
$$
\endgraf
Se tua linguagem de programação suporta funções de ordem superior,
considere que seu primeiro argumento deve ser a própria enumeração $q$:
$$
\align
\namedfun{ratApprox} &\eqtype (\nats\to\rats) \to \reals \to \reals \to \nats\\
\namedfun{ratApprox}\ q\ x\ \varepsilon &= \min\setst{n\in\nats}{\abs{q_n-x}<\varepsilon}
\endalign 
$$
Alternativamente, pode representar uma enumeração de racionais
como uma lista (infinita) de racionais.  Considere retornar o
primeiro racional suficientemente próximo alem de apenas seu
indice.  Improvise e teste sua função, vendo quanto ``demora''
uma enumeração para chegar suficientemente perto de um número
pre-determinado, sendo racional ou não.
Por exemplo, use $x=\sqrt 2$ ou $e$ ou $\pi$,
e
$\varepsilon=1, 1/2, 1/4, \dotsc$.
Assim, para qualquer real $x$, tu pode
\emph{construir}---mesmo não muito ``eficientemente''---uma
seqüência de racionais que converge em $x$, apenas aplicando a função
$\lambda \varepsilon. \namedfun{ratApprox}\ q\ x\ \varepsilon$
em argumentos que formam qualquer seqüência que convirja no zero!
\endcodeit
%%}}}

\endsection
%%}}}

%%{{{ Cantor's second diagonal argument 
\section O segundo argumento diagonal de Cantor.

%%{{{ x: why_cant_we_prove_that_rats_is_uncountable 
\exercise.
Por quê não podemos usar o mesmo argumento para concluir que o $\setst{q \in \rats}{0\leq q\leq 1}$ também é incontável?

\hint
Como tu vai provar que o número construido pela método de Cantor realmente é um elemento de $\rats\inter[0,1]$?

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Cantor set 
\section O conjunto de Cantor.

\endsection
%%}}}

%%{{{ Some important applications 
\section Umas aplicações importantes da teoria de Cantor.

\note Os números racionais.

\note Os números irracionais.

\note Os números algebricos.

\note Os números transcendentais.

\endsection
%%}}}

%%{{{ Looking for bijections 
\section Procurando bijecções.

\note.
Vamos ver como as transformações de esticar/encolher
(stretch/shrink) e de deslocar (shift) nos intervalos de reais,
sendo bijecções levam suas entradas para saidas equinúmeras.

%%{{{ x: (0,1) =c (0,2) 
\exercise.
Mostre as seguintes equinumerosidades entre os seguintes intervalos de reais:
\beginol
\li $(0,1) \eqc (0,2)$;
\li $(0,2) \eqc (3,5)$;
\li $[0,1) \eqc (0,1]$;
\li $(a,b) \eqc (c,d)$;
\li $[a,b) \eqc (c,d]$;
\li $[a,b) \eqc (c,d]$;
(onde $a < b$ e $c < d$);
\endol

\hint
Tente aproveitar que composição de bijecções é bijecção, quebrando assim cada
tarefa em tarefas menores e mais fáceis para resolver, tais que a composição
das resoluções delas, resultará na resolução da tua tarefa inicial.

\endexercise
%%}}}

%%{{{ x: (α,β) =c (0,1) 
\exercise.
Mostre as seguintes equinumerosidades entre os seguintes intervalos de reais,
$$
(\alpha,\beta) \eqc (0,1)
$$
onde $\alpha,\beta \in \reals\union\set{\minfty,\pinfty}$ com $\alpha < \beta$.
e $a,b \in \reals$ e tais que os intervalos são nem vazios nem singletons.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ The Cantor--Schröder--Bernstein theorem 
\section O teorema Cantor--Schröder--Bernstein.

\blah.
Esse teorema que provamos aqui é conhecido como ``\Cantor{}Cantor--\Schroder{}Shröder--\Bernstein{}Bernstein''
ou ``\Schroder{}Schröder--\Bernstein{}Bernstein'', mas vamos referir a ele nessas notas apenas com
o nome de Bernstein, pois foi o primeiro que demonstrou sua vericidade numa forma correta.%
\footnote{E sua prova não precisou o \emph{axioma da escolha}~(\refn{Axioms_of_choice}),
algo que vamos apreciar mais no~\ref{Axiomatic_set_theory}.}
Vamos começar atacando esse problema com uma abordagem amorosa,
de \Smullyan{}Smullyan (veja~\cite{smullyanbeginners}).

%%{{{ x: lovely approach 
\exercise Abordagem amorosa.
\label{schroder_bernstein_by_smullyan}%
Suponha que num universo seus habitantes são divididos em dois conjuntos \emph{infinitos}:
o conjunto $A$ de homens e $B$ de mulheres.
Suponha também que os seguintes são fatos sobre esse universo:
\beginol
\li Cada homem ama exatamente uma mulher.
\li Nenhuma mulher é amada por dois homens.
\li Cada mulher ama exatamente um homem.
\li Nenhum homem é amado por duas mulheres.
\endol
(Essas condições já deixam esse universo bem bizarro.)
Mostre que tem como casar todos os habitantes desse universo em casamentos monogâmicos e heterosexuais,
em tal modo que em cada casal é garantido amor (mas não necessariamente reciprocal), ou seja:
se $a\in A$ é casado com $b\in B$, \emph{pelo menos uma} das duas condições acontece:
$a$~ama~$b$; $b$~ama~$a$.

\hint
Escolhe uma pessoa $x \in A \union B$.  Independente se ela é homem ou mulher,
podemos a perguntar: \emph{<<quem te ama?>>}.
Duas possibilidades existem: ou ela é amada por algum $x_1 \in A \union B$,
ou ninguém ama $x$.  No primeiro caso perguntamos $x_1$ a mesma pergunta,
definindo assim o $x_2$, se $x_1$ é uma pessoa amada, etc.
Observerve que cada $x \in A \union B$ defina assim um \dterm{caminho amoroso}
$x, x_1, x_2, \dots$.  Esse caminho ou é infinito, ou termina num certo membro $x_n \in A\union B$.
Vamos agora separar todas as pessoas do $A\union B$ em três grupos:
$$
\align
G_A         &= \setstt {x \in A\union B} {o caminho amoroso de $x$ termina num membro de $A$}\\
G_B         &= \setstt {x \in A\union B} {o caminho amoroso de $x$ termina num membro de $B$}\\
G_\infty    &= \setstt {x \in A\union B} {o caminho amoroso de $x$ é infinito}
\endalign
$$
Tente casar todos os membros de cada um desse grupo entre si!

\endexercise
%%}}}

\blah.
Voltando dessa versão antropomórfica do problema, observe que a condição (1)
garanta a existência duma função $f : A \to B$, que graças à (2) é injetora.
Similarmente, a condição (3) garanta a existência duma função $g : B \to A$,
que graças à (4) é injetora também.
Essas são as hipotéses do~\ref{schroder_bernstein}
Observe também que se resolver o problema amoroso do~\ref{schroder_bernstein_by_smullyan}
tu já forneceu uma função \emph{bijetora} $F : A \to B$, definida pela
$$
F(x) = \text{a pessoa casada com $x$}.
$$
Vamos ver isso agora sem amor.

%%{{{ thm: schroder_bernstein 
\theorem Bernstein.
\Bernstein{}%
\label{schroder_bernstein}%
\ii{teorema}[Schröder--Bernstein]%
Sejam conjuntos $A$ e $B$ e funções injetoras
$f : A \injto B$ e $g : B \injto A$.
Então existe bijecção $\phi : A \bijto B$.
%%}}}

\endsection
%%}}}

%%{{{ Looking for injections 
\section Procurando injecções.

\blah.
Agora é \emph{bem} mais fácil provar o seguinte
e ganhar o corolário embaixo.
Sem \Bernstein{}Bernstein, precisamos resolver o~\ref{change_of_ends_of_intervals_without_bernstein}.

%%{{{ x: (a,b) \eqc (a,b] with Bernstein
\exercise.
\label{change_of_ends_of_intervals_with_bernstein}%
Usando o teorema de Schröder--Bernstein~\refn{schroder_bernstein}
prove que $(a,b) \eqc (a,b] \eqc [a,b]$.

\endexercise
%%}}}

\corollary.
Qualquer intervalo não-trivial (vazio ou singleton) de reais,
tem a mesma cardinalidade com o próprio $\reals$.

%%{{{ x: \reals \eqc \pset\nats with Bernstein
\exercise.
Usando o teorema de Schröder--Bernstein~\refn{schroder_bernstein}
prove que $\reals \eqc \pset\nats$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Encodings 
\section Codificações.

\exercise.
Prove que $[0,1) \eqc (\nats\to\nats)$.

\endexercise

\exercise.
Prove que $\nats \eqc \kstar\nats$.

\endexercise

\endsection
%%}}}

%%{{{ Cantor's theorem and its consequences 
\section O teorema de Cantor e suas conseqüências.

\blah.
Até agora temos encontrado apenas duas quantidades infinitas diferentes:
aquela do $\nats$, e aquela do $\reals$.
Essa situação está prestes a mudar drasticamente com o teorema seguinte.

%%{{{ thm: cantor_theorem 
\theorem Cantor.
\label{cantor_theorem}%
\Cantor[teorema]%
\ii{teorema}[Cantor]%
Seja $A$ conjunto.
Então $A\ltc \pset A$.
\proof.
Seguindo a definição de $\ltc$, precisamos provar duas coisas:
\endgraf
\proofstyle{Prova de $A\leqc \pset A$.}
Basta achar uma função injetora de $A$ para $\pset A$.
Definimos a $f : A \injto \pset A$ pela
$$
f(x) = \set x.
$$
Facilmente ela é injetora (\ref{the_singletonizer_is_injective}).
\endgraf
\proofstyle{Prova de $A\neqc \pset A$.}
Basta provar que não existe função sobrejetora de $A$ para $\pset A$.
Seja $\pi : A \to \pset A$.
Queremos provar que a $\pi$ não pode ser sobrejetora, ou seja,
mostrar um elemento $C$ do seu codomínio que não pertence na imagem da $\pi$
(ou seja: tal que $C \notin \img \pi A$; ou, equivalentemente,
$\pre \pi C = \emptyset$).
Observe que para qualquer $x\in A$, temos $\pi(x)\in\pset A$,
ou seja $\pi(x) \subseteq A$.
Faz sentido então perguntar:
$$
x \in \pi(x) ?
$$
Chame os $x\in A$ que satisfazem $x \in \pi(x)$ \dterm{obedientes},
e os outros \dterm{rebeldes}.
Queremos considerar o conjunto $C$ de todos os rebeldes:
$$
C = \setst {x\in A} {x \notin \pi(x)}.
$$
Pela definição de $C$, temos $C \subseteq A$.
Ou seja, $C \in \pset A$, que é o codomínio da $\pi$.
Precisamos provar que para todo $w \in A$, $\pi(w) \neq C$.
Seja $w\in A$, e suponha para chegar num absurdo suponho que $\pi(w) = C$.
Agora nos perguntamos: $w$ é rebelde ou não?
Ou seja: $w\in\pi(w)$ ou não?
E como $\pi(w)=C$, a pergunta reduza em:
$w\in C$?
Ambas as alternativas (\emph{sim} e \emph{não}) são impossíveis:
$$
w \in = C
\iff
w \notin = C
$$
pela definição de $C$ e pela escolha de $w$.
Absurdo!
\qed
%%}}}

%%{{{ x: the_singletonizer_is_injective 
\exercise.
\label{the_singletonizer_is_injective}%
Prove em detalhe que a função $f$ definida na prova de~\ref{cantor_theorem}
realmente é injetora.

\endexercise
%%}}}

%%{{{ cor: infinitely_many_infinities 
\corollary.
\label{infinitely_many_infinities}%
Existe uma infinidade (contável) de cardinalidades infinitas:
$$
\nats
\ltc \pset\nats
\ltc \pset\pset\nats
\ltc \pset\pset\pset\nats
\ltc \pset\pset\pset\pset\nats
\ltc \dotsc
$$
%%}}}

%%{{{ cor: no_maximum_cardinality 
\corollary.
Não existe cardinalidade máxima:
para qualquer conjunto $M$, o conjunto $\pset M$ tem cardinalidade maior.
%%}}}

%%{{{ df: aleph_and_continuum 
\definition.
\label{aleph_and_continuum}%
\sdefined{\aleph_0}{a cardinalidade do $\nats$}%
\sdefined{\continuum}{a cardinalidade do $\pset\nats$ e do $\reals$}%
\tdefined{aleph 0}%
\tdefined{continuum}%
Denotamos a cardinalidade de $\nats$ por $\aleph_0$ (\dterm{aleph 0}),
e a cardinalidade de $\pset\nats\eqc\reals$ por $\continuum$.
Chamamos o $\continuum$ o \dterm{continuum}.
%%}}}

%%{{{ note: holes in the chain of cardinalities of powersets 
\note.
Considere os conjuntos
$$
\emptyset
\ltc \pset\emptyset
\ltc \pset\pset\emptyset
\ltc \pset\pset\pset\emptyset
\ltc \pset\pset\pset\pset\emptyset
\ltc \dotsb
$$
Observe que cada conjunto nessa seqüência (infinita) de conjuntos é finito.
Mas, quais são suas cardinalidades?
Calculamos:
$$
\align
\card{\emptyset}                     &= 0\\
\card{\pset\emptyset}                &= 1\\
\card{\pset\pset\emptyset}           &= 2\\
\card{\pset\pset\pset\emptyset}      &= 4\\
\card{\pset\pset\pset\pset\emptyset} &= 16\\
                                     &\eqvdots\\
\endalign
$$
Observamos que a seqüência dessas cardinalidades ``tem burácos''.
Por exemplo, nenhum desses conjuntos tem cardinalidade $3$,
mesmo que realmente tem conjuntos com essa cardinalidade
(por exemplo o $\finord 3=\set{0,1,2}$).
Ou seja, existe conjunto $C$ com
$$
\pset\pset\emptyset\ltc C\ltc \pset\pset\pset\emptyset.
$$
Similarmente achamos conjuntos ``estritamente entre'' os conjuntos que aparecem
depois nessa seqüência.
%%}}}

%%{{{ note: some questions rise 
\note.
Umas questões aparecem imediatamente:
\beginol
\li Será que tem conjuntos ``estritamente entre'' alguns dos conjuntos
infinitos da seqüência anterior?
\li Será que tem algum conjunto com cardinalidade maior que qualquer uma dessas
cardinalidades?
\li Será que tem algum conjunto incomparável com todos eles?
\li Até pior: tem conjuntos incomparáveis em cardinalidade?)
\endol
%%}}}

\endsection
%%}}}

%%{{{ Cardinal comparability 
\section Comparabilidade de cardinais.

\endsection
%%}}}

%%{{{ The continuum hypothesis 
\section Hipótese do continuum.

\endsection
%%}}}

%%{{{ Ordinal vs. cardinal numbers 
\section Números ordinais vs.~cardinais.
\endsection
%%}}}

%%{{{ A taste of measure theory 
\section Um toque de teoria de medida.

\endsection
%%}}}

%%{{{ Consequences in computability and definability 
\section Conseqüências em computabilidade e definabilidade.

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ prob: a_letter_from_cantor_to_dedekind 
\problem Uma carta de Cantor para Dedekind.
\label{a_letter_from_cantor_to_dedekind}%
\Cantor{}Cantor definiu a função $f : (0,1)^2 \to (0,1)$ pela
$$
f(a, b)
= 0.a_1b_1a_2b_2a_3b_3\dotsc
\qtext{onde}
\left\{
\aligned
a &\eqass 0.a_1a_2a_3\dotsc\\
b &\eqass 0.b_1b_2b_3\dotsc
\endaligned
\right.
$$
são as expansões decimais \emph{que não terminam em 9's repetidos}.
Afirmando que ela é bijetora, mandou sua ideia para Dedekind,
como uma prova de $(0,1)^2 \eqc (0,1)$.
\Dedekind{}Dedekind percebeu um erro na carta de Cantor.
(1) Por que Cantor botou a restrição <<que não terminam em $9$'s repetidos>>?
(2) Qual o erro de Cantor?

\hint
(1) Precisamos disso para que $f$ seja bem definida (por quê?).
(2) A $f$ não é bijetora!  (Por quê?)

\endproblem
%%}}}

%%{{{ prob: change_of_ends_of_intervals_without_bernstein 
\problem Sem Bernstein.
\label{change_of_ends_of_intervals_without_bernstein}%
Mostre pela definição a equinumerosidade
$$
(a,b) \eqc [a,b) \eqc [a,b];
$$
onde $a,b \in \reals$ e tais que os intervalos não são
nem vazios nem singletons.

\endproblem
%%}}}

%%{{{ prob: sime_simo_eqclass_card 
\problem.
\label{sime_simo_eqclass_card}%
\def\sime{\rel{\stackrel{{}_{\mathrm e}}=}}%
\def\simo{\rel{\stackrel{{}_{\mathrm o}}=}}%
Seja~$f:\nats\to\nats$ e as $\sime$ e $\simo$ como no~\ref{simz_sime_simo_simi}:
$$
\align
f\sime g&\defiff f(2n)   = g(2n)  \ \text{para todo $n\in\nats$}\\
f\simo g&\defiff f(2k+1) = g(2k+1)\ \text{para todo $k\in\nats$}\\
\endalign
$$
Qual é a cardinalidade do $\eqclass f {\sime} \inter \eqclass f {\simo}$?

\endproblem
%%}}}

%%{{{ df: terminating_game 
\definition Jogo terminante.
\label{terminating_game}%
\tdefined{jogo}[terminante]%
Consideramos jogos entre 2 jogadores.
Chamamos um jogo \dterm{terminante} sse não tem partidas infinitas.
Ou seja, seguindo suas regras cada partida termina depois um finíto número de turnos.
%%}}}

%%{{{ df: hypergame 
\definition Hypergame (Zwicker).
\label{hypergame}%
\tdefined{hypergame}%
\Zwicker[hypergame]{}%
Considere o jogo seguinte $\cal H$, chamado \dterm{hypergame}:
O $\cal H$ começa com o {\scshape Player~I} que escolha um jogo terminante $G$.
O {\scshape Player~II} começa jogar o jogo $G$ contra o {\scshape Player~I}.
Quem ganha nesse jogo $G$ é o vencedor do jogo $\cal H$.
%%}}}

%%{{{ eg: hypergame_plays 
\example.
\label{hypergame_plays}%
Por exemplo, sendo um bom jogador de ``jogo da velha'' e um pessimo jogador
de xadrez, se eu for o {\scshape Player~I} num hypergame, meu primeiro
movimento seria escolher o jogo terminante ``jogo da velha'' para jogar.
Meu oponente, se for o {\scshape Player~I} duma partida de hypergame,
seu primeiro movimento seria escolher o jogo terminante ``xadrez''.
Depois desse movimento eu viro o {\scshape Player~I} no xadrez.
Quem vai ganhar nesse xadrez, vai ser o vencidor dessa partida de hypergame.
\endexample
%%}}}

%%{{{ hypergame_paradox 
\note O paradoxo de hypergame.
\label{hypergame_paradox}%
{\def\P{\text{\tt P}}
\def\O{\text{\tt O}}
Zwicker\Zwicker[hypergame]{} percebeu o seguinte paradoxo, se perguntando
se o próprio Hypergame é um jogo terminante ou não.
Claramente tem que ser, pois a primeira regra do jogo obriga o {\scshape Player~I}
escolher um jogo terminante.  Logo, depois de $n\in\nats$ turnos, esse jogo
termina, e junto com ele termina a partida do hypergame (em $n+1$ turnos).
Então hypergame é terminante.
Logo, numa partida de hypergame, o {\scshape Player~I} pode escolher o próprio
hypergame.  Assim começamos uma sub-partida de hypergame, onde o
{\scshape Player~II} toma o papel de {\scshape Player~I}.
Se ele escolher, por exemplo, ``jogo de velha'', a partida parece assim:
$$
\def\drawTTTboard{%
\draw (-1, 3)     -- (-1,-3);
\draw ( 1, 3)     -- ( 1,-3);
\draw (-3, 1)     -- ( 3, 1);
\draw (-3,-1)     -- ( 3,-1);
}
\align
\P:\quad& \hbox{Escolho ``Hypergame''}\\
\O:\quad& \hbox{Escolho ``Jogo de velha''}\\
\P:\quad&
\gathered
\tikzpicture[scale=0.15]
\drawTTTboard
\draw (-0.7,-0.7) -- (0.7, 0.7);
\draw (-0.7, 0.7) -- (0.7,-0.7);
\endtikzpicture
\endgathered\\
\phantom{\P}\vdots\quad&\vdots\\
\O:\quad&
\gathered
\tikzpicture[scale=0.15]
\drawTTTboard
\draw (-0.7,-0.7) -- ( 0.7, 0.7);
\draw (-0.7, 0.7) -- ( 0.7,-0.7);
\draw (-2.7,-0.7) -- (-1.3, 0.7);
\draw (-2.7, 0.7) -- (-1.3,-0.7);
\draw (2,2)  circle (0.7);
\draw (0,-2) circle (0.7);
\endtikzpicture
\endgathered\\
\P:\quad&
\gathered
\tikzpicture[scale=0.15]
\drawTTTboard
% X-moves
\draw (-0.7,-0.7) -- ( 0.7, 0.7);
\draw (-0.7, 0.7) -- ( 0.7,-0.7);
\draw (-2.7,-0.7) -- (-1.3, 0.7);
\draw (-2.7, 0.7) -- (-1.3,-0.7);
\draw ( 1.3,-0.7) -- ( 2.7, 0.7);
\draw ( 1.3, 0.7) -- ( 2.7,-0.7);
% O-moves
\draw (2,2)  circle (0.7);
\draw (0,-2) circle (0.7);
% draw winning line
\draw (-2.7, 0.0) -- ( 2.7, 0.0);
\endtikzpicture
\endgathered\\
\endalign
$$
Onde denotamos os dois jogadores com $\P$ e $\O$ (de ``Player'' e ``Opponent'').
Mas, agora a partida seguinte é possível:
$$
\align
\P:\quad& \hbox{Escolho ``Hypergame''}\\
\O:\quad& \hbox{Escolho ``Hypergame''}\\
\P:\quad& \hbox{Escolho ``Hypergame''}\\
\O:\quad& \hbox{Escolho ``Hypergame''}\\
\phantom{\P}\vdots\quad&\vdots
\endalign
$$
e achamos uma partida infinita do hypergame!
Logo o hypergame não é terminante.
}
%%}}}

%%{{{ prob: from_hypergame_to_cantors_theorem 
\problem.
\label{from_hypergame_to_cantors_theorem}%
Seja conjunto $A$ e suponha que existe injecção $\phi : A \injto \pset A$.
Para todo $x\in A$, denota com $S_x$ o $\phi(x)$, ou seja, $S_x$
é o subconjunto de $A$ associado com o $x$.
Seja $a\in A$.  Chame um \dterm{caminho} de $a$ qualquer seqüência
finita ou infinita $\set{a_i}_i$ de elementos de $A$ que satisfaz:
$$
\align
a_0     &= a\\
a_{n+1} &\in S_{a_n}.
\endalign
$$
Finalmente, chame um $a\in A$ \dterm{terminante} se todos os caminhos
de $a$ são finítos.  Use o paradoxo do Hypergame para provar que
a $\phi$ não pode ser sobrejetora, achando assim uma nova prova
do teorema de Cantor~\refn{cantor_theorem}.

\hint
Seja $T \subseteq A$ o conjunto de todos os terminantes elementos de $A$.
Queremos provar que $T\notin \img \phi A$, ou seja, que para todo $x\in A$,
$S_x \neq T$, provando assim que $\phi$ não é bijetora.

\hint
Suponha para chegar num absurdo que $T=S_a$ para algum $a\in A$.

\hint
$T = \emptyset$?

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

Sobre a teoria de conjuntos de Cantor:
\cite{kleeneIM},
\cite{ynmnst}.

Sobre teoria da medida:
\cite{bartlemeasure},
\cite{halmosmeasure},
\cite{taylorintegration}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Posets; Lattices; Boolean algebras 
\chapter Posets; Reticulados; Álgebras booleanas.
\label{Posets}%
\label{Lattices}%
\label{Boolean_algebras}%

%%{{{ Concept, notation, properties 
\section Conceito, notação, propriedades.

\TODO Conceito.

%%{{{ df: poset 
\definition poset.
\label{poset}%
\tdefined{poset}%
Chamamos o conjunto estruturado $\cal P = \sset P \leq$
um \dterm{poset} (ou conjunto parcialmente ordenado),
sse $\leq$ é uma relação de ordem parcial:
$$
\gather
x \leq x\\
x \leq y \mland y \leq z \implies x \leq z\\
x \leq y \mland y \leq x \implies x = y
\endgather
$$
%%}}}

%%{{{ Notational abuse 
\note Abusos notacionais.
Extendemos o ``tipo'' do predicado $\dhole\leq\dhole$ de elementos de $P$
para elementos e/ou subconjuntos de $P$, definindo:
$$
\align
a \leq Y &\defiff a \leq y, \quad\text{para todo $y\in Y$};\\
X \leq b &\defiff x \leq b, \quad\text{para todo $x\in X$};\\
X \leq Y &\defiff x \leq y, \quad\text{para todo $x\in X$ e $y\in Y$}.
\endalign
$$
%%}}}

\blah.
Nas definições seguintes nosso contexto é um poset $\sset P \leq$.

%%{{{ df: incomparable 
\definition.
\label{incomparable}%
\tdefined{incomparável}%
Se $x \nleq y$ e $y \nleq x$ chamamos $x$ e $y$ \dterm{incomparáveis}.
Denotamos assim:
$$
x \incomp y \defiff x \nleq y \mland y \nleq x.
$$
%%}}}

%%{{{ df: chain_antichain 
\definition.
\label{chain_antichain}%
\tdefined{cadeia}%
\tdefined{anticadeia}%
Seja $X\subseteq P$.
Chamamos o $X$ uma \dterm{cadeia} sse todos os seus elementos são comparáveis.
No caso oposto, onde todos são comparáveis apenas com eles mesmo,
chamamos o $X$ \dterm{anticadeia}.  Simbolicamente:
$$
\align
\text{cadeia:}\quad&       x, y \in X  \implies  x \leq y \mlor y\leq x;\\
\text{anticadeia:}\quad&   x, y \in X  \mland x \leq y \implies x = y.
\endalign
$$
%%}}}

%%{{{ df: covby 
\definition.
\label{covby}%
\tdefined{cobertura}%
\sdefined {\holed x \covby \holed y} {o $x$ é coberto por o $y$}%
Se $x\leq y$ e não existe nenhum $z$ estritamente entre os $x$ e $y$
falamos que $y$ \dterm{cobre} o $x$.  Simbolicamente:
$$
x\covby y \defiff x \leq y \mland \lnot\exists z (x < z < y).
$$
%%}}}

%%{{{ Diagramas Hasse 
\note Diagramas Hasse.
\Hasse{}
%%}}}

%%{{{ df: min_max 
\definition.
\label{min_max}%
\tdefined{mínimo}%
\tdefined{máximo}%
\sdefined{\min {\holed A}} {o mínimo de $\holed A$}%
\sdefined{\max {\holed A}} {o máximo de $\holed A$}%
Seja $A\subseteq P$.
Chamamos o $m$ o \dterm{mínimo} de $A$ sse $m\leq a$ para todo $a\in A$.
\emph{Dualmente} chamamos o $m\in A$ o \dterm{máximo} de $A$ sse $a\leq m$ para todo $a\in A$.
Denotamos o mínimo de $A$, se existe, por $\min A$ e seu máximo, se existe, por $\max A$.
\mistake
%%}}}

%%{{{ x: uniqueness_of_min_max 
\exercise.
\label{uniqueness_of_min_max}%
Qual o erro na definição acima?
Ache-o e corrija-o.

\endexercise
%%}}}

%%{{{ df: bottom_top 
\definition.
\label{bottom_top}%
\label{zero_one_in_poset}%
\label{zero_one}%
\label{bounded_poset}%
\tdefined{bottom}%
\tdefined{top}%
\tdefined{zero}[dum poset]%
\tdefined{one}[dum poset]%
\tdefined{bounded}[por cima]%
\tdefined{bounded}[por baixo]%
\sdefined{\bot_{\holed P}} {o bottom (o mínimo elemento dum poset)}%
\sdefined{\top_{\holed P}} {o top (o máximo elemento dum poset)}%
\sdefined{0_{\holed P}} {o zero (o máximo elemento dum poset)}%
\sdefined{1_{\holed P}} {o um (o máximo elemento dum poset)}%
Se o próprio $P\subseteq P$ possui elemento
mínimo, chamamos-lo o \dterm{bottom} de $P$,
e se possui
máximo, chamamos-lo o \dterm{top} de $P$.
Usamos as notações $\bot_P$ e $\top_P$ respectivamente,
esquecendo o $_P$ quando é implícito pelo contexto.
Sinônimos de bottom e top são os \dterm{zero} e \dterm{um} respectivamente,
usando as notações $0_P$ e $1_P$.
Se um poset possui bottom, ele é chamado \dterm{bounded por baixo},
e se ele possui top, ele é chamado \dterm{bounded por cima}.
Caso que seja bounded por cima e por baixo, chamamos-lo apenas
\dterm{bounded}.
%%}}}

%%{{{ df: minimal_maximal 
\definition.
\label{minimal_maximal}
\tdefined{minimal}%
\tdefined{maximal}%
Chamamos o $x$ um elemento \dterm{minimal} de $P$
sse nenhum elemento está embaixo dele, e, \emph{dualmente}
chamamos o $x$ \dterm{maximal} de $P$ sse nenhum elemento
está acima dele.  Simbolicamente:
$$
\align
\text{$x$ minimal}&\defiff  \lforall {y \in P} {y \leq x \implies x = y};\\
\text{$x$ maximal}&\defiff  \lforall {y \in P} {x \leq y \implies x = y}.
\endalign
$$
%%}}}

%%{{{ df: ubs_lbs 
\definition.
\label{ubs_lbs}%
\tdefined{upper bound}%
\tdefined{lower bound}%
\sdefined{\ubs {\holed A}} {o conjunto dos upper bounds de $\holed A$}%
\sdefined{\lbs {\holed A}} {o conjunto dos lower bounds de $\holed A$}%
Seja $A\subseteq P$
O $m$ é um \dterm{upper bound} de $A$ sse $x \leq m$ para todo $x\in A$.
Dualmente, o $m$ é um \dterm{lower bound} de $A$ sse $m \leq x$ para todo $x \in A$.
Usamos a notação
$$
\align
\ubs A &\defeq \setstt {m\in P} {$m$ é um upper bound de $A$}\\
\lbs A &\defeq \setstt {m\in P} {$m$ é um lower bound de $A$}.
\endalign
$$
%%}}}

%%{{{ eg: ubs_lbs_in_reals_example 
\example.
\label{ubs_lbs_in_reals_example}%
No $\reals$, considere seu subconjunto $(1,2]$.
Uns upper bounds dele são os reais $2, 5, \sqrt{12}, 8000$.
No outro ladom uns lower bounds dele são os $-400, -\pi, 0, 1/2, 0.8, 1$.
\endexample
%%}}}

%%{{{ df: lub_glb 
\definition.
\label{lub_glb}%
\tdefined{greatest lower bound}%
\tdefined{least upper bound}%
\tdefined{supremum}%
\tdefined{infimum}%
\sdefined{\sup{\holed A}} {supremum de $\holed A$}%
\sdefined{\inf{\holed A}} {infimum de $\holed A$}%
\sdefined{\lub{\holed A}} {least upper bound de $\holed A$}%
\sdefined{\glb{\holed A}} {greatest lower bound de $\holed A$}%
\sdefined{\Join{\holed A}} {join de $\holed A$}%
\sdefined{\Meet{\holed A}} {meet de $\holed A$}%
Se os $\ubs A$ e $\lbs A$ tem elemento mínimo e máximo respectivamente,
definimos
$$
\align
\lub A &\defeq \min\ubs A\\
\glb A &\defeq \max\lbs A.
\endalign
$$
Naturalmente chamamos o $\lub A$ o \dterm{least upper bound} de $A$,
e o $\glb A$ o \dterm{greatest lower bound} de $A$.
Usamos \emph{muitos} sinônimos, resumidos aqui:
$$
\xalignat3
\sup A &\ \text{(supremum)}   & \lub A &\ \text{(least upper bound)}    & \Join A &\ \text{(join)}\\
\inf A &\ \text{(infimum)}    & \glb A &\ \text{(greatest lower bound)} & \Meet A &\ \text{(meet)}
\endxalignat
$$
%%}}}

%%{{{ eg: inf_and_sup_of_openclosed_interval 
\example.
\label{inf_and_sup_of_openclosed_interval}%
O $A=(1,2]$ do~\ref{ubs_lbs_in_reals_example} tem
$\inf A = 1$ e $\sup A = 2$.
Observe que $\sup A \in A$ mas $\inf A \notin A$.
\endexample
%%}}}

%%{{{ x: when_glb_and_lub_is_min_and_max 
\exercise.
\label{when_glb_and_lub_is_min_and_max}%
O que podemos concluir quando $\glb A \in A$ e quando $\lub A \in A$?

\endexercise
%%}}}

%%{{{ df: downset_upset_downs  
\definition.
\label{downset_upset_downs}%
\tdefined{downset}%
\tdefined{upset}%
\sdefined{\downs{\holed P}} {o conjunto de downsets de $\holed P$}%
Chamamos o $A\subseteq P$ um \dterm{downset} de $A$
sse o $A$ é ``fechado para baixo'', e \emph{dualmente},
o chamamos \dterm{upset} sse ele é ``fechado para cima''.
Formalmente,
$$
\align
\text{$A$ downset} &\defiff {a \in A \mland x \leq a \implies x\in A};\\
\text{$A$ upset}   &\defiff {a \in A \mland a \leq x \implies x\in A}.
\endalign
$$
Dado um poset $P$, usamos $\downs P$ para denotar o conjunto de todos os seus
downsets.  Simbolicamente,
$$
\downs P \defeq \set{ D \subseteq P \st \text{$D$ é um downset de $P$} }.
$$
%%}}}

%%{{{ df: down_up 
\definition.
\label{down_up}%
\sdefined{\down {\holed a}} {o down de $\holed a$}%
\sdefined{\up {\holed a}} {o up de $\holed a$}%
Definimos para qualquer $a\in P$ os conjuntos
$$
\align
\down a &\defeq \setst {x \in P} {x \leq a}\\
\up a   &\defeq \setst {x \in P} {a \leq x}
\intertext{e generalizamos essas operações de elementos $a\in P$ para subconjuntos $A\subseteq P$ assim:}
\down A &\defeq \setstt {x \in P} {$x \leq a$ para algum $a \in A$}\\
\up A   &\defeq \setstt {x \in P} {$a \leq x$ para algum $a \in A$}.
\endalign
$$
Observe que $\down x = \down{\set x}$ e $\up x = \up{\set x}$.
Diretamente pelas definições também temos:
$$
\xalignat2
\down A &= \Union_{a\in A} {\down a}&
\up A &= \Union_{a\in A} {\up a}
\endxalignat
$$
%%}}}

%%{{{ x: down_is_downset_up_is_upset 
\exercise.
\label{down_is_downset_up_is_upset}%
Sejam $P$ poset e $A \in P$.
Prove que $\down A$ é um downset e $\up A$ um upset.

\endexercise
%%}}}

%%{{{ x: equivalent_statements_to_x_leq_y 
\exercise.
\label{equivalent_statements_to_x_leq_y}%
Sejam $P$ um poset, $x,y\in P$.
Prove que as afirmações
\beginil
\item{(i)}   $x \leq y$;
\item{(ii)}  $\down x \subseteq \down y$;
\item{(iii)} para todo downset $D$ de $P$ com $y \in D$, temos $x\in D$.
\endil
são equivalentes.

\solution
Vamos provar usando um caminho ``round-robin'':
\proofpart{$\text{(i)}\Rightarrow\text{(ii)}$.}
Seja $a \in \down x$.  Logo $a \leq x$, e como $x\leq y$ (hipótese),
pela transitividade da $\leq$ temos $a \leq y$.  Logo $a\in \down y$.
Ou seja, $\down x \subseteq \down y$.
\proofpart{$\text{(ii)}\Rightarrow\text{(iii)}$.}
Seja $D$ downset de $P$ com $y \in D$.
Logo $\down y \subseteq D$.
Pela hipótese $\down x \subseteq \down y$ e logo $\down x \subseteq D$.
Como $x \in \down x$, então $x \in D$.
\proofpart{$\text{(iii)}\Rightarrow\text{(i)}$.}
Observe que $\down y$ é um downset tal que $y$ pertence nele.
Logo $x \in \down y$ (pela hipótese).
Logo $x \leq y$ (pela def.~de $\down y$).

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Operations and constructions 
\section Operações e construções.

%TODO (Construções de conjutos ordenados)
%TODO (Dualidade)
%TODO (Ordens canônicas, ordens lexicográficas)

\endsection
%%}}}

%%{{{ Mappings 
\section Mapeamentos.

%%{{{ df: monotone_embedding_isomorphism 
\definition.
\label{monotone_embedding_isomorphism}%
\tdefined{monótona}%
\tdefined{order-embedding}%
\tdefined{order-isomorfismo}%
\tdefined{isomorfismo}[de ordem]%
Sejam $\sset P {\leq_P}$ e $\sset Q {\leq_Q}$ posets
e $\phi : P \to Q$.
Definimos
$$
\align
\text{$\phi$ monótona}
&\defiff x\leq_P y \implies \phi(x) \leq_Q \phi(y)\\
\text{$\phi$ order-embedding}
&\defiff \text{$\phi$ injetora} \mland x\leq_P y \iff \phi(x) \leq_Q \phi(y)\\
\text{$\phi$ order-isomorfismo}
&\defiff \text{$\phi$ bijetora} \mland x\leq_P y \iff \phi(x) \leq_Q \phi(y)
\endalign
$$
%%}}}

%%{{{ criterion: order_embedding_criterion 
\criterion.
\label{order_embedding_criterion}%
Se $\phi : P \to Q$ tal que
$$
x \leq_P y \iff \phi(x) \leq_Q \phi(y)
$$
então $\phi$ é um order-embedding.
Segue que se $\phi$ é sobrejetora, ela é um order-isomorfismo.
\proof.
Basta provar que $\phi$ é injetora.
Tome $x,y \in P$.
Temos
\alignx{
\phi(x) = \phi(y)
&\implies \phi(x) \leq_Q \phi(y) \mland \phi(y) \leq_Q \phi(x)  \qqby{\ref{converse_of_antisymmetry}}\\
&\implies x \leq_P y \mland y \leq_P x                          \qqby{pela hipótese}\\
&\implies x = y.                                                \qqby{transitividade}
}
\qed
%%}}}

%%{{{ x: converse_of_antisymmetry 
\exercise Converso de antisimetria.
\label{converse_of_antisymmetry}%
Justifique o primeiro passo (a primeira implicação) na prova do~\ref{order_embedding_criterion}.

\endexercise
%%}}}

%%{{{ x: downsets_of_poset_iso_downsets_of_dual 
\exercise.
\label{downsets_of_poset_iso_downsets_of_dual}%
Defina um $\phi : \downsets P \iso \downsets { \dual P }$.

\solution
$\phi(X) = P\setminus X$

\endexercise
%%}}}

%%{{{ x: downsets_of_disjunion_iso_product_of_downsets 
\exercise.
\label{downsets_of_disjunion_iso_product_of_downsets}%
Defina um
$\psi : \downsets { P_1 \disjunion P_2 } \iso \downsets {P_1} \times \downsets {P_2}$.

\solution
$\psi(D) = \tup{ D \inter P_1, D \inter P_2 }$

\endexercise
%%}}}

%%{{{ x: posets_of_divisors 
\exercise.
\label{posets_of_divisors}%
Para $n\in\nats$, definimos o poset
${\cal D}_n \defeq \sset {D_n} {\divides}$
onde $D_n \defeq \set{ d \in \nats \st d \divides n }$.
\item{(i)}
Desenha o diagrama Hasse de ${\cal D}_{30}$.
\item{(ii)}
Ache conjunto $A$ tal que ${\cal D}_{30} \iso \sset {\pset A} {\subseteq}$
e defina um isomorfismo $\phi : D_{30} \to \pset A$.
\item{(iii)}
Existe conjunto $B$ tal que ${\cal D}_0 \iso \sset {\pset B} {\subseteq}$?
Se sim, ache o $B$ e defina um isomorfismo
$\phi : D_0 \to {\pset B}$;
se não, prove que é impossível.

\solution%%{{{
\noindent (i)
Primeiramente calculamos: $D_{30} = \set{1, 2, 3, 5, 6, 10, 15, 30}$.
$$
\tikzpicture
\node (max) at (0,4)  {$30$};
\node (a)   at (-2,2) {$6$};
\node (b)   at (0,2)  {$10$};
\node (c)   at (2,2)  {$15$};
\node (d)   at (-2,0) {$2$};
\node (e)   at (0,0)  {$3$};
\node (f)   at (2,0)  {$5$};
\node (min) at (0,-2) {$1$};
\draw (min) -- (d) -- (a) -- (max) -- (b) -- (f)
(e) -- (min) -- (f) -- (c) -- (max)
(d) -- (b);
\draw[preaction={draw=white, -,line width=6pt}] (a) -- (e) -- (c);
\endtikzpicture
$$
\endgraf
\noindent (ii)
Tome o $A = \set{2,3,5}$ e defina a função $\phi : \pset A \to D_{30}$
pelas equações:
$$
\align
\phi(30) &= A\\
\phi(15) &= \set{3,5}\\
\phi(10) &= \set{2,5}\\
\phi(6)  &= \set{2,3}\\
\phi(2)  &= \set{2}\\
\phi(3)  &= \set{3}\\
\phi(5)  &= \set{5}\\
\phi(1)  &= \emptyset
\endalign
$$
Seu diagrama Hasse parece assim:
$$
\tikzpicture
\node (max) at (0,4)  {$\set{2,3,5}$};
\node (a)   at (-2,2) {$\set{2,3}$};
\node (b)   at (0,2)  {$\set{2,5}$};
\node (c)   at (2,2)  {$\set{3,5}$};
\node (d)   at (-2,0) {$\set 2$};
\node (e)   at (0,0)  {$\set 3$};
\node (f)   at (2,0)  {$\set 5$};
\node (min) at (0,-2) {$\emptyset$};
\draw (min) -- (d) -- (a) -- (max) -- (b) -- (f)
(e) -- (min) -- (f) -- (c) -- (max)
(d) -- (b);
\draw[preaction={draw=white, -,line width=6pt}] (a) -- (e) -- (c);
\endtikzpicture
$$
\noindent
Obs: qualquer conjunto $A$ com $|A|=3$ serve!
Uma avantagem desse é que podemos bem elegantemente definir a bijecção
inversa, mandando cada subconjunto de $\set{2,3,5}$ para seu produtório!
\endgraf
\noindent (iii)
Não existe, pois $D_0 = \nats$ (contável)
e logo não pode ser equinúmero com o powerset de nenhum conjunto $B$.
\endgraf
\noindent (iv)
Verdade, a função $\phi : D_0 \to \set{D_n \st n\in \nats}$ definida pela
$$
\phi(n) = D_n
$$
é um isomorfismo, pois:
$$
n \divides m \iff D_n \subseteq D_m.
$$
%%}}}

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Lattices as posets 
\section Reticulados como posets.

%%{{{ df: lattice_as_poset 
\definition.
\label{lattice_as_poset}%
\tdefined{lattice}[como poset]%
\iisee{lattice}{reticulado}
Um poset $\cal L = \sset L {\leq}$
é um \dterm{lattice} (ou \dterm{reticulado}) sse 
para todo $x,y \in L$, os $\sup\set{x,y}$ e $\inf\set{x,y}$
existem.
%%}}}

\endsection
%%}}}

%%{{{ Lattices as algebraic structures 
\section Reticulados como estruturas algébricas.

%%{{{ df: lattice_as_algebra 
\definition.
\label{lattice_as_algebra}%
\tdefined{lattice}[como algebra]%
Seja $\cal L = \sset L {\join, \meet}$ conjunto estruturado
onde $\join,\meet$ são operadores binários no $L$.
Chamamos o $L$ um \dterm{lattice} (ou \dterm{reticulado}) sse
as operações $\join,\meet$ são associativas, comutativas,
e idempotentes, e satisfazem as leis seguintes \emph{de absorção}:
$$
\align
a \join (b \meet a) &= a\\
a \meet (b \join a) &= a
\endalign
$$
%%}}}

%%{{{ x: abs_and_com_imply_idem 
\exercise.
\label{abs_and_com_imply_idem}%
Num lattice $L$, prove que podemos inferir as leis da idempotência pelas outras.

\hint
$a\join(a\meet(a\join a))$.

\solution
Seja $a \in L$.
Calculamos
$$
\alignat2
a \join ( (a\join a) \meet a )
&= a \join a                        \qqby{$\meet$-abs.}\\
\intertext{e também}
a \join ( (a\join a) \meet a)
&=  ( (a\join a) \meet a) \join a   \qqby{$\join$-com.}\\
&=  ( a \meet (a\join a) ) \join a  \qqby{$\meet$-com.}\\
&=  a                               \qqby{$\join$-abs.}
\endalignat
$$
Logo $a\join a = a$.

\endexercise
%%}}}

%%{{{ x: two_equiv_ways_to_define_an_order_on_an_algebraic_lattice 
\exercise.
\label{two_equiv_ways_to_define_an_order_on_an_algebraic_lattice}%
Seja $\cal L = \sset L {\join,\meet}$ um láttice pela~\ref{lattice_as_algebra}.
Prove que:
$$
a\join b = b \iff a\meet b = a.
$$

\solution
\lrdir:
Suponha $b = a \join b$.
Calculamos
$$
\alignat2
a \meet b
&= a \meet (a \join b) \qqby{hipótese}\\
&= (a \join b) \meet a \qqby{$\meet$-com.}\\
&= a.                  \qqby{$\meet$-abs.}
\endalignat
$$
\endgraf\noindent
\rldir:
Similar.

\endexercise
%%}}}

%%{{{ df: semilattice 
\definition.
\label{semilattice}%
\tdefined{semilattice}%
\iisee{semireticulado}{semilattice}%
Seja $\cal L = \sset L {\diamond}$ conjunto estruturado
onde $\diamond$ é um operador binário no $L$.
Chamamos o $L$ um \dterm{semilattice} (ou \dterm{semireticulado})
sse a operação $\diamond$ é associativa, comutativa, e idempotente.
%%}}}

%%{{{ x: from_semilattice_to_lattice 
\exercise.
\label{from_semilattice_to_lattice}%
\tdefined{lattice}%
Defina o conceito ``lattice'' usando o conceito ``semilattice''.

\solution
O conjunto estruturado $\cal L = \sset L {\join,\meet}$ é um
\dterm{lattice} sse os conjuntos estruturados
$\sset L {\join}$ e $\sset L {\meet}$ são semilattices,
e as leis de absorção são satisfeitas.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Complete lattices 
\section Reticulados completos.

%%{{{ df: complete_lattice 
\definition.
\label{complete_lattice}%
Um reticulado $L$ é um \dterm{reticulado completo} sse
para todo $S\subseteq L$ ambos os $\Join S$ e $\Meet S$ são definidos.
%%}}}

%%{{{ x: every_complete_lattice_is_bounded 
\exercise.
\label{every_complete_lattice_is_bounded}%
Todo reticulado completo é bounded.

\endexercise
%%}}}

%%{{{ remark: what do we gain in a complete lattice 
\remark.
Já provamos que num reticulado $L$ os joins e meets existem para qualquer
subconjunto \emph{não vazio e finito} dele.
Então num reticulado \emph{completo}, sabemos disso para o vazio
e para os subconjuntos infinitos também.
%%}}}

\endsection
%%}}}

%%{{{ Fixpoints 
\section Fixpoints.

%%{{{ df: fixpoint 
\definition fixpoint.
\tdefined{fixpoint}%
\tdefined{fixpoint}[least]%
\tdefined{fixpoint}[greatest]%
\sdefined{\fixpoints {\holed f}} {o conjunto dos fixpoints de $\holed f$}%
\sdefined{\lfp {\holed F}} {o least fixpoint de $\holed f$}%
\sdefined{\gfp {\holed F}} {o greatest fixpoint de $\holed f$}%
Seja $f : X \to X$.
Chamamos o $x_0\in X$ um \dterm{fixpoint} de $f$ sse
$f(x_0) = x_0$.
Usamos a notação
$$
\fixpoints f
\defeq
\setstt { x \in \dom f } {$x$ é um fixpoint de $f$}
$$
e se $X$ é um poset e $\fixpoints F$ tem mínimo e máximo botamos
$$
\alignat2
\lfp f &\defeq \min(\fixpoints f)&\quad&\text{(o \dterm{least fixpoint} de $f$)}\\
\gfp f &\defeq \max(\fixpoints f)&\quad&\text{(o \dterm{greatest fixpoint} de $f$)}.
\endalignat
$$
%%}}}

%%{{{ thm: knaster_tarski_fixpoint 
\theorem Knaster--Tarski.
\label{knaster_tarski_fixpoint}%
\Knaster{}\Tarski{}%
\ii{teorema}[Knaster--Tarski fixpoint]%
Seja $L$ reticulado completo e $F : L \to L$ monótona.
Então $F$ tem um fixpoint.
\sketch.
Sejam
$$
\xalignat2
D &\asseq \setst { x \in L } { x \leq Fx } &
U &\asseq \setst { x \in L } { Fx \leq x }.
\endxalignat
$$
Considere o conjunto $W \asseq \fixpoints F$.
Observe que $W = D \inter U$.
Vamos provar que o $\Join D$ é um fixpoint de $F$.
(O $\Meet U$ é similar.)
Precisamos $\Join D = F(\Join D)$.
Vamos provar $\Join D \leq F(\Join D)$ primeiro
e depois $F(\Join D) \leq \Join D$.
\proofpart{$\Join D \leq F(\Join D)$:}
Como $\Join D$ é o least upper bound de $D$,
basta provar $F(\Join D)$ é um upper bound de $D$.
\proofpart{$F(\Join D) \leq \Join D$:}
Aqui como $\Join D$ é um upper bound de $D$,
basta mostrar que $F(\Join D)$ é um membro de $D$.
(Nessa parte podemos e vamos usar a $\Join D \leq F(\Join D)$
que acabamos de provar!)
\qes
\proof.
Seja
$D \asseq \setst { x \in L } { x \leq Fx }$.
Vamos provar que $\Join D$ é um fixpoint de $F$,
ou seja $F(\Join D) = \Join D$.
Quebramos a prova em duas partes:
\proofpart{$\Join D \leq F(\Join D)$:}
Basta mostrar que $F(\Join D)$ é um upper bound de $D$.
Tome $d \in D$.
Logo $d \leq Fd$\fact1~(pela definição de $D$)
e também $d \leq \Join D$\fact2,
pois $\Join D$ é um upper bound de $D$.
Como $F$ é monótona, da \byfact2~ganhamos
$Fd \leq F(\Join D)$\fact3.
Juntando (transitividade) as \byfact1~e~\byfact3:
$$
d \leq Fd \leq F(\Join D)
$$
ou seja, $d \leq F(\Join D)$ e como $d$ foi arbitrário elemento de $D$,
concluimos que $F(\Join D)$ é um upper bound de $D$.
Logo $\Join D \leq F(\Join D)$.
\proofpart{$F(\Join D) \leq \Join D$:}
Basta provar que $F(\Join D) \in D$, pois $\Join D$ é um upper bound de $D$.
Como já provamos que $\Join D \leq F(\Join D)$, ganhamos a
$F(\Join D) \leq F(F(\Join D))$ (pela monotonicidade da $F$).
Ou seja, o $F(\Join D)$ satisfaz a definição de $D$, e logo pertence nele:
$F(\Join D) \in D$.
Como $\Join D$ é um upper bound de $D$, temos $F(\Join D) \leq \Join D$.
\qed
%%}}}

%%{{{ remark: the full Knaster--Tarski theorem 
\remark.
O teorema Knaster--Tarski fala que ainda mais é verdade:
o $\fixpoints F\subseteq L$ é um reticulado completo
(\ref{knaster_tarski_fixpoint_full}).
%%}}}

\TODO explicar e desenhar.

%%{{{ cor: real_f_monotone_on_closed_interval_has_lfp_and_gfp 
\corollary.
\label{real_f_monotone_on_closed_interval_has_lfp_and_gfp}%
Sejam $a,b\in\reals$ com $a\leq b$,
e função $f : [a,b] \to [a,b]$ monótona.
Logo $f$ tem um máximo e um mínimo fixpoint.
%%}}}

%%{{{ remark: we do not need f to be continuous 
\remark.
Observe que no~\ref{real_f_monotone_on_closed_interval_has_lfp_and_gfp}
não precisamos da $f$ ser continua.
%%}}}

%%{{{ note: a new proof of Schröder--Bernstein 
\note Uma nova prova de Schröder--Bernstein.
Ganhamos também como corolário o teorema Schröder--Bernstein
(\refn{schroder_bernstein})!
Os detalhes estão no~\ref{schroder_bernstein_lattice_proof}.
%%}}}

\endsection
%%}}}

%%{{{ Irreducible elements 
\section Elementos irredutíveis.

\endsection
%%}}}

%%{{{ Boolean algebras 
\section Álgebras booleanas.

\Boole{}

\endsection
%%}}}

%%{{{ Heyting algebras 
\section Álgebras Heyting.

\Heyting{}

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ df: cofinito_em_nats 
\definition.
\label{cofinito_em_nats}%
\tdefined{cofinito}%
Chamamos um $A\subseteq \nats$ \dterm{cofinito} sse seu complemento $\nats\setminus A$ é finito.
%%}}}

%%{{{ prob: family_of_cofinite_lattice 
\problem.
\label{family_of_cofinite_lattice}%
\tdefined{reticulado}[de conjuntos]%
Mostre que as famílias
$$
\align
\scr L_1 &\asseq \set{ A \subseteq \nats \st \text{$A$ é cofinito} }\\
\scr L_2 &\asseq \set{ A \subseteq \nats \st \text{$A$ é finito ou cofinito} }
\endalign
$$
são \dterm{reticulados de conjuntos}, ou seja,
reticulados com relação de ordem $\subseteq$.

\solution
\proofpartstyle{Sobre o $\scr L_1$.}
Sejam $A, B \in \scr L_1$.
Pela definição então $\nats\setminus A$ e $\nats\setminus B$ são finitos.
Vou mostrar que $A\union B$ e $A\inter B$ são cofinitos, e logo pertencem no $\scr L_1$ também.
Calculamos 
$$
\align
\nats\setminus(A\union B) &=\paren{\nats\setminus A} \inter \paren{\nats\setminus B}\\
\nats\setminus(A\inter B) &=\paren{\nats\setminus A} \union \paren{\nats\setminus B},
\endalign
$$
logo os dois conjuntos no lado esquerdo são finitos como intersecção e união de
finitos respectivamente.
\endgraf
\proofpartstyle{Sobre o $\scr L_2$.}
Sejam $A, B \in \scr L_2$.
Separamos em casos:
\endgraf
\case{Caso ambos finitos:}
Facilmente $A\union B$ e $A \inter B$ são finitos também,
como intersecção e união de conjuntos finitos.
Logo ambos pertencem no $\scr L_2$.
\endgraf
\case{Caso ambos cofinitos:}
Provamos isso na demonstração sobre o $\scr L_1$.
\endgraf
\case{Caso contrário:}
Temos um dos $A,B$ finito e o outro cofinito.
Sem perda de generalidade, suponha que $A$ finito, $B$ cofinito.
O $A\inter B$ é trivialmente finito como intersecção de finito com qualquer conjunto.
Logo $A\inter B \in \scr L_2$.
O $A\union B$ é cofinito, pois
$$
\nats\setminus(A \union B) = \paren{\nats\setminus A} \inter \paren{\nats\setminus B}
$$
que é finito para o mesmo motivo (intersecção com o $\nats\setminus B$ que é finito).
Logo $A\union B \in \scr L_2$.

\endproblem
%%}}}

%%{{{ prob: family_of_cofinite_not_complete_lattice 
\problem.
\label{family_of_cofinite_not_complete_lattice}%
Mostre que nenhum dos $\scr L_1,\scr L_2$ do~\ref{family_of_cofinite_lattice}
é completo.

\hint
Seja $A_n \asseq \nats\setminus\set{0,2,\dotsc, 2n - 2}$ o $\nats$ sem os
primeiros $n$ números pares.
Mostre que:
\emph{se $B \subseteq A_n$ para todo $n\in \nats$, então $B$ não é cofinito}.

\solution
Vamos provar primeiramente a afirmação seguinte:
\emph{se $B \subseteq A_n$ para todo $n\in \nats$, então $B$ não é cofinito}.
\endgraf
\proofstyle{Prova da afirmação:}
Suponha que para todo $n\in\nats$, $B \subseteq A_n$.
Logo
$$
\align
    B &\subseteq \Inter_{i=0}^\infty A_i\\
\intertext{e complementando os dois lado,}
\nats\setminus B
    &\supseteq \nats\setminus\Inter_{i=0}^\infty A_i\\
    &= \Union_{i=0}^\infty(\nats\setminus A_i)\\
    &= \Union_{i=0}^\infty(\set{0,2,\dotsc, 2n-2})\\
    &= 2\nats.
\endalign
$$
Como $2\nats$ é infinito, o $B$ não é cofinito.
\endgraf
Agora voltamos a provar que nenhum dos $\scr L_1, \scr L_2$ é completo.
Considere o conjunto
$$
\cal S \asseq \set { A_0, A_1, A_2, \dotsc }
$$
Observe que
$\cal S \subseteq \scr L_1, \scr L_2$
pois todos os seus elementos são claramente cofinitos.
Mesmo assim, o $\Inter \cal S$ não é cofinito
$\Inter \cal S$ é o conjunto de todos os ímpares)
e logo não pertence em nenhum dos $\scr L_1, L_2$.

\endproblem
%%}}}

%%{{{ prob: knaster_tarski_fixpoint_full 
\problem Teorema Knaster--Tarski completo.
\label{knaster_tarski_fixpoint_full}%
No contexto do~\ref{knaster_tarski_fixpoint}, prove que
o subconjunto $\fixpoints F \subseteq L$ é um reticulado completo.

\endproblem
%%}}}

%%{{{ prob: banach_decomposition_theorem 
\problem Teorema de decomposição de Banach.
\label{banach_decomposition_theorem}%

\endproblem
%%}}}

%%{{{ prob: schroder_bernstein_lattice_proof 
\problem Teorema de Schröder--Bernstein.
\label{schroder_bernstein_lattice_proof}%
Sejam $f : A \injto B$ e $g : B \injto A$ funções injetoras.
Usando o teorema fixpoint de Knaster--Tarski~\refn{knaster_tarski_fixpoint}
prove que existe função bijetora $h : A \bijto B$.

\hint
O $\sset{\pset A}{\subseteq}$ é um reticulado completo.

\hint
Considere a função $F : \pset A \to \pset A$ definida pela
$$
F(X) = A \setminus \paren{ \img g {B \setminus {\img f X}} }.
$$
Mostre que ela é monótona.

\hint
Pelo teorema Knaster--Tarski~\refn{knaster_tarski_fixpoint}
a $F$ tem um fixpoint $C \subseteq A$, e
$$
C = F(C)
\iff
C = A \setminus \paren{ \img g {B \setminus {\img f C}} }
\iff
A \setminus C = \img g {B \setminus {\img f C}}.
$$

\hint
Defina a desejada $h : A \bijto B$ por casos:
$$
h(x) = \knuthcases{
\dots, & se $x \in C$ \cr
\dots, & se $x \in A\setminus C$.
}
$$

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{DaveyPriestley},
\cite{gratzerlatticefirst},
\cite{gratzerlatticefoundation}.

\cite[Cap.~6]{ynmnst}.

\cite[Cap.~2]{corilascar1},
\cite[Cap.~4]{bellmachover},
\cite{halmosboolean}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: General topology 
\chapter Topologia geral.

%%{{{ What is a topology? 
\section O que é uma topologia.

\endsection
%%}}}

%%{{{ Topology constructions 
\section Construções de topologias.

\endsection
%%}}}

%%{{{ Bases and subbases 
\section Bases e subbases.

\endsection
%%}}}

%%{{{ Continuity 
\section Continuidade.

\endsection
%%}}}

%%{{{ Connectedness 
\section Conectividade.

\endsection
%%}}}

%%{{{ Compactness 
\section Compactividade.

\endsection
%%}}}

%%{{{ Hausdorff and separation axioms 
\section Hausdorff e axiomas de separação.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{janichtopology},
\cite{simmonstopology},
\cite{munkrestopology},
\cite{willardtopology}.

\cite{vickerstopology},
\cite{escardosynthetic}.

\cite{johnstonestone}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Graph theory 
\chapter Teoria de grafos.

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

Umas introduções extensas são
o clássico~\cite{bondymurty1976}
e o mais novo~\cite{ChartrandZhang}.
Depois continua com~\cite{diestelgraph}
e~\cite{bondymurty2011}.
Finalmente, um nível ainda mais avançado, \cite{bollobasmodern}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Lambda calculus 
\chapter Lambda calculus.
\label{Lambda_calculus}%

%%{{{ The untyped lambda calculus 
\section O $\lambda$-calculus não-tipado.

\endsection
%%}}}

%%{{{ Faithfully representing mathematics 
\section Representando matemática fielmente.

\endsection
%%}}}

%%{{{ Programming 
\section Programmando.

\endsection
%%}}}

%%{{{ Recursion and fixpoints 
\section Recursão e fixpoints.

\endsection
%%}}}

%%{{{ Functional programming revisited 
\section Programação funcional revisitado.

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ prob: what_does_this_lambda_term_with_minus_do 
\problem.
\label{what_does_this_lambda_term_with_minus_do}
Suponha que já temos definido um $\lambda$-term $\Lmac{minus}$,
que comporta corretamente, no sentido que:
$$
\align
\Lmac{minus}\ {\Lnum n}\ {\Lnum m}
&\Lfinto \knuthcases{
  \Lnum {n - m},   &se $n \geq m$\cr
  \Lnum {0},       &se $n < m$.
}
\endalign
$$
Explique o comportamento do termo
$$
\Lmac f  \asseq  \Llam n {n\ (\Lmac{minus}\ {\Lnum 1})\ {\Lnum 0}}
$$
quando for aplicado para um numeral de \Church[numeral]{}Church $\Lnum k$:
qual é a função $f : \nats\to\nats$ que o termo $\Lmac f$ computa?

\hint
Cuidado com \Curry[currificação]{}Curry.

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{nederpeltgeuvers},
\cite{lecturesch}.
\cite{hindleyseldinlambdacl},
\cite{krivinelambda}.
\cite{barendregtlambda}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Combinatory logic 
\chapter Lógica combinatória.

%%{{{ Our first combinators 
\section Nossos primeiros combinadores.

%%{{{ df: first_combinators 
\definition.
\label{first_combinators}%
$$
\xalignat4
    \cI\,x    &\Cto x     &   \cB\,x\,y\,z &\Cto x\,(y\,z) &   \cS\,x\,y\,z &\Cto x\,z\,(y\,z)&\cR\,x\,y\,z &\Cto y\,z\,x\\\\
    \cK\,x\,y &\Cto x     &   \cBp\,x\,y\,z&\Cto y\,(x\,z) &   \cW\,x\,y    &\Cto x\,y\,y     &\cV\,x\,y\,z &\Cto z\,x\,y\\\\
    \cM\,x    &\Cto x\,x  &   \cC\,x\,y\,z &\Cto x\,z\,y   &                                
\endxalignat
$$
%%}}}

%%{{{ x: some_equiv_to_I 
\exercise.
\label{some_equiv_to_I}%
Mostre que o combinador
$\C S\ \C K\ (\C W\ (\C I\ \C B))$ comporta como o $\C I$.

\endexercise
%%}}}

%%{{{ x: another_equiv_to_I 
\exercise.
\label{another_equiv_to_I}%
Mostre que o combinator
$\C C\ (\C W\ \C K)\ \C K\ \C W$ comporta como o $\C I$.

\endexercise
%%}}}

%%{{{ x: CL_define_Bp 
\exercise.
\label{CL_define_Bp}%
Defina o $\cBp$ dos $\cI$, $\cM$, $\cB$, $\cC$.

\endexercise
%%}}}

%%{{{ x: CL_define_R 
\exercise.
\label{CL_define_R}
Defina o $\cR$ dos $\cI$, $\cK$, $\cM$, $\cB$, $\cBp$, $\cC$, $\cS$, $\cW$.

\endexercise
%%}}}

%%{{{ x: CL_define_V 
\exercise.
\label{CL_define_V}
Defina o $\cV$ dos $\cI$, $\cK$, $\cM$, $\cB$, $\cBp$, $\cC$, $\cS$, $\cW$, $\cR$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{mockingbird},
\cite{bimbocl},
\cite{hindleyseldinlambdacl}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Mathematical logic 
\chapter Lógica matemática.
\label{Mathematical_logic}%

%%{{{ Semantics: worlds and models 
\section Semântica: mundos e modelos.

\note Mundos em $\zolang$: valuação e sua extenção recursiva.

\note Tautologias na $\zolang$.

\note Mundos em $\folang$: estruturas, e valuação de variáveis.

\note Tautologias na $\folang$.

\note Emulando constantes por funções.

\note Emulando funções por relações.

\note Modelos.

\note Como provar que duas formulas da $\folang$ (não) são equivalentes.

\note Independência de axiomas: o 5o axioma de Euclides.

\endsection
%%}}}

%%{{{ Complete sets of connectives 
\section Conjuntos de conectivos completos.

\endsection
%%}}}

%%{{{ Classical and intuitionistic logic 
\section Lógica clássica e intuicionista.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

Sobre lógica matemática:
\cite{kleeneIM},
\cite{curryfoundations};
\cite{kleenelogic},
\cite{smullyanfol};
\cite{corilascar1}~\&~\cite{corilascar2},
\cite{shoenfieldlogic},
\cite{bellmachover}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Structural recursion and induction 
\chapter Recursão e indução estrutural.

%%{{{ Recursing over formulas 
\section Recursando nas fórmulas.

%%{{{ eg: bincon_count 
\example.
\label{bincon_count}%
Defina uma função $f : \zolang \to \nats$ que calcula o número
de conectivos binários que aparecem na sua entrada.
Use-lá para calcular os conectivos binários da expressão
$$
\lnot(P_4 \limplies (P_9 \land \lnot P_9)).
$$

\solution
Seguindo a definição de $\zolang$, cada um dos seus elementos
é formado por uma de certas regras.  Basta escrever então como
calcular o número desejado para cada um desses casos:
$$
\alignat2
f(p)                &= 0,          &\quad&\text{($p\in \mathrm{Pvar}$)} \tag{BC$_{P}$}\\
f(\lnot A)          &= f(A),            &&\text{($A\in \zolang$)}       \tag{BC$_{\lnot}$}\\
f((A \limplies B))  &= f(A) + 1 + f(B), &&\text{($A,B\in \zolang$)}     \tag{BC$_{\limplies}$}\\
f((A \land B))      &= f(A) + 1 + f(B), &&\text{($A,B\in \zolang$)}     \tag{BC$_{\land}$}\\
f((A \lor B))       &= f(A) + 1 + f(B), &&\text{($A,B\in \zolang$)}     \tag{BC$_{\lor}$}\\
\intertext{Preguiçosamente, podemos condensar as três últimas equações em úma só, assim:}
f((A \heartsuit B)) &= f(A) + 1 + f(B), &&\text{($A,B\in \zolang$, e $\heartsuit \in \set{\limplies,\land,\lor}$)}
\endalignat
$$
Aplicando nossa função na fórmula dada calculamos:
$$
\alignat2
f( \lnot(P_4 \limplies (P_9 \land \lnot P_9)) )
&= f( (P_4 \limplies (P_9 \land \lnot P_9)) )   \qqby{por BC$_{\lnot}$}\\
&= f( P_4 ) + 1 + f( (P_9 \land \lnot P_9) )    \qqby{por BC$_{\limplies}$}\\
&= 0 + 1 + f( (P_9 \land \lnot P_9) )           \qqby{por BC$_{P}$}\\
&= 0 + 1 + ( f( P_9 ) + 1 + f ( \lnot P_9 ) )   \qqby{por BC$_{\land}$}\\
&= 0 + 1 + ( 0 + 1 + f ( \lnot P_9 ) )          \qqby{por BC$_{P}$}\\
&= 0 + 1 + ( 0 + 1 + f ( P_9 ) )                \qqby{por BC$_{\lnot}$}\\
&= 0 + 1 + ( 0 + 1 + 0 )                        \qqby{por BC$_{P}$}\\
&= 2
\endalignat
$$

\endexample
%%}}}

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{aczelinductive},
\cite{ynminduction}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Computability and complexity 
\chapter Computabilidade e complexidade.
\label{Computability_and_complexity}%

%%{{{ A surprisingly difficult question 
\section Uma questão surpresamente difícil.

\endsection
%%}}}

%%{{{ Models of computation 
\section Modelos de computação.

\endsection
%%}}}

%%{{{ Decision problems 
\section Problemas de decisão.

\endsection
%%}}}

%%{{{ The halting problem 
\section O problema da parada.

\endsection
%%}}}

%%{{{ Asymptotic notation 
\section A notação assintótica.

\endsection
%%}}}

%%{{{ Analysis of algorithms 
\section Análise de algorítmos.

\endsection
%%}}}

%%{{{ Computational complexity 
\section Complexidade computacional.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{cutlandcomputability},
\cite{kleeneIM},
\cite{rogersrecursive}.

\cite{kozenac}, \cite{kozentc}.

\cite{daviscu}, \cite{davisccl}, \cite{alicebook}.

\cite[Cap.~7]{bellmachover}.

\cite{dpv},
\cite{jonescomputability}.
\cite{gareyjohnson}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Theory of recursive functions 
\chapter Teoria de funções recursivas.
\label{Recursive_functions}%

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite[Part~III]{kleeneIM},
\cite{shoenfieldrecursion},
\cite{ynmrandc},
\cite{rogersrecursive}.

\cite[Cap.~6--8]{bellmachover}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Formal languages 
\chapter Linguagens formais.

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{alicebook},
\cite{kozenac},
\cite[Part~2]{davisccl}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Axiomatic set theory 
\chapter Teoria axiomática dos conjuntos.
\label{Axiomatic_set_theory}%

%%{{{ Problems in Cantor's paradise: Russell's paradox 
\section Problemas no paraíso de Cantor: o paradoxo de Russell.

%%{{{ Russell's paradox 
\note O paradoxo de Russell (1902).
\label{russells_paradox}%
\tdefined{paradoxo}[de Russell]%
Russell\Russell[paradoxo]~observou que o conjunto
$$
\Univ \defeq \set{ x \st \text{$x$ é conjunto} }
$$
tem uma peculiaridade, uma propriedade estranha:
\emph{ele pertence nele mesmo}, ou seja, $\Univ\in \Univ$.
Os conjuntos que encontramos em matemática normalmente não têm essa
propriedade: $\nats\notin\nats$, pois o $\nats$ não é um número natural!
Similarmente $\set{0,1,\set{1,2}}\notin\set{0,1,\set{1,2}}$, pois
$\set{0,1,\set{1,2}} \neq 0$,
$\set{0,1,\set{1,2}} \neq 1$, e
$\set{0,1,\set{1,2}} \neq \set{1,2}$.
Também $\emptyset \notin \emptyset$ pois nada pertence ao $\emptyset$.
Tudo bem, nenhum problema com isso, mas faz sentido definir o conjunto de todos os
conjuntos ``normais'', ou seja, aqueles que não têm essa propriedade estranha
de pertencer neles mesmo.  Russell definiu então o conjunto seguinte:
$$
R \defeq \set{ x \st \text{$x$ é conjunto e $x\notin x$} }.
$$
E se perguntou: \emph{o conjunto $R$ é ``normal'' ou tem essa propriedade estranha?}
Consideramos os dois casos:
Se $R\in R$ então pela definição de $R$ temos que $R\notin R$; então esse caso é impossível.
Se $R\notin R$ então $R$ não pertence nele mesmo e pela definição de $R$ temos $R\in R$; e assim esse caso também é impossível!
Curtamente concluimos que:
$$
R \in R \iff R\notin R
$$
e naturalmente queremos escrever um grande \emph{``absurdo''} neste momento,
mas\dots{}
De onde chegamos nesse absurdo?
Todas as vezes que chegamos num absurdo até agora, foi tentando provar algo:
\emph{supondo uma hipótese $H$}, chegamos num absurdo, então concluimos que
sua negação $\lnot H$ é verdade, ou vice-versa, usando o ``reductio ad absurdum'',
querendo provar que a $H$ é verdade supomos sua negação $\lnot H$,
achamos um absurdo e concluimos que nossa suposição não pode ser correta,
logo $H$.
Mas aqui não começamos supondo algo aleatoriamente.
Qual vai ser nossa conclusão agora?
Parece que chegamos num absurdo apenas com lógica sem supor nada ``extra''.
Será que lógica ou matemática é quebrada?
%%}}}

%%{{{ General Comprehension Principle 
\principle Comprehensão geral.
\label{general_comprehension_principle}%
Seja $P(\dhole)$ uma condição definitiva.
Existe um conjunto
$$
\set { x \st P(x) }
$$
cujos membros são exatamente todos os objetos $x$
que satisfazem a condição: $P(x)$.
%%}}}

%%{{{ cor: The general comprehension principle is invalid 
\corollary Russell.
O princípio da comprehensão geral não é válido.
\proof.
Supondo que é, chegamos no absurdo que achamos no~\refn{russells_paradox}.
\qed
%%}}}

\endsection
%%}}}

%%{{{ Russell's and Zermelo's solutions 
\section As soluções de Russell e de Zermelo.

\note Teoria de tipos (Russell).
\Russell[teoria de tipos]{}

\note Teoria axiomática de conjuntos (Zermelo).
\Zermelo[teoria axiomática de conjuntos]{}

\note Créditos.
A teoria axiomática de conjuntos que estudamos nesse capítulo é conhecida
como ``Zermelo\Zermelo{}--\Fraenkel{}Fraenkel set theory''.
Mesmo assim, mais foram envolvidos na sua evolução, sua definição, e seu
amadurecimento, como os \Mirimanoff{}Mirimanoff, \Skolem{}Skolem,
e \vonNeumann{}von~Neumann, entre outros.

\endsection
%%}}}

%%{{{ Translations to and from the FOL of set theory 
\section Traduções de e para a FOL de conjuntos.
\label{FOL_translations_for_sets}%

%%{{{ The FOL of set theory 
\note A FOL da teoria de conjuntos.
Nessa linguagem de primeira ordem temos apenas um predicado não-constante:
o $\in$, de aridade 2, cuja interpretação canônica é ``\thole\ pertence ao \thole''.
Nosso universo aqui consiste (apenas) em conjuntos.
%%}}}

%%{{{ ex: FOL_translations_for_sets_exercise 
\exercise.
\label{FOL_translations_for_sets_exercise}%
Traduza as frases seguintes para a FOL da teoria de conjuntos.
\beginol
\li Existe conjunto sem membros.
\li O conjunto $x$ não tem membros.
\li O conjunto $y$ tem membros.
\li Existe conjunto com membros.
\li O $x$ é um singleton.
\li Existe conjunto com exatamente um membro.
\li Existe conjunto com pelo menos dois membros.
\li Os $x$ e $y$ têm exatamente um membro em comum.
\li Todos os conjuntos tem o $x$ como membro.
\li Existe conjunto que pertence nele mesmo.
\li O $y$ consiste em todos os subconjuntos de $x$ com exatamente 2 elementos.
\li Existe conjunto com exatamente dois membros.
\li Para todos conjuntos $a$ e $b$ sua intersecção é conjunto.
\li A união de $a$ e $b$ é um conjunto.
\li O $x$ não pertence em nenhum conjunto.
\li Existem conjuntos tais que cada um pertence no outro.
\li Existe conjunto que não é igual com ele mesmo.
\endol

\endexercise
%%}}}

%%{{{ Merely saying something doesn't make it true 
\note Apenas escrever algo não o torna verdade.
O fato que podemos expressar uma afirmação numa linguagem não quer dizer
que essa afirmação é válida.  Isso não é nada profundo: em português
também podemos escrever a frase ``a lua não é feita de queijo'', mas isso
não quer dizer que realmente não é---todos sabemos que é, certo?
Infelizmente existe um hábito de confundir as duas noções e usar
como ``prova de validade'' o fato que apenas algo foi escrito, ou dito.%
\footnote{Veja por exemplo argumentações de várias igrejas de várias religiões.}
A afirmação da fórmula que tu achou para a última frase
do~\ref{FOL_translations_for_sets_exercise} por exemplo é falsa em nosso
mundo de conjuntos e ainda mais: é falsa em cada mundo possível, com qualquer
interpretação do símbolo $\in$!
%%}}}

%%{{{ A useful pattern 
\note Um padrão útil.
Muitas vezes queremos dizer que
existe um certo conjunto \emph{determinado por uma propriedade
característica}, ou seja, um conjunto $s$ que consiste em exatamente
todos os objetos que satisfazem um certo critério.
\endgraf
\emph{Como podemos dizer isso na FOL da teoria de conjuntos?}
Fácil!  Assim:
$$
\phantom{
\forall a
\forall b
\forall c
\dotsb
}
{\color{alert}
\exists s
\forall x
\bigparen{
x\in s \liff
{}
{\color{normal}
\tunderbrace{
\text{\vphantom|\xlthole}
}{critério}
}}}.
$$
Na maioria das vezes queremos afirmar a existência dum certo conjunto
dados conjuntos $a,b,c,\dotsc$.
Nesse caso usamos apenas o
$$
\forall a
\forall b
\forall c
\dotsb
{\color{alert}
\exists s
\forall x
\bigparen{
x\in s \liff
{}
{\color{normal}
\text{\xlthole}
}}}.
$$
Esse padrão vai aparecer em muitos dos axiomas abaixo.
%%}}}

%%{{{ Abbreviations and syntactic sugar 
\note Abreviações e açúcar sintáctico.
Assim que conseguirmos descrever um conceito interessante com uma fórmula,
faz sentido introduzir uma notação, um novo predicado.
Por exemplo, nas (2) e (5) de~\ref{FOL_translations_for_sets_exercise},
tu achou fórmulas que afirmam que $x$ é vazio, e que $x$ é um singleton.
Faz sentido definir como abreviações então os predicados seguintes:
$$
\align
\Empty(x)
&\sugareq
\lnot \exists w \paren{ w \in x }\\
\Singleton(x)
&\sugareq
\exists w \bigparen{
w \in x
\land
\forall u \paren{ u \in x \limplies u = w }
}
\intertext{e os símbolos:}
a \subseteq b
&\sugareq \forall x \paren{ x \in a \limplies x \in b }\\
a \subsetneq b
&\sugareq a \subseteq b \land a \neq b.
\intertext{Lembre-se também nossa práctica onde usamos}
x \neq y
&\sugareq \lnot\, x = y,\\
x \notin y
&\sugareq \lnot\, x \in y,
\endalign
$$
etc.
%%}}}


\endsection
%%}}}

%%{{{ The first axioms of Zermelo 
\section Os primeiros axiomas de Zermelo.

%%{{{ ax: Extensionality 
\axiom Extensionalidade.
\tdefined{axioma}[Extensionality]%
\label{extensionality}%
Todo conjunto é determinado por seus membros.
$$
\forall a \forall b
\paren{
a = b
\liff
\forall x
\paren{
x \in a
\liff
x \in b
}
}
\axtaglabel{ZF1}{extensionality}
$$
%%}}}

\note.
Qual o efeito disso em nosso mundo?
Ainda nem podemos garantir a existência de nada,
mas pelo menos sabemos dizer se duas coisas são iguais ou não.
Vamos logo garantir a existência dum conjunto familiar:

%%{{{ ax: Emptyset 
\axiom Emptyset.
\tdefined{axioma}[Emptyset]%
\label{emptyset}%
Existe conjunto sem membros.
$$
\exists s \forall x
\paren{
x \notin s
}
\axtaglabel{ZF2}{emptyset}
$$
%%}}}

\blah.
E já nosso mundo mudou completamente:
ganhamos nossa primeira peça, uma coisa para brincar:
\emph{um conjunto sem membros!}
E já estamos em posição de provar nosso primeiro teorema,
seguido pela nossa primeira definição:

%%{{{ thm: uniqueness_of_emptyset 
\theorem Unicidade do conjunto vazio.
\ii{unicidade!do $\emptyset$}%
\label{uniqueness_of_emptyset}%
O conjunto sem membros garantido pelo axioma~\axref{emptyset} é único.
\proof.
Suponha que $e, o$ são conjuntos ambós satisfazendo a propriedade:
$$
\forall x\paren{x \notin e}
\qqqquad
\forall x\paren{x \notin o}.
$$
Então a equivaléncia
$$
x\in e \iff x \in o
$$
é válida para todo $x$, pois ambos lados são falsos.
Logo, pelo axioma~\axref{extensionality}, $e=o$.
\qed
%%}}}

%%{{{ df: emptyset_def 
\definition Conjunto vazio.
\label{emptyset_def}%
\tdefined{conjunto}[vazio]%
\sdefined {\emptyset} {o conjunto vazio}%
Denotamos com $\emptyset$ o \dterm{conjunto vazio} com a propriedade característica
$$
\forall x\paren{x\notin \emptyset}.
$$
%%}}}

\blah.
\noindent\dots e agora parece que não podemos fazer muita coisa mais.
Precisamos novos axiomas:

%%{{{ ax: Pairset 
\axiom Pairset.
\tdefined{axioma}[Pairset]%
\label{pairset}%
Dado um par de conjuntos, existe conjunto que consiste
em exatamente os conjuntos do par.
$$
\forall a
\forall b
\exists s
\forall x
\bigparen{
x\in s
\liff
\paren{
x = a
\lor
x = b
}
}
\axtaglabel{ZF3}{pairset}
$$
%%}}}

%%{{{ df: doubleton 
\definition Doubleton.
\tdefined {doubleton}%
\sdefined {\set{\holed a, \holed b}} {o conjunto doubleton de $\holed a$ e $\holed b$}%
Dados $a$ e $b$ quaisquer, o conjunto que consiste nos $a$ e $b$
é chamado o \dterm{doubleton} de $a$ e $b$, e denotado por $\set {a, b}$.
Definimos assim o operador $\set{\dhole, \dhole}$.
%%}}}

%%{{{ Effects 
\note Efeitos.
Como isso muda nosso mundo?
Quais novas peças ganhamos em nosso xadrez?
Para ganhar a existência de algo usando o Pairset
precisamos dá-lo dois objetos,
pois começa com dois quantificadores universais ($\forall$) antes de chegar no seu primeiro existencial ($\exists$):
``$\forall a\forall b \exists \dots$''.
Quais objetos vamos escolher para dá-lo?
Nosso mundo está tão pobre que é fácil responder nessa pergunta:
\emph{vamos usar como $a$ e como $b$ a única peça que temos: o $\emptyset$}.
Ganhamos então que:
$$
\exists s \forall x\bigparen { x \in s \liff \paren{ x = \emptyset \lor x = \emptyset }}
$$
ou seja, $\exists s \forall x \bigparen { x \in s \liff x = \emptyset }$,
ou seja, existe o conjunto
$$
\set { x \st x = \emptyset }
$$
que acostumamos a denotá-lo por $\set \emptyset$.
Uma nova peça!  E teoremas?
%%}}}

%%{{{ thm: singleton_thm 
\theorem Singleton.
\label{singleton_thm}%
Dado conjunto $a$, existe um único conjunto cujo membro único é o $a$.
Formalmente,
$$
\forall a
\exists s
\forall x
\bigparen{
x\in s
\liff
x = a
}.
$$
\proof.
Bote $a\asseq a$ e $b\asseq a$ no Pairset~(\axref{pairset}):
$$
\phantom{\forall a}
\exists s
\forall x
\bigparen{
x \in s
\liff
x = a
}.
$$
O conjunto cuja existência está sendo afirmada tem como membro único o $a$,
e graças ao~\axref{extensionality}, ele é o único conjunto com essa propriedade.
\qed
%%}}}

%%{{{ df: singleton 
\definition.
\label{singleton}%
\sdefined {\set{\holed a}} {o conjunto singleton de $\holed a$, com membro único o $\holed a$}%
Dado qualquer conjunto $a$, o conjunto cujo único membro é o $a$
é chamado o \dterm{singleton} de $a$, e denotado por $\set a$.
Definimos assim o operador $\set{\dhole}$.
%%}}}

%%{{{ x: infinitely_many_sets 
\exercise.
Ache uma infinidade de peças novas usando apenas os axiomas \axref{extensionality}, \axref{emptyset}, e \axref{pairset}.

\hint
Agora temos duas opções para cada $\forall$ do Pairset: $\emptyset$, $\set\emptyset$.

\endexercise
%%}}}

\blah.
Mesmo que nosso mundo mudou drasticamente---sim, ganhamos uma infinidade de
objetos---ele ainda tá bem limitado.

%%{{{ x: infinitely_many_singletons 
\exercise.
Mostre como construir uma infinidade de singletons e uma infinidade de doubletons.

\hint
\axref{emptyset}~\&~\ref{singleton_thm}.

\hint
Comece com o $\emptyset$ e aplique iterativamente o operador $\set{\dhole}$.

\solution
Graças ao Emptyset~(\axref{emptyset}) temos o $\emptyset$.
Aplicamos iterativamente o operador $\set{\dhole}$ e assim construimos
a seqüência infinita de singletons
$$
\emptyset,
\set{\emptyset},
\set{\set{\emptyset}},
\set{\set{\set{\emptyset}}},
\set{\set{\set{\set{\emptyset}}}},
\dotsc
$$
Para os doubletons, uma abordagem seria aplicar o $\set{\emptyset,\dhole}$
em todos os membros da seqüência acima começando com o segundo.
Construimos assim a seqüência seguinte de doubletons:
$$
\set{\emptyset, \set{\emptyset}},
\set{\emptyset, \set{\set{\emptyset}}},
\set{\emptyset, \set{\set{\set{\emptyset}}}},
\set{\emptyset, \set{\set{\set{\set{\emptyset}}}}},
\dotsc
$$

\endexercise
%%}}}

%%{{{ x: only_sets_with_up_to_two_elements 
\exercise.
\label{only_sets_with_up_to_two_elements}%
Podemos garantir a existência de conjuntos com qualquer cardinalidade finita que desejamos?

\hint
No exercício anterior construimos uns conjuntos com cardinalidade até 2.
Tente construir conjunto com cardinalidade 3.

\hint
Não tem como.  Por quê?

\solution
A construção dum conjunto com cardinalidade finita $n$ só pode ter sido garantida
ou pelo Emptyset, se $n=0$ (nesse caso o conjunto construido é o próprio $\emptyset$),
ou pelo Pairset, se $n>0$.  Mas o Pairset só construe
conjuntos de cardinalidade $1$ ou $2$, dependendo se o aplicamos em conjuntos
iguais ou não (respectivamente).
Para concluir: nossos axiomas não são suficientemente poderosos para garantir
a existência de conjuntos com cardinalidades maiores que $2$.

\endexercise
%%}}}

\note.
O próximo axioma não vai nos permitir---por enquanto---definir novos conjuntos.
Mas é a versão ``bug-free'' do princípio da comprehensão geral.
Com isso, o paradoxo de Russell se torna teorema!

%%{{{ ax: Separation 
\axiom Separation (schema).
\tdefined{axioma}[Separation (schema)]%
\label{separation}%
{\rm Para cada propriedade $\phi(\dhole)$, o seguinte:}
para todo conjunto, a colecção de todos os seus membros que têm a propriedade $\phi$ é um conjunto.
$$
\forall w
\exists s
\forall x
\bigparen{
x\in s
\liff
\paren{
x\in w 
\land
\phi(x)
}
}
\axtaglabel{ZF4}{separation}
$$
%%}}}

%%{{{ x: how many axioms? 
\exercise.
Quantos axiomas temos listado até este momento?

\hint
Não são 4.

\hint
Não é um número finito de axiomas!

\solution
Veja a discução no~\refn{axioms_vs_axiomatic_schemata}.

\endexercise
%%}}}

%%{{{ Axioms vs. axiomatic schemata 
\note Axiomas vs{.}~esquemas axiomáticos.
\label{axioms_vs_axiomatic_schemata}%
Usamos o termo ``esquema axiomático'', pois para cada fórmula $\phi(\dhole)$,
ganhamos um novo axioma pelo~\axref{separation}.
Para enfatizar isso podemos até o citar como~\axref{separation}$_{\phi}$.
Antes de o usar então precisamos primeiramente escolher nossa fórmula $\phi$, assim passando do \emph{esquema}~\axref{separation}
para o \emph{axioma}~\axref{separation}$_{\phi}$.
Agora como o axioma começa com ``$\forall w \exists \dots$'',
precisamos escolher em qual conjunto $w$ nos vamos o aplicar,
para ganhar finalmente um novo conjunto.
%%}}}

%%{{{ df: set_builder_separation 
\definition.
Denotamos com
$$
\setst {x \in W} {\phi(x)}
$$
o conjunto único (pelo~\axref{extensionality}) garantido pelo~\axref{separation} quando o aplicamos com uma fórmula $\phi(x)$ para um conjunto $W$.
%%}}}

%%{{{ x: separation_yields_no_new_sets_yet 
\exercise.
\label{separation_yields_no_new_sets_yet}%
Mostre que os conjuntos garantidos pelos~\axref{extensionality}--\axref{pairset}
são os mesmos com os conjuntos garantidos pelos~\axref{extensionality}--\axref{separation}.

\hint
Usando o~\axref{separation}, criamos subconjunto de um conjunto dado.

\hint
Quais são todas as cardinalidades possíveis para o conjunto em qual
usamos o~\axref{separation}?

\endexercise
%%}}}

%%{{{ How to use the Separation 
\note Como usar o~\axref{separation}.
Queremos mostrar que uma certa classe $C$ de objetos realmente é um conjunto.
Para conseguir isso com o~\axref{separation},
precisamos construir (pelos axiomas!) um \emph{conjunto}
$W$ que contenha todos os objetos da nossa classe $C$.
Em geral o $W$ vai ter mais elementos, um certo ``lixo'', que precisamos nos livrar.
E é exatamente com o~\axref{separation} que jogamos fora esse lixo,
usando uma apropriada fórmula $\phi$ como ``tesoura'' para cortar o $W$ e ficar só com o $C$,
garantido agora de ser conjunto.
Vamos ver uns exemplos desse uso,
enriquecendo nosso mundo com uns operadores conhecidos.
%%}}}

%%{{{ eg: define inters 
\example.
Defina o operador $\dhole\inter\dhole$.

\solution
Dados conjuntos $a$ e $b$,
precisamos achar um conjunto $W$ que contenha todos os membros
da intersecção desejada.  Assim vamos conseguir definir o $a \inter b$
usando o~\axref{separation} com filtro a fórmula
$$
\phi(x)\asseq {x \in a \land x \in b}
$$
Observe que todos os elementos da $a \inter b$ são elementos tanto de $a$,
quanto de $b$.
Temos então duas opções.  Vamos escolher a primeira e construir o
$$
\setst {x \in a} {x \in a \land x \in b}
$$
Observamos que com essa escolha nem precisamos a parte ``$x \in a$'' em nosso filtro.
Chegamos assim em duas soluções para nosso problema:
$$
\setst {x \in a} {x \in b}
\qqqquad
\setst {x \in b} {x \in a}
$$

\endexample
%%}}}

%%{{{ df: inters 
\definition Intersecção binária.
\label{inters_constructed}%
Sejam conjuntos $a,b$.
Usando o~\axref{separation} definimos
$$
a\inter b \defeq \setst {x\in a} {x\in b}.
$$
%%}}}

%%{{{ x: define setminus 
\exercise.
Defina o operador $\dhole\setminus\dhole$.

\hint
Começa considerando dados conjuntos $a$ e $b$.
Procure um \emph{conjunto} que contenha todos os membros
da classe $a\setminus a$ que tu queres construir como conjunto.
Cuidado: nesse caso não temos as duas opções que tivemos
na~\ref{inters_constructed}.

\solution
Usando o~\axref{separation} definimos:
$$
a\setminus b\defeq \setst {x \in a} {x \notin b}.
$$

\endexercise
%%}}}

%%{{{ x: cannot_define_union_yet 
\exercise.
\label{cannot_define_union_yet}%
Tente definir os operadores $\dhole\union\dhole$ e $\dhole\symdiff\dhole$.

\hint
Dados conjuntos $a$ e $b$,
precisas achar um \emph{conjunto} $W$
que contenha todos os membros de $a\union b$,
para depois filtarar apenas os certos usando
como filtro a fórmula
$$
\phi(x) \asseq
x \in a \lor x \in b
$$
para a operação $\dhole\union\dhole$;
e similarmente para a $\dhole\symdiff\dhole$ só que
para essa o filtro vai ser a fórmula
$$
\phi(x)\asseq
\paren{x \in a \land x \notin b}
\lor
\paren{x \notin a \land x \in b}.
$$

\hint
Não tem como!

\solution
Não tem como!
Os axiomas que temos por enquanto não são suficientemente poderosos para
definir nenhuma dessas operações!

\endexercise
%%}}}

\blah.
Com o axioma da separação no lugar do princípio da comprehensão geral,
o paradoxo de \Russell{}\ii{paradoxo!de Russell!vira teorema}Russell
vira-se um teorema muito útil que nos permite definir o operador
$\russell\dhole$ que
``escolhe definitivamente um objeto fora da sua entrada''.
Vamos?

%%{{{ thm: russells_paradox_to_theorem 
\theorem.
\label{russells_paradox_to_theorem}%
Dado qualquer conjunto existe algo que não pertence nele.
Ainda mais, pelo menos um dos seus subconjuntos não pertence nele.
\sketch.
Tome um conjunto $A$.
Usamos a mesma idéia do paradoxo de Russell\Russell[de paradoxo para teorema],
só que essa vez não consideramos \emph{todos} os conjuntos que não
pertencem neles mesmo, mas apenas aqueles que pertencem ao $A$.
Concluimos que $\russell A \notin A$ pois o caso $\russell A \in A$ chega 
no mesmo absurdo de Russell.
\qes
%%}}}

%%{{{ Univ is not a set 
\corollary.
\label{Univ_is_not_a_set}%
O universo $\Univ$ não é um conjunto.
\proof.
Se $\Univ$ fosse um conjunto, aplicando o teorema teriamos um conjunto $\russell \Univ$
com $\russell\Univ \notin \Univ$, absurdo pela definição do $\Univ$.
\qed
%%}}}

%%{{{ ax: Powerset 
\axiom Powerset.
\tdefined{axioma}[Powerset]%
\label{powerset}%
Para cada conjunto a colecção de todos os seus subconjuntos é um conjunto.
$$
\forall a
\exists s
\forall x
\paren{
x\in s
\liff
x \subseteq a
}
\axtaglabel{ZF5}{powerset}
$$
%%}}}

%%{{{ df: pset 
\definition.
\tdefined{powerset}%
\sdefined {\pset {\holed a}} {o conjunto de partes (powerset) de $\holed a$}%
\iisee{conjunto!de partes}{powerset}%
\iisee{conjunto!potência}{powerset}%
Dado conjunto $a$, escrevemos
$\pset a$
para o conjunto garantido pelo Powerset~(\axref{powerset}),
que é único graças ao~Extensionality(\axref{extensionality}).
Definimos assim o operador $\pset\dhole$.
%%}}}

%%{{{ x: powersingleton 
\exercise.
\label{powersingleton}%
Seja $a$ conjunto.  Mostre que a classe
$$
\class { \set x } { x \in a }
$$
de todos os singletons de elementos de $a$ é conjunto.

\solution
Queremos mostrar que dado conjunto $a$, a classe
$$
\class { \set x } { x \in a }
$$
é conjunto.
Basta só achar um conjunto $W$ tal que todos os $\set x \in W$.
Botamos apenas o $W\asseq\pset a$ que sabemos que é conjunto
pelo~Powerset~(\axref{powerset}), assim ganhando o conjunto
$$
\setst { z\in \pset a } { \lexists {x \in a} {z = \set x} }.
$$
pelo~Separation~(\axref{separation}).

\endexercise
%%}}}

%%{{{ x: arbitrarily_large_finite_sets 
\exercise.
\label{arbitrarily_large_finite_sets}
Usando
os~\axref{extensionality}+\axref{emptyset}+\axref{pairset}+\axref{powerset},
podemos construir conjunto com cardinalidade finita, arbitrariamente grande?

\solution
Sim.
Seja $n\in\nats$.
Precisamos construir um conjunto $A$ com $\card A \geq n$.
Se $n=0$, graças ao Emptyset~(\axref{emptyset}) tomamos $A\asseq\emptyset$.
Se $n>0$, iteramos o operador $\pset\dhole$ até chegar num conjunto
cuja cardinalidade supera o $n$.

\endexercise
%%}}}

%%{{{ x: still_missing_some_finite_cardinalities 
\exercise.
\label{still_missing_some_finite_cardinalities}
Usando os~\axref{extensionality}+\axref{emptyset}+\axref{pairset}+\axref{powerset}, podemos construir conjunto com cardinalidade finita qualquer?

\hint
Não.  Por quê?

\hint
Como vimos no~\ref{only_sets_with_up_to_two_elements},
usando os \axref{extensionality}+\axref{emptyset}+\axref{pairset}
podemos consturir apenas conjuntos com cardinalidades $0$, $1$, e $2$.
Se aplicar o Powerset~(\axref{powerset}) num conjunto $A$ com cardinalidade
finita $n$, qual será a cardinalidade do $\pset A$?

\solution
Não.
Por exemplo, não temos como construir conjunto com cardinalidade $3$,
pois uma tal construção deveria ``terminar'' com uma aplicação do Powerset
(o Emptyset construe conjuntos com cardinalidade $0$, e o Pairset com $1$ ou $2$).
Mas aplicando o Powerset para conjunto com cardinalidade finita $n$,
construimos conjunto com cardinalidade $2^n$, e $3$ não é uma potência de $2$.

\endexercise
%%}}}

%%{{{ Games 
\note Jogos.
Como descobrimos no~\ref{still_missing_some_finite_cardinalities}
não existe estrategia\ii{estratégia}[vencedora]\ vencedora num jogo
onde nosso oponente joga primeiro escolhendo um número $n\in\nats$,
e nosso objetivo é construir pelos axiomas um conjunto
com cardinalidade $n$.
Se ele escolher $n=0$ ou uma potência de $2$, temos como ganhar,
mas caso contrário, não.
\endgraf
No outro lado, num jogo onde  nosso objetivo é construir pelos axiomas um
conjunto com cardinalidade \emph{pelo menos} $n$, como vimos
no~\ref{arbitrarily_large_finite_sets} temos uma estratégia vencedora sim:
comece com uma aplicação do Emptyset~(\axref{emptyset})
para ganhar o $\emptyset$ e aplique iterativamente o
Powerset~(\axref{powerset}) construindo assim conjuntos de
cardinalidades $0$ (do próprio $\emptyset$),
$1$, $2$, $2^2$, $2^{2^2}$, etc., até chegar num conjunto com cardinalidade
maior-ou-igual ao $n$ escolhido por nosso oponente.
%%}}}

%%{{{ x: how many iterations of powerset do we need to win? 
\exercise.
Quantas iterações precisamos para conseguir conjunto com cardinalidade $n\in\nats$?

\endexercise
%%}}}

%%{{{ x: all_finite_cardinalities 
\exercise.
\label{all_finite_cardinalities}
Usando os~\axref{extensionality}+\axref{emptyset}+\axref{separation}+\axref{powerset}, podemos construir conjunto com cardinalidade finita qualquer?

\hint
Dado $n\in\nats$ construa primeiramente um conjunto com cardinalidade
maior-ou-igual, e aplica o Separation~(\axref{separation}) para
ficar com apenas $n$ elementos.
Formalmente, use indução!

\endexercise
%%}}}

%%{{{ ax: Unionset 
\axiom Unionset.
\tdefined{axioma}[Unionset]%
\label{unionset}%
Para cada conjunto, sua união (a colecção de todos os membros dos seus membros) é um conjunto.
$$
\forall a
\exists s
\forall x
\bigparen{
x\in s
\liff
\exists w
\paren{
x \in w
\land
w \in a
}
}
\axtaglabel{ZF6}{unionset}
$$
%%}}}

%%{{{ df: unionset 
\definition.
\tdefined{unionset}%
\sdefined {\Union {\holed a}} {a união de $\holed a$ (operação unária)}
Dado conjunto $a$, escrevemos
$\Union a$
para o conjunto garantido pelo Unionset~(\axref{unionset}),
que é único graças ao~Extensionality~(\axref{extensionality}).
Definimos assim o operador da \dterm{união arbitrária} $\Union\dhole$.
%%}}}

%%{{{ x: union_and_symdiff_constructed 
\exercise.
\label{union_and_symdiff_constructed}%
Defina os operadores binários $\union$ e $\symdiff$.

\hint
(Sobre o operador $\union$.)
Combine os operadores $\Union\dhole$ e $\set{\dhole,\dhole}$!

\hint
(Sobre o operador $\symdiff$.)
Suponha $a,b$ conjuntos.  Temos
$a\symdiff b\subseteq a\union b$.

\solution
Sejam conjuntos $a,b$.
Definimos:
$$
\align
a \union b   &\defeq \Union\set{a,b}\\
a \symdiff b &\defeq \setst {x \in a\union b} {x \notin a\inter b}
\endalign
$$

\endexercise
%%}}}

%%{{{ x: complement_impossible 
\exercise.
\label{complement_impossible}%
Como podemos definir o operador unitário $\complement{\cdot}$ de \emph{complemento},
tal que $\complement a$ é o conjunto de todos os objetos que não pertencem ao $a$?

\hint
De jeito nenhum!  Por quê?

\solution
Não podemos.
Dado conjunto $a$, se seu complemento $\complement a$ também fosse conjunto,
poderiamos aplicar o $\union$ para construir o $a\union\complement a$.
Mas pela definição dos $\union$ e $\complement a$, temos agora
$$
x\in a\union \complement a
\iff
x\in a \lor x \notin a
$$
ou seja, todos os objetos $x$ satisfazem a condição na direita!
Em outras palavras $a \union \complement a$ seria o próprio universo $\Univ$
que sabemos que não é um conjunto.

\endexercise
%%}}}

%%{{{ x: Inter_constructed 
\exercise.
\label{Inter_constructed}%
Defina o operador unário $\Inter$,
aplicável em qualquer conjunto não vazio.
Precisamos o Unionset~(\axref{unionset})?

\solution
Dado conjunto $A\neq\emptyset$, definimos
$$
\Inter A
\defeq
\setst {x \in \Union A} {\lforall {a \in A} {x \in a}}.
$$

\endexercise
%%}}}

%%{{{ thm: finite_set_constructor 
\theorem.
\label{finite_set_constructor}%
Dados $a_1, a_2, \dotsc, a_n$ (onde $n\in\nats$) existe conjunto único
cujos membros são exatamente os $a_1$, $a_2$, \dots, $a_n$.
\sketch.
Provamos por indução no $n$.
Já temos provado o resultado para os valores $n=0,1,2.$
Usamos o operador $\union$ para o passo indutivo.
\qes
%%}}}

\endsection
%%}}}

%%{{{ Construction trees 
\section Arvores de construção.

\blah.
Um jeito bem econômico e claro para descrever uma construção
e usando árvores.
Os exemplos seguintes servem para explicar essa idéia.

%%{{{ eg: Tree explanation 
\example.
Queremos provar que $\set{ \emptyset, \set{\emptyset, \set{\emptyset}}}$
é um conjunto.
Escrevemos:
{Pelo Emptyset~(\axref{emptyset}), $\emptyset$ é um conjunto.
Pelo Pairset~(\axref{pairset}) aplicado com $a,b\asseq\emptyset$ temos
que $\set{\emptyset,\emptyset}$ também é conjunto.
Mas, pelo Extensionality~(\axref{extensionality}),
$\set{\emptyset,\emptyset}=\set{\emptyset}$.
Agora, novamente pelo Pairset~(\axref{pairset}) essa vez
aplicado com $a\asseq\emptyset$ e $b\asseq\set{\emptyset}$
temos que $\set{\emptyset, \set{\emptyset}}$ é um conjunto.
Aplicando uma última vez o Pairset~(\axref{pairset}) com
$a\asseq\emptyset$ e $b\asseq \set{\emptyset, \set{\emptyset}}$,
conseguimos construir o conjunto
$\set{ \emptyset, \set{\emptyset, \set{\emptyset}}}$.
}
Podemos representar essa construção em forma de árvore:
$$
\centerAlignProof
\AxiomC{}
\RightLabel{\axref{emptyset}}
\UnaryInfC{$\emptyset$}
\AxiomC{}
\RightLabel{\axref{emptyset}}
\UnaryInfC{$\emptyset$}
\AxiomC{}
\RightLabel{\axref{emptyset}}
\UnaryInfC{$\emptyset$}
\AxiomC{}
\RightLabel{\axref{emptyset}}
\UnaryInfC{$\emptyset$}
\doubleLine
\RightLabel{\axref{pairset}}
\BinaryInfC{$\set{\emptyset}$}
\RightLabel{\axref{pairset}}
\BinaryInfC{$\set{\emptyset, \set{\emptyset}}$}
\RightLabel{\axref{pairset}}
\BinaryInfC{$\set{\emptyset, \set{\emptyset, \set{\emptyset}}}$}
\DisplayProof{}
$$
onde a dupla linha indica que pulamos alguns passos implícitios,
como o uso de Extensionality~(\axref{extensionality}) nesse caso.
Usamos agora essa construção para construir um conjunto de cardinalidade $3$:
$$
\centerAlignProof
\AxiomC{}
\RightLabel{\axref{emptyset}}
\UnaryInfC{$\emptyset$}
\AxiomC{}
\RightLabel{\axref{emptyset}}
\UnaryInfC{$\emptyset$}
\AxiomC{}
\RightLabel{\axref{emptyset}}
\UnaryInfC{$\emptyset$}
\AxiomC{}
\RightLabel{\axref{emptyset}}
\UnaryInfC{$\emptyset$}
\doubleLine
\RightLabel{\axref{pairset}}
\BinaryInfC{$\set{\emptyset}$}
\RightLabel{\axref{pairset}}
\BinaryInfC{$\set{\emptyset, \set{\emptyset}}$}
\RightLabel{\axref{pairset}}
\BinaryInfC{$\set{\emptyset, \set{\emptyset, \set{\emptyset}}}$}
\RightLabel{\axref{powerset}}
\UnaryInfC{$\set{\emptyset, \set{\emptyset}, \set{\set{\emptyset, \set{\emptyset}}}, \set{\emptyset, \set{\emptyset, \set{\emptyset}}}}$}
\RightLabel{\axref{separation},\ $\phi(x)\asseq \exists w(w\in x)$}
\UnaryInfC{$\set{\set{\emptyset}, \set{\set{\emptyset, \set{\emptyset}}}, \set{\emptyset, \set{\emptyset, \set{\emptyset}}}}$}
\DisplayProof{}
$$
Observe que para usar o \axref{separation} precisamos especificar qual é a fórmula--filtro.
\endexample
%%}}}

%%{{{ eg: tree_construction_with_open_leaves 
\example.
\label{tree_construction_with_open_leaves}%
Seja $a,b$ conjuntos.
Mostre que $\set{b, \set{\emptyset, \set{a}}}$ é conjunto.

\solution
$$
\centerAlignProof
\AxiomC{$b$}
\AxiomC{}
\RightLabel{Empty}
\UnaryInfC{$\emptyset$}
\AxiomC{$a$}
\doubleLine
\RightLabel{Singleton}
\UnaryInfC{$\set{a}$}
\RightLabel{Pair}
\BinaryInfC{$\set{\emptyset, \set{a}}$}
\RightLabel{Pair}
\BinaryInfC{$\set{b, \set{\emptyset, \set{a}}}$}
\DisplayProof{}
$$
Onde deixamos as ``folhas'' da árvore $a,b$ ``sem fechar'', pois
correspondem realmente em nossas hipotéses: os conjuntos $a,b$ são dados!
Observe também que ``Singleton'' se-refere no~\ref{singleton_thm}.

\endexample
%%}}}

%%{{{ x: tree_construction_practice 
\exercise.
\label{tree_construction_practice}%
Sejam $a,b,c,d$ conjuntos.
Mostre pelos axiomas que os seguintes também são:
$$
\align
A &= \set{a,b,c,d}\\
B &= \set{a,b, \set{c,d}}\\
C &= \setstt x {$x \subseteq a\union b\union c\union d$\ \;\&\;\ $x$ tem exatamente 2 membros}
\endalign
$$
Use a método de árvores para umas construções e outras faça escrevendo em texto mesmo.
É bom practicar os dois jeitos.

\solution
Como $a,b$ são conjuntos, pelo Pairset o $\set{a,b}$ também é.
Similarmente o $\set{c,d}$ é conjunto, e aplicando mais uma vez o Pairset neles
temos que o $\set{\set{a,b},\set{c,d}}$ é conjunto.
Agora aplicando o Union nele o ganhamos o $A$.
\endgraf
\bigskip
\noindent
Aqui uma construção do $B$ pelos axiomas, em forma de árvore:
$$
\centerAlignProof
\AxiomC{$a$}
\AxiomC{$b$}
\RightLabel{Pair}
\BinaryInfC{$\set{a,b}$}
\AxiomC{$c$}
\AxiomC{$d$}
\RightLabel{Pair}
\BinaryInfC{$\set{c,d}$}
\RightLabel{Singleton}
\doubleLine
\UnaryInfC{$\set{\set{c,d}}$}
\RightLabel{Pair}
\BinaryInfC{$\set{\set{a,b},\set{\set{c,d}}}$}
\RightLabel{Union}
\UnaryInfC{$\set{a,b,\set{c,d}}$}
\DisplayProof{}
$$
\endgraf
\bigskip
\noindent
Para o $C$, usamos o Separation~(\axref{separation})
no $\pset \paren{\Union A}$, que é conjunto graças aos Union (\axref{unionset})
\& Powerset (\axref{powerset}):
$$
\centerAlignProof
\AxiomC{$A$}
\RightLabel{ZF6}
\UnaryInfC{$\Union A$}
\RightLabel{ZF5}
\UnaryInfC{$\pset\Union A$}
\RightLabel{ZF4}
\UnaryInfC{$C$}
\DisplayProof{}
$$
onde na aplicação de ZF4 usamos a fórmula
$
\exists u \exists v
\paren{ u \neq v \land \forall w(w \in x \liff w = u \lor w = v ) }
$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Classes vs. Sets (I) 
\section Classes vs{.}~Conjuntos (I).

%%{{{ What is a class? 
\note O que é uma classe?.
Sem dúvida, a notação $\set{ x \st \text{\lthole} }$
que temos usado até agora é natural e útil.
Ela denota a colecção de todos os objetos $x$ que satisfazem
a condição (ou ``passam o filtro'') que escrevemos no \lthole.
Dada uma condição definitiva $P$ então consideramos a colecção
$$
\set {x \st P(x)}
$$
de todos os objetos que a satisfazem.
Provavelmente vocé já percebeu que eu evitei usar a palavra
\emph{conjunto}, pois reservamos essa palavra para
apenas os conjuntos-objetos do nosso universo.
%%}}}

%%{{{ df: class 
\definition Classe.
\tdefined{classe}%
\tdefined{classe}[própria]%
\iisee{própria}[classe]{classe própria}%
Dada uma condição definitiva $P(\dhole)$ definimos a \dterm{classe}
$$
\class x {P(x)}
$$
como um sinónimo da própria condição $P$!
Chamamos a classe $P$ \dterm{própria} sse não existe \emph{conjunto}
$S$ que satisfaz a propriedade:
$$
x \in S \iff P(x).
$$
%%}}}

%%{{{ Abuso notacional 
\note Abuso notacional.
É muito comum abusar o símbolo $\in$, escrevendo
$$
x \in C
$$
mesmo quando $C$ é uma classe própria!
Nesse caso consideramos o ``$x \in C$'' apenas como uma
abreviação do $C(x)$.
Em outras palavras, esse $\in$ não é um símbolo de relação da nossa FOL de
teoria de conjuntos, mas sim uma abreviação em nossa \emph{metalinguagem},
no mesmo jeito que $\iff$ também não é, mas o $\liff$ é.
Para enfatisar essa diferença vamos usar um símbolo diferente:
%%}}}

%%{{{ df: inclass 
\definition.
\label{inclass}%
\sdefined{\holed x\inclass\holed C}{o objeto \holed x está na classe \holed C}%
Usamos o símbolo $\inclass$ na metalinguagem como ``pertence''
quando possivelmente o lado direito é uma classe própria.%
\footnote{Seguimos aqui o exemplo dos símbolos de equivalência na metalinguágem
($\Longleftrightarrow$) e na linguagem-objeto de lógica ($\leftrightarrow$).}
Com essa notação:
$$
x\inclass P
\defiff
\knuthcases{
P(x)    & se $P$ é uma classe própria\cr
x\in P  & se $P$ é um conjunto.
}
$$
%%}}}

%%{{{ eg: sets and proper classes 
\example.
Dados conjuntos $a$ e $b$,
das classes
$$
\munderbrace{\class x {x = a}} {\set a}
\qqquad
\munderbrace{\class x {x \in a \land x\in b}} {a\inter b}
\qqquad
\munderbrace{\class x {x \neq x}} {\emptyset}
\qqquad
\setst x {x = x}
$$
apenas a última é própria.
As outras são conjuntos mesmo!
\endexample
%%}}}

\endsection
%%}}}

%%{{{ Foundations of mathematics 
\section Fundações de matemática.

%%{{{ A low-level language for mathematics 
\note Uma linguagem ``low-level'' para matemática.
Fazendo uma analogia entre matemática e programação,
dizemos que a teoria de conjuntos pode servir como uma certa low-level linguagem
em qual podemos ``compilar'' (traduzir, representar, \dots)~todos os high-level
conceitos que nos interessam em matemática!
As ``definições'' (assim entre aspas) que temos usado até agora para os vários
tipos e conceitos que encontramos não foram formais.
Nossa tarefa então aqui é tirar essas aspas.
Dar uma definição formal dum conceito significa o definir dentro da
teoria de conjuntos.
No final das contas, tudo vai ser representado dentro da FOL da teoria de conjuntos,
pegando como noções primitívas \emph{apenas} os ``$\Set$'' de ``ser conjunto''
e o ``$\in$'' de ``pertencer''.
Já temos uma primeira biblioteca construida até agora,
um certo \emph{açúcar\ii{açúcar sintáctico}\ sintáctico}.
E cada vez que conseguimos compilar algo dentro da teoria de conjuntos,
ganhamos não apenas o proprio algo para seus usos e suas aplicações,
mas também algo mais para usar para nossas próximas compilações.
%%}}}

%%{{{ Our inventory so far 
\note Nosso inventório até agora.
Vamos resumir todos os operadores e predicados que temos já definido
dentro da teoria de conjuntos, usando apenas os axiomas que encontramos
até agora.
Temos:
$$
\gather
\emptyset \;;\\
\set \dhole \;;\quad
\set{\dhole,\dhole} \;;\quad
\set{\dhole,\dotsc,\dhole} \;;\quad
\set{x \in \dhole \st \phi(x)} \;;\\
\dhole \inter \dhole \;;\quad
\dhole \union \dhole \;;\quad
\dhole \setminus \dhole \;;\quad
\dhole\symdiff \dhole \;;\quad
\Union \dhole \;;\quad
\pset \dhole
\endgather
$$
{e com o proviso de $a$ conjunto com $a\neq\emptyset$ também o}
$$
\dsize\Inter a\,.
$$
Observe-se então que de todos esses operadores, o $\Inter\dhole$ é
o único operador \emph{parcial}.
Mas isso não é nada novo como conceito:
no final das contas, estamos usando operadores parciais o tempo todo
trabalhando com números reais: o $\dhole / \dhole$ por exemplo
não é definido quando seu segundo argumento é o $0$, e a mesma coisa
sobre a operação (unária) de inverso: o $0^{-1}$ também não é definido.
%%}}}

%%{{{ From specification to implementation 
\note De especificação para implementação.
Quando queremos representar algum \emph{tipo} de coisa
dentro do nosso mundo de conjuntos,
precisamos esclarecer qual é a \emph{especificação} desse tipo.
Quais propriedades desejamos dos objetos desse tipo?
O que precisamos para construir um objeto desse tipo?
Quando identificamos dois objetos desse tipo e os consideramos iguais?
Como podemos usar os objetos desse tipo?
Qual é a ``interface'' deles?
Talvez ajuda pensar que nossa tarefa é similhante de um ``vendedor
de implementações matemáticas''.
Nossos ``clientes'' são os próprios matemáticos que desejam usar certos
tipos de objetos matemáticos, e nos seus pedidos eles estão esclarecendo
quais são as propriedades que eles precisam.
Nosso trabalho então será:
\emph{implementar} essa especificação, ou seja,
\emph{representar fielmente} esses tipos e conceitos como conjuntos.
Para conseguir isto:
(1) \emph{definimos} os conceitos e objetos como conjuntos;
(2) \emph{provamos} que nossa implementação realmente atende as especificações.
Muitas vezes vamos até oferecer uma \emph{garantia de unicidade}
para mostrar para nosso cliente-matemático que ele não precisa
procurar outras implementações alternativas da nossa concorrência,
pois \emph{essencialmente} nem tem!
%%}}}

\blah.
Nosso próximo trabalho será representar as tuplas,
e por isso vamos analizar em muito detalhe essa especificação.
Depois relaxamos um pouco deixando uns detalhes tediosos como
``óbvios''.

\endsection
%%}}}

%%{{{ Constructing the tuples 
\section Construindo as tuplas.

%%{{{ Specification 
\note Especificação.
\label{tup_specification}%
Vamos começar com o trabalho de implementar tuplas de tamanho 2,
ou seja \emph{pares ordenados}.
Precisamos então definir \emph{um} operador
$\tup{\dhole,\dhole}$ que atende as especificações.
Primeiramente:
$$
\tup{x, y} = \tup{x', y'} \implies x = x' \mland y=y'.
\taglabel{TUP1}{spec_tup1}
$$
Mas precisamos mais que isso.
Dados conjuntos $A$ e $B$ queremos que
$$
\text{a \emph{classe}}
\quad
A\times B = \class z {
(\exists x \in A)
(\exists y \in B)
z = \tup {x,y}
}
\quad
\text{é um \emph{conjunto}}.
\taglabel{TUP2}{spec_tup2}
$$
Lembrando a idéia de tupla como black\ii{black box}[de tupla]\ box,
o interface que desejamos consiste em duas operações,
as \emph{projecções}
$\first$ e $\second$ tais que
$$
\first \tup{x,y} = x
\qqqquad
\text e
\qqqquad
\second \tup{x,y} = y.
$$
Queremos definir também um predicado $\Pair(\dhole)$
para afirmar que um certo objeto representa um par ordenado.
Isso é facil:
$$
\Pair(z) \defiff
\exists x
\exists y
\paren{
z = \tup {x,y}
}
$$
Finalmente, precisamos e confirmamos:
$$
\Pair(z) \iff z = \tup{ \first(z), \second(z) }.
$$
Anotamos também que assim que definir \emph{funções} dentro
da teoria de conjuntos, vamos mostrar a existência das funções
$$
\xalignat2
\pi_0 &\eqtype A\times B \to A &  \pi_1&\eqtype A\times B \to B\\
\pi_0\tup{x,y} &= x            &  \pi_1\tup{x,y} &= y
\endxalignat
$$
para todos os conjuntos $A$ e $B$.
%%}}}

%%{{{ x: op1_converse_direction_by_logic 
\exercise.
\label{op1_converse_direction_by_logic}%
No \ref{spec_tup1} botamos ``$\Longrightarrow$'' em vez de ``$\Longleftrightarrow$''.
Por quê?  O que acontece com a ``$\Longleftarrow$''?

\hint
Como a direção ``$\Longleftarrow$'' poderia ser inválida?

\solution
A direção ``$\Longleftarrow$'' é garantida pela nossa lógica:
a propriedade da igualdade $=$,
que nos permite substituir iguais por iguais em qualquer expressão.

\endexercise
%%}}}

%%{{{ x: first_attempt_pair 
\exercise.
\label{first_attempt_pair}%
Prove que a operação
$$
\tup{x,y} \defeq \set{x,y}
$$
satisfaz uma das \ref{spec_tup1}~\&~\ref{spec_tup2}
mas não a outra, então essa
\emph{não} é uma implementação de par ordenado

\endexercise
%%}}}

\blah.
Nossa primeira tentativa não deu certo.
Mesmo assim é realmente possível implementar pares ordenados
como conjuntos!  Como?
\spoiler.

%%{{{ df: kuratowski_pair 
\definition par de Kuratowski.
\label{kuratowski_pair}%
\Kuratowski[par]%
Sejam $x,y$ objetos.
Definimos
$$
\tup{x,y} \defeq \kurpair x y.
$$
%%}}}

%%{{{ x: kurpair_satisfies_tup0 
\exercise.
\label{kurpair_satisfies_tup0}%
Mostre pelos axiomas que o operador $\tup{\dhole, \dhole}$ de Kuratowski
é bem definido, ou seja: dados objetos $x,y$, o $\tup{x,y}$ é conjunto.

\endexercise
%%}}}

%%{{{ prop: kurpair_satisfies_tup1 
\proposition.
\label{kurpair_satisfies_tup1}%
O operador $\tup{\dhole, \dhole}$ de Kuratowski satisfaz a~\ref{spec_tup1}.
\sketch.
Suponha $\tup{x,y} = \tup{x',y'}$.
Logo
$$
\kurpair x y = \kurpair {x'} {y'}.
$$
Precisamos deduzir que $x=x'$ e $y=y'$ mas ainda não é claro.
O que temos é apenas igualdade desses dois conjuntos, que não
garanta o que queremos imediatamente.
Não podemos concluir nem que
$$
\alignat3
\set {x} &= \set {x'}
&\qquad&\mland\qquad&
\set {x,y} &= \set {x',y'},\\
\intertext{%
pois pela definição de igualdade de conjuntos (\axref{extensionality})
sabemos apenas que cada membro do conjunto no lado esquerdo
é algum membro do conjunto no lado direito e vice-versa.
Então, talvez
}
\set {x} &= \set { x',y'}
&\qquad&\mland\qquad &
\set {x,y} &= \set {x'}.
\endalignat
$$
Precisamos então separar em casos:
$x = y$ ou não.
Em cada caso argumentamos usando o (\axref{extensionality}) e a
cardinalidade dos conjuntos para progressar até chegar nos desejados
$x=x'$ e $y=y'$.
\qes
%%}}}

%%{{{ prop: kurpair_satisfies_tup2 
\proposition.
\label{kurpair_satisfies_tup2}%
O operador $\tup{\dhole, \dhole}$ de Kuratowski satisfaz a~\ref{spec_tup2}.
\proof.
Sejam $A,B$ conjuntos.
Precisamos mosrar que a classe
$$
A\times B = \class z {
\pexists {x \in A}
\lexists {y \in B}
{z = \tup {x,y}}
}
$$
é um conjunto.
Como já temos escrita a classe nessa forma, basta achar um conjunto $W$
que contem todos os pares que queremos, e aplicar esse mesmo filtro
para ficar apenas com eles mesmo.
Como parece o aleatorio $\tup{a,b} \in A\times B$?
$$
a\in A
\mland
b\in B
\implies
\tup{a,b} = \kurpair a b \in \mathord{?}
$$
Vamos ver:
$$
\stepproof{
\proofsteptnb {Suponha $a\in A$ e $b\in B$.}\\
\thereforetby {$a,b \in A\union B$}                               {def.~$\union$}\\
\thereforetby {$\set {a}, \set{a,b} \subseteq A \union B$}        {def.~$\subseteq$}\\
\thereforetby {$\set {a}, \set{a,b} \in \pset\paren{A \union B}$} {def.~$\pset$}\\
\thereforetby {$\kurpair a b \subseteq \pset\paren{A \union B}$}  {def.~$\subseteq$}\\
\thereforetby {$\kurpair a b \in \pset\pset\paren{A \union B}$}   {def.~$\pset$}\\
\thereforetby {$\tup {a, b} \in \pset\pset\paren{A \union B}$}    {def.~$\tup{a,b}$}
}
$$
Tome então $W\asseq \pset\pset\paren{A \union B}$
e defina
$$
A \times B \defeq \setst { z \in \pset\pset\paren{A\union B} } {
\pexists {x \in A}
\lexists {y \in B}
{z = \tup {x,y}}
}
$$
que é conjunto graças ao Separation~(\axref{separation}).
\qed
%%}}}

%%{{{ Being agnostic 
\note Sendo agnósticos.
\tdefined{agnóstico}%
Acabamos de encontrar \emph{um} operador de par ordenado:
do Kuratowski\Kuratowski{}.
Ele não é o único possível, mas para continuar com nossa teoria,
precisamos apenas mostrar que existe um.
Vamos usar o símbolo $\tup{\dhole,\dhole}$ sem esclarecer se realmente é
a implementação de Kuratowski que usamos, ou alguma outra implementação.
Tomando cuidado, sobre esse operador nos permitimos usar
\emph{apenas as propriedades da sua especificação e nada mais}:
as \ref{spec_tup1}~\&~\ref{spec_tup2} do \refn{tup_specification}.
Falamos então que estamos sendo $\tup{\,}$-\dterm{agnósticos}.
Por exemplo, não podemos afirmar que $\set {x} \in \tup {x,y}$.
Sim, isso é valido com a implementação de Kuratowski, mas é uma
\emph{coincidência} e não uma \emph{conseqüência} da especificação
de par ordenado.
Talvez outra implementação não tem essa propriedade,
como tu vai descobrir agora provando que o $\tup{\dhole,\dhole}$
do~Wiener\Wiener{} também é uma implementação de par ordenado.
%%}}}

%%{{{ x: wiener_pair 
\exercise par de Wiener.
\label{wiener_pair}%
\Wiener[par]%
Mostre pelos axiomas que a operação $\tup{\dhole,\dhole}$ definida pela
$$
\tup{x,y} \defeq \bigset{ \set{ \emptyset, \set{x} }, \set{ \set{ y } } }
$$
é uma implementação bem definida de par ordenado
(ou seja, dados $x,y$ o $\tup{x,y}$ é um conjunto sim)
que satisfaz as~\ref{spec_tup1}~\&~\ref{spec_tup2}.%
\footnote{Wiener definiu essa operação uns anos \emph{antes} da definição de Kuratowski.}

\hint
Trabalhe como fizemos para o par ordenado de Kuratowski
no~\ref{kurpair_satisfies_tup0} e nas
proposições~\refn{kurpair_satisfies_tup1}--\refn{kurpair_satisfies_tup2}.

\solution
Primeiramente verificamos que dados objetos $x,y$, o $\tup{x,y}$
realmente é um conjunto:
$$
\centerAlignProof
\AxiomC{}
\RightLabel{Empty}
\UnaryInfC{$\emptyset$}
\AxiomC{$x$}
\RightLabel{Singleton}
\doubleLine
\UnaryInfC{$\set{x}$}
\RightLabel{Pair}
\BinaryInfC{$\set{\emptyset, \set{x}}$}
\AxiomC{$y$}
\RightLabel{Singleton}
\doubleLine
\UnaryInfC{$\set{y}$}
\RightLabel{Singleton}
\doubleLine
\UnaryInfC{$\set{\set{y}}$}
\RightLabel{Pair}
\BinaryInfC{$\set{\set{\emptyset,\set{x}}, \set{\set{y}}}$}
\DisplayProof{}
$$
\proofpart{\ref{spec_tup2}:}
Sejam $A,B$ conjuntos.
Queremos mosrar que a classe
$$
A\times B = \class {\tup{x,y}} {
x\in A
\mland
y\in B
}
$$
é um conjunto.
Como na prova da~\ref{kurpair_satisfies_tup2},
Basta achar um conjunto $W$ que contem o arbitrário $\tup{a,b}\in A\times B$,
pois depois aplicamos o Separation~(\axref{separation}) com a mesma
fórmula da~\ref{kurpair_satisfies_tup2} para ganhar o $A\times B$.
Um conjunto que serve como $W$ é o $\pset\pset\pset(A\union B)$,
como verificamos aqui, escrevendo a derivação em forma de árvore:
$$
\centerAlignProof
\AxiomC{}
\UnaryInfC{$\emptyset\in\pset(A\union B)$}
\AxiomC{$a \in A$}
\UnaryInfC{$a \in A\union B$}
\UnaryInfC{$\set{a} \in \psetp{A\union B}$}
\BinaryInfC{$\set{\emptyset,\set{a}} \in \pset\psetp{A\union B}$}
\AxiomC{$b \in B$}
\UnaryInfC{$b \in A\union B$}
\UnaryInfC{$\set{b} \in \psetp{A\union B}$}
\UnaryInfC{$\set{\set{b}} \in \pset\psetp{A\union B}$}
\BinaryInfC{$\set{\set{\emptyset,\set{a}}, \set{\set{b}}}\in\pset\pset\psetp{A\union B}$}
\DisplayProof
$$

\endexercise
%%}}}

%%{{{ x: another_pair 
\exercise.
\label{another_pair}%
Considere $0$ e $1$ dois objetos distintos (algo que nossos axiomas garantam).
Por exemplo, tome $0\defeq\emptyset$ e $1\defeq\set\emptyset$.
Prove que a operação
$$
\tup{x,y} \defeq \bigset{ \set{0, x}, \set{1, y} }
$$
também é uma implementação de par ordenado.

\hint
Calcule os $\tup {0,0}$, $\tup {0,1}$, $\tup {1,0}$, $\tup {1,1}$.

\hint
Separe em casos: $x=y$ ou não.

\endexercise
%%}}}

%%{{{ x: bad_pair 
\exercise.
\label{bad_pair}%
Prove que não podemos usar a operação
$$
\tup{x,y} \defeq \bigset{ x, \set{x, y} }
$$
como uma implementação de par ordenado.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Constructing the disjoint union 
\section Construindo a união disjunta.

%%{{{ Specification 
\note Especificação.
\label{disjunion_specification}%
Queremos definir a operação binária da \emph{união\ii{união!disjunta}\ disjunta}.
%%}}}

\TODO Especificação: mention coproduct.

%%{{{ df: disjoint_union 
\definition União disjunta.
\label{disjoint_union}%
\tdefined{união}[disjunta]%
\sdefined{\holed A \disjunion \holed B} {a união disjunta de $A$ com $B$}%
Fixamos dois objetos distintos como os $\mathrm L\asseq \emptyset$ e $\mathrm R\asseq \set\emptyset$
e definimos:
$$
A \disjunion B
\defeq
\paren{\set{\mathrm L} \times A}
\union
\paren{\set{\mathrm R} \times B}.
$$
%%}}}

%%{{{ x: why_not_use_A_and_B_as_tags 
\exercise.
\label{why_not_use_A_and_B_as_tags}%
Uma escolha de ``tags'' para os membros dos conjuntos $A$ e $B$ seria
os próprios conjuntos $A$ e $B$ em vez dos $\emptyset$ e $\set\emptyset$
que usamos.  Qual é o problema com essa idéia?

\endexercise
%%}}}

%%{{{ x: generalize_disjunion_to_indexed_Disjunion 
\exercise.
\label{generalize_disjunion_to_indexed_Disjunion}%
Generalize a construção de união disjunta binária para
o operador ``grande'' de união disjunta indexada por algum conjunto
de índices $I$.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Constructing the relations 
\section Construindo as relações.

%%{{{ Specification 
\note Especificação.
O que precisamos de algum objeto $R$ que merece o nome de
\emph{implementação de relação de $A$ para $B$}?
Bem, primeiramente, dados $a\in A$ e $b\in B$ queremos ter
como ``perguntar'' esse objeto $R$ se o $a$ está relacionado
com o $b$.
Dados quaisquer conjuntos $c$ e $d$ queremos também que
a classe de todas as relações de $c$ para $d$ seja um conjunto.
Nossa definição tem que ser feita em tal jeito que facilita
as demais definições de operações em relações, por exemplo
a composição, os vários fechos que encontramos, etc.
\endgraf
Praticamente, \emph{nossa especificação é o~\ref{Relations}!}
%%}}}

%%{{{ df: relation_formal_def 
\definition Relação.
\label{relation_formal_def}%
Sejam $A,B$ conjuntos.
Qualquer subconjunto $R \subseteq A \times B$
é uma relação de $A$ para $B$.
Em outras palavras:
$$
\text{$R$ relação de $A$ para $B$}
\defiff
R \subseteq A \times B.
$$
Introduzimos as notações
$$
\align
x \rel R y
&\sugariff \tup{x,y} \in R\\
R(x,y)
&\sugariff \tup{x,y} \in R.
\endalign
$$
Formalmente definimos o predicado
$$
\Relation(r,a,b)
\sugareq
r \subseteq (a \times b).
$$
%%}}}

%%{{{ remark: remember the graph of a relation? 
\remark.
No final das contas, já tivemos definido esse conceito.
Seu nome foi \emph{o gráfico da $R$}.  Lembra?
Se não, veja o~\ref{relation_graph}.
Em outras palavras, dentro da teoria de conjuntos,
com nossa~\ref{relation_formal_def},
\emph{identificamos as relações com seus gráficos: $R = \graph R$.}
%%}}}

%%{{{ warning: faithful representation 
\warning.
Enfatisamos mais uma vez que isso não quis dizer que
uma relação \emph{é} o seu gráfico (que é um conjunto)!
Mas que isso é apenas um jeito de \emph{representar fielmente}
o conceito de \emph{relação} dentro da teoria de conjuntos, ou seja:
``\emph{como se fosse} conjunto''.
%%}}}

%%{{{ Q: must we define more terminolofy from relations? 
\question.
Precisamos definir as demais noções e termos que encontramos no~\ref{Relations}?
Por exemplo: precisamos definir os termos ``transitiva'', ``reflexiva'', etc.?
%%}}}

%%{{{ A: No! 
\blah Resposta.
Não!
Voltando no~\ref{Relations} podes verificar que todas as outras definições
usou termos não-definidos.  Todas dependem apenas na noção de relação mesmo
(que acabamos de definir formalmente na~\ref{relation_formal_def}).
%%}}}

%%{{{ eg: equality in A 
\example.
Seja $A$ um conjunto.
O conjunto
$$
\setst {\tup{x,x}\in A^2} {x \in A}
$$
é uma relação, pois realmente é um subconjunto de $A\times A$.
Qual relação é essa?
Ela merece seu próprio nome e sua própria notação.
\endexample
%%}}}

%%{{{ df: eqin 
\definition.
\label{eqin}%
Dado conjunto $A$, a relação de \dterm{igualdade no $A$}
é a relação
$$
{\eqin A} \defeq \setst {\tup{x,x}\in A^2} {x \in A}.
$$
Logo temos
$$
x \eqin A y \iff x = y \mland x,y \in A.
$$
%%}}}

%%{{{ prop: a_relto_b_is_a_set 
\proposition.
\label{a_relto_b_is_a_set}%
Dados conjuntos $a,b$, a classe
$$
(a \relto b)
\defeq
\classt R {$R$ é uma relação de $a$ para $b$}
$$
é um conjunto.
\proof.
Basta achar um conjunto onde todas as relações de $a$ para $b$
pertencem.
Pela definição de relação, todas pertencem no $\pset(a\times b)$.
De fato, ainda mais é verdade:
$$
(a \relto b)
=
\pset(a\times b)
$$
e logo é um conjunto graças aos operadores (totais) $\pset$ e $\times$.
\qed
%%}}}

%%{{{ eg: reflexive_and_irreflexive_formally 
\example.
Seja $R\subseteq A\times A$.
Então temos
$$
\align
\text{$R$ reflexive}
&\iff {\eqin A} \subseteq R\\
\text{$R$ irreflexive}
&\iff {\eqin A} \inter R = \emptyset
\endalign
$$
etc.
\endexample
%%}}}

%%{{{ x: rcompose_formal_def 
\exercise.
\label{rcompose_formal_def}%
Mostre que podemos definir o operador de composição de relações
$\dhole\rcom\dhole$ em tal modo quando é aplicado em conjuntos
$a,b$ que são relações (compatíveis), o conjunto
$a\rcom b$ também é uma relação, e a correta:
a composição de $a$ com $b$.
(Lembre-se a~\ref{rcompose}.)

\endexercise
%%}}}

%%{{{ x: closures_formal_def 
\exercise.
\label{closures_formal_def}%
Defina formalmente e diretamente como conjuntos os fechos que encontramos
no~\ref{Relations}:
reflexivo (\refn{rclosure}),
simétrico (\refn{sclosure}),
transitivo (\refn{tclosure}).
Tente dar a definição mais curta, elegante, e flexível possível!

\endexercise
%%}}}

\TODO Fechos: top-down revisitado.

\endsection
%%}}}

%%{{{ Constructing the functions 
\section Construindo as funções.
\label{Constructing_the_functions}%

%%{{{ Specification 
\note Especificação.
Como nas relações, aqui também nossa especificação deve ser clara:
\emph{traduzir todo o~\ref{Functions} na teoria de conjuntos!}
%%}}}

%%{{{ df: function_formal_def 
\definition Função.
\label{function_formal_def}%
Sejam $A,B$ conjuntos.
Uma relação $f$ de $A$ para $B$ é chamada \dterm{função de $A$ para $B$}
sse
$$
\pforall {a \in A}
\lunique {b \in B}
{\tup{a,b} \in f}.
$$
Equivalentemente
(e para ficar mais perto das Condições~\refn{functionhood_conditions}
do~\ref{Functions}) podemos separar essa condição em duas:
$$
\gather
\pforall {a \in A}
\lexists {b \in B}
{\tup{a,b} \in f}
\tag{TOT}\\
\pforall {a \in A}
\lforall {b,b' \in B}
{\tup{a,b},\tup{a,b'} \in f \implies b = b'}.
\tag{DET}
\endgather
$$
Escrevemos
$$
f(a) = b
\defiff
\tup{a,b} \in f
$$
e também usamos
$$
f(a)
\defeq
\text{aquele único $b\in B$ tal que $\tup{a,b}\in f$.}
$$
Lembre-se que escrevemos
$f : A \to B$ ou $A \toarrow f B$ para dizer que
$f$ é uma função de $A$ para $B$, etc.
(Veja~\ref{function_notation}.)
Formalmente definimos o predicado
$$
\Function(f,a,b)
\sugareq
\Relation(f,a,b)
\land
\pforall {x \in a}
\lunique {y \in b}
{\tup{x,y}\in f}.
$$
%%}}}

%%{{{ prop: a_to_b_is_a_set 
\property.
\label{a_to_b_is_a_set}%
Dados conjuntos $a,b$, a classe
$$
(a \to b)
\defeq
\class f {f : A \to B}
$$
é um conjunto.
\proof.
Fácil:
$$
(a \to b)
=
\setst {f \in (a \relto b)} {f : A \to B}
$$
que é conjunto graças ao operador $(\dhole\relto\dhole)$
(\ref{a_relto_b_is_a_set}) e ao axioma da separação~\axref{separation}.
\qed
%%}}}

%%{{{ We get inj surj bij for free 
\remark.
Como as definições de ``injetora'', ``sobrejetora'', e ``bijetora''
do~\ref{Functions} dependem apenas da definição de ``função''
(que acabamos de definir), já temos essas definições na teoria de conjuntos!
Simlarmente os operadores $(\dhole\injto\dhole)$, $(\dhole\surjto\dhole)$,
e $(\dhole\bijto\dhole)$ são facilmente definidos graças
à~\ref{a_to_b_is_a_set}
e o axioma da separação~\axref{separation}.
%%}}}

%%{{{ eg: eqc_formally_defined 
\example.
\label{eqc_formally_defined}%
Uma definição alternativa e formal do $\eqc$ é a seguinte:
$$
a \eqc b \defiff (a \bijto b) \neq \emptyset.
$$
\endexample
%%}}}

%%{{{ x: fcompose_fresto_fcross
\exercise.
Defina formalmente as operações e construções de funções que encontramos
no~\ref{Functions}:
composição (\refn{fcompose});
restrição (\refn{fresto});
produto (\refn{fcross}).

\endexercise
%%}}}

%%{{{ x: id_char_const_as_sets 
\exercise.
Descreva curtamente as funções identidades, características, e constantes como
conjuntos.
Esses conjuntos representam outras coisas (de outros típos)?

\endexercise
%%}}}

%%{{{ beware: we do note get partial functions for free! 
\beware.
Tem um conceito do~\ref{Functions} que \emph{não} definimos
em termos de ``função'', e logo precisamos definí-lo formalmente
aqui: a \emph{função parcial}.
%%}}}

%%{{{ df: partial_function 
\definition Função parcial.
\label{partial_function_formally_defined}%
Uma relação $f$ de $A$ para $B$ é uma \dterm{função parcial} sse
$$
\pforall {a \in A}
\lforall {b,b' \in B}
{\tup{a,b},\tup{a,b'} \in f \implies b = b'}.
\tag{DET}
$$
%%}}}

%%{{{ x: a_parto_b_is_a_set 
\exercise.
\label{a_parto_b_is_a_set}%
Dados conjuntos $a,b$, a classe
$$
(a \parto b)
\defeq
\class f {f : A \parto B}
$$
é um conjunto.

\solution
Fácil, como na prova da~\ref{a_to_b_is_a_set}:
$$
(a \parto b)
=
\setst {f \in (a \relto b)} {f : A \parto B}
$$
que é conjunto.

\endexercise
%%}}}

%%{{{ x: parto_formally_defined 
\exercise.
\label{partial_function_formally_defined_as_function}%
Ache um outro jeito para definir funções parciais como funções.
Verifique que dados conjuntos $a,b$ a classe
$(a \parto b)$
também é um conjunto.

\hint
Cada função parcial $f : A \parto B$ pode ser representada
como uma função total $f : A \parto B'$ onde $B'$ é um outro
conjunto.
Qual $B'$ serve?

\hint
Duas idéias razoáveis:
\endgraf\noindent
\proofstyle{Idéia 1:}
Dados conjuntos $A,B$, escolha (como?) um objeto fora do $B$
para representar a ``diverjão'', ou valor ``não-definido''.
Lembra-se que $\russell B \notin B$, algo que
temos graças ao \ref{russells_paradox_to_theorem}.
Então tome $B' \asseq B \union \russell B$.
\endgraf\noindent
\proofstyle{Idéia 2:}
Tome
$$
B'
\asseq
\setstt {Y \subseteq B} {$\Singleton(Y)$ ou $Y = \emptyset$}.
$$

\endexercise
%%}}}

%%{{{ df: parfun_compatibility 
\definition Compatibilidade.
\label{parfun_compatibility}%
\tdefined{função}[parcial!conflito]%
\tdefined{função}[parcial!compatibilidade]%
Sejam $A,B$ conjuntos e $\scr F$ uma família de funções parciais de $A$ para $B$:
$\scr F \subseteq (A\parto B)$.
Chamamos a $\scr F$ \dterm{compatível} sse $\Union {\scr F} \in (A\parto B)$.
Digamos que $\scr F$ tem \dterm{conflito} no $a\in A$ sse
existem $y,y'\in B$ com $y\neq y'$ e $\tup{a,y}, tup{a,y'}\in \scr F$;
equivalentemente
$$
\card{ \set{ \tup{a,y} \st y\in B } } > 1.
$$
%%}}}

%%{{{ df: approximation 
\definition Aproximação.
\label{parfun_approx}%
\tdefined{função}[parcial!aproximação]%
Seja $F : A \to B$.
Chamamos qualquer $f\subseteq F$ uma aproximação (parcial) da $F$.
Ela é \dterm{própria} se $f\subsetneq F$.
%%}}}

%%{{{ x: fun_approxes_is_set 
\exercise.
\label{fun_approxes_is_set}%
Seja $F : A \to B$.
Prove que a classe
$$
\class f { \text{$f$ é uma aproximação da $F$} }
$$
é um conjunto.

\solution
Usando o Separation~(\axref{separation}) escrevemos
$$
\set {f \in (A\parto B)} {f \subseteq F}.
$$

\endexercise
%%}}}

%%{{{ x: fun_with_approxes 
\def\Approxes{{\scr F}}
\def\FinApproxes{\Approxes_{\textrm{f}}}
\exercise.
\label{fun_with_approxes}%
Seja $F : A \to B$.
(i) Prove que:
$$
F = \Union \Approxes
$$
onde $\scr F$ é o conjunto de todas as aproximações da $F$.
(ii) É verdade também que
$$
F = \Union \FinApproxes
$$
onde $\FinApproxes$ é o conjunto de todas as aproximações finitas da $F$?

\solution
{%
\def\Approxes{{\scr F}}
\def\FinApproxes{\Approxes_{\textrm{f}}}
(i)
Tome $\tup{x,y} \in F$.
Para concluir que $\tup{x,y} \in \Union \Approxes$
precisamos achar uma aproximação $f\in\Approxes$ tal que $\tup{x,y} \in f$.
Aqui uma: a aproximação $\set{\tup{x,y}} \subseteq F$.
Conversamente, tome $\tup{x,y}$ in $\Union\Approxes$.
Pela definição de $\Union$ então temos que $\tup{x,y}\in f$ para alguma aproximação
$f\in\Approxes$.  Pela definição de aproximação agora, $f\subseteq F$, ou seja:
$\tup{x,y}\in f \subseteq F$.
\endgraf
(ii) Sim.  A direção $\Union \FinApproxes \subseteq F$ é trivial graças ao (i),
e a direção oposta também provamos no (i) pois a aproximação $\set{\tup{x,y}}$
que escolhemos nessa direção é realmente finita.
}

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Constructing the sequences and indexed families 
\section Construindo as seqüências e famílias indexadas.
\label{Constructing_the_sequences_and_indexed_families}%

\endsection
%%}}}

%%{{{ Cardinal arithmetic 
\section Aritmética cardinal.

\endsection
%%}}}

%%{{{ Classes vs. Sets (II) 
\section Classes vs{.}~Conjuntos (II).

\note Relações e funções ``grandes demais''.
\tdefined{predicado}%
\tdefined{class-relação}%
\TODOthis{Explicar.}

%%{{{ df: functionlike 
\definition.
\label{functionlike}%
Uma fórmula $\Phi(x,y)$ é \dterm{function-like}, sse:
$$
\forall x
\unique y
\Phi(x,y)
\qquad
\text{ou seja,}
\qquad
\forall x
\exists y
\bigparen{
\Phi(x,y)
\land
\forall y'
\paren{\Phi(x,y') \limplies y = y'}}.
$$
Nesse caso, também usamos os termo \dterm{função-classe}, \dterm{operador},
e a notação comum
$$
\Phi(x) = y
\qqqtext{como sinónimo de}
\Phi(x,y).
$$
Seguindo essa linha denotamos por $\Phi(x)$ o único objeto $y$ tal que
$\Phi(x,y)$.
Assim o $\Phi(x)$ denota um \emph{objeto}, mas o $\Phi(x,y)$ uma \emph{afirmação}.
%%}}}

\endsection
%%}}}

%%{{{ Problems intermission 
\problems Intervalo de problemas.

%%{{{ someset_problem 
\problem Someset is the new Emptyset.
\label{someset_problem}%
Considere o axioma seguinte:
\endgraf
\noindent
{\bf Someset.}
{\proclaimstyle Existe algo.}
$$
\exists s \paren{ s = s }
\axtaglabel{ZF2*}{someset}
$$
Mostre que no sistema axiomático
\axref{extensionality}%
+\axref{someset}%
+\axref{pairset}%
+\axref{separation}%
+\axref{powerset}%
+\axref{unionset},
existe o $\emptyset$.%
\footnote{Dependendo do uso e do contexto, podemos considerar como parte da lógica
que o universo não é vazio, ou seja, existe algo.  Nesse caso nem precisamos
o Someset~(\axref{someset}), pois seria implícito.}

\endproblem
%%}}}

%%{{{ triset_problem 
\problem Triset is the new Pairset.
\label{triset_problem}%
Considere o axioma seguinte:
\endgraf\noindent
{\bf Triset.}
{\proclaimstyle
Dados tres objetos distintos existe conjunto com exatamente
esses membros.
}
$$
\forall a
\forall b
\forall c
\lparen{
\bigparen{
a\neq b \land b \neq c \land c \neq a
}
\limplies
\exists s
\forall x
\bigparen{x\in s \liff x = a \lor x = b \lor x = c}
}
\axtaglabel{ZF3*}{triset}
$$
%\beginil
\item{(0)}
No sistema
\axref{extensionality}%
+\axref{emptyset}%
+\axref{pairset}%
+\axref{separation}%
+\axref{powerset}%
+\axref{unionset}
construa conjunto de cardinalidade~$3$.
\item{(1)}
Prove que no mesmo sistema
podemos substituir o axioma Pairset~(\axref{pairset}) pelo axioma
Triset~(\axref{triset}) ``sem perder nada''.
Em outras palavras, prove que no sistema
\axref{extensionality}%
+\axref{emptyset}%
+\axref{triset}%
+\axref{separation}%
+\axref{powerset}%
+\axref{unionset}
\emph{para todos os $a,b$ existe o conjunto $\set{a,b}$}.
\item{(2)}
Podemos provar a mesma coisa no sistema
\axref{extensionality}%
+\axref{emptyset}%
+\axref{triset}%
+\axref{separation}%
+\axref{unionset}%
?
%\endil

\hint
Para o (1), veja o (2); para o (2), veja o (1)!

\endproblem
%%}}}

%%{{{ conset_problem 
\problem.
\label{conset_problem}%
Considere o axioma seguinte:
$$
\forall h
\forall t
\exists s
\forall x
\bigparen{
x \in s
\liff
x = h
\lor
x \in t
}.
\axtaglabel{CONS}{conset}
$$
(1)
No sistema
{\axref{extensionality}%
+\axref{emptyset}%
+\axref{conset}}
prove o \axref{pairset} como teorema.
\endgraf\noindent
(2)
Mostre que não tem como provar o \axref{conset}
no sistema
{\axref{extensionality}%
+\axref{emptyset}%
+\axref{pairset}}.
\endgraf\noindent
(3)
No sistema
{\axref{extensionality}%
+\axref{emptyset}%
+\axref{pairset}%
+\axref{separation}%
+\axref{powerset}%
+\axref{unionset}}
prove o \axref{conset} como teorema.

\solution
(1)
Dados os objetos $a,b$, queremos construir o $\set{a,b}$.
Aplicando o \axref{conset} com $h \asseq b$ e $t \asseq \emptyset$
ganhamos o $\set{b}$, e agora aplicando novamente o mesmo axioma
com $h \asseq a$ e $t \asseq \set{b}$ ganhamos o desejado $\set{a,b}$.
\endgraf\noindent
(2)
Observe que com os axiomas
\axref{extensionality}%
+\axref{emptyset}%
+\axref{conset}\ 
conseguimos construir conjuntos de qualquer cardinalidade finita,
mas com os
\axref{extensionality}%
+\axref{emptyset}%
+\axref{pairset}\ 
conseguimos construir apenas conjuntos com cardinalidades $0$, $1$, ou $2$.
Basta realmente construir um conjunto com cardinalidade maior que $2$ então.
Aplique o \axref{conset} com $h,t \asseq \emptyset$ ganhando assim
o $\set{\emptyset}$.
Agora com $h \asseq \set\emptyset$ e $t \asseq \emptyset$ ganhando
o $\set{\set{\emptyset}}$.
Com $h \asseq \emptyset$ e $t \asseq \set{\set{\emptyset}}$
ganhamos o $\set{\emptyset, \set{\emptyset}}$.
E finalmente, com $h,t \asseq \set{\emptyset, \set{\emptyset}}$
construimos o $\set{\emptyset, \set{\emptyset}, \set{\emptyset, \set{\emptyset}}}$,
que tem cardinalidade $3$.
\endgraf\noindent
(3)
Sejam $h, t$ conjuntos.
Pelo singleton (\ref{singleton_thm}) ganhamos o $\set h$,
e usando a união binária (\ref{union_and_symdiff_constructed})
nos $\set h$ e $t$ ganhamos o desejado conjunto.

\endproblem
%%}}}

%%{{{ one_class_set_the_other_proper_problem 
\problem.
\label{one_class_set_the_other_proper_problem}%
Sejam $a,b$ conjuntos.
Mostre pelos axiomas \axref{extensionality}--\axref{unionset} que:
\item{(i)}  a classe $\set{ \set{x,\set y} \st x \in a \land y \in b}$ é conjunto;
\item{(ii)} a classe $\set{ \set{x,y} \st \text{$x,y$ conjuntos com $x\neq y$}}$ é propria.

\hint
(ii) Absurdo.

\endproblem
%%}}}

%%{{{ two_sets_and_one_proper_class_problem 
\problem.
\label{two_sets_and_one_proper_class_problem}%
Sejam $a,b$ conjuntos.
Mostre pelos axiomas \axref{extensionality}--\axref{union} que as classes
$$
\align
    C &= \set{
          \set{x, \set{x,y}}
          \st
          x \in a
          \land
          y \in b
    }\\
    D &= \set{
          \set{x,y}
          \st
          \paren{
              x \in a
              \lor
              x \in \Union a
          }
          \land
          \paren{y \in b \lor y \subseteq b}
    }\\
\intertext{são conjuntos, mas não a classe}
    Z &= \set{
        {\Inter\Inter z}
            \st z \neq \emptyset \land \Inter z \neq \emptyset
    }.
\endalign
$$

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ The axiom of infinity 
\section O axioma da infinidade.

%%{{{ No infinite sets but Infinite(-) predicate 
\note.
Com todos os nossos axiomas até agora, mesmo tendo conseguido
representar tanta matemática fielmente dentro da teoria de conjuntos,
ainda \emph{não é garantida} a existência de nenhum conjunto infinito.
Mesmo assim, a noção de ``ser infinito'' pode sim ser expressada
em nossa dicionário, num jeito genial graças ao Dedekind\Dedekind{},
que deu a primeira definição de infinito que não presupõe
a definição dos números naturais.  Como?
\spoiler.
%%}}}

%%{{{ df: Dedekind-infinite 
\definition Dedekind-infinito.
\tdefined{Dedekind-infinito}
\sdefined {\Infinite(\holed a)} {o conjunto $\holed a$ é Dedekind-infinito}
Seja $A$ conjunto.  Chamamos o $A$ \Dedekind[infinito]\dterm{Dedekind-infinito} sse
ele pode ser ``injetado'' para um subconjunto proprio dele, ou seja,
sse existem $X\subsetneq A$ e $f : A \bijto X$.
Definimos então o predicado
$$
\Infinite(a) \defiff \exists x
\paren{
x\subsetneq a \land (a \eqc x)
}.
$$
%%}}}

%%{{{ Set successor 
\note Conjunto-sucessor.
\ii{conjunto-sucessor}
%%}}}

%%{{{ df: setsucc 
\definition Zermelo, von Neumann.
\tdefined {conjunto-sucessor}%
\sdefined {\setsucc {\holed x}} {o conjunto-sucessor de $\holed x$}%
Definimos
\vonNeumann[conjunto-sucessor]%
\Zermelo[conjunto-sucessor]%
o \dterm{conjunto-sucessor} dum conjunto $x$ ser o
$$
\align
\setsucc x &\defeq \set x           \tag{Zermelo}\\
\setsucc x &\defeq x \union \set x. \tag{von Neumann}
\endalign
$$
Como não existe ambigüidade, omitimos parenteses escrevendo por exemplo
$\setsucc{\setsucc{\setsucc x}}$ em vez de
$\setsucc{(\setsucc{(\setsucc x)})}$.
%%}}}

%%{{{ ax: Infinity 
\axiom Infinity.
\tdefined{axioma}[Infinity]%
\label{infinity}%
Existe um conjunto que tem o $\emptyset$ como membro e é fechado pela
operação $(x \mapsto \setsucc x)$.
$$
\exists s
\bigparen{
\emptyset \in s
\land
\forall x
\paren{
x \in s
\limplies
\setsucc x \in s
}
}
\axtaglabel{ZF7}{infinity}
$$
%%}}}

%%{{{ x: infinity_axiom_guarantees_natlike_object 
\exercise.
Verdade ou falso?
Com o axioma Infinity~(\axref{infinity}) é garantida a existéncia \emph{do} conjunto
$$
\set {
\emptyset,
\setsucc\emptyset,
\setsucc{\setsucc{\emptyset}},
\setsucc{\setsucc{\setsucc{\emptyset}}},
\dotsc
}.
$$
(Escrevemos ``do'' em vez de ``dum'' pois o axioma
Extensionality~(\axref{extensionality}) garanta que se existe, existe único.)

\hint
\emph{Não é} uma conseqüência imediata do~Infinity~(\axref{infinity}).
Por quê não?

\endexercise
%%}}}

%%{{{ df: wrong_definition_of_I 
\definition.
\label{wrong_definition_of_I}%
Seja $I$ o conjunto cuja existência é garantida pelo axioma Infinity~(\axref{infinity}).
Ou seja, o conjunto que satisfaz a condição:
$$
\emptyset \in I \land \forall x \paren{x \in I \limplies \setsucc x \in I}.
$$
\mistake
%%}}}

%%{{{ x: def_of_I_used_definite_articile 
\exercise.
\label{def_of_I_used_definite_articile}%
Qual o problema com a \ref{wrong_definition_of_I}?

\hint
O artigo.

\solution
Para definir $I$ como \emph{o} conjunto que satisfaz tal propriedade
precisamos: \emph{existência \& unicidade}.
Existéncia é o que~\axref{infinity} garanta;
mas não temos---e nem podemos provar---unicidade.
Então precisamos definir o $I$ como \emph{um} conjunto
que satisfaz aquela condição.

\endexercise
%%}}}

%%{{{ Effects and side-effects 
\note Efeitos e efeitos colaterais.
O axioma Infinity~(\axref{infinity}) é o segundo dos nossos axiomas
que garanta diretamente a existência dum certo objeto;
o primeiro foi o Emptyset~(\axref{emptyset}).%
\footnote{Pois todos os outros começam com quantificadores universais.}
Assim que aceitamos o Emptyset, nos definimos o símbolo $\emptyset$
para ser \emph{o} conjunto vazio.
Para poder fazer isso precisamos \emph{provar} a unicidade
do conjunto vazio~(\ref{uniqueness_of_emptyset}).
Mas a condição que aparece no~\axref{infinity} não é
suficientemente forte para ganhar unicidade pelo~\axref{extensionality}!
Possivelmente (e realmente, como nos vamos ver) nosso mundo tem muitos
conjuntos com essa propriedade!
%%}}}

%%{{{ x: def_of_I_used_definite_articile 
\exercise.
\label{infinitely_many_infinite_sets}%
Mostre que já é garantida uma infinidade de conjuntos infinitos.

\hint
Olha para os subconjuntos de $I$.

\solution
Tome
$$
\align
I_0 &\asseq I\\
I_1 &\asseq I \setminus \set{ \emptyset }\\
I_2 &\asseq I \setminus \set{ \emptyset, \setsucc\emptyset }\\
I_3 &\asseq I \setminus \set{ \emptyset, \setsucc\emptyset, \setsucc\emptyset }\\
    &\eqvdots
\endalign
$$

\endexercise
%%}}}

%%{{{ How does this infinite set look like? 
\note Como parece esse conjunto infinito?.
Bem; sabemos que $I$ é infinito e tal, mas quais são os elementos dele?
É tentador pensar que $I$ é o conjunto
$$
I_* \pseudodefeq \set { \emptyset, \setsucc\emptyset, \setsucc{\setsucc\emptyset}, \setsucc{\setsucc{\setsucc{\emptyset}}},\dotsc}.
$$
No final das contas, vendo o~\axref{infinity},
\emph{o que mais poderia estar no $I$?}
Nada.  Certo?
Não.  Bem o oposto!
\emph{Absolutamente tudo} pode pertencer nesse $I$, pois a única informação
que temos sobre ele não tira nenhum objeto como possível membro dele!
Realmente, os únicos elementos \emph{garantidos} no $I$ são aqueles que escrevemos
acima como membros do $I_*$, mas o $I$ pode ter mais: pode ter ``lixo'', como esse:
$$
I_{\spadesuit,\heartsuit} \pseudodefeq \set {
\emptyset,
\spadesuit,
\heartsuit,
\setsucc\emptyset,
\setsucc{\setsucc\emptyset},
\setsucc{\setsucc{\setsucc{\emptyset}}},
\dotsc
}.
$$
Aqui os $\spadesuit$ e $\heartsuit$ denotam dois objetos do nosso universo,
talvez nem são conjuntos, talvez denotam os próprios símbolos
``$\spadesuit$'' e ``$\heartsuit$'', talvez somos nos, eu e tu, etc.
Para a gente, é o lixo.%
\footnote{Sem ofensa.}
\endgraf
Na verdade, esse último conjunto não pode ser o nosso $I$, pois ele não
satisfaz a condição do~(\axref{infinity}) pois
$$
\spadesuit \in I
\qqtext{mas}
\setsucc\spadesuit \notin I.
$$
Podemos então entender melhor nosso $I$.
Ele é um superconjunto do $I_*$---isto é garantido pelo~(\axref{infinity}) mesmo.
O que mais ele tem?  Não sabemos dizer, mas sabemos que \emph{se tem} outros objetos,
ele obrigatoriamente tem uma infinidade de conjuntos para cada um deles:
$$
\set {
\emptyset,
\spadesuit,
\heartsuit,
\setsucc{\emptyset},
\setsucc{\spadesuit},
\setsucc{\heartsuit},
\setsucc{\setsucc\emptyset},
\setsucc{\setsucc{\spadesuit}},
\setsucc{\setsucc{\heartsuit}},
\setsucc{\setsucc{\setsucc{\emptyset}}},
\setsucc{\setsucc{\setsucc{\spadesuit}}},
\setsucc{\setsucc{\setsucc{\heartsuit}}},
\dotsc
}.
$$
Vamos revisar esse $I$ então.
{\def\noise{\mathord{\;\vdots\;}}
Sabemos que ele parece assim:
$$
I = \set {
\emptyset,
\noise,
\setsucc{\emptyset},
\noise,
\setsucc{\setsucc{\emptyset}},
\noise,
\setsucc{\setsucc{\setsucc{\emptyset}}},
\noise,
\setsucc{\setsucc{\setsucc{\setsucc{\emptyset}}}},
\noise,
\dotsc
}
$$
onde os $\noise$ representam o lixo,
e nosso próximo trabalho será achar um jeito para nos livrar desse lixo!
}
%%}}}

\endsection
%%}}}

%%{{{ Constructing the natural numbers 
\section Construindo os números naturais.

%%{{{ Specification 
\note Especificação.
Primeiramente precisamos esclarecer o que precisamos implementar.
Qual é o ``pedido'' do cliente que queremos atender?
Quais são as leis (suficientes e necessárias) que os números naturais devem
respeitar?
\spoiler.
%%}}}

%%{{{ Peano system 
\definition Sistema Peano.
\tdefined{sistema Peano}%
\tdefined{princípio}[da indução, Peano]%
\label{Peano_system}%
Um \dterm{sistema Peano}\Peano[sistema]~é um conjunto estruturado
$\cal N = \sset \Nats {\Zero,\Succ}$ que satisfaz as leis:
$$
\alignat2
&\text{Zero é um número natural:}&\qquad&\Zero \in \Nats                                 \tag{P1}\\
&\text{O sucessor é uma operação unária nos naturais:}&&\Succ \eqtype \Nats \to \Nats  \tag{P2}\\
&\text{Naturais diferentes tem sucessores diferentes:}&&\Succ \eqtype \Nats \injto \Nats \tag{P3}\\
&\text{Zero não é o sucessor de nenhum natural:}&&\Zero \notin \img \Succ \Nats          \tag{P4}\\
&\text{Os naturais satisfazem o princípio da indução:}                                   \tag{P5}
\endalignat
$$
\dterm{Princípio da indução}\/:
\emph{para todo $X\subseteq \Nats$,}
$$
\bigparen{
\Zero\in X
\land
\forall n
\paren{
n \in X \limplies \Succ n \in X
}
} \limplies X = \Nats.
$$
Observe que graças às (P3) e (P4) temos
$$
\gather
\Succ n = \Succ m \implies n = m \\
\Succ n \neq \Zero
\endgather
$$
para todos os $n,m\in \Nats$.
%%}}}

%%{{{ Defining a Peano system 
\note Definindo um sistema Peano.
Então o que precisamos implementar é um conjunto estruturado
$\cal N = \sset \Nats {\Zero, \Succ}$.
Isso é fácil: nosso $\cal N$ vai ser uma tripla $\tup {\Nats, \Zero, \Succ}$,
onde seus membros $\Nats$, $\Zero$, e $\Succ$ são tais objetos que as leis
(P1)--(P5) são satisfeitas.
Sabemos que o $\Nats$ precisa ser infinito, então temos que o procurar
entre os conjuntos infinitos da nossa teoria.
Uma primeira idéia seria botar $\Nats \defeq I$, mas essa não parece
uma idéia boa---será difícil ``vender'' uma implementação com lixo!
O que realmente queremos botar como $\Nats$ é o $I_*$
(que não consiguimos ainda defini-lo).
Mas vamos supor que o $I_*$ realmente é um conjunto;
ele vai representar os números naturais,
mas quais serão nossos $\Zero$ e $\Succ$?
Pela especificação dos naturais, $\Zero$ tem que ser um dos membros do $I_*$,
e bem naturalmente escolhemos o $\emptyset$ como o zero.
E o $\Succ$?  Obviamente queremos botar $\Succ = \lam x {\setsucc x}$,
mas para realmente definir o $\Succ$ como função, lembramos que em nosso
dicionário ``função'' é um certo tipo de conjunto de pares.
Botamos então
$$
\align
\Succ &\pseudodefeq \class {\tup{n,m}} { m = \setsucc n }
\intertext{e agora só basta achar um conjunto que tem todos esses pares
como membros.  Fácil:}
\Succ &\defeq \setst {\tup{n,m}\in \Nats\times \Nats} { m = \setsucc n }.
\endalign
$$
Então falta só definir esse $I_*$.
%%}}}

%%{{{ Getting rid of noise 
\note Jogando fora o lixo.
Queremos definir o $I_*$ como conjunto; construí-lo pelos axiomas.
Uma primeira tentativa seria começar com o proprio $I$,
e usar o Separation~(\axref{separation}) para filtrar
seus elementos, separando os quais queremos do lixo,
assim botando
$$
I_* = \setst {x\in I} {\phi(x)}.
$$
para algum certo filtro $\phi(\dhole)$.
Qual fórmula vamos usar?
\spoiler.
%%}}}

%%{{{ A top-down approach 
\note Uma abordagem top-down.
Não podemos descrever um filtro em nossa linguagem de lógica
(FOL de teoria de conjuntos)!  (Lembra-se, uma fórmula não pode
ter tamanho infinito.)
Precisamos então alguma outra idéia para nos livrar dos elementos ``extra'' do $I$.
\emph{Vamos definir o conjunto $I_*$ com a abordagem top-down!}
Sabemos que nosso $I_*$ desejado é um subconjunto de $I$.
Então vamos começar com a colecção de todos os subconjuntos de $I$
que satisfazem a condição do Infinity:
$$
\scr I
\defeq
\setst {i \in \pset I} {\emptyset \in i \land \forall x\paren{x\in i \limplies \setsucc x \in i}
}.
$$
Queremos agora selecionar o ``menor'' elemento dessa família $\scr I$.
Menor no sentido de ``aquele que está contido em todos''.
Sim, nosso $I_*$ é o $\subseteq$-menor elemento do $\scr I$!
Para defini-lo basta tomar a intersecção da família $\scr I$,
que podemos pois
$\scr I \neq \emptyset$~(\ref{why_is_scrI_nonempty}):
$$
I_* \defeq \Inter {\scr I}.
$$
%%}}}

%%{{{ x: why_is_scrI_nonempty 
\exercise.
\label{why_is_scrI_nonempty}%
Por que $\scr I \neq \emptyset$?

\solution
Pois $I\in\scr I$.

\endexercise
%%}}}

%%{{{ thm: existence_of_nats 
\theorem Existência dos naturais.
\label{existence_of_nats}%
Existe pelo menos um sistema Peano $\cal N = \sset \Nats {\Zero, \Succ}$.
\sketch.
Definimos:
$$
\align
\cal N &\defeq \tup{\Nats, \Zero, \Succ},\\
\text{onde:}\qquad
\Nats &\defeq \Inter \setst {i \in \pset I} {\emptyset \in i \land \forall x \paren{x\in i \limplies \setsucc x \in i}}\\
\Zero &\defeq \emptyset\\
\Succ &\defeq \setst {\tup{m,n}\in \Nats\times\Nats} { n = \setsucc m }.
\endalign
$$
Temos já justificado que cada objeto que aparece nessa definição
é conjunto pelos axiomas.  Basta só verificar que as (P1)--(P5)
são satisfeitas.
\qes
\proof.
A única coisa que deixamos para completar a prova foi
verificar os (P1)--(P5), que é feito nos
exercícios \refn{zero_is_a_nat}--\refn{nat_has_induction}.
\qed
%%}}}

%%{{{ x: P1 zero_is_a_nat 
\exercise P1.
\label{zero_is_a_nat}%
Prove que $\Zero\in\Nats$.

\endexercise
%%}}}

%%{{{ x: P2 succ_is_a_function 
\exercise P2.
\label{succ_is_a_function}%
Prove que $\Succ$ é uma função.

\endexercise
%%}}}

%%{{{ x: P3 succ_is_injective 
\exercise P3.
\label{succ_is_injective}%
Prove que $\Succ : \Nats \injto \Nats$.

\endexercise
%%}}}

%%{{{ x: P4 zero_is_not_a_succ 
\exercise P4.
\label{zero_is_not_a_succ}%
Prove que $\Zero\notin \img \Succ \Nats$.

\endexercise
%%}}}

%%{{{ x: P5 nat_has_induction 
\exercise P5.
\label{nat_has_induction}%
Seja $X\subseteq \Nats$ tal que:
\beginil
\item{(1)} $\Zero \in X$;
\item{(2)} para todo $k\in \Nats$, se $k\in X$ então $\Succ k \in X$.
\endil
\noindent
Prove que $X=\Nats$.

\endexercise
%%}}}

%%{{{ thm: uniqueness_of_nats 
\theorem Unicidade dos naturais.
\ii{unicidade!dos naturais}%
\label{uniqueness_of_nats}%
Se  $\cal N_1 = \sset {\Nats_1} {\Zero_1, \Succ_1}$
e   $\cal N_2 = \sset {\Nats_2} {\Zero_2, \Succ_2}$
são sistemas Peano, então são isomorfos: $\cal N_1 \iso \cal N_2$.
\wrongproof.
Precisamos definir um isomorfismo
$\phi : \cal N_1 \iso \cal N_2$.
Definimos a função $\phi : \Nats_1 \to \Nats_2$ usando recursão:
$$
\align
\phi(\Zero_1) &= \Zero_2\\
\phi(\Succ_1n) &= \Succ_2\phi(n).
\endalign
$$
Pela sua definição, a $\phi$ é um homomorfismo.
Basta só verificar que a $\phi$ é bijetora,
algo que tu vai fazer agora nos exercícios
\refn{homomorphism_of_nats_is_mono}~\&~\refn{homomorphism_of_nats_is_epi}.
\mistaqed
%%}}}

%%{{{ x: homomorphism_of_nats_is_mono 
\exercise.
\label{homomorphism_of_nats_is_mono}
Prove que a $\phi : \Nats_1 \to \Nats_2$ definida
no~\ref{uniqueness_of_nats} é um monomorfismo.

\endexercise
%%}}}

%%{{{ x: homomorphism_of_nats_is_epi 
\exercise.
\label{homomorphism_of_nats_is_epi}
Prove que a $\phi : \Nats_1 \to \Nats_2$ definida
no~\ref{uniqueness_of_nats} é um epimorfismo.

\hint
Pela definição de sobrejetora e de imagem,
basta provar que
$\img \phi {\Nats_1} = \Nats_2$.

\hint
Já sabemos que $\img\phi{\Nats_1} \subseteq \Nats2$.
Para provar a igualdade mesmo, use o princípio da indução.

\hint
Precisas provar duas coisas então:
(1) $\Zero_2 \in \img\phi{\Nats_1}$;
(2) para todo $n \in \Nats_2$, se $n \in \img\phi{\Nats_1}$ então $\Succ_2 n \in \img\phi{\Nats_1}$.

\solution
Como $\img \phi {\Nats_1} \subseteq \Nats_2$,
provamos a igualdade usando o princípio da indução~(P5).
\proofpart{Base.}
$\Zero_2 \in \img\phi{\Nats_1}$:
Imediato pois $\phi(\Zero_1) = \Zero_2$.
\proofpart{Passo indutivo.}
Suponha $k \in \img\phi{\Nats_1}$.
Precisamos mostrar que $\Succ_2 k \in \img\phi{\Nats_1}$.
Pela escolha de $k$, tome $k' \in \Nats_1$ tal que
$\phi(k') = k$.
Calculamos:
\alignx{
\phi(\Succ_1 k')
&= \Succ_2 (\phi(k')) \qqby{pela def.~$\phi$}\\
&= \Succ_2 k          \qqby{pela escolha de $k'$}
}
ou seja, $\Succ_2 k \in \phi[\Nats_1]$.

\endexercise
%%}}}

%%{{{ x: we_do_not_have_recursion_yet 
\exercise.
\label{we_do_not_have_recursion_yet}%
Qual o erro na prova do~\ref{uniqueness_of_nats}?

\hint
O que é uma função em nosso dicionário,
e quem garanta que escrevendo assim do nada duas equações
sobre um certo objeto $F$, isso realmente defina
uma função?

\solution
Não temos provado que dando equações recursivas como na
prova desse teorema podemos realmente definir uma função.
Fazemos isso no~\ref{recursion_theorem}, assim
realmente botando o $\qedsymbol$ no~\ref{uniqueness_of_nats}.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Recursion theorems 
\section Teoremas de recursão.

%%{{{ thm: recursion_theorem 
\theorem Recursão.
\ii{teorema}[de recursão]%
\label{recursion_theorem}%
Sejam $\cal N = \sset \Nats {\Zero, \Succ}$ um sistema Peano,
$A$ conjunto,
$a \in A$,
e $h: A \to A$.
Então existe única função $F : \Nats \to A$ que satisfaz as equações:
$$
\align
F(\Zero)    &= a \tag{1}\\
F(\Succ n)  &= h(F(n)), \quad\text{para todo $n\in\Nats$}.\tag{2}
\endalign
$$
\sketch.
Nosso plano é
\beginil
\item{(i)} construir o objeto $F$ como conjunto;
\item{(ii)} mostrar que $F : \Nats \to A$;
\item{(iii)} mostrar que $F$ satisfaz as (1)--(2);
\item{(iv)} unicidade.
\endil
\endgraf
(i)
Vamos construir o $F$ \emph{bottom-up}, juntando umas das suas aproximações finitas:
funções parciais $f : \Nats\parto E$ onde a idéia é que elas ``concordam'' com a $F$
desejada onde elas estão definidas.
Nem vamos considerar todas elas: para nossa conveniência queremos apenas aquelas
cujo domínio é algum $\finord n$.
Por exemplo, as primeiras aproximações seriam as seguintes:
$$
\align
f_0 &= \emptyset\\
f_1 &= \bigset{ \tup{0,a} }\\
f_2 &= \bigset{ \tup{0,a}, \tup{1,h(a)} }\\
f_3 &= \bigset{ \tup{0,a}, \tup{1,h(a)}, \tup{2,h(h(a))} },\\
    &\eqvdots
\endalign
$$
Definimos o conjunto $\scr A$ de todas as aproximações aceitáveis:
$$
\scr A \defeq \setst {f \in (\Nats\parto E)} {\text{$f$ é aproximação aceitável}}
$$
onde falta descrever com uma fórmula nossa idéia de ``ser aproximação aceitável''
(\ref{acceptable_approximation}).
(Das aproximações acima a $f_0$ não é aceitável.)
Agora podemos já definir o $F$:
$$
F \defeq \Union {\scr A}.
$$
\endgraf
(ii)
Precisamos mostrar a compatibilidade da $\scr A$ e a totalidade da $F$,
ou seja: que não existem conflitos\ii{função!parcial!conflito}{}
(em outras palavras: que a família de funções parciais
$\scr A$ é compatível\ii{função!parcial!compatibilidade});
e que $\dom F = \Nats$.
Esses são os exercícios~\ref{compatibility_of_scrF}~\&~\ref{totality_of_F}
respectivamente.
\endgraf
(iii)
Precisamos verificar a corretude da $F$, que ela atende sua especificação.
Essa parte deve seguir da definição de ``aproximação aceitável''.
Confirmamos isso no~\ref{correctness_of_F}.
\endgraf
(iv)
Para a unicidade da $F$, precisamos mostrar que se $G : \Nats \to A$ tal que
satisfaz as (1)--(2), então $F = G$.  Isso é o~\ref{uniqueness_of_F}, e com
ele terminamos nossa prova.
\qes
\proof.
A prova completa segue do seu esboço junto com os exercícios:
\refn{acceptable_approximation},
\refn{compatibility_of_scrF},
\refn{totality_of_F},
\refn{correctness_of_F}, e
\refn{uniqueness_of_F}.
\qed
%%}}}

%%{{{ x: acceptable_approximation 
\exercise.
\label{acceptable_approximation}
No contexto do~\ref{recursion_theorem} defina formalmente a afirmação ``$f$ é uma aproximação aceitável''.

\hint
Podemos ``quebrar'' a afirmação nesses partes:
\beginol
\li $f : \Nats \parto A$
\li $\tup{0,a} \in f$
\li Para qualquer $n\in\Nats_{\neq0}$, se $f$ é definida no $n$, então ela também é definida no predecessor de $n$, e o valor dela no $n$ é o correto, ou seja, o valor que ganhamos aplicando a $h$ no valor do predecessor de $n$.
\endol
O único que precisamos formalizar agora é o último.

\endexercise
%%}}}

%%{{{ x: compatibility_of_scrF 
\exercise Compatibilidade.
\label{compatibility_of_scrF}%
No contexto do~\ref{recursion_theorem} mostre que $\scr A$ é compatível.

\endexercise
%%}}}

%%{{{ x: totality_of_F 
\exercise Totalidade da $F$.
\label{totality_of_F}%
No contexto do~\ref{recursion_theorem} mostre que $\dom F = \Nats$.

\hint
Verifique que $\dom F \subseteq \Nats$.
Agora basta provar que $\dom F = \Nats$, usando o princípio da indução.

\endexercise
%%}}}

%%{{{ x: correctness_of_F 
\exercise Corretude da $F$.
\label{correctness_of_F}%
No contexto do~\ref{recursion_theorem} mostre que $F$ atende sua especificação,
ou seja:
$$
\align
F(\Zero)    &= a \tag{1}\\
F(\Succ n)  &= h(F(n)), \quad\text{para todo $n\in\Nats$}.\tag{2}
\endalign
$$

\endexercise
%%}}}

%%{{{ x: uniqueness_of_F 
\exercise Unicidade da $F$.
\label{uniqueness_of_F}%
No contexto do~\ref{recursion_theorem} prove a unicidade da $F$, ou seja:
se $G : \Nats \to A$ tal que
$$
\align
G(\Zero)    &= a \tag{1}\\
G(\Succ n)  &= h(G(n)), \quad\text{para todo $n\in\Nats$}.\tag{2}
\endalign
$$
então $F = G$.
Em outras palavras, as equações (1)--(2)
\emph{determinam} a função no $\Nats$.

\hint
Seja $X \subseteq \Nats$ o conjunto onde $F$ e $G$ ``concordam''.
Mostre que $X = \Nats$ usando o princípio da indução.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Consequences of induction and recursion 
\section Conseqüências de indução e recursão.

\blah.
Na~\refn{Nats_formally} definimos recursivamente operações nos naturais.
Graças ao~\ref{recursion_theorem}, ganhamos todas essas operações em qualquer
sistema Peano.  Vamos lembrar como, e também provar que não importa
\emph{em qual} sistema Peano calculamos: os resultados serão os
correspondentes!

%%{{{ note: Operations and order 
\note Operações e ordem.
Para qualquer sistema Peano $\cal N = \sset \Nats {\Zero, \Succ}$,
definimos as operações de adição e de multiplicação
$$
\xxalignat5
&\text{(a1)}  & n + \Zero   &= n          &&& n \ntimes \Zero   &= \Zero                &&\text{(m1)}\\
&\text{(a2)}  & n + \Succ m &= \Succ(n+m) &&& n \ntimes \Succ m &= (n \ntimes m) + n    &&\text{(m2)}
\endxxalignat
$$
e a relação de ordem no $\Nats$
$$
    n \leq m \defiff (\exists k\in\Nats)[n + k = m].
$$
Sejam dois sistemas Peano
$\cal N_1 = \sset {\Nats_1} {\Zero_1, \Succ_1}$ e 
$\cal N_2 = \sset {\Nats_2} {\Zero_2, \Succ_2}$, e
suas operações de adição $+_1$ e $+_2$, e suas relações de ordem $\leq_1$ e $\leq_2$.
Seja $\phi:\Nats_1\bijto\Nats_2$ o isomorfismo definido pelas
$$
\align
    \phi(\Zero_1)   &= \Zero_2           \tag{$\phi$1}\\
    \phi(\Succ_1 n) &= \Succ_2(\phi(n)). \tag{$\phi$2}
\endalign
$$
%%}}}

%%{{{ property: peano_morphism_respects_addition 
\property.
\label{peano_morphism_respects_addition}%
A $\phi$ respeita a adição, ou seja:
$$
\text{para todo $n,m\in\Nats_1$},\ \ 
\phi(n +_1 m) = \phi(n) +_2 \phi(m)
$$
\proof.
Por indução no $m\in\Nats_1$:
\proofpart{Base ($m \asseq \Zero_1$):}
{\proclaimstyle para todo $n\in\Nats_1$, $\phi(n +_1 \Zero_1) = \phi(n) +_1 \phi(\Zero_1)$.}
Seja $n \in \Nats_1$.
Calculamos:
\alignx{
\phi(n +_1 \Zero_1)
&= \phi(n)                    \qqby{pela (a1)$_1$}  \\
&= \phi(n) +_2 \Zero_2        \qqby{pela (a1)$_2$}  \\
&= \phi(n) +_2 \phi(\Zero_1)  \qqby{pela ($\phi$1)}
}
\proofpart{Passo indutivo:}
Seja $k \in \Nats_1$ tal que
$$
\text{para todo $n \in \Nats_1$, $\phi(n +_1 k) = \phi(n) +_1 \phi(k)$.}\tag{H.I.}
$$
Vamos provar que
$$
\text{\proclaimstyle{para todo $n \in \Nats_1$, $\phi(n +_1 \Succ_1 k) = \phi(n) +_1 \phi(\Succ_1 k)$.}}
$$
Seja $n \in \Nats_1$.
Calculamos:
\alignx{
\phi(n +_1 \Succ_1 k)
&= \phi(\Succ_1(n +_1 k))       \qqby{pela (a1)$_2$}\\
&= \Succ_2(\phi(n +_1 k))       \qqby{pela ($\phi$2)}\\
&= \Succ_2(\phi(n) +_2 \phi(k)) \qqby{pela (H.I.), com $n\asseq n$}\\
&= \phi(n) +_2 \Succ_2\phi(k)   \qqby{pela (a2)$_2$}\\
&= \phi(n) +_2 \phi(\Succ_1 k)  \qqby{pela ($\phi$2)}
}
\qed
%%}}}

%%{{{ x: peano_morphism_respects_multiplication 
\exercise.
\label{peano_morphism_respects_multiplication}%
Mostre que $\phi$ respeita a multiplicação, ou seja:
$$
\text{para todo $n,m\in\Nats_1$},\ \ 
\phi(n \ntimes_1 m) = \phi(n) \ntimes_2 \phi(m).
$$

\hint
Indução no $m\in\Nats_1$.

\endexercise
%%}}}

%%{{{ x: peano_morphism_respects_order 
\exercise.
\label{peano_morphism_respects_order}%
Mostre que $\phi$ \emph{respeita a ordem} também, no sentido de:
$$
\text{para todo $n,m\in\Nats_1$},\ \ 
n\leq_1 m \iff \phi(n)\leq_2 \phi(m).
$$

\hint
Prove as duas direções da \bidir\ separadamente.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Constructing more numbers 
\section Construindo mais números.

\blah.
Tendo construido já os naturais,
vamos construir seus parentes também:
os inteiros, os racionais, os reais, e os complexos.

\TODO Os números inteiros.
\TODOthis{Mostrar a construção dos inteiros.}

{\def\eqrat{\approx}%
\note Os números racionais.
Essa construção é bem interessante---e simples!---pois usa um conceito nosso que
deve ser familiar já: o conjunto quociente.
Queremos identificar o racional $1/2$ com o par $\tup{1,2}$,
mas não podemos identificar o próprio $\rats$ com o $\ints \times \ints_{\neq0}$,
pois $\tup{1,2} \neq \tup{2,4}$ mesmo que $1/2 = 2/4$.
Duas idéias parecem razoáveis: (1) escolher um representante específico para cada
racional, trabalhando assim num subconjunto próprio do $\ints\times\ints_{\neq0}$;
(2) definir a relação $\eqrat$ de \emph{equivalência} no $\ints\times\ints_{\neq0}$,
e representar os racionais \emph{não como} membros desse conjunto,
mas \emph{sim como} classes de equivalência, ou seja, membros do conjunto quociente
$\quoset {\ints\times\ints_{\neq0}} {\eqrat}$.
Vamos seguir essa segunda ideia, pois é mais símples e elegante.

%%{{{ df: eqrat
\definition Números racionais.
Seja $Q = \ints\times\ints_{\neq0}$.
Defina no $Q$ a relação $\eqrat$ pela
$$
\tup{a,b} \eqrat \tup{c,d}
\defiff
ad = bc.
$$
Sendo uma relação de equivalência (\ref{eqrat_is_an_eqrel}),
defina
$$
\Rats
\defeq
\quoset Q {\eqrat}.
$$
%%}}}

%%{{{ x: eqrat_is_an_eqrel 
\exercise.
\label{eqrat_is_an_eqrel}%
Mostre que $\eqrat$ é uma relação de equivalência.

\endexercise
%%}}}

%%{{{ x: addition_multiplication_of_Rats 
\exercise.
\label{addition_multiplication_of_Rats}%
Defina formalmente a adição e multiplicação no $\Rats$.

\endexercise
%%}}}

\TODOthis{Mostrar a construção dos racionais.}
}

\note Os números reais (Dedekind cuts).
\TODOthis{Mostrar a construção dos reais como Dedekind cuts.}
Uma abordagem alternativa é mostrada no~\ref{construct_reals_as_cauchy}.

%%{{{ x: construct_complex 
\exercise.
\label{construct_complex}%
Mostre como representar os complexos.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Problems intermission 
\problems Intervalo de problemas.

%%{{{ prob: multiset_formally_defined 
\problem Multisets.
\label{multiset_formally_defined}%
\ii{multiset}%
Alguém te deu a seguinte especificação de multiset
e tu queres implementá-la dentro da teoria de conjuntos.
(Veja também \ref{Multisets} no \ref{Sets}.)
\endgraf
\noindent
{\bf ``Definição''.}
Lembre (\ref{multiset}) que um \dterm{multiset} (ou \dterm{bag}) $M$ é como um conjunto
onde um elemento pode pertencer no $M$ mais que
uma vez (mas não uma infinidade de vezes).
Ou seja, a ordem não importa (como nos conjuntos),
mas a ``multiplicidade'' importa sim.
\endgraf
Queremos tres operações em multisets, exemplificadas assim:
$$
\align
    \bag{ x, y, y, z, z, z, w } \bagunion
    \bag{ x, y, z, z, u, v, v } &=
    \bag{ x, y, y, z, z, z, u, v, v, w }\\
    \bag{ x, y, y, z, z, z, w } \baginter
    \bag{ x, y, z, z, u, v, v } &=
    \bag{ x, y, z, z }\\
    \bag{ x, y, y, z, z, z, w } \bagplus
    \bag{ x, y, z, z, u, v, v } &=
    \bag{ x, x, y, y, y, z, z, z, z, z, u, v, v, w }
\endalign
$$
Também queremos um predicado de ``pertencer'' $\inbag$
e uma relação de ``submultiset'' $\subbag$ tais que:
$$
\xalignat2
x&{}\inbag \bag{ x, y, y, z, z, z, w }           &\bag{ x, y, z, z }&{}\subbag    \bag{ x, x, y, y, z, z }            \\
z&{}\inbag \bag{ x, y, y, z, z, z, w }           &\bag{ x, y, z, z }&{}\notsubbag \bag{ x, x, y, y, z }               \\
u&{}\notinbag \bag{ x, y, y, z, z, z, w }        &\bag{ x, y, z, z }&{}\subbag    \bag{ x, y, z, z }                  \\
x&{}\notinbag \emptybag \quad\text{para todo $x$}&M                 &{}\subbag    M \quad\text{para todo multiset $M$}\\
 &                                               &\emptybag         &{}\subbag    M \quad\text{para todo multiset $M$}. 
\endxalignat
$$
(MS1) Para os multisets $A$ e $B$ temos $A = B$ sse eles tem os mesmos membro
com as mesmas multiplicidades.
Por exemplo,
$$
\bag{x, y, z, z, y} = \bag{x, y, y, z, z} \neq \bag{x,y,z}.
$$
(MS2) Para cada conjunto $A$, a classe
$$
\classt M {$M$ é multiset e $\forall x(x \inbag M \limplies x \in A)$}
$$
de todos os multisets formados por membros de $A$ é um conjunto.
\item{(i)}
Defina formalmente (em teoria de conjuntos) o termo ``multiset'' e mostre
(como exemplos) como são representados os multisets seguintes:
$$
\emptybag
\qqqquad
\bag{0, 1, 2, 2, 1}
\qqqquad
\bag{1, 2, 2, 3, 3, 3, 4, 4, 4, 4, \dotsc }.
$$
\item{(ii)}
Defina as operações de multisets ($\bagunion, \baginter, \bagplus$)
e os predicados ($\inbag$, $\subbag$).
\item{(iii)}
Prove pelos axiomas ZF que tua definição satisfaz as (MS1)--(MS2).

\hint
Para representar a multiplicidade, use uma função com codomínio o $\nats_{>0}$.

\solution
(i)
Um \dterm{multiset} é uma tupla $\cal M = \tup{ M ; f }$
onde $M$ é um conjunto e $f : M \to \nats_{>0}$.
$$
\align
\emptybag                       &= \tup{ \emptyset ; \emptyset }\\
\bag{0, 1, 2, 2, 1}             &= \tup{ \set{0,1,2} ; f }\\
\bag{1, 2, 2, 3, 3, 3, \dotsc}  &= \tup{ \nats_{>0} ; \idof {\nats_{>0}} }\\
\endalign
$$
onde $f : \set{0,1,2} \to \nats_{>0}$ é a função definida pela
$$
f(n) = \knuthcases{
    1,  &se $n = 0$\cr
    2,  &se $n = 1$\cr
    2,  &se $n = 2$.
}
$$
\endgraf
(ii)
$$
\align
\tup{A;\alpha} \bagunion \tup{B;\beta}&\defeq\tup{A\union B \;;\; \lambda x. \max\set{\alpha(x),\beta(x)}}\\
\tup{A;\alpha} \baginter \tup{B;\beta}&\defeq\tup{A\inter B \;;\; \lambda x. \max\set{\alpha(x),\beta(x)}}\\
\tup{A;\alpha} \bagplus  \tup{B;\beta}&\defeq\tup{A\union B \;;\; \lambda x. (\alpha(x) + \beta(x))}\\
x \inbag \tup{A;\alpha} &\defiff x \in A\\
\tup{A;\alpha} \subbag \tup{B;\beta} &\defiff A\subseteq B \mland (\forall x \in A)[ \alpha(x) \leq \beta(x)]
\endalign
$$
\endgraf
(iii)
A (MS1) é obviamente satisfeita graças à nossa definição de múltiset como tupla
de conjunto e função: ganhamos assim a (MS1) pelas definições de $=$ nos três
tipos involvidos: conjunto; tupla; função.
Vamos verificar a (MS2).
Seja $A$ conjunto.
O arbitrário multiset $\cal M$ com membros de $A$ tem a forma
$\cal M = \tup{X , f}$ para algum $X\subseteq A$ e $f : X \to\nats_{>0}$.
Então $\cal M \in \pset A \times (A \parto \nats_{>0})$ e construimos o conjunto
de todos os multisets com membros de $A$ usando o ZF4:
$$
\namedop{Multisets}(A) \defeq
    \set{
        \cal M\in \pset A \times (A \parto \nats_{>0})
        \st
        \text{$\cal M$ é um multiset}.
    }
$$
Para mostrar que o $\pset A \times (A \parto \nats\setminus\set{0})$ é um conjunto,
precisamos os operadores $\pset$, $\times$, $\parto$, $\setminus$, e o próprio $\nats$, que já temos construido pelos ZF1--ZF7.

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ More axioms 
\section Mais axiomas.

%%{{{ Credits 
\note Créditos.
\label{fol_filter_by_fraenkel_and_skolem}
Todos os axiomas que temos visto até agora são essencialmente os axiomas
de Zermelo\Zermelo{}, e falta apenas um dos seus axiomas originais
(o axioma da escolha que encontramos na~\refn{Axioms_of_choice}).
Sobre o axioma Separation~(\axref{separation}), Zermelo usou o termo
``propriedade definitiva'', que temos usado também sobre o ``filtro'',
mas foram \Fraenkel{}Fraenkel~e~\Skolem{}Skolem que consideraram definir isso
como uma fórmula da linguagem da FOL com $=$ e $\in$.
%%}}}

%%{{{ A letter from Fraenkel to Zermelo 
\note Uma carta de Fraenkel para Zermelo.
\Fraenkel{}Fraenkel percebeu (e comunicou no 1921 para Zermelo) que
com os seus axiomas não é possível provar a existência duns certos
conjuntos interessantes, como por exemplo o
$$
\bigset{
\Nats, \pset\Nats, \pset\pset\Nats, \pset\pset\pset\Nats, \dotsc
}.
$$
Sim, podemos construir cada um dos seus elementos, mas não a
colecção deles como conjunto!
%%}}}

%%{{{ ax: replacement 
\axiom Replacement (schema).
\tdefined{axioma}[Replacement (schema)]%
\label{replacement}%
{\rm Para cada função-classe $\Phi(\dhole)$, o seguinte:}
Para todo conjunto $a$, a classe
$
\classimg \Phi a \defeq \class {\Phi(x)} {x \in a}
$
é um conjunto.
$$
\forall a
\exists b
\forall y
\bigparen{
    y \in b
    \liff
    \lexists {x \in a} {\Phi(x) = y}
}
\axtaglabel{ZF8}{replacement}
$$
%%}}}

%%{{{ x: powersingleton_without_powerset 
\exercise.
\label{powersingleton_without_powerset}%
Resolve o~\ref{powersingleton} sem usar o~Powerset~(\axref{powerset}).

\hint
Qual operador $\Phi(\dhole)$ tu podes definir para o aplicar no $a$?

\solution
Definimos o operador $\Phi(\dhole)$ assim:
$$
\Phi(x) \defeq \set x.
$$
Facilmente, pelo Replacement~(\axref{replacement}) aplicado no $a$ com
esse $\Phi$ temos que
$\classimg \Phi a$
é um conjunto: o conjunto que procuramos!

\endexercise
%%}}}

%%{{{ A mortal game 
\note Um jogo mortal.
Teu oponente escolha um conjunto (e ele não participa mais no jogo):
esse é o ``conjunto da mesa''.
Em cada rodada do jogo tu tem que escolher um dos membros do conjunto da mesa,
e ele se vira o novo conjunto da mesa.
O objetivo é simples: \emph{continuar jogando pra sempre}.
(Imagine que se o jogo acabar, tu morre---e que tu queres viver---ou algo desse tipo.)
Então uma partida onde o oponente escolheu o conjunto
$$
\set{ \emptyset, \fsset{\emptyset}, \fsset{\emptyset, \fsset{\emptyset}},
\set{ \emptyset, \fsset{\emptyset}, \fsset{\emptyset, \fsset{\emptyset}}}}
$$
seria a seguinte
(sublinhamos as escolhas do jogador onde possível):
$$
\matrix
\format
\c\quad & \c\quad & \c \\
\text{Rodada} & \text{Conjunto} & \text{Movimento}\\
1 & \bigset{ \emptyset, \ \fsset{\emptyset}, \ \underline{\fsset{\emptyset, \fsset{\emptyset}}}, \ \fsset{ \emptyset, \fsset{\emptyset}, \fsset{\emptyset, \fsset{\emptyset}} } } & \fsset{\emptyset, \fsset{\emptyset}}\\
2 & \bigset{\emptyset, \underline{\fsset{\emptyset}}} & \fsset{\emptyset} \\
3 & \bigset{\underline{\emptyset}} & \emptyset\\
4 & \emptyset & \boohoo
\endmatrix
$$
Talvez esse jogador não foi o mais esperto, mas facilmente confirmamos
que qualquer possível estratégia dele é condenada com morte certa depois
dum finito número de rodadas.
\emph{E se o proprio jogador começa escolhendo qual é o conjunto da mesa inicial?}
Qual conjunto tu escolheria?
Pode \emph{imaginar} algum conjunto que seria uma boa opção que porderia garantir
vitória?
\spoiler.
%%}}}

%%{{{ x: how_to_win_the_wf_game 
\exercise.
\label{how_to_win_the_wf_game}%
Considere os conjuntos da mesa seguintes:
\beginil
\item{(1)} o conjunto $x$, onde
$$
x = \bigset{ \emptyset, \ \Nats, \ \set{ \emptyset, \set{\set{\emptyset}}}, \ x };
$$
\item{(2)} o conjunto $a$, onde
$$
\xalignat3
a &= \bigset{ \emptyset, \ b } &
b &= \bigset{ \set{\emptyset}, \ c } &
c &= \bigset{ \set{\emptyset}, \ \set{ \set{a}, \set{\set{\set{\emptyset}}}}};
\endxalignat
$$
\item{(3)} o conjunto $\Omega$, onde
$$
\Omega = \bigset{ \Omega }.
$$
\endil
\noindent
Como tu jogaria nesses jogos?

\endexercise
%%}}}

%%{{{ Can we win? 
\note Podemos ganhar?.
Talvez.  Nossos axiomas não garantam a existência de nenhum conjunto
que nos permitaria ganhar; no outro lado, nem garantam a ausência de
conjuntos como os $x,a,b,c$ do~\ref{how_to_win_the_wf_game}.
O axioma seguinte resolve essa questão, afirmando que qualquer partida
desse jogo seria realmente mortal.
%%}}}

%%{{{ ax: foundation 
\axiom Foundation.
\tdefined{axioma}[Foundation]%
\label{foundation}%
Todo conjunto não vazio tem membro disjunto com ele mesmo.
$$
\pforall {a\neq\emptyset}
\lexists {z \in a} {z\inter a = \emptyset}
\axtaglabel{ZF9}{foundation}
$$
%%}}}

\blah.
Vamos agora pesquisar umas conseqüências desse axioma, também conhecido como
\dterm{Regularity}\iisee{axioma}[Regularity]{Foundation}.

%%{{{ x: x_notin_x 
\exercise.
\label{x_notin_x}%
Prove diretamente que para todo conjunto $x$, $x\notin x$.
Quais axiomas tu precisou?

\hint
Seja $x$ conjunto.
Não podemos aplicar o~\refn{foundation} diretamente no $x$,
pois talvez $x = \emptyset$.
Uma abordagem seria separar casos.
Ao inves disso, aplique o~\refn{foundation} no conjunto $\set x$.

\endexercise
%%}}}

%%{{{ cor: univ_not_in_univ 
\corollary.
\label{unit_not_in_univ}
$\Univ\notin\Univ$, ou seja, $\Univ$ não é um conjunto.
%%}}}

%%{{{ x: x_y_cannot_belong_to_each_other 
\exercise.
\label{x_y_cannot_belong_to_each_other}%
Prove que é impossível para dois conjuntos $x,y$ ter
$x \in y$ e também $y \in x$.

\endexercise
%%}}}

%%{{{ x: no_infinite_in_descending_chain_of_sets 
\exercise.
\label{no_infinite_in_descending_chain_of_sets}%
Prove que não existe seqüência infinita de conjuntos
$$
x_0 \ni x_1 \ni x_2 \ni x_3 \ni \dotsb
$$
e mostre que assim ganhamos os
exercícios~\refn{x_notin_x}~\&~\refn{x_y_cannot_belong_to_each_other}
como corolários.

\endexercise
%%}}}

%%{{{ x: bad_pair_becomes_good_pair 
\exercise.
\label{bad_pair_becomes_good_pair}%
Prove que com o axioma Foundation podemos sim usar a operação
do~\ref{bad_pair}
$$
\tup{x,y} \defeq \bigset{ x, \set{x, y} }
$$
como uma implementação de par ordenado.

\endexercise
%%}}}

\endsection
%%}}}

%%{{{ Axioms of choice 
\section Axiomas de escolha.
\label{Axioms_of_choice}%

\blah.
Finalmente encontramos aqui o último axioma de Zermelo,
o mais infame, seu \emph{axioma de escolha}.
Mas, primeiramente, umas definições.

%%{{{ df: choice_set 
\definition Conjunto-escolha.
\label{choice_set}%
\tdefined{conjunto-escolha}%
Seja $\scr A$ uma familia de conjuntos.
Chamamos o $E$ um \dterm{conjunto-escolha} da $\scr A$ sse
(1) $E \subseteq \union \scr A$, e
(2) para todo $A \in \scr A$, a intersecção $E \inter A$ é um singleton.
%%}}}

%%{{{ eg: choice_sets 
\example.
\label{choice_sets}%
Aqui umas famílias de conjuntos e um exemplo de conjunto-escolha para cada uma:
$$
\xalignat2
\scr A_1 &= \set{ [0,2], [1,4], [3,5] }
&&{\set{ 0, \,5/2, \,5 }}\\
\scr A_2 &= \set{ \set{a,b}, \set{b,c}, \set{d} }
&&{\set{a,c,d}}\\
\scr A_3 &= \set{ \set{a,b}, \set{b,c}, \set{c,a} }
&&\text{não tem conjunto-escolha}\\
\scr A_4 &= \set{ \emptyset, \set{\emptyset}, \set{\set{\emptyset}}, \set{\set{\set{\emptyset}}}, \set{\set{\set{\set{\emptyset}}}}, \dots }
&&\text{não tem conjunto-escolha}\\
\scr A_5 &= \set{            \set{\emptyset}, \set{\set{\emptyset}}, \set{\set{\set{\emptyset}}}, \set{\set{\set{\set{\emptyset}}}}, \dots }
&&\scr A_4\\
\scr A_6 &= \set{ \finord 1, \finord 2, \finord 3, \dotsc }
&&\text{não tem conjunto-escolha}
\endxalignat
$$
\endexample
%%}}}

%%{{{ df: choice_function 
\definition Função-escolha.
\label{choice_function}%
\tdefined{função-escolha}[de conjunto]%
\tdefined{função-escolha}[de família]%
Seja $A$ conjunto.
Chamamos a $\varepsilon : \pset A \setminus \set{\emptyset} \to A$
uma \dterm{função-escolha do conjunto} $A$ sse $\varepsilon(X) \in X$ para todo $X\in\dom\varepsilon$.
\endgraf
Seja $\scr A$ família de conjuntos.
Chamamos a $\varepsilon : \scr A \to \union \scr A$ uma
\dterm{função-escolha da família de conjuntos} $\scr A$ sse
$\varepsilon(A) \in A$ para todo $A\in \scr A$.
%%}}}

%%{{{ ax: choice_ac 
\axiom Choice (AC).
\tdefined{axioma}[Choice (AC)]%
\label{choice_ac}%
Seja $\scr A$ família de conjuntos não vazios.
Então
$$
\gathered
\text{
existe
$\varepsilon : \scr A \to \Union \scr A$,
tal que
}\\
\text{
para todo $A\in\scr A$,
$\varepsilon(A) \in A$.
}
\endgathered
\axtaglabel{AC}{ac}
$$
%%}}}

%%{{{ ax: choice_ac_disjoint 
\axiom Choice (forma disjunta).
\label{choice_ac_disjoint}%
Seja $\scr D$ família disjunta de conjuntos não vazios.
Então
$$
\gathered
\text{
existe
$\varepsilon : \scr D \to \Union \scr D$,
tal que
}\\
\text{
para todo $D\in\scr D$,
$\varepsilon(D) \in D$.
}
\endgathered
\axtaglabel{ACdis}{acdisj}
$$
%%}}}

%%{{{ ax: choice_ac_pset 
\axiom Choice (forma powerset).
\label{choice_ac_powerset}%
Seja $M$ conjunto não vazio.
Então
$$
\gathered
\text{
existe
$\varepsilon : \pset M\setminus\set{\emptyset} \to M$,
tal que
}\\
\text{
para todo
$\emptyset\neq A\subseteq M$,
$\varepsilon(A) \in A$.
}
\endgathered
\axtaglabel{AC$\pset$}{acpset}
$$
%%}}}

%%{{{ x: first_ac_equivalences 
\exercise.
\label{first_ac_equivalences}
Todas as ``formas'' do axioma de escolha (AC) que vimos até agora
são logicamente equivalentes.
Prove isso seguindo o ``round-robin'' seguinte:
$$
\axref{ac}
\implies \axref{acdisj}
\implies \axref{acpset}
\implies \axref{ac}.
$$

\endexercise
%%}}}

\blah.
Depois vamos encontrar mais teoremas (assumindo o \axref{ac}),
que na verdade são equivalentes com ele.

\endsection
%%}}}

%%{{{ Desired and controversial consequences 
\section Conseqüências desejáveis e controversiais.

%%{{{ thm: banach_tarski 
\theorem Banach--Tarski.
\label{banach_tarski}%
\Banach{}\Tarski{}%
\ii{teorema}[Banach--Tarski]%
Podemos decompor a bola sólida unária
$$
B = \set{\tup{x,y,z} \in \reals^3 \st x^2 + y^2 + z^2 \leq 1}
$$
em $5$ subconjuntos
$S_1, S_2, S_3, S_4, S_5 \subseteq S$,
rodar e transladar eles, criando duas cópias sólidas de $B$.
%%}}}

%%{{{ thm: wellordering_thm 
\theorem Bem-ordenação (Zermelo).
\label{wellordering_thm}%
\ii{teorema}[da bem-ordenação]
Todo conjunto $A$ pode ser bem ordenado.
%%}}}

%%{{{ thm: cardinal_comparability_thm 
\theorem Comparabilidade de cardinais.
\label{cardinal_comparability_thm}%
Para todos conjuntos $A,B$, temos $A\leqc B$ ou $B \leqc A$.
%%}}}

\endsection
%%}}}

%%{{{ Weaker choices 
\section Escolhas mais fracas.

\endsection
%%}}}

%%{{{ Other set theories 
\section Outras teorias de conjuntos.

\endsection
%%}}}

%%{{{ Other foundations 
\section Outras fundações.

\endsection
%%}}}

%%{{{ Problems 
\problems.

%%{{{ three_classes_are_sets_problem 
\problem.
\label{three_classes_are_sets_problem}%
Seja $a$ conjunto.
\emph{Sem usar} o Separation~(\axref{separation}),
mostre pelo resto dos axiomas que as classes seguintes são conjuntos:
$$
\xalignat3
    E &= \setlst {\set{x, \Union x,\pset x}} {x\in a} ;&
    F &= \setlst x {x\subsetneq a}                    ;&
    G &= \setst  x {x\neq\emptyset \land x = \Inter x}.
\endxalignat
$$

\endproblem
%%}}}

%%{{{ replacement_replaces_separation 
\problem Replacement is the new Separation---or is it?.
\label{replacement_replaces_separation}%
Podemos tirar o Separation scheme~(\axref{separation})
dos nossos axiomas ``sem perder nada'', se temos o
Replacement scheme~(\axref{replacement}) no lugar dele?

\hint
Tente achar uma class-function $\Phi$ tal que aplicada
nos elementos dum conjunto $A$, vai ``identificar'' todos
aqueles que \emph{não} tem a propriedade $\phi(\dhole)$,
mas mesmo assim sendo injetora quando restrita naqueles
que satisfazem a.

\hint
Alem de tudo isso, os ``originais'' $a\in A$ tem que ser
recuperáveis pelas suas imagens atraves da $\Phi$.

\solution
Seja $A$ conjunto e $\phi(x)$ fórmula.
Definimos a class-function
$$
\Phi(x) =
\knuthcases{
    \set {x},   &se $\phi(x)$\cr
    \emptyset,  &se não.
}
$$
Agora aplicamos o Replacement com essa class-function no conjunto $A$,
ganhando assim como conjunto o $\classimg\Phi A$, cujos elementos são exatamente os
\emph{singletons} $\set{a}$ de todos os $a\in A$ que satisfazem a $\phi(a)$,
e o $\emptyset$.
Usando o ZF6 chegamos no $\Union \classimg\Phi A$ que realmente é o desejado
conjunto
$\set { a \in A \st \phi(a) }$.

\endproblem
%%}}}

%%{{{ replacement_replaces_pairset 
\problem Replacement is the new Pairset---or is it?.
\label{replacement_replaces_pairset}%
Podemos tirar o Pairset~(\axref{pairset}) dos
nossos axiomas ``sem perder nada'', se temos o
Replacement scheme~(\axref{replacement}) no lugar dele?

\hint
Podemos sim.
Dados \emph{objetos} $a,b$, mostre que existe o conjunto
$\set{a,b}$ que consiste em exatamente esses objetos.

\hint
Tente achar uma class-function $\Phi$ tal que aplicada
nos elementos dum conjunto suficientemente grande,
vai ter como imagem o desejado $\set{a,b}$.

\solution
Sejam $a,b$ objetos.
Considere a class-function
$$
\Phi (x) \asseq 
\knuthcases{
    a, &se $x=\emptyset$\cr
    b, &se $x\neq\emptyset$.
}
$$
Agora precisamos apenas construir um conjunto $S$ tal que:
$\emptyset \in S$, e $|S| \geq 2$.
Pelo Emptyset, temos o $\emptyset$.
Pelo Powerset aplicado no $\emptyset$ ganhamos o $\set{\emptyset}$, e aplicando mais uma vez o Powerset chegamos no $\set{\emptyset, \set{\emptyset}}$.
Usando o Replacement com a $\Phi(x)$ nesse conjunto, construimos o desejado $\set{a,b}$.
\endgraf
Em forma de arvore:
$$
\centerAlignProof
\AxiomC{}
\RightLabel{Empty}
\UnaryInfC{$\emptyset$}
\RightLabel{Power}
\UnaryInfC{$\set{\emptyset}$}
\RightLabel{Power}
\UnaryInfC{$\set{\emptyset, \set{\emptyset}}$}
\RightLabel{Repl; $\Phi$}
\UnaryInfC{$\set{a, b}$}
\DisplayProof{}
$$

\endproblem
%%}}}

%%{{{ choice_rel_problem 
\problem.
\label{choice_rel_problem}%
Mostre que o Choice~\axref{ac} é equivalente com o seguinte axioma:
\endgraf
\noindent
{\bf Choice (Rel).}
{\proclaimstyle
Se uma relação $R \in \relspace A B$ tem a propriedade de totalidade,
então existe função $f : A\to B$ com $x \mathrel{R} f(x)$ para todo $x\in A$.
}
$$
\bigparen{
R \in \relspace A B
\land
\dom R = A
}
\limplies
\bigparen{
\pexists {f : A \to B}
\lforall {x\in A} {x \mathrel R f(x)}
}
\axtaglabel{ACrel}{acrel}
$$

\endproblem
%%}}}

%%{{{ prob: construct_reals_as_cauchy 
\problem Reais como seqüências Cauchy.
\label{construct_reals_as_cauchy}%
\TODOthis{Enunciar o problema.}

\endproblem
%%}}}

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{fromfregetogodel},
\cite{halmosnaive},
\cite{ynmnst},
\cite{kunenfoundations}.
\cite{kunen2011},
\cite{cohensetch},
\cite{kunen1980},
\cite{jechset}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Well-orderings and transfinite induction 
\chapter Bem-ordens e indução transfinita.
\label{Wellorderings_and_transfinite_induction}%

%%{{{ intro 
\chapintro
O termo \emph{wellorder} (ou \emph{well-order}) de inglês tem sido traduzido
como \emph{boa ordem} em português.  Aqui eu uso o termo \emph{bem-ordem}.
Além de ficar mais perto no termo internacional, a palavra ``bem'' tem
um significado \emph{bem} mais usado em português do que em inglês,
onde não é muito \emph{well} known, exemplificado aqui:%
\footnote{e com certeza \emph{well} beyond nossos interesses aqui}
\endgraf\smallskip
Uma ordem é uma relação legal.\endgraf
Uma \emph{bem}-ordem é uma relação \emph{bem}~legal---vamos descobrir isso neste capítulo.
%%}}}

%%{{{ df: woset 
\definition Bem-ordem.
\label{woset}%
\tdefined{woset}%
\iisee{conjunto}[bem-ordenado]{woset}%
Seja $\sset A <$ um conjunto totalmente ordenado.
Sua ordem $<$ é uma \dterm{bem-ordem}, sse
\emph{cada subconjunto $S\subseteq A$ possui um elemento mínimo}.
Nesse caso chamamos o $A$ \dterm{bem-ordenado} ou \dterm{woset}
(de \dterm{well-ordered set}).
%%}}}

%%{{{ Transfinite induction 
\section Indução transfinita.

\endsection
%%}}}

%%{{{ Transfinite recursion 
\section Recursão transfinita.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{goldreisets},
\cite{ynmnst}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Ordinal arithmetic 
\chapter Aritmética ordinal.

%%{{{ x: omegaomega_plus_one_is_well_ordered 
\exercise.
\label{omegaomega_plus_one_is_well_ordered}%
O $\omega^2+1$ é bem ordenado.

\hint
Lembre-se que usamos a ordem (anti)lexicográfica nos produtos.
Tome $A$ tal que $\emptyset\neq A \subseteq \omega^2 + 1$ e ache se u mínimo.
Separe casos dependendo se $A=\set{\top}$ ou não,
onde $\top$ o máximo elemento do $\omega^2+1$.

\solution
Seja $A\subseteq \omega^2 + 1$ com $A\neq\emptyset$.
Temos a seguinte ordem no $\omega^2 + 1$:
$$
\munderbrace{
 \munderbrace{\tup{0,0} < \tup{1,0} < \tup{2,0} < \dotsb}{\dsize\omega} 
 <
 \munderbrace{\tup{0,1} < \tup{1,1} < \tup{2,1} < \dotsb}{\dsize\omega} 
 <
 \dotsb
}{\dsize\omega^2}
<
\set\top.
$$
\case{Caso $A = \set {\top}$}:
$\min A = \top$.
\endgraf
\case{Caso $A \neq \set {\top}$}:
Como $A\neq \emptyset$, concluimos que $A\inter \omega^2 \neq \emptyset$.
Sejam:
$$
\align
y_0 &\asseq \min\set{ y\in\nats \st \lexists {x\in\nats}{\tup{x,y}\in A}}\\
x_0 &\asseq \min\set{ x\in\nats \st \tup{x,y_0}\in A}
\endalign
$$
onde os dois mínima existem graças ao PBO dos naturais.
Facilmente, $\min A = \tup{x_0,y_0}$.

\endexercise
%%}}}

%%{{{ x: solving_for_ordinals 
\exercise.
\label{solving_for_ordinals}%
O que podes concluir sobre os ordinais $\alpha$ e $\beta$ se\dots:
$$
\xxalignat3
\text{(i)}~&\omega + \alpha = \omega & \text{(iii)}~& \omega \cdot \alpha = \omega & \text{(v)}~& \alpha +     \beta = \omega\\
\text{(ii)}~&\alpha + \omega = \omega & \text{(iv)}~& \alpha \cdot \omega = \omega & \text{(vi)}~& \alpha \cdot \beta = \omega
\endxxalignat
$$

\solution
\item{(i)}   $\alpha = 0$
\item{(ii)}  $\alpha$ é finito
\item{(iii)} $\alpha=1$
\item{(iv)}  $\alpha$ finíto \& $\alpha\neq 0$
\item{(v)}   $\text{ou}\,\left\{\aligned&\text{$\alpha$ finíto      \& $\beta=\omega$}\\&\text{$\alpha=\omega$ \& $\beta=0$}\endaligned\right.$
\item{(vi)}  $\text{ou}\,\left\{\aligned&\text{$1\leq\alpha<\omega$ \& $\beta=\omega$}\\&\text{$\alpha=\omega$ \& $\beta=1$}\endaligned\right.$

\endexercise
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{goldreisets},
\cite{ynmnst},
\cite{kunen2011}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Denotational semantics 
\chapter Semântica denotacional.

%TODO: Check http://pages.cs.wisc.edu/~horwitz/CS704-NOTES/
%TODO: use Stoy and Tennent

%%{{{ A language of binary numerals 
\section Uma linguagem de numerais binários.

\endsection
%%}}}

%%{{{ A little programming language 
\section Uma pequena linguagem de programação.

\endsection
%%}}}

%%{{{ Domain theory 
\section Teoria de domínios.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{stoysemantics},
\cite{tennent1976},
\cite{tennentsemantics}.

\cite{streicherdomainsfp}.

\cite{lpbook}.

\cite{winskelsemantics},
\cite{guntersemantics}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Universal algebra 
\chapter Álgebra universal.
\label{Universal_algebra}%

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Category theory 
\chapter Teoria das categorias.
\label{Category_theory}%

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{babylawvere},
\cite{arbibmanesarrows},
\cite{papalawvere}.

\cite{goldblatttopoi}.

\cite{awodeycats},
\cite{barrwellscatscs},
\cite{joyofcats},
\cite{borceuxhandbook1}.

\cite{riehlcats},
\cite{maclanecats}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Intuitionistic logic 
\chapter Lógica intuicionista.
\label{Intuitionistic_logic}%

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{heytingintuitionism}.
\cite{dummettintuitionism}.
\cite{proofsandtypes}.
\cite{lecturesch}.
\cite{bishopfca}~\&~\cite{bishopbridgesconstructive}.
\cite{girardblindspot}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Proof theory 
\chapter Teoria de provas.
\label{Proof_theory}%

%%{{{ Systems à la Hilbert 
\section Sistemas à la Hilbert.

\endsection
%%}}}

%%{{{ Dedução natural 
\section Natural deduction.

\endsection
%%}}}

%%{{{ Sequent calculus 
\section Sequent calculus.

\endsection
%%}}}

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{vonplatoelements},
\cite{bimboproof},
\cite{negrivonplatospt},
\cite{takeuti},
\cite{prawitz},
\cite{proofsandtypes},
\cite{olthdem},
\cite{kleeneIM}.
\cite{lecturesch}.
\cite{girardblindspot}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Linear logic 
\chapter Lógica linear.
\label{Linear_logic}%

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{girardllss}.
\cite{girardblindspot}.

\endfurther
%%}}}

\endchapter
%%}}}

%%{{{ chapter: Type theory 
\chapter Teoria dos tipos.
\label{Type_theory}%

%%{{{ Problems 
\problems.

\endproblems
%%}}}

%%{{{ Further reading 
\further.

\cite{nederpeltgeuvers},
\cite{piercetapl}.
\cite{hott}.

\endfurther
%%}}}

\endchapter
%%}}}

